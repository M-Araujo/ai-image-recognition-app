var wB=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var dbt=wB((pbt,oD)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function $v(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return n=>n in t}const hn={},Gu=[],ga=()=>{},CB=()=>!1,Sp=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Bv=e=>e.startsWith("onUpdate:"),pr=Object.assign,Lv=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},SB=Object.prototype.hasOwnProperty,Ye=(e,t)=>SB.call(e,t),ye=Array.isArray,qu=e=>_p(e)==="[object Map]",t_=e=>_p(e)==="[object Set]",Se=e=>typeof e=="function",Nn=e=>typeof e=="string",Qa=e=>typeof e=="symbol",En=e=>e!==null&&typeof e=="object",e_=e=>(En(e)||Se(e))&&Se(e.then)&&Se(e.catch),n_=Object.prototype.toString,_p=e=>n_.call(e),_B=e=>_p(e).slice(8,-1),r_=e=>_p(e)==="[object Object]",Wv=e=>Nn(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,bl=$v(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ep=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},EB=/-(\w)/g,Po=Ep(e=>e.replace(EB,(t,n)=>n?n.toUpperCase():"")),kB=/\B([A-Z])/g,Xi=Ep(e=>e.replace(kB,"-$1").toLowerCase()),kp=Ep(e=>e.charAt(0).toUpperCase()+e.slice(1)),Ym=Ep(e=>e?`on${kp(e)}`:""),Ui=(e,t)=>!Object.is(e,t),Qm=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},o_=(e,t,n,r=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:r,value:n})},RB=e=>{const t=parseFloat(e);return isNaN(t)?e:t},TB=e=>{const t=Nn(e)?Number(e):NaN;return isNaN(t)?e:t};let y2;const Rp=()=>y2||(y2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Tp(e){if(ye(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],o=Nn(r)?NB(r):Tp(r);if(o)for(const i in o)t[i]=o[i]}return t}else if(Nn(e)||En(e))return e}const DB=/;(?![^(]*\))/g,AB=/:([^]+)/,IB=/\/\*[^]*?\*\//g;function NB(e){const t={};return e.replace(IB,"").split(DB).forEach(n=>{if(n){const r=n.split(AB);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t}function no(e){let t="";if(Nn(e))t=e;else if(ye(e))for(let n=0;n<e.length;n++){const r=no(e[n]);r&&(t+=r+" ")}else if(En(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}function PB(e){if(!e)return null;let{class:t,style:n}=e;return t&&!Nn(t)&&(e.class=no(t)),n&&(e.style=Tp(n)),e}const MB="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",OB=$v(MB);function a_(e){return!!e||e===""}const i_=e=>!!(e&&e.__v_isRef===!0),va=e=>Nn(e)?e:e==null?"":ye(e)||En(e)&&(e.toString===n_||!Se(e.toString))?i_(e)?va(e.value):JSON.stringify(e,s_,2):String(e),s_=(e,t)=>i_(t)?s_(e,t.value):qu(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[r,o],i)=>(n[Jm(r,i)+" =>"]=o,n),{})}:t_(t)?{[`Set(${t.size})`]:[...t.values()].map(n=>Jm(n))}:Qa(t)?Jm(t):En(t)&&!ye(t)&&!r_(t)?String(t):t,Jm=(e,t="")=>{var n;return Qa(e)?`Symbol(${(n=e.description)!=null?n:t})`:e};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let co;class FB{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=co,!t&&co&&(this.index=(co.scopes||(co.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].pause();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].resume();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].resume()}}run(t){if(this._active){const n=co;try{return co=this,t()}finally{co=n}}}on(){co=this}off(){co=this.parent}stop(t){if(this._active){this._active=!1;let n,r;for(n=0,r=this.effects.length;n<r;n++)this.effects[n].stop();for(this.effects.length=0,n=0,r=this.cleanups.length;n<r;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,r=this.scopes.length;n<r;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function $B(){return co}let bn;const Zm=new WeakSet;class u_{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,co&&co.active&&co.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Zm.has(this)&&(Zm.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||l_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,b2(this),d_(this);const t=bn,n=qo;bn=this,qo=!0;try{return this.fn()}finally{f_(this),bn=t,qo=n,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)Vv(t);this.deps=this.depsTail=void 0,b2(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Zm.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ng(this)&&this.run()}get dirty(){return Ng(this)}}let c_=0,xl,wl;function l_(e,t=!1){if(e.flags|=8,t){e.next=wl,wl=e;return}e.next=xl,xl=e}function Uv(){c_++}function zv(){if(--c_>0)return;if(wl){let t=wl;for(wl=void 0;t;){const n=t.next;t.next=void 0,t.flags&=-9,t=n}}let e;for(;xl;){let t=xl;for(xl=void 0;t;){const n=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(r){e||(e=r)}t=n}}if(e)throw e}function d_(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function f_(e){let t,n=e.depsTail,r=n;for(;r;){const o=r.prevDep;r.version===-1?(r===n&&(n=o),Vv(r),BB(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=o}e.deps=t,e.depsTail=n}function Ng(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(p_(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function p_(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Dl))return;e.globalVersion=Dl;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!Ng(e)){e.flags&=-3;return}const n=bn,r=qo;bn=e,qo=!0;try{d_(e);const o=e.fn(e._value);(t.version===0||Ui(o,e._value))&&(e._value=o,t.version++)}catch(o){throw t.version++,o}finally{bn=n,qo=r,f_(e),e.flags&=-3}}function Vv(e,t=!1){const{dep:n,prevSub:r,nextSub:o}=e;if(r&&(r.nextSub=o,e.prevSub=void 0),o&&(o.prevSub=r,e.nextSub=void 0),n.subs===e&&(n.subs=r,!r&&n.computed)){n.computed.flags&=-5;for(let i=n.computed.deps;i;i=i.nextDep)Vv(i,!0)}!t&&!--n.sc&&n.map&&n.map.delete(n.key)}function BB(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=void 0),n&&(n.prevDep=t,e.nextDep=void 0)}let qo=!0;const h_=[];function Yi(){h_.push(qo),qo=!1}function Qi(){const e=h_.pop();qo=e===void 0?!0:e}function b2(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const n=bn;bn=void 0;try{t()}finally{bn=n}}}let Dl=0;class LB{constructor(t,n){this.sub=t,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Hv{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!bn||!qo||bn===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==bn)n=this.activeLink=new LB(bn,this),bn.deps?(n.prevDep=bn.depsTail,bn.depsTail.nextDep=n,bn.depsTail=n):bn.deps=bn.depsTail=n,m_(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const r=n.nextDep;r.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=r),n.prevDep=bn.depsTail,n.nextDep=void 0,bn.depsTail.nextDep=n,bn.depsTail=n,bn.deps===n&&(bn.deps=r)}return n}trigger(t){this.version++,Dl++,this.notify(t)}notify(t){Uv();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{zv()}}}function m_(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let r=t.deps;r;r=r.nextDep)m_(r)}const n=e.dep.subs;n!==e&&(e.prevSub=n,n&&(n.nextSub=e)),e.dep.subs=e}}const Pg=new WeakMap,Fs=Symbol(""),Mg=Symbol(""),Al=Symbol("");function _r(e,t,n){if(qo&&bn){let r=Pg.get(e);r||Pg.set(e,r=new Map);let o=r.get(n);o||(r.set(n,o=new Hv),o.map=r,o.key=n),o.track()}}function za(e,t,n,r,o,i){const l=Pg.get(e);if(!l){Dl++;return}const d=p=>{p&&p.trigger()};if(Uv(),t==="clear")l.forEach(d);else{const p=ye(e),h=p&&Wv(n);if(p&&n==="length"){const g=Number(r);l.forEach((y,x)=>{(x==="length"||x===Al||!Qa(x)&&x>=g)&&d(y)})}else switch((n!==void 0||l.has(void 0))&&d(l.get(n)),h&&d(l.get(Al)),t){case"add":p?h&&d(l.get("length")):(d(l.get(Fs)),qu(e)&&d(l.get(Mg)));break;case"delete":p||(d(l.get(Fs)),qu(e)&&d(l.get(Mg)));break;case"set":qu(e)&&d(l.get(Fs));break}}zv()}function Fu(e){const t=Ke(e);return t===e?t:(_r(t,"iterate",Al),No(e)?t:t.map(Er))}function Dp(e){return _r(e=Ke(e),"iterate",Al),e}const WB={__proto__:null,[Symbol.iterator](){return tg(this,Symbol.iterator,Er)},concat(...e){return Fu(this).concat(...e.map(t=>ye(t)?Fu(t):t))},entries(){return tg(this,"entries",e=>(e[1]=Er(e[1]),e))},every(e,t){return $a(this,"every",e,t,void 0,arguments)},filter(e,t){return $a(this,"filter",e,t,n=>n.map(Er),arguments)},find(e,t){return $a(this,"find",e,t,Er,arguments)},findIndex(e,t){return $a(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return $a(this,"findLast",e,t,Er,arguments)},findLastIndex(e,t){return $a(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return $a(this,"forEach",e,t,void 0,arguments)},includes(...e){return eg(this,"includes",e)},indexOf(...e){return eg(this,"indexOf",e)},join(e){return Fu(this).join(e)},lastIndexOf(...e){return eg(this,"lastIndexOf",e)},map(e,t){return $a(this,"map",e,t,void 0,arguments)},pop(){return ol(this,"pop")},push(...e){return ol(this,"push",e)},reduce(e,...t){return x2(this,"reduce",e,t)},reduceRight(e,...t){return x2(this,"reduceRight",e,t)},shift(){return ol(this,"shift")},some(e,t){return $a(this,"some",e,t,void 0,arguments)},splice(...e){return ol(this,"splice",e)},toReversed(){return Fu(this).toReversed()},toSorted(e){return Fu(this).toSorted(e)},toSpliced(...e){return Fu(this).toSpliced(...e)},unshift(...e){return ol(this,"unshift",e)},values(){return tg(this,"values",Er)}};function tg(e,t,n){const r=Dp(e),o=r[t]();return r!==e&&!No(e)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.value&&(i.value=n(i.value)),i}),o}const UB=Array.prototype;function $a(e,t,n,r,o,i){const l=Dp(e),d=l!==e&&!No(e),p=l[t];if(p!==UB[t]){const y=p.apply(e,i);return d?Er(y):y}let h=n;l!==e&&(d?h=function(y,x){return n.call(this,Er(y),x,e)}:n.length>2&&(h=function(y,x){return n.call(this,y,x,e)}));const g=p.call(l,h,r);return d&&o?o(g):g}function x2(e,t,n,r){const o=Dp(e);let i=n;return o!==e&&(No(e)?n.length>3&&(i=function(l,d,p){return n.call(this,l,d,p,e)}):i=function(l,d,p){return n.call(this,l,Er(d),p,e)}),o[t](i,...r)}function eg(e,t,n){const r=Ke(e);_r(r,"iterate",Al);const o=r[t](...n);return(o===-1||o===!1)&&Kv(n[0])?(n[0]=Ke(n[0]),r[t](...n)):o}function ol(e,t,n=[]){Yi(),Uv();const r=Ke(e)[t].apply(e,n);return zv(),Qi(),r}const zB=$v("__proto__,__v_isRef,__isVue"),g_=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Qa));function VB(e){Qa(e)||(e=String(e));const t=Ke(this);return _r(t,"has",e),t.hasOwnProperty(e)}class v_{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,r){if(n==="__v_skip")return t.__v_skip;const o=this._isReadonly,i=this._isShallow;if(n==="__v_isReactive")return!o;if(n==="__v_isReadonly")return o;if(n==="__v_isShallow")return i;if(n==="__v_raw")return r===(o?i?ZB:w_:i?x_:b_).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(r)?t:void 0;const l=ye(t);if(!o){let p;if(l&&(p=WB[n]))return p;if(n==="hasOwnProperty")return VB}const d=Reflect.get(t,n,Dr(t)?t:r);return(Qa(n)?g_.has(n):zB(n))||(o||_r(t,"get",n),i)?d:Dr(d)?l&&Wv(n)?d:d.value:En(d)?o?qv(d):Ap(d):d}}class y_ extends v_{constructor(t=!1){super(!1,t)}set(t,n,r,o){let i=t[n];if(!this._isShallow){const p=Ws(i);if(!No(r)&&!Ws(r)&&(i=Ke(i),r=Ke(r)),!ye(t)&&Dr(i)&&!Dr(r))return p?!1:(i.value=r,!0)}const l=ye(t)&&Wv(n)?Number(n)<t.length:Ye(t,n),d=Reflect.set(t,n,r,Dr(t)?t:o);return t===Ke(o)&&(l?Ui(r,i)&&za(t,"set",n,r):za(t,"add",n,r)),d}deleteProperty(t,n){const r=Ye(t,n);t[n];const o=Reflect.deleteProperty(t,n);return o&&r&&za(t,"delete",n,void 0),o}has(t,n){const r=Reflect.has(t,n);return(!Qa(n)||!g_.has(n))&&_r(t,"has",n),r}ownKeys(t){return _r(t,"iterate",ye(t)?"length":Fs),Reflect.ownKeys(t)}}class HB extends v_{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const GB=new y_,qB=new HB,jB=new y_(!0),Og=e=>e,xf=e=>Reflect.getPrototypeOf(e);function KB(e,t,n){return function(...r){const o=this.__v_raw,i=Ke(o),l=qu(i),d=e==="entries"||e===Symbol.iterator&&l,p=e==="keys"&&l,h=o[e](...r),g=n?Og:t?Fg:Er;return!t&&_r(i,"iterate",p?Mg:Fs),{next(){const{value:y,done:x}=h.next();return x?{value:y,done:x}:{value:d?[g(y[0]),g(y[1])]:g(y),done:x}},[Symbol.iterator](){return this}}}}function wf(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function XB(e,t){const n={get(o){const i=this.__v_raw,l=Ke(i),d=Ke(o);e||(Ui(o,d)&&_r(l,"get",o),_r(l,"get",d));const{has:p}=xf(l),h=t?Og:e?Fg:Er;if(p.call(l,o))return h(i.get(o));if(p.call(l,d))return h(i.get(d));i!==l&&i.get(o)},get size(){const o=this.__v_raw;return!e&&_r(Ke(o),"iterate",Fs),Reflect.get(o,"size",o)},has(o){const i=this.__v_raw,l=Ke(i),d=Ke(o);return e||(Ui(o,d)&&_r(l,"has",o),_r(l,"has",d)),o===d?i.has(o):i.has(o)||i.has(d)},forEach(o,i){const l=this,d=l.__v_raw,p=Ke(d),h=t?Og:e?Fg:Er;return!e&&_r(p,"iterate",Fs),d.forEach((g,y)=>o.call(i,h(g),h(y),l))}};return pr(n,e?{add:wf("add"),set:wf("set"),delete:wf("delete"),clear:wf("clear")}:{add(o){!t&&!No(o)&&!Ws(o)&&(o=Ke(o));const i=Ke(this);return xf(i).has.call(i,o)||(i.add(o),za(i,"add",o,o)),this},set(o,i){!t&&!No(i)&&!Ws(i)&&(i=Ke(i));const l=Ke(this),{has:d,get:p}=xf(l);let h=d.call(l,o);h||(o=Ke(o),h=d.call(l,o));const g=p.call(l,o);return l.set(o,i),h?Ui(i,g)&&za(l,"set",o,i):za(l,"add",o,i),this},delete(o){const i=Ke(this),{has:l,get:d}=xf(i);let p=l.call(i,o);p||(o=Ke(o),p=l.call(i,o)),d&&d.call(i,o);const h=i.delete(o);return p&&za(i,"delete",o,void 0),h},clear(){const o=Ke(this),i=o.size!==0,l=o.clear();return i&&za(o,"clear",void 0,void 0),l}}),["keys","values","entries",Symbol.iterator].forEach(o=>{n[o]=KB(o,e,t)}),n}function Gv(e,t){const n=XB(e,t);return(r,o,i)=>o==="__v_isReactive"?!e:o==="__v_isReadonly"?e:o==="__v_raw"?r:Reflect.get(Ye(n,o)&&o in r?n:r,o,i)}const YB={get:Gv(!1,!1)},QB={get:Gv(!1,!0)},JB={get:Gv(!0,!1)},b_=new WeakMap,x_=new WeakMap,w_=new WeakMap,ZB=new WeakMap;function tL(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eL(e){return e.__v_skip||!Object.isExtensible(e)?0:tL(_B(e))}function Ap(e){return Ws(e)?e:jv(e,!1,GB,YB,b_)}function nL(e){return jv(e,!1,jB,QB,x_)}function qv(e){return jv(e,!0,qB,JB,w_)}function jv(e,t,n,r,o){if(!En(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=o.get(e);if(i)return i;const l=eL(e);if(l===0)return e;const d=new Proxy(e,l===2?r:n);return o.set(e,d),d}function ju(e){return Ws(e)?ju(e.__v_raw):!!(e&&e.__v_isReactive)}function Ws(e){return!!(e&&e.__v_isReadonly)}function No(e){return!!(e&&e.__v_isShallow)}function Kv(e){return e?!!e.__v_raw:!1}function Ke(e){const t=e&&e.__v_raw;return t?Ke(t):e}function rL(e){return!Ye(e,"__v_skip")&&Object.isExtensible(e)&&o_(e,"__v_skip",!0),e}const Er=e=>En(e)?Ap(e):e,Fg=e=>En(e)?qv(e):e;function Dr(e){return e?e.__v_isRef===!0:!1}function Lf(e){return oL(e,!1)}function oL(e,t){return Dr(e)?e:new aL(e,t)}class aL{constructor(t,n){this.dep=new Hv,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?t:Ke(t),this._value=n?t:Er(t),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(t){const n=this._rawValue,r=this.__v_isShallow||No(t)||Ws(t);t=r?t:Ke(t),Ui(t,n)&&(this._rawValue=t,this._value=r?t:Er(t),this.dep.trigger())}}function iL(e){return Dr(e)?e.value:e}const sL={get:(e,t,n)=>t==="__v_raw"?e:iL(Reflect.get(e,t,n)),set:(e,t,n,r)=>{const o=e[t];return Dr(o)&&!Dr(n)?(o.value=n,!0):Reflect.set(e,t,n,r)}};function C_(e){return ju(e)?e:new Proxy(e,sL)}class uL{constructor(t,n,r){this.fn=t,this.setter=n,this._value=void 0,this.dep=new Hv(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Dl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&bn!==this)return l_(this,!0),!0}get value(){const t=this.dep.track();return p_(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function cL(e,t,n=!1){let r,o;return Se(e)?r=e:(r=e.get,o=e.set),new uL(r,o,n)}const Cf={},jf=new WeakMap;let _s;function lL(e,t=!1,n=_s){if(n){let r=jf.get(n);r||jf.set(n,r=[]),r.push(e)}}function dL(e,t,n=hn){const{immediate:r,deep:o,once:i,scheduler:l,augmentJob:d,call:p}=n,h=M=>o?M:No(M)||o===!1||o===0?Va(M,1):Va(M);let g,y,x,C,_=!1,k=!1;if(Dr(e)?(y=()=>e.value,_=No(e)):ju(e)?(y=()=>h(e),_=!0):ye(e)?(k=!0,_=e.some(M=>ju(M)||No(M)),y=()=>e.map(M=>{if(Dr(M))return M.value;if(ju(M))return h(M);if(Se(M))return p?p(M,2):M()})):Se(e)?t?y=p?()=>p(e,2):e:y=()=>{if(x){Yi();try{x()}finally{Qi()}}const M=_s;_s=g;try{return p?p(e,3,[C]):e(C)}finally{_s=M}}:y=ga,t&&o){const M=y,F=o===!0?1/0:o;y=()=>Va(M(),F)}const A=$B(),I=()=>{g.stop(),A&&A.active&&Lv(A.effects,g)};if(i&&t){const M=t;t=(...F)=>{M(...F),I()}}let N=k?new Array(e.length).fill(Cf):Cf;const D=M=>{if(!(!(g.flags&1)||!g.dirty&&!M))if(t){const F=g.run();if(o||_||(k?F.some((W,L)=>Ui(W,N[L])):Ui(F,N))){x&&x();const W=_s;_s=g;try{const L=[F,N===Cf?void 0:k&&N[0]===Cf?[]:N,C];p?p(t,3,L):t(...L),N=F}finally{_s=W}}}else g.run()};return d&&d(D),g=new u_(y),g.scheduler=l?()=>l(D,!1):D,C=M=>lL(M,!1,g),x=g.onStop=()=>{const M=jf.get(g);if(M){if(p)p(M,4);else for(const F of M)F();jf.delete(g)}},t?r?D(!0):N=g.run():l?l(D.bind(null,!0),!0):g.run(),I.pause=g.pause.bind(g),I.resume=g.resume.bind(g),I.stop=I,I}function Va(e,t=1/0,n){if(t<=0||!En(e)||e.__v_skip||(n=n||new Set,n.has(e)))return e;if(n.add(e),t--,Dr(e))Va(e.value,t,n);else if(ye(e))for(let r=0;r<e.length;r++)Va(e[r],t,n);else if(t_(e)||qu(e))e.forEach(r=>{Va(r,t,n)});else if(r_(e)){for(const r in e)Va(e[r],t,n);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&Va(e[r],t,n)}return e}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ed(e,t,n,r){try{return r?e(...r):e()}catch(o){Ip(o,t,n)}}function Ko(e,t,n,r){if(Se(e)){const o=ed(e,t,n,r);return o&&e_(o)&&o.catch(i=>{Ip(i,t,n)}),o}if(ye(e)){const o=[];for(let i=0;i<e.length;i++)o.push(Ko(e[i],t,n,r));return o}}function Ip(e,t,n,r=!0){const o=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:l}=t&&t.appContext.config||hn;if(t){let d=t.parent;const p=t.proxy,h=`https://vuejs.org/error-reference/#runtime-${n}`;for(;d;){const g=d.ec;if(g){for(let y=0;y<g.length;y++)if(g[y](e,p,h)===!1)return}d=d.parent}if(i){Yi(),ed(i,null,10,[e,p,h]),Qi();return}}fL(e,n,o,r,l)}function fL(e,t,n,r=!0,o=!1){if(o)throw e;console.error(e)}const Br=[];let ca=-1;const Ku=[];let Di=null,zu=0;const S_=Promise.resolve();let Kf=null;function __(e){const t=Kf||S_;return e?t.then(this?e.bind(this):e):t}function pL(e){let t=ca+1,n=Br.length;for(;t<n;){const r=t+n>>>1,o=Br[r],i=Il(o);i<e||i===e&&o.flags&2?t=r+1:n=r}return t}function Xv(e){if(!(e.flags&1)){const t=Il(e),n=Br[Br.length-1];!n||!(e.flags&2)&&t>=Il(n)?Br.push(e):Br.splice(pL(t),0,e),e.flags|=1,E_()}}function E_(){Kf||(Kf=S_.then(R_))}function hL(e){ye(e)?Ku.push(...e):Di&&e.id===-1?Di.splice(zu+1,0,e):e.flags&1||(Ku.push(e),e.flags|=1),E_()}function w2(e,t,n=ca+1){for(;n<Br.length;n++){const r=Br[n];if(r&&r.flags&2){if(e&&r.id!==e.uid)continue;Br.splice(n,1),n--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function k_(e){if(Ku.length){const t=[...new Set(Ku)].sort((n,r)=>Il(n)-Il(r));if(Ku.length=0,Di){Di.push(...t);return}for(Di=t,zu=0;zu<Di.length;zu++){const n=Di[zu];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}Di=null,zu=0}}const Il=e=>e.id==null?e.flags&2?-1:1/0:e.id;function R_(e){try{for(ca=0;ca<Br.length;ca++){const t=Br[ca];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),ed(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;ca<Br.length;ca++){const t=Br[ca];t&&(t.flags&=-2)}ca=-1,Br.length=0,k_(),Kf=null,(Br.length||Ku.length)&&R_()}}let Jn=null,T_=null;function Xf(e){const t=Jn;return Jn=e,T_=e&&e.type.__scopeId||null,t}function zo(e,t=Jn,n){if(!t||e._n)return e;const r=(...o)=>{r._d&&N2(-1);const i=Xf(t);let l;try{l=e(...o)}finally{Xf(i),r._d&&N2(1)}return l};return r._n=!0,r._c=!0,r._d=!0,r}function $g(e,t){if(Jn===null)return e;const n=Fp(Jn),r=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[i,l,d,p=hn]=t[o];i&&(Se(i)&&(i={mounted:i,updated:i}),i.deep&&Va(l),r.push({dir:i,instance:n,value:l,oldValue:void 0,arg:d,modifiers:p}))}return e}function xs(e,t,n,r){const o=e.dirs,i=t&&t.dirs;for(let l=0;l<o.length;l++){const d=o[l];i&&(d.oldValue=i[l].value);let p=d.dir[r];p&&(Yi(),Ko(p,n,8,[e.el,d,e,t]),Qi())}}const mL=Symbol("_vte"),D_=e=>e.__isTeleport,Ai=Symbol("_leaveCb"),Sf=Symbol("_enterCb");function gL(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Yv(()=>{e.isMounted=!0}),$_(()=>{e.isUnmounting=!0}),e}const _o=[Function,Array],A_={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_o,onEnter:_o,onAfterEnter:_o,onEnterCancelled:_o,onBeforeLeave:_o,onLeave:_o,onAfterLeave:_o,onLeaveCancelled:_o,onBeforeAppear:_o,onAppear:_o,onAfterAppear:_o,onAppearCancelled:_o},I_=e=>{const t=e.subTree;return t.component?I_(t.component):t},vL={name:"BaseTransition",props:A_,setup(e,{slots:t}){const n=e0(),r=gL();return()=>{const o=t.default&&M_(t.default(),!0);if(!o||!o.length)return;const i=N_(o),l=Ke(e),{mode:d}=l;if(r.isLeaving)return ng(i);const p=C2(i);if(!p)return ng(i);let h=Bg(p,l,r,n,y=>h=y);p.type!==Lr&&Nl(p,h);let g=n.subTree&&C2(n.subTree);if(g&&g.type!==Lr&&!Rs(p,g)&&I_(n).type!==Lr){let y=Bg(g,l,r,n);if(Nl(g,y),d==="out-in"&&p.type!==Lr)return r.isLeaving=!0,y.afterLeave=()=>{r.isLeaving=!1,n.job.flags&8||n.update(),delete y.afterLeave,g=void 0},ng(i);d==="in-out"&&p.type!==Lr?y.delayLeave=(x,C,_)=>{const k=P_(r,g);k[String(g.key)]=g,x[Ai]=()=>{C(),x[Ai]=void 0,delete h.delayedLeave,g=void 0},h.delayedLeave=()=>{_(),delete h.delayedLeave,g=void 0}}:g=void 0}else g&&(g=void 0);return i}}};function N_(e){let t=e[0];if(e.length>1){for(const n of e)if(n.type!==Lr){t=n;break}}return t}const yL=vL;function P_(e,t){const{leavingVNodes:n}=e;let r=n.get(t.type);return r||(r=Object.create(null),n.set(t.type,r)),r}function Bg(e,t,n,r,o){const{appear:i,mode:l,persisted:d=!1,onBeforeEnter:p,onEnter:h,onAfterEnter:g,onEnterCancelled:y,onBeforeLeave:x,onLeave:C,onAfterLeave:_,onLeaveCancelled:k,onBeforeAppear:A,onAppear:I,onAfterAppear:N,onAppearCancelled:D}=t,M=String(e.key),F=P_(n,e),W=(q,Q)=>{q&&Ko(q,r,9,Q)},L=(q,Q)=>{const it=Q[1];W(q,Q),ye(q)?q.every(at=>at.length<=1)&&it():q.length<=1&&it()},X={mode:l,persisted:d,beforeEnter(q){let Q=p;if(!n.isMounted)if(i)Q=A||p;else return;q[Ai]&&q[Ai](!0);const it=F[M];it&&Rs(e,it)&&it.el[Ai]&&it.el[Ai](),W(Q,[q])},enter(q){let Q=h,it=g,at=y;if(!n.isMounted)if(i)Q=I||h,it=N||g,at=D||y;else return;let ht=!1;const gt=q[Sf]=Ct=>{ht||(ht=!0,Ct?W(at,[q]):W(it,[q]),X.delayedLeave&&X.delayedLeave(),q[Sf]=void 0)};Q?L(Q,[q,gt]):gt()},leave(q,Q){const it=String(e.key);if(q[Sf]&&q[Sf](!0),n.isUnmounting)return Q();W(x,[q]);let at=!1;const ht=q[Ai]=gt=>{at||(at=!0,Q(),gt?W(k,[q]):W(_,[q]),q[Ai]=void 0,F[it]===e&&delete F[it])};F[it]=e,C?L(C,[q,ht]):ht()},clone(q){const Q=Bg(q,t,n,r,o);return o&&o(Q),Q}};return X}function ng(e){if(Np(e))return e=Vi(e),e.children=null,e}function C2(e){if(!Np(e))return D_(e.type)&&e.children?N_(e.children):e;const{shapeFlag:t,children:n}=e;if(n){if(t&16)return n[0];if(t&32&&Se(n.default))return n.default()}}function Nl(e,t){e.shapeFlag&6&&e.component?(e.transition=t,Nl(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function M_(e,t=!1,n){let r=[],o=0;for(let i=0;i<e.length;i++){let l=e[i];const d=n==null?l.key:String(n)+String(l.key!=null?l.key:i);l.type===kr?(l.patchFlag&128&&o++,r=r.concat(M_(l.children,t,d))):(t||l.type!==Lr)&&r.push(d!=null?Vi(l,{key:d}):l)}if(o>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function bL(){const e=e0();return e?(e.appContext.config.idPrefix||"v")+"-"+e.ids[0]+e.ids[1]++:""}function O_(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function Yf(e,t,n,r,o=!1){if(ye(e)){e.forEach((_,k)=>Yf(_,t&&(ye(t)?t[k]:t),n,r,o));return}if(Xu(r)&&!o){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Yf(e,t,n,r.component.subTree);return}const i=r.shapeFlag&4?Fp(r.component):r.el,l=o?null:i,{i:d,r:p}=e,h=t&&t.r,g=d.refs===hn?d.refs={}:d.refs,y=d.setupState,x=Ke(y),C=y===hn?()=>!1:_=>Ye(x,_);if(h!=null&&h!==p&&(Nn(h)?(g[h]=null,C(h)&&(y[h]=null)):Dr(h)&&(h.value=null)),Se(p))ed(p,d,12,[l,g]);else{const _=Nn(p),k=Dr(p);if(_||k){const A=()=>{if(e.f){const I=_?C(p)?y[p]:g[p]:p.value;o?ye(I)&&Lv(I,i):ye(I)?I.includes(i)||I.push(i):_?(g[p]=[i],C(p)&&(y[p]=g[p])):(p.value=[i],e.k&&(g[e.k]=p.value))}else _?(g[p]=l,C(p)&&(y[p]=l)):k&&(p.value=l,e.k&&(g[e.k]=l))};l?(A.id=-1,uo(A,n)):A()}}}Rp().requestIdleCallback;Rp().cancelIdleCallback;const Xu=e=>!!e.type.__asyncLoader,Np=e=>e.type.__isKeepAlive;function xL(e,t){F_(e,"a",t)}function wL(e,t){F_(e,"da",t)}function F_(e,t,n=fr){const r=e.__wdc||(e.__wdc=()=>{let o=n;for(;o;){if(o.isDeactivated)return;o=o.parent}return e()});if(Pp(t,r,n),n){let o=n.parent;for(;o&&o.parent;)Np(o.parent.vnode)&&CL(r,t,n,o),o=o.parent}}function CL(e,t,n,r){const o=Pp(t,e,r,!0);B_(()=>{Lv(r[t],o)},n)}function Pp(e,t,n=fr,r=!1){if(n){const o=n[e]||(n[e]=[]),i=t.__weh||(t.__weh=(...l)=>{Yi();const d=nd(n),p=Ko(t,n,e,l);return d(),Qi(),p});return r?o.unshift(i):o.push(i),i}}const Ja=e=>(t,n=fr)=>{(!Ol||e==="sp")&&Pp(e,(...r)=>t(...r),n)},SL=Ja("bm"),Yv=Ja("m"),_L=Ja("bu"),EL=Ja("u"),$_=Ja("bum"),B_=Ja("um"),kL=Ja("sp"),RL=Ja("rtg"),TL=Ja("rtc");function DL(e,t=fr){Pp("ec",e,t)}const Qv="components",AL="directives";function Ao(e,t){return Jv(Qv,e,!0,t)||e}const L_=Symbol.for("v-ndc");function Ts(e){return Nn(e)?Jv(Qv,e,!1)||e:e||L_}function W_(e){return Jv(AL,e)}function Jv(e,t,n=!0,r=!1){const o=Jn||fr;if(o){const i=o.type;if(e===Qv){const d=v5(i,!1);if(d&&(d===t||d===Po(t)||d===kp(Po(t))))return i}const l=S2(o[e]||i[e],t)||S2(o.appContext[e],t);return!l&&r?i:l}}function S2(e,t){return e&&(e[t]||e[Po(t)]||e[kp(Po(t))])}function Lg(e,t,n,r){let o;const i=n,l=ye(e);if(l||Nn(e)){const d=l&&ju(e);let p=!1;d&&(p=!No(e),e=Dp(e)),o=new Array(e.length);for(let h=0,g=e.length;h<g;h++)o[h]=t(p?Er(e[h]):e[h],h,void 0,i)}else if(typeof e=="number"){o=new Array(e);for(let d=0;d<e;d++)o[d]=t(d+1,d,void 0,i)}else if(En(e))if(e[Symbol.iterator])o=Array.from(e,(d,p)=>t(d,p,void 0,i));else{const d=Object.keys(e);o=new Array(d.length);for(let p=0,h=d.length;p<h;p++){const g=d[p];o[p]=t(e[g],g,p,i)}}else o=[];return o}function Qn(e,t,n={},r,o){if(Jn.ce||Jn.parent&&Xu(Jn.parent)&&Jn.parent.ce)return t!=="default"&&(n.name=t),de(),Vn(kr,null,[In("slot",n,r&&r())],64);let i=e[t];i&&i._c&&(i._d=!1),de();const l=i&&U_(i(n)),d=n.key||l&&l.key,p=Vn(kr,{key:(d&&!Qa(d)?d:`_${t}`)+(!l&&r?"_fb":"")},l||(r?r():[]),l&&e._===1?64:-2);return p.scopeId&&(p.slotScopeIds=[p.scopeId+"-s"]),i&&i._c&&(i._d=!0),p}function U_(e){return e.some(t=>Ml(t)?!(t.type===Lr||t.type===kr&&!U_(t.children)):!0)?e:null}const Wg=e=>e?uE(e)?Fp(e):Wg(e.parent):null,Cl=pr(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Wg(e.parent),$root:e=>Wg(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>V_(e),$forceUpdate:e=>e.f||(e.f=()=>{Xv(e.update)}),$nextTick:e=>e.n||(e.n=__.bind(e.proxy)),$watch:e=>JL.bind(e)}),rg=(e,t)=>e!==hn&&!e.__isScriptSetup&&Ye(e,t),IL={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:r,data:o,props:i,accessCache:l,type:d,appContext:p}=e;let h;if(t[0]!=="$"){const C=l[t];if(C!==void 0)switch(C){case 1:return r[t];case 2:return o[t];case 4:return n[t];case 3:return i[t]}else{if(rg(r,t))return l[t]=1,r[t];if(o!==hn&&Ye(o,t))return l[t]=2,o[t];if((h=e.propsOptions[0])&&Ye(h,t))return l[t]=3,i[t];if(n!==hn&&Ye(n,t))return l[t]=4,n[t];Ug&&(l[t]=0)}}const g=Cl[t];let y,x;if(g)return t==="$attrs"&&_r(e.attrs,"get",""),g(e);if((y=d.__cssModules)&&(y=y[t]))return y;if(n!==hn&&Ye(n,t))return l[t]=4,n[t];if(x=p.config.globalProperties,Ye(x,t))return x[t]},set({_:e},t,n){const{data:r,setupState:o,ctx:i}=e;return rg(o,t)?(o[t]=n,!0):r!==hn&&Ye(r,t)?(r[t]=n,!0):Ye(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(i[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:r,appContext:o,propsOptions:i}},l){let d;return!!n[l]||e!==hn&&Ye(e,l)||rg(t,l)||(d=i[0])&&Ye(d,l)||Ye(r,l)||Ye(Cl,l)||Ye(o.config.globalProperties,l)},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:Ye(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function _2(e){return ye(e)?e.reduce((t,n)=>(t[n]=null,t),{}):e}let Ug=!0;function NL(e){const t=V_(e),n=e.proxy,r=e.ctx;Ug=!1,t.beforeCreate&&E2(t.beforeCreate,e,"bc");const{data:o,computed:i,methods:l,watch:d,provide:p,inject:h,created:g,beforeMount:y,mounted:x,beforeUpdate:C,updated:_,activated:k,deactivated:A,beforeDestroy:I,beforeUnmount:N,destroyed:D,unmounted:M,render:F,renderTracked:W,renderTriggered:L,errorCaptured:X,serverPrefetch:q,expose:Q,inheritAttrs:it,components:at,directives:ht,filters:gt}=t;if(h&&PL(h,r,null),l)for(const lt in l){const ft=l[lt];Se(ft)&&(r[lt]=ft.bind(n))}if(o){const lt=o.call(n,n);En(lt)&&(e.data=Ap(lt))}if(Ug=!0,i)for(const lt in i){const ft=i[lt],Tt=Se(ft)?ft.bind(n,n):Se(ft.get)?ft.get.bind(n,n):ga,Pt=!Se(ft)&&Se(ft.set)?ft.set.bind(n):ga,Bt=b5({get:Tt,set:Pt});Object.defineProperty(r,lt,{enumerable:!0,configurable:!0,get:()=>Bt.value,set:Ut=>Bt.value=Ut})}if(d)for(const lt in d)z_(d[lt],r,n,lt);if(p){const lt=Se(p)?p.call(n):p;Reflect.ownKeys(lt).forEach(ft=>{LL(ft,lt[ft])})}g&&E2(g,e,"c");function pt(lt,ft){ye(ft)?ft.forEach(Tt=>lt(Tt.bind(n))):ft&&lt(ft.bind(n))}if(pt(SL,y),pt(Yv,x),pt(_L,C),pt(EL,_),pt(xL,k),pt(wL,A),pt(DL,X),pt(TL,W),pt(RL,L),pt($_,N),pt(B_,M),pt(kL,q),ye(Q))if(Q.length){const lt=e.exposed||(e.exposed={});Q.forEach(ft=>{Object.defineProperty(lt,ft,{get:()=>n[ft],set:Tt=>n[ft]=Tt})})}else e.exposed||(e.exposed={});F&&e.render===ga&&(e.render=F),it!=null&&(e.inheritAttrs=it),at&&(e.components=at),ht&&(e.directives=ht),q&&O_(e)}function PL(e,t,n=ga){ye(e)&&(e=zg(e));for(const r in e){const o=e[r];let i;En(o)?"default"in o?i=Wf(o.from||r,o.default,!0):i=Wf(o.from||r):i=Wf(o),Dr(i)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:l=>i.value=l}):t[r]=i}}function E2(e,t,n){Ko(ye(e)?e.map(r=>r.bind(t.proxy)):e.bind(t.proxy),t,n)}function z_(e,t,n,r){let o=r.includes(".")?rE(n,r):()=>n[r];if(Nn(e)){const i=t[e];Se(i)&&Mi(o,i)}else if(Se(e))Mi(o,e.bind(n));else if(En(e))if(ye(e))e.forEach(i=>z_(i,t,n,r));else{const i=Se(e.handler)?e.handler.bind(n):t[e.handler];Se(i)&&Mi(o,i,e)}}function V_(e){const t=e.type,{mixins:n,extends:r}=t,{mixins:o,optionsCache:i,config:{optionMergeStrategies:l}}=e.appContext,d=i.get(t);let p;return d?p=d:!o.length&&!n&&!r?p=t:(p={},o.length&&o.forEach(h=>Qf(p,h,l,!0)),Qf(p,t,l)),En(t)&&i.set(t,p),p}function Qf(e,t,n,r=!1){const{mixins:o,extends:i}=t;i&&Qf(e,i,n,!0),o&&o.forEach(l=>Qf(e,l,n,!0));for(const l in t)if(!(r&&l==="expose")){const d=ML[l]||n&&n[l];e[l]=d?d(e[l],t[l]):t[l]}return e}const ML={data:k2,props:R2,emits:R2,methods:ll,computed:ll,beforeCreate:$r,created:$r,beforeMount:$r,mounted:$r,beforeUpdate:$r,updated:$r,beforeDestroy:$r,beforeUnmount:$r,destroyed:$r,unmounted:$r,activated:$r,deactivated:$r,errorCaptured:$r,serverPrefetch:$r,components:ll,directives:ll,watch:FL,provide:k2,inject:OL};function k2(e,t){return t?e?function(){return pr(Se(e)?e.call(this,this):e,Se(t)?t.call(this,this):t)}:t:e}function OL(e,t){return ll(zg(e),zg(t))}function zg(e){if(ye(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function $r(e,t){return e?[...new Set([].concat(e,t))]:t}function ll(e,t){return e?pr(Object.create(null),e,t):t}function R2(e,t){return e?ye(e)&&ye(t)?[...new Set([...e,...t])]:pr(Object.create(null),_2(e),_2(t??{})):t}function FL(e,t){if(!e)return t;if(!t)return e;const n=pr(Object.create(null),e);for(const r in t)n[r]=$r(e[r],t[r]);return n}function H_(){return{app:null,config:{isNativeTag:CB,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $L=0;function BL(e,t){return function(r,o=null){Se(r)||(r=pr({},r)),o!=null&&!En(o)&&(o=null);const i=H_(),l=new WeakSet,d=[];let p=!1;const h=i.app={_uid:$L++,_component:r,_props:o,_container:null,_context:i,_instance:null,version:w5,get config(){return i.config},set config(g){},use(g,...y){return l.has(g)||(g&&Se(g.install)?(l.add(g),g.install(h,...y)):Se(g)&&(l.add(g),g(h,...y))),h},mixin(g){return i.mixins.includes(g)||i.mixins.push(g),h},component(g,y){return y?(i.components[g]=y,h):i.components[g]},directive(g,y){return y?(i.directives[g]=y,h):i.directives[g]},mount(g,y,x){if(!p){const C=h._ceVNode||In(r,o);return C.appContext=i,x===!0?x="svg":x===!1&&(x=void 0),e(C,g,x),p=!0,h._container=g,g.__vue_app__=h,Fp(C.component)}},onUnmount(g){d.push(g)},unmount(){p&&(Ko(d,h._instance,16),e(null,h._container),delete h._container.__vue_app__)},provide(g,y){return i.provides[g]=y,h},runWithContext(g){const y=Yu;Yu=h;try{return g()}finally{Yu=y}}};return h}}let Yu=null;function LL(e,t){if(fr){let n=fr.provides;const r=fr.parent&&fr.parent.provides;r===n&&(n=fr.provides=Object.create(r)),n[e]=t}}function Wf(e,t,n=!1){const r=fr||Jn;if(r||Yu){const o=Yu?Yu._context.provides:r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return n&&Se(t)?t.call(r&&r.proxy):t}}const G_={},q_=()=>Object.create(G_),j_=e=>Object.getPrototypeOf(e)===G_;function WL(e,t,n,r=!1){const o={},i=q_();e.propsDefaults=Object.create(null),K_(e,t,o,i);for(const l in e.propsOptions[0])l in o||(o[l]=void 0);n?e.props=r?o:nL(o):e.type.props?e.props=o:e.props=i,e.attrs=i}function UL(e,t,n,r){const{props:o,attrs:i,vnode:{patchFlag:l}}=e,d=Ke(o),[p]=e.propsOptions;let h=!1;if((r||l>0)&&!(l&16)){if(l&8){const g=e.vnode.dynamicProps;for(let y=0;y<g.length;y++){let x=g[y];if(Mp(e.emitsOptions,x))continue;const C=t[x];if(p)if(Ye(i,x))C!==i[x]&&(i[x]=C,h=!0);else{const _=Po(x);o[_]=Vg(p,d,_,C,e,!1)}else C!==i[x]&&(i[x]=C,h=!0)}}}else{K_(e,t,o,i)&&(h=!0);let g;for(const y in d)(!t||!Ye(t,y)&&((g=Xi(y))===y||!Ye(t,g)))&&(p?n&&(n[y]!==void 0||n[g]!==void 0)&&(o[y]=Vg(p,d,y,void 0,e,!0)):delete o[y]);if(i!==d)for(const y in i)(!t||!Ye(t,y))&&(delete i[y],h=!0)}h&&za(e.attrs,"set","")}function K_(e,t,n,r){const[o,i]=e.propsOptions;let l=!1,d;if(t)for(let p in t){if(bl(p))continue;const h=t[p];let g;o&&Ye(o,g=Po(p))?!i||!i.includes(g)?n[g]=h:(d||(d={}))[g]=h:Mp(e.emitsOptions,p)||(!(p in r)||h!==r[p])&&(r[p]=h,l=!0)}if(i){const p=Ke(n),h=d||hn;for(let g=0;g<i.length;g++){const y=i[g];n[y]=Vg(o,p,y,h[y],e,!Ye(h,y))}}return l}function Vg(e,t,n,r,o,i){const l=e[n];if(l!=null){const d=Ye(l,"default");if(d&&r===void 0){const p=l.default;if(l.type!==Function&&!l.skipFactory&&Se(p)){const{propsDefaults:h}=o;if(n in h)r=h[n];else{const g=nd(o);r=h[n]=p.call(null,t),g()}}else r=p;o.ce&&o.ce._setProp(n,r)}l[0]&&(i&&!d?r=!1:l[1]&&(r===""||r===Xi(n))&&(r=!0))}return r}const zL=new WeakMap;function X_(e,t,n=!1){const r=n?zL:t.propsCache,o=r.get(e);if(o)return o;const i=e.props,l={},d=[];let p=!1;if(!Se(e)){const g=y=>{p=!0;const[x,C]=X_(y,t,!0);pr(l,x),C&&d.push(...C)};!n&&t.mixins.length&&t.mixins.forEach(g),e.extends&&g(e.extends),e.mixins&&e.mixins.forEach(g)}if(!i&&!p)return En(e)&&r.set(e,Gu),Gu;if(ye(i))for(let g=0;g<i.length;g++){const y=Po(i[g]);T2(y)&&(l[y]=hn)}else if(i)for(const g in i){const y=Po(g);if(T2(y)){const x=i[g],C=l[y]=ye(x)||Se(x)?{type:x}:pr({},x),_=C.type;let k=!1,A=!0;if(ye(_))for(let I=0;I<_.length;++I){const N=_[I],D=Se(N)&&N.name;if(D==="Boolean"){k=!0;break}else D==="String"&&(A=!1)}else k=Se(_)&&_.name==="Boolean";C[0]=k,C[1]=A,(k||Ye(C,"default"))&&d.push(y)}}const h=[l,d];return En(e)&&r.set(e,h),h}function T2(e){return e[0]!=="$"&&!bl(e)}const Y_=e=>e[0]==="_"||e==="$stable",Zv=e=>ye(e)?e.map(da):[da(e)],VL=(e,t,n)=>{if(t._n)return t;const r=zo((...o)=>Zv(t(...o)),n);return r._c=!1,r},Q_=(e,t,n)=>{const r=e._ctx;for(const o in e){if(Y_(o))continue;const i=e[o];if(Se(i))t[o]=VL(o,i,r);else if(i!=null){const l=Zv(i);t[o]=()=>l}}},J_=(e,t)=>{const n=Zv(t);e.slots.default=()=>n},Z_=(e,t,n)=>{for(const r in t)(n||r!=="_")&&(e[r]=t[r])},HL=(e,t,n)=>{const r=e.slots=q_();if(e.vnode.shapeFlag&32){const o=t._;o?(Z_(r,t,n),n&&o_(r,"_",o,!0)):Q_(t,r)}else t&&J_(e,t)},GL=(e,t,n)=>{const{vnode:r,slots:o}=e;let i=!0,l=hn;if(r.shapeFlag&32){const d=t._;d?n&&d===1?i=!1:Z_(o,t,n):(i=!t.$stable,Q_(t,o)),l=t}else t&&(J_(e,t),l={default:1});if(i)for(const d in o)!Y_(d)&&l[d]==null&&delete o[d]},uo=a5;function qL(e){return jL(e)}function jL(e,t){const n=Rp();n.__VUE__=!0;const{insert:r,remove:o,patchProp:i,createElement:l,createText:d,createComment:p,setText:h,setElementText:g,parentNode:y,nextSibling:x,setScopeId:C=ga,insertStaticContent:_}=e,k=(Y,nt,mt,Et=null,St=null,Dt=null,$t=void 0,Ft=null,It=!!nt.dynamicChildren)=>{if(Y===nt)return;Y&&!Rs(Y,nt)&&(Et=se(Y),Ut(Y,St,Dt,!0),Y=null),nt.patchFlag===-2&&(It=!1,nt.dynamicChildren=null);const{type:Rt,ref:Ht,shapeFlag:Wt}=nt;switch(Rt){case Op:A(Y,nt,mt,Et);break;case Lr:I(Y,nt,mt,Et);break;case Uf:Y==null&&N(nt,mt,Et,$t);break;case kr:at(Y,nt,mt,Et,St,Dt,$t,Ft,It);break;default:Wt&1?F(Y,nt,mt,Et,St,Dt,$t,Ft,It):Wt&6?ht(Y,nt,mt,Et,St,Dt,$t,Ft,It):(Wt&64||Wt&128)&&Rt.process(Y,nt,mt,Et,St,Dt,$t,Ft,It,re)}Ht!=null&&St&&Yf(Ht,Y&&Y.ref,Dt,nt||Y,!nt)},A=(Y,nt,mt,Et)=>{if(Y==null)r(nt.el=d(nt.children),mt,Et);else{const St=nt.el=Y.el;nt.children!==Y.children&&h(St,nt.children)}},I=(Y,nt,mt,Et)=>{Y==null?r(nt.el=p(nt.children||""),mt,Et):nt.el=Y.el},N=(Y,nt,mt,Et)=>{[Y.el,Y.anchor]=_(Y.children,nt,mt,Et,Y.el,Y.anchor)},D=({el:Y,anchor:nt},mt,Et)=>{let St;for(;Y&&Y!==nt;)St=x(Y),r(Y,mt,Et),Y=St;r(nt,mt,Et)},M=({el:Y,anchor:nt})=>{let mt;for(;Y&&Y!==nt;)mt=x(Y),o(Y),Y=mt;o(nt)},F=(Y,nt,mt,Et,St,Dt,$t,Ft,It)=>{nt.type==="svg"?$t="svg":nt.type==="math"&&($t="mathml"),Y==null?W(nt,mt,Et,St,Dt,$t,Ft,It):q(Y,nt,St,Dt,$t,Ft,It)},W=(Y,nt,mt,Et,St,Dt,$t,Ft)=>{let It,Rt;const{props:Ht,shapeFlag:Wt,transition:Yt,dirs:he}=Y;if(It=Y.el=l(Y.type,Dt,Ht&&Ht.is,Ht),Wt&8?g(It,Y.children):Wt&16&&X(Y.children,It,null,Et,St,og(Y,Dt),$t,Ft),he&&xs(Y,null,Et,"created"),L(It,Y,Y.scopeId,$t,Et),Ht){for(const Ee in Ht)Ee!=="value"&&!bl(Ee)&&i(It,Ee,null,Ht[Ee],Dt,Et);"value"in Ht&&i(It,"value",null,Ht.value,Dt),(Rt=Ht.onVnodeBeforeMount)&&ia(Rt,Et,Y)}he&&xs(Y,null,Et,"beforeMount");const Ce=KL(St,Yt);Ce&&Yt.beforeEnter(It),r(It,nt,mt),((Rt=Ht&&Ht.onVnodeMounted)||Ce||he)&&uo(()=>{Rt&&ia(Rt,Et,Y),Ce&&Yt.enter(It),he&&xs(Y,null,Et,"mounted")},St)},L=(Y,nt,mt,Et,St)=>{if(mt&&C(Y,mt),Et)for(let Dt=0;Dt<Et.length;Dt++)C(Y,Et[Dt]);if(St){let Dt=St.subTree;if(nt===Dt||aE(Dt.type)&&(Dt.ssContent===nt||Dt.ssFallback===nt)){const $t=St.vnode;L(Y,$t,$t.scopeId,$t.slotScopeIds,St.parent)}}},X=(Y,nt,mt,Et,St,Dt,$t,Ft,It=0)=>{for(let Rt=It;Rt<Y.length;Rt++){const Ht=Y[Rt]=Ft?Ii(Y[Rt]):da(Y[Rt]);k(null,Ht,nt,mt,Et,St,Dt,$t,Ft)}},q=(Y,nt,mt,Et,St,Dt,$t)=>{const Ft=nt.el=Y.el;let{patchFlag:It,dynamicChildren:Rt,dirs:Ht}=nt;It|=Y.patchFlag&16;const Wt=Y.props||hn,Yt=nt.props||hn;let he;if(mt&&ws(mt,!1),(he=Yt.onVnodeBeforeUpdate)&&ia(he,mt,nt,Y),Ht&&xs(nt,Y,mt,"beforeUpdate"),mt&&ws(mt,!0),(Wt.innerHTML&&Yt.innerHTML==null||Wt.textContent&&Yt.textContent==null)&&g(Ft,""),Rt?Q(Y.dynamicChildren,Rt,Ft,mt,Et,og(nt,St),Dt):$t||ft(Y,nt,Ft,null,mt,Et,og(nt,St),Dt,!1),It>0){if(It&16)it(Ft,Wt,Yt,mt,St);else if(It&2&&Wt.class!==Yt.class&&i(Ft,"class",null,Yt.class,St),It&4&&i(Ft,"style",Wt.style,Yt.style,St),It&8){const Ce=nt.dynamicProps;for(let Ee=0;Ee<Ce.length;Ee++){const $e=Ce[Ee],Wn=Wt[$e],sn=Yt[$e];(sn!==Wn||$e==="value")&&i(Ft,$e,Wn,sn,St,mt)}}It&1&&Y.children!==nt.children&&g(Ft,nt.children)}else!$t&&Rt==null&&it(Ft,Wt,Yt,mt,St);((he=Yt.onVnodeUpdated)||Ht)&&uo(()=>{he&&ia(he,mt,nt,Y),Ht&&xs(nt,Y,mt,"updated")},Et)},Q=(Y,nt,mt,Et,St,Dt,$t)=>{for(let Ft=0;Ft<nt.length;Ft++){const It=Y[Ft],Rt=nt[Ft],Ht=It.el&&(It.type===kr||!Rs(It,Rt)||It.shapeFlag&70)?y(It.el):mt;k(It,Rt,Ht,null,Et,St,Dt,$t,!0)}},it=(Y,nt,mt,Et,St)=>{if(nt!==mt){if(nt!==hn)for(const Dt in nt)!bl(Dt)&&!(Dt in mt)&&i(Y,Dt,nt[Dt],null,St,Et);for(const Dt in mt){if(bl(Dt))continue;const $t=mt[Dt],Ft=nt[Dt];$t!==Ft&&Dt!=="value"&&i(Y,Dt,Ft,$t,St,Et)}"value"in mt&&i(Y,"value",nt.value,mt.value,St)}},at=(Y,nt,mt,Et,St,Dt,$t,Ft,It)=>{const Rt=nt.el=Y?Y.el:d(""),Ht=nt.anchor=Y?Y.anchor:d("");let{patchFlag:Wt,dynamicChildren:Yt,slotScopeIds:he}=nt;he&&(Ft=Ft?Ft.concat(he):he),Y==null?(r(Rt,mt,Et),r(Ht,mt,Et),X(nt.children||[],mt,Ht,St,Dt,$t,Ft,It)):Wt>0&&Wt&64&&Yt&&Y.dynamicChildren?(Q(Y.dynamicChildren,Yt,mt,St,Dt,$t,Ft),(nt.key!=null||St&&nt===St.subTree)&&tE(Y,nt,!0)):ft(Y,nt,mt,Ht,St,Dt,$t,Ft,It)},ht=(Y,nt,mt,Et,St,Dt,$t,Ft,It)=>{nt.slotScopeIds=Ft,Y==null?nt.shapeFlag&512?St.ctx.activate(nt,mt,Et,$t,It):gt(nt,mt,Et,St,Dt,$t,It):Ct(Y,nt,It)},gt=(Y,nt,mt,Et,St,Dt,$t)=>{const Ft=Y.component=f5(Y,Et,St);if(Np(Y)&&(Ft.ctx.renderer=re),p5(Ft,!1,$t),Ft.asyncDep){if(St&&St.registerDep(Ft,pt,$t),!Y.el){const It=Ft.subTree=In(Lr);I(null,It,nt,mt)}}else pt(Ft,Y,nt,mt,St,Dt,$t)},Ct=(Y,nt,mt)=>{const Et=nt.component=Y.component;if(r5(Y,nt,mt))if(Et.asyncDep&&!Et.asyncResolved){lt(Et,nt,mt);return}else Et.next=nt,Et.update();else nt.el=Y.el,Et.vnode=nt},pt=(Y,nt,mt,Et,St,Dt,$t)=>{const Ft=()=>{if(Y.isMounted){let{next:Wt,bu:Yt,u:he,parent:Ce,vnode:Ee}=Y;{const Vr=eE(Y);if(Vr){Wt&&(Wt.el=Ee.el,lt(Y,Wt,$t)),Vr.asyncDep.then(()=>{Y.isUnmounted||Ft()});return}}let $e=Wt,Wn;ws(Y,!1),Wt?(Wt.el=Ee.el,lt(Y,Wt,$t)):Wt=Ee,Yt&&Qm(Yt),(Wn=Wt.props&&Wt.props.onVnodeBeforeUpdate)&&ia(Wn,Ce,Wt,Ee),ws(Y,!0);const sn=A2(Y),yt=Y.subTree;Y.subTree=sn,k(yt,sn,y(yt.el),se(yt),Y,St,Dt),Wt.el=sn.el,$e===null&&o5(Y,sn.el),he&&uo(he,St),(Wn=Wt.props&&Wt.props.onVnodeUpdated)&&uo(()=>ia(Wn,Ce,Wt,Ee),St)}else{let Wt;const{el:Yt,props:he}=nt,{bm:Ce,m:Ee,parent:$e,root:Wn,type:sn}=Y,yt=Xu(nt);ws(Y,!1),Ce&&Qm(Ce),!yt&&(Wt=he&&he.onVnodeBeforeMount)&&ia(Wt,$e,nt),ws(Y,!0);{Wn.ce&&Wn.ce._injectChildStyle(sn);const Vr=Y.subTree=A2(Y);k(null,Vr,mt,Et,Y,St,Dt),nt.el=Vr.el}if(Ee&&uo(Ee,St),!yt&&(Wt=he&&he.onVnodeMounted)){const Vr=nt;uo(()=>ia(Wt,$e,Vr),St)}(nt.shapeFlag&256||$e&&Xu($e.vnode)&&$e.vnode.shapeFlag&256)&&Y.a&&uo(Y.a,St),Y.isMounted=!0,nt=mt=Et=null}};Y.scope.on();const It=Y.effect=new u_(Ft);Y.scope.off();const Rt=Y.update=It.run.bind(It),Ht=Y.job=It.runIfDirty.bind(It);Ht.i=Y,Ht.id=Y.uid,It.scheduler=()=>Xv(Ht),ws(Y,!0),Rt()},lt=(Y,nt,mt)=>{nt.component=Y;const Et=Y.vnode.props;Y.vnode=nt,Y.next=null,UL(Y,nt.props,Et,mt),GL(Y,nt.children,mt),Yi(),w2(Y),Qi()},ft=(Y,nt,mt,Et,St,Dt,$t,Ft,It=!1)=>{const Rt=Y&&Y.children,Ht=Y?Y.shapeFlag:0,Wt=nt.children,{patchFlag:Yt,shapeFlag:he}=nt;if(Yt>0){if(Yt&128){Pt(Rt,Wt,mt,Et,St,Dt,$t,Ft,It);return}else if(Yt&256){Tt(Rt,Wt,mt,Et,St,Dt,$t,Ft,It);return}}he&8?(Ht&16&&fe(Rt,St,Dt),Wt!==Rt&&g(mt,Wt)):Ht&16?he&16?Pt(Rt,Wt,mt,Et,St,Dt,$t,Ft,It):fe(Rt,St,Dt,!0):(Ht&8&&g(mt,""),he&16&&X(Wt,mt,Et,St,Dt,$t,Ft,It))},Tt=(Y,nt,mt,Et,St,Dt,$t,Ft,It)=>{Y=Y||Gu,nt=nt||Gu;const Rt=Y.length,Ht=nt.length,Wt=Math.min(Rt,Ht);let Yt;for(Yt=0;Yt<Wt;Yt++){const he=nt[Yt]=It?Ii(nt[Yt]):da(nt[Yt]);k(Y[Yt],he,mt,null,St,Dt,$t,Ft,It)}Rt>Ht?fe(Y,St,Dt,!0,!1,Wt):X(nt,mt,Et,St,Dt,$t,Ft,It,Wt)},Pt=(Y,nt,mt,Et,St,Dt,$t,Ft,It)=>{let Rt=0;const Ht=nt.length;let Wt=Y.length-1,Yt=Ht-1;for(;Rt<=Wt&&Rt<=Yt;){const he=Y[Rt],Ce=nt[Rt]=It?Ii(nt[Rt]):da(nt[Rt]);if(Rs(he,Ce))k(he,Ce,mt,null,St,Dt,$t,Ft,It);else break;Rt++}for(;Rt<=Wt&&Rt<=Yt;){const he=Y[Wt],Ce=nt[Yt]=It?Ii(nt[Yt]):da(nt[Yt]);if(Rs(he,Ce))k(he,Ce,mt,null,St,Dt,$t,Ft,It);else break;Wt--,Yt--}if(Rt>Wt){if(Rt<=Yt){const he=Yt+1,Ce=he<Ht?nt[he].el:Et;for(;Rt<=Yt;)k(null,nt[Rt]=It?Ii(nt[Rt]):da(nt[Rt]),mt,Ce,St,Dt,$t,Ft,It),Rt++}}else if(Rt>Yt)for(;Rt<=Wt;)Ut(Y[Rt],St,Dt,!0),Rt++;else{const he=Rt,Ce=Rt,Ee=new Map;for(Rt=Ce;Rt<=Yt;Rt++){const Pn=nt[Rt]=It?Ii(nt[Rt]):da(nt[Rt]);Pn.key!=null&&Ee.set(Pn.key,Rt)}let $e,Wn=0;const sn=Yt-Ce+1;let yt=!1,Vr=0;const rs=new Array(sn);for(Rt=0;Rt<sn;Rt++)rs[Rt]=0;for(Rt=he;Rt<=Wt;Rt++){const Pn=Y[Rt];if(Wn>=sn){Ut(Pn,St,Dt,!0);continue}let Hr;if(Pn.key!=null)Hr=Ee.get(Pn.key);else for($e=Ce;$e<=Yt;$e++)if(rs[$e-Ce]===0&&Rs(Pn,nt[$e])){Hr=$e;break}Hr===void 0?Ut(Pn,St,Dt,!0):(rs[Hr-Ce]=Rt+1,Hr>=Vr?Vr=Hr:yt=!0,k(Pn,nt[Hr],mt,null,St,Dt,$t,Ft,It),Wn++)}const At=yt?XL(rs):Gu;for($e=At.length-1,Rt=sn-1;Rt>=0;Rt--){const Pn=Ce+Rt,Hr=nt[Pn],du=Pn+1<Ht?nt[Pn+1].el:Et;rs[Rt]===0?k(null,Hr,mt,du,St,Dt,$t,Ft,It):yt&&($e<0||Rt!==At[$e]?Bt(Hr,mt,du,2):$e--)}}},Bt=(Y,nt,mt,Et,St=null)=>{const{el:Dt,type:$t,transition:Ft,children:It,shapeFlag:Rt}=Y;if(Rt&6){Bt(Y.component.subTree,nt,mt,Et);return}if(Rt&128){Y.suspense.move(nt,mt,Et);return}if(Rt&64){$t.move(Y,nt,mt,re);return}if($t===kr){r(Dt,nt,mt);for(let Wt=0;Wt<It.length;Wt++)Bt(It[Wt],nt,mt,Et);r(Y.anchor,nt,mt);return}if($t===Uf){D(Y,nt,mt);return}if(Et!==2&&Rt&1&&Ft)if(Et===0)Ft.beforeEnter(Dt),r(Dt,nt,mt),uo(()=>Ft.enter(Dt),St);else{const{leave:Wt,delayLeave:Yt,afterLeave:he}=Ft,Ce=()=>r(Dt,nt,mt),Ee=()=>{Wt(Dt,()=>{Ce(),he&&he()})};Yt?Yt(Dt,Ce,Ee):Ee()}else r(Dt,nt,mt)},Ut=(Y,nt,mt,Et=!1,St=!1)=>{const{type:Dt,props:$t,ref:Ft,children:It,dynamicChildren:Rt,shapeFlag:Ht,patchFlag:Wt,dirs:Yt,cacheIndex:he}=Y;if(Wt===-2&&(St=!1),Ft!=null&&Yf(Ft,null,mt,Y,!0),he!=null&&(nt.renderCache[he]=void 0),Ht&256){nt.ctx.deactivate(Y);return}const Ce=Ht&1&&Yt,Ee=!Xu(Y);let $e;if(Ee&&($e=$t&&$t.onVnodeBeforeUnmount)&&ia($e,nt,Y),Ht&6)ce(Y.component,mt,Et);else{if(Ht&128){Y.suspense.unmount(mt,Et);return}Ce&&xs(Y,null,nt,"beforeUnmount"),Ht&64?Y.type.remove(Y,nt,mt,re,Et):Rt&&!Rt.hasOnce&&(Dt!==kr||Wt>0&&Wt&64)?fe(Rt,nt,mt,!1,!0):(Dt===kr&&Wt&384||!St&&Ht&16)&&fe(It,nt,mt),Et&&Zt(Y)}(Ee&&($e=$t&&$t.onVnodeUnmounted)||Ce)&&uo(()=>{$e&&ia($e,nt,Y),Ce&&xs(Y,null,nt,"unmounted")},mt)},Zt=Y=>{const{type:nt,el:mt,anchor:Et,transition:St}=Y;if(nt===kr){Xt(mt,Et);return}if(nt===Uf){M(Y);return}const Dt=()=>{o(mt),St&&!St.persisted&&St.afterLeave&&St.afterLeave()};if(Y.shapeFlag&1&&St&&!St.persisted){const{leave:$t,delayLeave:Ft}=St,It=()=>$t(mt,Dt);Ft?Ft(Y.el,Dt,It):It()}else Dt()},Xt=(Y,nt)=>{let mt;for(;Y!==nt;)mt=x(Y),o(Y),Y=mt;o(nt)},ce=(Y,nt,mt)=>{const{bum:Et,scope:St,job:Dt,subTree:$t,um:Ft,m:It,a:Rt}=Y;D2(It),D2(Rt),Et&&Qm(Et),St.stop(),Dt&&(Dt.flags|=8,Ut($t,Y,nt,mt)),Ft&&uo(Ft,nt),uo(()=>{Y.isUnmounted=!0},nt),nt&&nt.pendingBranch&&!nt.isUnmounted&&Y.asyncDep&&!Y.asyncResolved&&Y.suspenseId===nt.pendingId&&(nt.deps--,nt.deps===0&&nt.resolve())},fe=(Y,nt,mt,Et=!1,St=!1,Dt=0)=>{for(let $t=Dt;$t<Y.length;$t++)Ut(Y[$t],nt,mt,Et,St)},se=Y=>{if(Y.shapeFlag&6)return se(Y.component.subTree);if(Y.shapeFlag&128)return Y.suspense.next();const nt=x(Y.anchor||Y.el),mt=nt&&nt[mL];return mt?x(mt):nt};let jt=!1;const Pe=(Y,nt,mt)=>{Y==null?nt._vnode&&Ut(nt._vnode,null,null,!0):k(nt._vnode||null,Y,nt,null,null,null,mt),nt._vnode=Y,jt||(jt=!0,w2(),k_(),jt=!1)},re={p:k,um:Ut,m:Bt,r:Zt,mt:gt,mc:X,pc:ft,pbc:Q,n:se,o:e};return{render:Pe,hydrate:void 0,createApp:BL(Pe)}}function og({type:e,props:t},n){return n==="svg"&&e==="foreignObject"||n==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function ws({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function KL(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function tE(e,t,n=!1){const r=e.children,o=t.children;if(ye(r)&&ye(o))for(let i=0;i<r.length;i++){const l=r[i];let d=o[i];d.shapeFlag&1&&!d.dynamicChildren&&((d.patchFlag<=0||d.patchFlag===32)&&(d=o[i]=Ii(o[i]),d.el=l.el),!n&&d.patchFlag!==-2&&tE(l,d)),d.type===Op&&(d.el=l.el)}}function XL(e){const t=e.slice(),n=[0];let r,o,i,l,d;const p=e.length;for(r=0;r<p;r++){const h=e[r];if(h!==0){if(o=n[n.length-1],e[o]<h){t[r]=o,n.push(r);continue}for(i=0,l=n.length-1;i<l;)d=i+l>>1,e[n[d]]<h?i=d+1:l=d;h<e[n[i]]&&(i>0&&(t[r]=n[i-1]),n[i]=r)}}for(i=n.length,l=n[i-1];i-- >0;)n[i]=l,l=t[l];return n}function eE(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:eE(t)}function D2(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const YL=Symbol.for("v-scx"),QL=()=>Wf(YL);function Mi(e,t,n){return nE(e,t,n)}function nE(e,t,n=hn){const{immediate:r,deep:o,flush:i,once:l}=n,d=pr({},n),p=t&&r||!t&&i!=="post";let h;if(Ol){if(i==="sync"){const C=QL();h=C.__watcherHandles||(C.__watcherHandles=[])}else if(!p){const C=()=>{};return C.stop=ga,C.resume=ga,C.pause=ga,C}}const g=fr;d.call=(C,_,k)=>Ko(C,g,_,k);let y=!1;i==="post"?d.scheduler=C=>{uo(C,g&&g.suspense)}:i!=="sync"&&(y=!0,d.scheduler=(C,_)=>{_?C():Xv(C)}),d.augmentJob=C=>{t&&(C.flags|=4),y&&(C.flags|=2,g&&(C.id=g.uid,C.i=g))};const x=dL(e,t,d);return Ol&&(h?h.push(x):p&&x()),x}function JL(e,t,n){const r=this.proxy,o=Nn(e)?e.includes(".")?rE(r,e):()=>r[e]:e.bind(r,r);let i;Se(t)?i=t:(i=t.handler,n=t);const l=nd(this),d=nE(o,i.bind(r),n);return l(),d}function rE(e,t){const n=t.split(".");return()=>{let r=e;for(let o=0;o<n.length&&r;o++)r=r[n[o]];return r}}const ZL=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Po(t)}Modifiers`]||e[`${Xi(t)}Modifiers`];function t5(e,t,...n){if(e.isUnmounted)return;const r=e.vnode.props||hn;let o=n;const i=t.startsWith("update:"),l=i&&ZL(r,t.slice(7));l&&(l.trim&&(o=n.map(g=>Nn(g)?g.trim():g)),l.number&&(o=n.map(RB)));let d,p=r[d=Ym(t)]||r[d=Ym(Po(t))];!p&&i&&(p=r[d=Ym(Xi(t))]),p&&Ko(p,e,6,o);const h=r[d+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[d])return;e.emitted[d]=!0,Ko(h,e,6,o)}}function oE(e,t,n=!1){const r=t.emitsCache,o=r.get(e);if(o!==void 0)return o;const i=e.emits;let l={},d=!1;if(!Se(e)){const p=h=>{const g=oE(h,t,!0);g&&(d=!0,pr(l,g))};!n&&t.mixins.length&&t.mixins.forEach(p),e.extends&&p(e.extends),e.mixins&&e.mixins.forEach(p)}return!i&&!d?(En(e)&&r.set(e,null),null):(ye(i)?i.forEach(p=>l[p]=null):pr(l,i),En(e)&&r.set(e,l),l)}function Mp(e,t){return!e||!Sp(t)?!1:(t=t.slice(2).replace(/Once$/,""),Ye(e,t[0].toLowerCase()+t.slice(1))||Ye(e,Xi(t))||Ye(e,t))}function A2(e){const{type:t,vnode:n,proxy:r,withProxy:o,propsOptions:[i],slots:l,attrs:d,emit:p,render:h,renderCache:g,props:y,data:x,setupState:C,ctx:_,inheritAttrs:k}=e,A=Xf(e);let I,N;try{if(n.shapeFlag&4){const M=o||r,F=M;I=da(h.call(F,M,g,y,C,x,_)),N=d}else{const M=t;I=da(M.length>1?M(y,{attrs:d,slots:l,emit:p}):M(y,null)),N=t.props?d:e5(d)}}catch(M){Sl.length=0,Ip(M,e,1),I=In(Lr)}let D=I;if(N&&k!==!1){const M=Object.keys(N),{shapeFlag:F}=D;M.length&&F&7&&(i&&M.some(Bv)&&(N=n5(N,i)),D=Vi(D,N,!1,!0))}return n.dirs&&(D=Vi(D,null,!1,!0),D.dirs=D.dirs?D.dirs.concat(n.dirs):n.dirs),n.transition&&Nl(D,n.transition),I=D,Xf(A),I}const e5=e=>{let t;for(const n in e)(n==="class"||n==="style"||Sp(n))&&((t||(t={}))[n]=e[n]);return t},n5=(e,t)=>{const n={};for(const r in e)(!Bv(r)||!(r.slice(9)in t))&&(n[r]=e[r]);return n};function r5(e,t,n){const{props:r,children:o,component:i}=e,{props:l,children:d,patchFlag:p}=t,h=i.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&p>=0){if(p&1024)return!0;if(p&16)return r?I2(r,l,h):!!l;if(p&8){const g=t.dynamicProps;for(let y=0;y<g.length;y++){const x=g[y];if(l[x]!==r[x]&&!Mp(h,x))return!0}}}else return(o||d)&&(!d||!d.$stable)?!0:r===l?!1:r?l?I2(r,l,h):!0:!!l;return!1}function I2(e,t,n){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let o=0;o<r.length;o++){const i=r[o];if(t[i]!==e[i]&&!Mp(n,i))return!0}return!1}function o5({vnode:e,parent:t},n){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r===e)(e=t.vnode).el=n,t=t.parent;else break}}const aE=e=>e.__isSuspense;function a5(e,t){t&&t.pendingBranch?ye(e)?t.effects.push(...e):t.effects.push(e):hL(e)}const kr=Symbol.for("v-fgt"),Op=Symbol.for("v-txt"),Lr=Symbol.for("v-cmt"),Uf=Symbol.for("v-stc"),Sl=[];let fo=null;function de(e=!1){Sl.push(fo=e?null:[])}function i5(){Sl.pop(),fo=Sl[Sl.length-1]||null}let Pl=1;function N2(e,t=!1){Pl+=e,e<0&&fo&&t&&(fo.hasOnce=!0)}function iE(e){return e.dynamicChildren=Pl>0?fo||Gu:null,i5(),Pl>0&&fo&&fo.push(e),e}function He(e,t,n,r,o,i){return iE(Ve(e,t,n,r,o,i,!0))}function Vn(e,t,n,r,o){return iE(In(e,t,n,r,o,!0))}function Ml(e){return e?e.__v_isVNode===!0:!1}function Rs(e,t){return e.type===t.type&&e.key===t.key}const sE=({key:e})=>e??null,zf=({ref:e,ref_key:t,ref_for:n})=>(typeof e=="number"&&(e=""+e),e!=null?Nn(e)||Dr(e)||Se(e)?{i:Jn,r:e,k:t,f:!!n}:e:null);function Ve(e,t=null,n=null,r=0,o=null,i=e===kr?0:1,l=!1,d=!1){const p={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&sE(t),ref:t&&zf(t),scopeId:T_,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Jn};return d?(t0(p,n),i&128&&e.normalize(p)):n&&(p.shapeFlag|=Nn(n)?8:16),Pl>0&&!l&&fo&&(p.patchFlag>0||i&6)&&p.patchFlag!==32&&fo.push(p),p}const In=s5;function s5(e,t=null,n=null,r=0,o=null,i=!1){if((!e||e===L_)&&(e=Lr),Ml(e)){const d=Vi(e,t,!0);return n&&t0(d,n),Pl>0&&!i&&fo&&(d.shapeFlag&6?fo[fo.indexOf(e)]=d:fo.push(d)),d.patchFlag=-2,d}if(y5(e)&&(e=e.__vccOpts),t){t=u5(t);let{class:d,style:p}=t;d&&!Nn(d)&&(t.class=no(d)),En(p)&&(Kv(p)&&!ye(p)&&(p=pr({},p)),t.style=Tp(p))}const l=Nn(e)?1:aE(e)?128:D_(e)?64:En(e)?4:Se(e)?2:0;return Ve(e,t,n,r,o,l,i,!0)}function u5(e){return e?Kv(e)||j_(e)?pr({},e):e:null}function Vi(e,t,n=!1,r=!1){const{props:o,ref:i,patchFlag:l,children:d,transition:p}=e,h=t?pe(o||{},t):o,g={__v_isVNode:!0,__v_skip:!0,type:e.type,props:h,key:h&&sE(h),ref:t&&t.ref?n&&i?ye(i)?i.concat(zf(t)):[i,zf(t)]:zf(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:d,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==kr?l===-1?16:l|16:l,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:p,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Vi(e.ssContent),ssFallback:e.ssFallback&&Vi(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return p&&r&&Nl(g,p.clone(g)),g}function Us(e=" ",t=0){return In(Op,null,e,t)}function c5(e,t){const n=In(Uf,null,e);return n.staticCount=t,n}function Hn(e="",t=!1){return t?(de(),Vn(Lr,null,e)):In(Lr,null,e)}function da(e){return e==null||typeof e=="boolean"?In(Lr):ye(e)?In(kr,null,e.slice()):Ml(e)?Ii(e):In(Op,null,String(e))}function Ii(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Vi(e)}function t0(e,t){let n=0;const{shapeFlag:r}=e;if(t==null)t=null;else if(ye(t))n=16;else if(typeof t=="object")if(r&65){const o=t.default;o&&(o._c&&(o._d=!1),t0(e,o()),o._c&&(o._d=!0));return}else{n=32;const o=t._;!o&&!j_(t)?t._ctx=Jn:o===3&&Jn&&(Jn.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Se(t)?(t={default:t,_ctx:Jn},n=32):(t=String(t),r&64?(n=16,t=[Us(t)]):n=8);e.children=t,e.shapeFlag|=n}function pe(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const o in r)if(o==="class")t.class!==r.class&&(t.class=no([t.class,r.class]));else if(o==="style")t.style=Tp([t.style,r.style]);else if(Sp(o)){const i=t[o],l=r[o];l&&i!==l&&!(ye(i)&&i.includes(l))&&(t[o]=i?[].concat(i,l):l)}else o!==""&&(t[o]=r[o])}return t}function ia(e,t,n,r=null){Ko(e,t,7,[n,r])}const l5=H_();let d5=0;function f5(e,t,n){const r=e.type,o=(t?t.appContext:e.appContext)||l5,i={uid:d5++,vnode:e,type:r,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new FB(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:X_(r,o),emitsOptions:oE(r,o),emit:null,emitted:null,propsDefaults:hn,inheritAttrs:r.inheritAttrs,ctx:hn,data:hn,props:hn,attrs:hn,slots:hn,refs:hn,setupState:hn,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=t5.bind(null,i),e.ce&&e.ce(i),i}let fr=null;const e0=()=>fr||Jn;let Jf,Hg;{const e=Rp(),t=(n,r)=>{let o;return(o=e[n])||(o=e[n]=[]),o.push(r),i=>{o.length>1?o.forEach(l=>l(i)):o[0](i)}};Jf=t("__VUE_INSTANCE_SETTERS__",n=>fr=n),Hg=t("__VUE_SSR_SETTERS__",n=>Ol=n)}const nd=e=>{const t=fr;return Jf(e),e.scope.on(),()=>{e.scope.off(),Jf(t)}},P2=()=>{fr&&fr.scope.off(),Jf(null)};function uE(e){return e.vnode.shapeFlag&4}let Ol=!1;function p5(e,t=!1,n=!1){t&&Hg(t);const{props:r,children:o}=e.vnode,i=uE(e);WL(e,r,i,t),HL(e,o,n);const l=i?h5(e,t):void 0;return t&&Hg(!1),l}function h5(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,IL);const{setup:r}=n;if(r){Yi();const o=e.setupContext=r.length>1?g5(e):null,i=nd(e),l=ed(r,e,0,[e.props,o]),d=e_(l);if(Qi(),i(),(d||e.sp)&&!Xu(e)&&O_(e),d){if(l.then(P2,P2),t)return l.then(p=>{M2(e,p)}).catch(p=>{Ip(p,e,0)});e.asyncDep=l}else M2(e,l)}else cE(e)}function M2(e,t,n){Se(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:En(t)&&(e.setupState=C_(t)),cE(e)}function cE(e,t,n){const r=e.type;e.render||(e.render=r.render||ga);{const o=nd(e);Yi();try{NL(e)}finally{Qi(),o()}}}const m5={get(e,t){return _r(e,"get",""),e[t]}};function g5(e){const t=n=>{e.exposed=n||{}};return{attrs:new Proxy(e.attrs,m5),slots:e.slots,emit:e.emit,expose:t}}function Fp(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(C_(rL(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in Cl)return Cl[n](e)},has(t,n){return n in t||n in Cl}})):e.proxy}function v5(e,t=!0){return Se(e)?e.displayName||e.name:e.name||t&&e.__name}function y5(e){return Se(e)&&"__vccOpts"in e}const b5=(e,t)=>cL(e,t,Ol);function x5(e,t,n){const r=arguments.length;return r===2?En(t)&&!ye(t)?Ml(t)?In(e,null,[t]):In(e,t):In(e,null,t):(r>3?n=Array.prototype.slice.call(arguments,2):r===3&&Ml(n)&&(n=[n]),In(e,t,n))}const w5="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Gg;const O2=typeof window<"u"&&window.trustedTypes;if(O2)try{Gg=O2.createPolicy("vue",{createHTML:e=>e})}catch{}const lE=Gg?e=>Gg.createHTML(e):e=>e,C5="http://www.w3.org/2000/svg",S5="http://www.w3.org/1998/Math/MathML",Wa=typeof document<"u"?document:null,F2=Wa&&Wa.createElement("template"),_5={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,r)=>{const o=t==="svg"?Wa.createElementNS(C5,e):t==="mathml"?Wa.createElementNS(S5,e):n?Wa.createElement(e,{is:n}):Wa.createElement(e);return e==="select"&&r&&r.multiple!=null&&o.setAttribute("multiple",r.multiple),o},createText:e=>Wa.createTextNode(e),createComment:e=>Wa.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Wa.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,r,o,i){const l=n?n.previousSibling:t.lastChild;if(o&&(o===i||o.nextSibling))for(;t.insertBefore(o.cloneNode(!0),n),!(o===i||!(o=o.nextSibling)););else{F2.innerHTML=lE(r==="svg"?`<svg>${e}</svg>`:r==="mathml"?`<math>${e}</math>`:e);const d=F2.content;if(r==="svg"||r==="mathml"){const p=d.firstChild;for(;p.firstChild;)d.appendChild(p.firstChild);d.removeChild(p)}t.insertBefore(d,n)}return[l?l.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},Ei="transition",al="animation",Fl=Symbol("_vtc"),dE={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},E5=pr({},A_,dE),k5=e=>(e.displayName="Transition",e.props=E5,e),R5=k5((e,{slots:t})=>x5(yL,T5(e),t)),Cs=(e,t=[])=>{ye(e)?e.forEach(n=>n(...t)):e&&e(...t)},$2=e=>e?ye(e)?e.some(t=>t.length>1):e.length>1:!1;function T5(e){const t={};for(const at in e)at in dE||(t[at]=e[at]);if(e.css===!1)return t;const{name:n="v",type:r,duration:o,enterFromClass:i=`${n}-enter-from`,enterActiveClass:l=`${n}-enter-active`,enterToClass:d=`${n}-enter-to`,appearFromClass:p=i,appearActiveClass:h=l,appearToClass:g=d,leaveFromClass:y=`${n}-leave-from`,leaveActiveClass:x=`${n}-leave-active`,leaveToClass:C=`${n}-leave-to`}=e,_=D5(o),k=_&&_[0],A=_&&_[1],{onBeforeEnter:I,onEnter:N,onEnterCancelled:D,onLeave:M,onLeaveCancelled:F,onBeforeAppear:W=I,onAppear:L=N,onAppearCancelled:X=D}=t,q=(at,ht,gt,Ct)=>{at._enterCancelled=Ct,Ss(at,ht?g:d),Ss(at,ht?h:l),gt&&gt()},Q=(at,ht)=>{at._isLeaving=!1,Ss(at,y),Ss(at,C),Ss(at,x),ht&&ht()},it=at=>(ht,gt)=>{const Ct=at?L:N,pt=()=>q(ht,at,gt);Cs(Ct,[ht,pt]),B2(()=>{Ss(ht,at?p:i),Ba(ht,at?g:d),$2(Ct)||L2(ht,r,k,pt)})};return pr(t,{onBeforeEnter(at){Cs(I,[at]),Ba(at,i),Ba(at,l)},onBeforeAppear(at){Cs(W,[at]),Ba(at,p),Ba(at,h)},onEnter:it(!1),onAppear:it(!0),onLeave(at,ht){at._isLeaving=!0;const gt=()=>Q(at,ht);Ba(at,y),at._enterCancelled?(Ba(at,x),z2()):(z2(),Ba(at,x)),B2(()=>{at._isLeaving&&(Ss(at,y),Ba(at,C),$2(M)||L2(at,r,A,gt))}),Cs(M,[at,gt])},onEnterCancelled(at){q(at,!1,void 0,!0),Cs(D,[at])},onAppearCancelled(at){q(at,!0,void 0,!0),Cs(X,[at])},onLeaveCancelled(at){Q(at),Cs(F,[at])}})}function D5(e){if(e==null)return null;if(En(e))return[ag(e.enter),ag(e.leave)];{const t=ag(e);return[t,t]}}function ag(e){return TB(e)}function Ba(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e[Fl]||(e[Fl]=new Set)).add(t)}function Ss(e,t){t.split(/\s+/).forEach(r=>r&&e.classList.remove(r));const n=e[Fl];n&&(n.delete(t),n.size||(e[Fl]=void 0))}function B2(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let A5=0;function L2(e,t,n,r){const o=e._endId=++A5,i=()=>{o===e._endId&&r()};if(n!=null)return setTimeout(i,n);const{type:l,timeout:d,propCount:p}=I5(e,t);if(!l)return r();const h=l+"end";let g=0;const y=()=>{e.removeEventListener(h,x),i()},x=C=>{C.target===e&&++g>=p&&y()};setTimeout(()=>{g<p&&y()},d+1),e.addEventListener(h,x)}function I5(e,t){const n=window.getComputedStyle(e),r=_=>(n[_]||"").split(", "),o=r(`${Ei}Delay`),i=r(`${Ei}Duration`),l=W2(o,i),d=r(`${al}Delay`),p=r(`${al}Duration`),h=W2(d,p);let g=null,y=0,x=0;t===Ei?l>0&&(g=Ei,y=l,x=i.length):t===al?h>0&&(g=al,y=h,x=p.length):(y=Math.max(l,h),g=y>0?l>h?Ei:al:null,x=g?g===Ei?i.length:p.length:0);const C=g===Ei&&/\b(transform|all)(,|$)/.test(r(`${Ei}Property`).toString());return{type:g,timeout:y,propCount:x,hasTransform:C}}function W2(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,r)=>U2(n)+U2(e[r])))}function U2(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function z2(){return document.body.offsetHeight}function N5(e,t,n){const r=e[Fl];r&&(t=(t?[t,...r]:[...r]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}const Zf=Symbol("_vod"),fE=Symbol("_vsh"),P5={beforeMount(e,{value:t},{transition:n}){e[Zf]=e.style.display==="none"?"":e.style.display,n&&t?n.beforeEnter(e):il(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:r}){!t!=!n&&(r?t?(r.beforeEnter(e),il(e,!0),r.enter(e)):r.leave(e,()=>{il(e,!1)}):il(e,t))},beforeUnmount(e,{value:t}){il(e,t)}};function il(e,t){e.style.display=t?e[Zf]:"none",e[fE]=!t}const M5=Symbol(""),O5=/(^|;)\s*display\s*:/;function F5(e,t,n){const r=e.style,o=Nn(n);let i=!1;if(n&&!o){if(t)if(Nn(t))for(const l of t.split(";")){const d=l.slice(0,l.indexOf(":")).trim();n[d]==null&&Vf(r,d,"")}else for(const l in t)n[l]==null&&Vf(r,l,"");for(const l in n)l==="display"&&(i=!0),Vf(r,l,n[l])}else if(o){if(t!==n){const l=r[M5];l&&(n+=";"+l),r.cssText=n,i=O5.test(n)}}else t&&e.removeAttribute("style");Zf in e&&(e[Zf]=i?r.display:"",e[fE]&&(r.display="none"))}const V2=/\s*!important$/;function Vf(e,t,n){if(ye(n))n.forEach(r=>Vf(e,t,r));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const r=$5(e,t);V2.test(n)?e.setProperty(Xi(r),n.replace(V2,""),"important"):e[r]=n}}const H2=["Webkit","Moz","ms"],ig={};function $5(e,t){const n=ig[t];if(n)return n;let r=Po(t);if(r!=="filter"&&r in e)return ig[t]=r;r=kp(r);for(let o=0;o<H2.length;o++){const i=H2[o]+r;if(i in e)return ig[t]=i}return t}const G2="http://www.w3.org/1999/xlink";function q2(e,t,n,r,o,i=OB(t)){r&&t.startsWith("xlink:")?n==null?e.removeAttributeNS(G2,t.slice(6,t.length)):e.setAttributeNS(G2,t,n):n==null||i&&!a_(n)?e.removeAttribute(t):e.setAttribute(t,i?"":Qa(n)?String(n):n)}function j2(e,t,n,r,o){if(t==="innerHTML"||t==="textContent"){n!=null&&(e[t]=t==="innerHTML"?lE(n):n);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const d=i==="OPTION"?e.getAttribute("value")||"":e.value,p=n==null?e.type==="checkbox"?"on":"":String(n);(d!==p||!("_value"in e))&&(e.value=p),n==null&&e.removeAttribute(t),e._value=n;return}let l=!1;if(n===""||n==null){const d=typeof e[t];d==="boolean"?n=a_(n):n==null&&d==="string"?(n="",l=!0):d==="number"&&(n=0,l=!0)}try{e[t]=n}catch{}l&&e.removeAttribute(o||t)}function B5(e,t,n,r){e.addEventListener(t,n,r)}function L5(e,t,n,r){e.removeEventListener(t,n,r)}const K2=Symbol("_vei");function W5(e,t,n,r,o=null){const i=e[K2]||(e[K2]={}),l=i[t];if(r&&l)l.value=r;else{const[d,p]=U5(t);if(r){const h=i[t]=H5(r,o);B5(e,d,h,p)}else l&&(L5(e,d,l,p),i[t]=void 0)}}const X2=/(?:Once|Passive|Capture)$/;function U5(e){let t;if(X2.test(e)){t={};let r;for(;r=e.match(X2);)e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Xi(e.slice(2)),t]}let sg=0;const z5=Promise.resolve(),V5=()=>sg||(z5.then(()=>sg=0),sg=Date.now());function H5(e,t){const n=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=n.attached)return;Ko(G5(r,n.value),t,5,[r])};return n.value=e,n.attached=V5(),n}function G5(e,t){if(ye(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(r=>o=>!o._stopped&&r&&r(o))}else return t}const Y2=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,q5=(e,t,n,r,o,i)=>{const l=o==="svg";t==="class"?N5(e,r,l):t==="style"?F5(e,n,r):Sp(t)?Bv(t)||W5(e,t,n,r,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):j5(e,t,r,l))?(j2(e,t,r),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&q2(e,t,r,l,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!Nn(r))?j2(e,Po(t),r,i,t):(t==="true-value"?e._trueValue=r:t==="false-value"&&(e._falseValue=r),q2(e,t,r,l))};function j5(e,t,n,r){if(r)return!!(t==="innerHTML"||t==="textContent"||t in e&&Y2(t)&&Se(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const o=e.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return Y2(t)&&Nn(n)?!1:t in e}const K5={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Q2=(e,t)=>{const n=e._withKeys||(e._withKeys={}),r=t.join(".");return n[r]||(n[r]=o=>{if(!("key"in o))return;const i=Xi(o.key);if(t.some(l=>l===i||K5[l]===i))return e(o)})},X5=pr({patchProp:q5},_5);let J2;function Y5(){return J2||(J2=qL(X5))}const Q5=(...e)=>{const t=Y5().createApp(...e),{mount:n}=t;return t.mount=r=>{const o=Z5(r);if(!o)return;const i=t._component;!Se(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const l=n(o,!1,J5(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),l},t};function J5(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function Z5(e){return Nn(e)?document.querySelector(e):e}function t6(e,t){return e?e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className):!1}function pE(e,t){if(e&&t){const n=r=>{t6(e,r)||(e.classList?e.classList.add(r):e.className+=" "+r)};[t].flat().filter(Boolean).forEach(r=>r.split(" ").forEach(n))}}function _l(e,t){if(e&&t){const n=r=>{e.classList?e.classList.remove(r):e.className=e.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi")," ")};[t].flat().filter(Boolean).forEach(r=>r.split(" ").forEach(n))}}function Z2(e){return e?Math.abs(e.scrollLeft):0}function e6(e,t){return e instanceof HTMLElement?e.offsetWidth:0}function n6(e){if(e){let t=e.parentNode;return t&&t instanceof ShadowRoot&&t.host&&(t=t.host),t}return null}function r6(e){return!!(e!==null&&typeof e<"u"&&e.nodeName&&n6(e))}function rd(e){return typeof HTMLElement<"u"?e instanceof HTMLElement:e!==null&&typeof e=="object"&&e.nodeType===1&&typeof e.nodeName=="string"}function tp(e,t={}){if(rd(e)){const n=(r,o)=>{var i,l;const d=(i=e==null?void 0:e.$attrs)!=null&&i[r]?[(l=e==null?void 0:e.$attrs)==null?void 0:l[r]]:[];return[o].flat().reduce((p,h)=>{if(h!=null){const g=typeof h;if(g==="string"||g==="number")p.push(h);else if(g==="object"){const y=Array.isArray(h)?n(r,h):Object.entries(h).map(([x,C])=>r==="style"&&(C||C===0)?`${x.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${C}`:C?x:void 0);p=y.length?p.concat(y.filter(x=>!!x)):p}}return p},d)};Object.entries(t).forEach(([r,o])=>{if(o!=null){const i=r.match(/^on(.+)/);i?e.addEventListener(i[1].toLowerCase(),o):r==="p-bind"||r==="pBind"?tp(e,o):(o=r==="class"?[...new Set(n("class",o))].join(" ").trim():r==="style"?n("style",o).join(";").trim():o,(e.$attrs=e.$attrs||{})&&(e.$attrs[r]=o),e.setAttribute(r,o))}})}}function o6(e,t={},...n){{const r=document.createElement(e);return tp(r,t),r.append(...n),r}}function a6(e,t){return rd(e)?e.matches(t)?e:e.querySelector(t):null}function i6(e,t){if(rd(e)){const n=e.getAttribute(t);return isNaN(n)?n==="true"||n==="false"?n==="true":n:+n}}function tC(e){if(e){let t=e.offsetHeight;const n=getComputedStyle(e);return t-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)+parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth),t}return 0}function s6(e){if(e){const t=e.getBoundingClientRect();return{top:t.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:t.left+(window.pageXOffset||Z2(document.documentElement)||Z2(document.body)||0)}}return{top:"auto",left:"auto"}}function u6(e,t){return e?e.offsetHeight:0}function eC(e){if(e){let t=e.offsetWidth;const n=getComputedStyle(e);return t-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)+parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth),t}return 0}function c6(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function l6(e,t="",n){rd(e)&&n!==null&&n!==void 0&&e.setAttribute(t,n)}var d6=Object.defineProperty,nC=Object.getOwnPropertySymbols,f6=Object.prototype.hasOwnProperty,p6=Object.prototype.propertyIsEnumerable,rC=(e,t,n)=>t in e?d6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h6=(e,t)=>{for(var n in t||(t={}))f6.call(t,n)&&rC(e,n,t[n]);if(nC)for(var n of nC(t))p6.call(t,n)&&rC(e,n,t[n]);return e};function qs(e){return e==null||e===""||Array.isArray(e)&&e.length===0||!(e instanceof Date)&&typeof e=="object"&&Object.keys(e).length===0}function n0(e){return typeof e=="function"&&"call"in e&&"apply"in e}function Cn(e){return!qs(e)}function xa(e,t=!0){return e instanceof Object&&e.constructor===Object&&(t||Object.keys(e).length!==0)}function hE(e={},t={}){const n=h6({},e);return Object.keys(t).forEach(r=>{const o=r;xa(t[o])&&o in e&&xa(e[o])?n[o]=hE(e[o],t[o]):n[o]=t[o]}),n}function m6(...e){return e.reduce((t,n,r)=>r===0?n:hE(t,n),{})}function Io(e,...t){return n0(e)?e(...t):e}function ro(e,t=!0){return typeof e=="string"&&(t||e!=="")}function pa(e){return ro(e)?e.replace(/(-|_)/g,"").toLowerCase():e}function r0(e,t="",n={}){const r=pa(t).split("."),o=r.shift();if(o){if(xa(e)){const i=Object.keys(e).find(l=>pa(l)===o)||"";return r0(Io(e[i],n),r.join("."),n)}return}return Io(e,n)}function $p(e,t=!0){return Array.isArray(e)&&(t||e.length!==0)}function g6(e){return Cn(e)&&!isNaN(e)}function Ha(e,t){if(t){const n=t.test(e);return t.lastIndex=0,n}return!1}function v6(...e){return m6(...e)}function El(e){return e&&e.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"").replace(/ {2,}/g," ").replace(/ ([{:}]) /g,"$1").replace(/([;,]) /g,"$1").replace(/ !/g,"!").replace(/: /g,":")}function y6(e){return ro(e,!1)?e[0].toUpperCase()+e.slice(1):e}function mE(e){return ro(e)?e.replace(/(_)/g,"-").replace(/[A-Z]/g,(t,n)=>n===0?t:"-"+t.toLowerCase()).toLowerCase():e}function oC(e){return ro(e)?e.replace(/[A-Z]/g,(t,n)=>n===0?t:"."+t.toLowerCase()).toLowerCase():e}function gE(){const e=new Map;return{on(t,n){let r=e.get(t);return r?r.push(n):r=[n],e.set(t,r),this},off(t,n){const r=e.get(t);return r&&r.splice(r.indexOf(n)>>>0,1),this},emit(t,n){const r=e.get(t);r&&r.forEach(o=>{o(n)})},clear(){e.clear()}}}var _f={};function b6(e="pui_id_"){return Object.hasOwn(_f,e)||(_f[e]=0),_f[e]++,`${e}${_f[e]}`}var x6=Object.defineProperty,w6=Object.defineProperties,C6=Object.getOwnPropertyDescriptors,ep=Object.getOwnPropertySymbols,vE=Object.prototype.hasOwnProperty,yE=Object.prototype.propertyIsEnumerable,aC=(e,t,n)=>t in e?x6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vo=(e,t)=>{for(var n in t||(t={}))vE.call(t,n)&&aC(e,n,t[n]);if(ep)for(var n of ep(t))yE.call(t,n)&&aC(e,n,t[n]);return e},ug=(e,t)=>w6(e,C6(t)),La=(e,t)=>{var n={};for(var r in e)vE.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&ep)for(var r of ep(e))t.indexOf(r)<0&&yE.call(e,r)&&(n[r]=e[r]);return n},S6=gE(),cr=S6;function iC(e,t){$p(e)?e.push(...t||[]):xa(e)&&Object.assign(e,t)}function _6(e){return xa(e)&&e.hasOwnProperty("$value")&&e.hasOwnProperty("$type")?e.$value:e}function E6(e){return e.replaceAll(/ /g,"").replace(/[^\w]/g,"-")}function qg(e="",t=""){return E6(`${ro(e,!1)&&ro(t,!1)?`${e}-`:e}${t}`)}function bE(e="",t=""){return`--${qg(e,t)}`}function k6(e=""){const t=(e.match(/{/g)||[]).length,n=(e.match(/}/g)||[]).length;return(t+n)%2!==0}function xE(e,t="",n="",r=[],o){if(ro(e)){const i=/{([^}]*)}/g,l=e.trim();if(k6(l))return;if(Ha(l,i)){const d=l.replaceAll(i,g=>{const x=g.replace(/{|}/g,"").split(".").filter(C=>!r.some(_=>Ha(C,_)));return`var(${bE(n,mE(x.join("-")))}${Cn(o)?`, ${o}`:""})`}),p=/(\d+\s+[\+\-\*\/]\s+\d+)/g,h=/var\([^)]+\)/g;return Ha(d.replace(h,"0"),p)?`calc(${d})`:d}return l}else if(g6(e))return e}function R6(e,t,n){ro(t,!1)&&e.push(`${t}:${n};`)}function Vu(e,t){return e?`${e}{${t}}`:""}var kl=(...e)=>T6(en.getTheme(),...e),T6=(e={},t,n,r)=>{if(t){const{variable:o,options:i}=en.defaults||{},{prefix:l,transform:d}=(e==null?void 0:e.options)||i||{},h=Ha(t,/{([^}]*)}/g)?t:`{${t}}`;return r==="value"||qs(r)&&d==="strict"?en.getTokenValue(t):xE(h,void 0,l,[o.excludedKeyRegex],n)}return""};function D6(e,t={}){const n=en.defaults.variable,{prefix:r=n.prefix,selector:o=n.selector,excludedKeyRegex:i=n.excludedKeyRegex}=t,l=(h,g="")=>Object.entries(h).reduce((y,[x,C])=>{const _=Ha(x,i)?qg(g):qg(g,mE(x)),k=_6(C);if(xa(k)){const{variables:A,tokens:I}=l(k,_);iC(y.tokens,I),iC(y.variables,A)}else y.tokens.push((r?_.replace(`${r}-`,""):_).replaceAll("-",".")),R6(y.variables,bE(_),xE(k,_,r,[i]));return y},{variables:[],tokens:[]}),{variables:d,tokens:p}=l(e,r);return{value:d,tokens:p,declarations:d.join(""),css:Vu(o,d.join(""))}}var Uo={regex:{rules:{class:{pattern:/^\.([a-zA-Z][\w-]*)$/,resolve(e){return{type:"class",selector:e,matched:this.pattern.test(e.trim())}}},attr:{pattern:/^\[(.*)\]$/,resolve(e){return{type:"attr",selector:`:root${e}`,matched:this.pattern.test(e.trim())}}},media:{pattern:/^@media (.*)$/,resolve(e){return{type:"media",selector:`${e}{:root{[CSS]}}`,matched:this.pattern.test(e.trim())}}},system:{pattern:/^system$/,resolve(e){return{type:"system",selector:"@media (prefers-color-scheme: dark){:root{[CSS]}}",matched:this.pattern.test(e.trim())}}},custom:{resolve(e){return{type:"custom",selector:e,matched:!0}}}},resolve(e){const t=Object.keys(this.rules).filter(n=>n!=="custom").map(n=>this.rules[n]);return[e].flat().map(n=>{var r;return(r=t.map(o=>o.resolve(n)).find(o=>o.matched))!=null?r:this.rules.custom.resolve(n)})}},_toVariables(e,t){return D6(e,{prefix:t==null?void 0:t.prefix})},getCommon({name:e="",theme:t={},params:n,set:r,defaults:o}){var i,l,d,p,h,g,y;const{preset:x,options:C}=t;let _,k,A,I,N,D,M;if(Cn(x)&&C.transform!=="strict"){const{primitive:F,semantic:W,extend:L}=x,X=W||{},{colorScheme:q}=X,Q=La(X,["colorScheme"]),it=L||{},{colorScheme:at}=it,ht=La(it,["colorScheme"]),gt=q||{},{dark:Ct}=gt,pt=La(gt,["dark"]),lt=at||{},{dark:ft}=lt,Tt=La(lt,["dark"]),Pt=Cn(F)?this._toVariables({primitive:F},C):{},Bt=Cn(Q)?this._toVariables({semantic:Q},C):{},Ut=Cn(pt)?this._toVariables({light:pt},C):{},Zt=Cn(Ct)?this._toVariables({dark:Ct},C):{},Xt=Cn(ht)?this._toVariables({semantic:ht},C):{},ce=Cn(Tt)?this._toVariables({light:Tt},C):{},fe=Cn(ft)?this._toVariables({dark:ft},C):{},[se,jt]=[(i=Pt.declarations)!=null?i:"",Pt.tokens],[Pe,re]=[(l=Bt.declarations)!=null?l:"",Bt.tokens||[]],[_e,Y]=[(d=Ut.declarations)!=null?d:"",Ut.tokens||[]],[nt,mt]=[(p=Zt.declarations)!=null?p:"",Zt.tokens||[]],[Et,St]=[(h=Xt.declarations)!=null?h:"",Xt.tokens||[]],[Dt,$t]=[(g=ce.declarations)!=null?g:"",ce.tokens||[]],[Ft,It]=[(y=fe.declarations)!=null?y:"",fe.tokens||[]];_=this.transformCSS(e,se,"light","variable",C,r,o),k=jt;const Rt=this.transformCSS(e,`${Pe}${_e}`,"light","variable",C,r,o),Ht=this.transformCSS(e,`${nt}`,"dark","variable",C,r,o);A=`${Rt}${Ht}`,I=[...new Set([...re,...Y,...mt])];const Wt=this.transformCSS(e,`${Et}${Dt}color-scheme:light`,"light","variable",C,r,o),Yt=this.transformCSS(e,`${Ft}color-scheme:dark`,"dark","variable",C,r,o);N=`${Wt}${Yt}`,D=[...new Set([...St,...$t,...It])],M=Io(x.css,{dt:kl})}return{primitive:{css:_,tokens:k},semantic:{css:A,tokens:I},global:{css:N,tokens:D},style:M}},getPreset({name:e="",preset:t={},options:n,params:r,set:o,defaults:i,selector:l}){var d,p,h;let g,y,x;if(Cn(t)&&n.transform!=="strict"){const C=e.replace("-directive",""),_=t,{colorScheme:k,extend:A,css:I}=_,N=La(_,["colorScheme","extend","css"]),D=A||{},{colorScheme:M}=D,F=La(D,["colorScheme"]),W=k||{},{dark:L}=W,X=La(W,["dark"]),q=M||{},{dark:Q}=q,it=La(q,["dark"]),at=Cn(N)?this._toVariables({[C]:Vo(Vo({},N),F)},n):{},ht=Cn(X)?this._toVariables({[C]:Vo(Vo({},X),it)},n):{},gt=Cn(L)?this._toVariables({[C]:Vo(Vo({},L),Q)},n):{},[Ct,pt]=[(d=at.declarations)!=null?d:"",at.tokens||[]],[lt,ft]=[(p=ht.declarations)!=null?p:"",ht.tokens||[]],[Tt,Pt]=[(h=gt.declarations)!=null?h:"",gt.tokens||[]],Bt=this.transformCSS(C,`${Ct}${lt}`,"light","variable",n,o,i,l),Ut=this.transformCSS(C,Tt,"dark","variable",n,o,i,l);g=`${Bt}${Ut}`,y=[...new Set([...pt,...ft,...Pt])],x=Io(I,{dt:kl})}return{css:g,tokens:y,style:x}},getPresetC({name:e="",theme:t={},params:n,set:r,defaults:o}){var i;const{preset:l,options:d}=t,p=(i=l==null?void 0:l.components)==null?void 0:i[e];return this.getPreset({name:e,preset:p,options:d,params:n,set:r,defaults:o})},getPresetD({name:e="",theme:t={},params:n,set:r,defaults:o}){var i,l;const d=e.replace("-directive",""),{preset:p,options:h}=t,g=((i=p==null?void 0:p.components)==null?void 0:i[d])||((l=p==null?void 0:p.directives)==null?void 0:l[d]);return this.getPreset({name:d,preset:g,options:h,params:n,set:r,defaults:o})},applyDarkColorScheme(e){return!(e.darkModeSelector==="none"||e.darkModeSelector===!1)},getColorSchemeOption(e,t){var n;return this.applyDarkColorScheme(e)?this.regex.resolve(e.darkModeSelector===!0?t.options.darkModeSelector:(n=e.darkModeSelector)!=null?n:t.options.darkModeSelector):[]},getLayerOrder(e,t={},n,r){const{cssLayer:o}=t;return o?`@layer ${Io(o.order||"primeui",n)}`:""},getCommonStyleSheet({name:e="",theme:t={},params:n,props:r={},set:o,defaults:i}){const l=this.getCommon({name:e,theme:t,params:n,set:o,defaults:i}),d=Object.entries(r).reduce((p,[h,g])=>p.push(`${h}="${g}"`)&&p,[]).join(" ");return Object.entries(l||{}).reduce((p,[h,g])=>{if(g!=null&&g.css){const y=El(g==null?void 0:g.css),x=`${h}-variables`;p.push(`<style type="text/css" data-primevue-style-id="${x}" ${d}>${y}</style>`)}return p},[]).join("")},getStyleSheet({name:e="",theme:t={},params:n,props:r={},set:o,defaults:i}){var l;const d={name:e,theme:t,params:n,set:o,defaults:i},p=(l=e.includes("-directive")?this.getPresetD(d):this.getPresetC(d))==null?void 0:l.css,h=Object.entries(r).reduce((g,[y,x])=>g.push(`${y}="${x}"`)&&g,[]).join(" ");return p?`<style type="text/css" data-primevue-style-id="${e}-variables" ${h}>${El(p)}</style>`:""},createTokens(e={},t,n="",r="",o={}){return Object.entries(e).forEach(([i,l])=>{const d=Ha(i,t.variable.excludedKeyRegex)?n:n?`${n}.${oC(i)}`:oC(i),p=r?`${r}.${i}`:i;xa(l)?this.createTokens(l,t,d,p,o):(o[d]||(o[d]={paths:[],computed(h,g={}){var y,x;return this.paths.length===1?(y=this.paths[0])==null?void 0:y.computed(this.paths[0].scheme,g.binding):h&&h!=="none"?(x=this.paths.find(C=>C.scheme===h))==null?void 0:x.computed(h,g.binding):this.paths.map(C=>C.computed(C.scheme,g[C.scheme]))}}),o[d].paths.push({path:p,value:l,scheme:p.includes("colorScheme.light")?"light":p.includes("colorScheme.dark")?"dark":"none",computed(h,g={}){const y=/{([^}]*)}/g;let x=l;if(g.name=this.path,g.binding||(g.binding={}),Ha(l,y)){const _=l.trim().replaceAll(y,I=>{var N;const D=I.replace(/{|}/g,""),M=(N=o[D])==null?void 0:N.computed(h,g);return $p(M)&&M.length===2?`light-dark(${M[0].value},${M[1].value})`:M==null?void 0:M.value}),k=/(\d+\w*\s+[\+\-\*\/]\s+\d+\w*)/g,A=/var\([^)]+\)/g;x=Ha(_.replace(A,"0"),k)?`calc(${_})`:_}return qs(g.binding)&&delete g.binding,{colorScheme:h,path:this.path,paths:g,value:x.includes("undefined")?void 0:x}}}))}),o},getTokenValue(e,t,n){var r;const i=(p=>p.split(".").filter(g=>!Ha(g.toLowerCase(),n.variable.excludedKeyRegex)).join("."))(t),l=t.includes("colorScheme.light")?"light":t.includes("colorScheme.dark")?"dark":void 0,d=[(r=e[i])==null?void 0:r.computed(l)].flat().filter(p=>p);return d.length===1?d[0].value:d.reduce((p={},h)=>{const g=h,{colorScheme:y}=g,x=La(g,["colorScheme"]);return p[y]=x,p},void 0)},getSelectorRule(e,t,n,r){return n==="class"||n==="attr"?Vu(Cn(t)?`${e}${t},${e} ${t}`:e,r):Vu(e,Cn(t)?Vu(t,r):r)},transformCSS(e,t,n,r,o={},i,l,d){if(Cn(t)){const{cssLayer:p}=o;if(r!=="style"){const h=this.getColorSchemeOption(o,l);t=n==="dark"?h.reduce((g,{type:y,selector:x})=>(Cn(x)&&(g+=x.includes("[CSS]")?x.replace("[CSS]",t):this.getSelectorRule(x,d,y,t)),g),""):Vu(d??":root",t)}if(p){const h={name:"primeui"};xa(p)&&(h.name=Io(p.name,{name:e,type:r})),Cn(h.name)&&(t=Vu(`@layer ${h.name}`,t),i==null||i.layerNames(h.name))}return t}return""}},en={defaults:{variable:{prefix:"p",selector:":root",excludedKeyRegex:/^(primitive|semantic|components|directives|variables|colorscheme|light|dark|common|root|states|extend|css)$/gi},options:{prefix:"p",darkModeSelector:"system",cssLayer:!1}},_theme:void 0,_layerNames:new Set,_loadedStyleNames:new Set,_loadingStyles:new Set,_tokens:{},update(e={}){const{theme:t}=e;t&&(this._theme=ug(Vo({},t),{options:Vo(Vo({},this.defaults.options),t.options)}),this._tokens=Uo.createTokens(this.preset,this.defaults),this.clearLoadedStyleNames())},get theme(){return this._theme},get preset(){var e;return((e=this.theme)==null?void 0:e.preset)||{}},get options(){var e;return((e=this.theme)==null?void 0:e.options)||{}},get tokens(){return this._tokens},getTheme(){return this.theme},setTheme(e){this.update({theme:e}),cr.emit("theme:change",e)},getPreset(){return this.preset},setPreset(e){this._theme=ug(Vo({},this.theme),{preset:e}),this._tokens=Uo.createTokens(e,this.defaults),this.clearLoadedStyleNames(),cr.emit("preset:change",e),cr.emit("theme:change",this.theme)},getOptions(){return this.options},setOptions(e){this._theme=ug(Vo({},this.theme),{options:e}),this.clearLoadedStyleNames(),cr.emit("options:change",e),cr.emit("theme:change",this.theme)},getLayerNames(){return[...this._layerNames]},setLayerNames(e){this._layerNames.add(e)},getLoadedStyleNames(){return this._loadedStyleNames},isStyleNameLoaded(e){return this._loadedStyleNames.has(e)},setLoadedStyleName(e){this._loadedStyleNames.add(e)},deleteLoadedStyleName(e){this._loadedStyleNames.delete(e)},clearLoadedStyleNames(){this._loadedStyleNames.clear()},getTokenValue(e){return Uo.getTokenValue(this.tokens,e,this.defaults)},getCommon(e="",t){return Uo.getCommon({name:e,theme:this.theme,params:t,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getComponent(e="",t){const n={name:e,theme:this.theme,params:t,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return Uo.getPresetC(n)},getDirective(e="",t){const n={name:e,theme:this.theme,params:t,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return Uo.getPresetD(n)},getCustomPreset(e="",t,n,r){const o={name:e,preset:t,options:this.options,selector:n,params:r,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return Uo.getPreset(o)},getLayerOrderCSS(e=""){return Uo.getLayerOrder(e,this.options,{names:this.getLayerNames()},this.defaults)},transformCSS(e="",t,n="style",r){return Uo.transformCSS(e,t,r,n,this.options,{layerNames:this.setLayerNames.bind(this)},this.defaults)},getCommonStyleSheet(e="",t,n={}){return Uo.getCommonStyleSheet({name:e,theme:this.theme,params:t,props:n,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getStyleSheet(e,t,n={}){return Uo.getStyleSheet({name:e,theme:this.theme,params:t,props:n,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},onStyleMounted(e){this._loadingStyles.add(e)},onStyleUpdated(e){this._loadingStyles.add(e)},onStyleLoaded(e,{name:t}){this._loadingStyles.size&&(this._loadingStyles.delete(t),cr.emit(`theme:${t}:load`,e),!this._loadingStyles.size&&cr.emit("theme:load"))}},Pi={_loadedStyleNames:new Set,getLoadedStyleNames:function(){return this._loadedStyleNames},isStyleNameLoaded:function(t){return this._loadedStyleNames.has(t)},setLoadedStyleName:function(t){this._loadedStyleNames.add(t)},deleteLoadedStyleName:function(t){this._loadedStyleNames.delete(t)},clearLoadedStyleNames:function(){this._loadedStyleNames.clear()}},A6=({dt:e})=>`
*,
::before,
::after {
    box-sizing: border-box;
}

/* Non vue overlay animations */
.p-connected-overlay {
    opacity: 0;
    transform: scaleY(0.8);
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-visible {
    opacity: 1;
    transform: scaleY(1);
}

.p-connected-overlay-hidden {
    opacity: 0;
    transform: scaleY(1);
    transition: opacity 0.1s linear;
}

/* Vue based overlay animations */
.p-connected-overlay-enter-from {
    opacity: 0;
    transform: scaleY(0.8);
}

.p-connected-overlay-leave-to {
    opacity: 0;
}

.p-connected-overlay-enter-active {
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-leave-active {
    transition: opacity 0.1s linear;
}

/* Toggleable Content */
.p-toggleable-content-enter-from,
.p-toggleable-content-leave-to {
    max-height: 0;
}

.p-toggleable-content-enter-to,
.p-toggleable-content-leave-from {
    max-height: 1000px;
}

.p-toggleable-content-leave-active {
    overflow: hidden;
    transition: max-height 0.45s cubic-bezier(0, 1, 0, 1);
}

.p-toggleable-content-enter-active {
    overflow: hidden;
    transition: max-height 1s ease-in-out;
}

.p-disabled,
.p-disabled * {
    cursor: default;
    pointer-events: none;
    user-select: none;
}

.p-disabled,
.p-component:disabled {
    opacity: ${e("disabled.opacity")};
}

.pi {
    font-size: ${e("icon.size")};
}

.p-icon {
    width: ${e("icon.size")};
    height: ${e("icon.size")};
}

.p-overlay-mask {
    background: ${e("mask.background")};
    color: ${e("mask.color")};
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.p-overlay-mask-enter {
    animation: p-overlay-mask-enter-animation ${e("mask.transition.duration")} forwards;
}

.p-overlay-mask-leave {
    animation: p-overlay-mask-leave-animation ${e("mask.transition.duration")} forwards;
}

@keyframes p-overlay-mask-enter-animation {
    from {
        background: transparent;
    }
    to {
        background: ${e("mask.background")};
    }
}
@keyframes p-overlay-mask-leave-animation {
    from {
        background: ${e("mask.background")};
    }
    to {
        background: transparent;
    }
}
`;function $l(e){"@babel/helpers - typeof";return $l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$l(e)}function sC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function uC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sC(Object(n),!0).forEach(function(r){I6(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function I6(e,t,n){return(t=N6(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N6(e){var t=P6(e,"string");return $l(t)=="symbol"?t:t+""}function P6(e,t){if($l(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if($l(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function M6(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e0()?Yv(e):t?e():__(e)}var O6=0;function F6(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=Lf(!1),r=Lf(e),o=Lf(null),i=c6()?window.document:void 0,l=t.document,d=l===void 0?i:l,p=t.immediate,h=p===void 0?!0:p,g=t.manual,y=g===void 0?!1:g,x=t.name,C=x===void 0?"style_".concat(++O6):x,_=t.id,k=_===void 0?void 0:_,A=t.media,I=A===void 0?void 0:A,N=t.nonce,D=N===void 0?void 0:N,M=t.first,F=M===void 0?!1:M,W=t.onMounted,L=W===void 0?void 0:W,X=t.onUpdated,q=X===void 0?void 0:X,Q=t.onLoad,it=Q===void 0?void 0:Q,at=t.props,ht=at===void 0?{}:at,gt=function(){},Ct=function(ft){var Tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(d){var Pt=uC(uC({},ht),Tt),Bt=Pt.name||C,Ut=Pt.id||k,Zt=Pt.nonce||D;o.value=d.querySelector('style[data-primevue-style-id="'.concat(Bt,'"]'))||d.getElementById(Ut)||d.createElement("style"),o.value.isConnected||(r.value=ft||e,tp(o.value,{type:"text/css",id:Ut,media:I,nonce:Zt}),F?d.head.prepend(o.value):d.head.appendChild(o.value),l6(o.value,"data-primevue-style-id",Bt),tp(o.value,Pt),o.value.onload=function(Xt){return it==null?void 0:it(Xt,{name:Bt})},L==null||L(Bt)),!n.value&&(gt=Mi(r,function(Xt){o.value.textContent=Xt,q==null||q(Bt)},{immediate:!0}),n.value=!0)}},pt=function(){!d||!n.value||(gt(),r6(o.value)&&d.head.removeChild(o.value),n.value=!1)};return h&&!y&&M6(Ct),{id:k,name:C,el:o,css:r,unload:pt,load:Ct,isLoaded:qv(n)}}function Bl(e){"@babel/helpers - typeof";return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bl(e)}function cC(e,t){return W6(e)||L6(e,t)||B6(e,t)||$6()}function $6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B6(e,t){if(e){if(typeof e=="string")return lC(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lC(e,t):void 0}}function lC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function L6(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,o,i,l,d=[],p=!0,h=!1;try{if(i=(n=n.call(e)).next,t!==0)for(;!(p=(r=i.call(n)).done)&&(d.push(r.value),d.length!==t);p=!0);}catch(g){h=!0,o=g}finally{try{if(!p&&n.return!=null&&(l=n.return(),Object(l)!==l))return}finally{if(h)throw o}}return d}}function W6(e){if(Array.isArray(e))return e}function dC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function cg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dC(Object(n),!0).forEach(function(r){U6(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function U6(e,t,n){return(t=z6(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z6(e){var t=V6(e,"string");return Bl(t)=="symbol"?t:t+""}function V6(e,t){if(Bl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Bl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var H6=function(t){var n=t.dt;return`
.p-hidden-accessible {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    opacity: 0;
    overflow: hidden;
    padding: 0;
    pointer-events: none;
    position: absolute;
    white-space: nowrap;
    width: 1px;
}

.p-overflow-hidden {
    overflow: hidden;
    padding-right: `.concat(n("scrollbar.width"),`;
}
`)},G6={},q6={},mn={name:"base",css:H6,style:A6,classes:G6,inlineStyles:q6,load:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(i){return i},o=r(Io(t,{dt:kl}));return Cn(o)?F6(El(o),cg({name:this.name},n)):{}},loadCSS:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.load(this.css,t)},loadStyle:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return this.load(this.style,n,function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return en.transformCSS(n.name||t.name,"".concat(o).concat(r))})},getCommonTheme:function(t){return en.getCommon(this.name,t)},getComponentTheme:function(t){return en.getComponent(this.name,t)},getDirectiveTheme:function(t){return en.getDirective(this.name,t)},getPresetTheme:function(t,n,r){return en.getCustomPreset(this.name,t,n,r)},getLayerOrderThemeCSS:function(){return en.getLayerOrderCSS(this.name)},getStyleSheet:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.css){var r=Io(this.css,{dt:kl})||"",o=El("".concat(r).concat(t)),i=Object.entries(n).reduce(function(l,d){var p=cC(d,2),h=p[0],g=p[1];return l.push("".concat(h,'="').concat(g,'"'))&&l},[]).join(" ");return Cn(o)?'<style type="text/css" data-primevue-style-id="'.concat(this.name,'" ').concat(i,">").concat(o,"</style>"):""}return""},getCommonThemeStyleSheet:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return en.getCommonStyleSheet(this.name,t,n)},getThemeStyleSheet:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=[en.getStyleSheet(this.name,t,n)];if(this.style){var o=this.name==="base"?"global-style":"".concat(this.name,"-style"),i=Io(this.style,{dt:kl}),l=El(en.transformCSS(o,i)),d=Object.entries(n).reduce(function(p,h){var g=cC(h,2),y=g[0],x=g[1];return p.push("".concat(y,'="').concat(x,'"'))&&p},[]).join(" ");Cn(l)&&r.push('<style type="text/css" data-primevue-style-id="'.concat(o,'" ').concat(d,">").concat(l,"</style>"))}return r.join("")},extend:function(t){return cg(cg({},this),{},{css:void 0,style:void 0},t)}};function j6(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"pc",t=bL();return"".concat(e).concat(t.replace("v-","").replaceAll("-","_"))}var fC=mn.extend({name:"common"});function Ll(e){"@babel/helpers - typeof";return Ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ll(e)}function K6(e){return SE(e)||X6(e)||CE(e)||wE()}function X6(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function sl(e,t){return SE(e)||Y6(e,t)||CE(e,t)||wE()}function wE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CE(e,t){if(e){if(typeof e=="string")return pC(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pC(e,t):void 0}}function pC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Y6(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,o,i,l,d=[],p=!0,h=!1;try{if(i=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;p=!1}else for(;!(p=(r=i.call(n)).done)&&(d.push(r.value),d.length!==t);p=!0);}catch(g){h=!0,o=g}finally{try{if(!p&&n.return!=null&&(l=n.return(),Object(l)!==l))return}finally{if(h)throw o}}return d}}function SE(e){if(Array.isArray(e))return e}function hC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hC(Object(n),!0).forEach(function(r){dl(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function dl(e,t,n){return(t=Q6(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q6(e){var t=J6(e,"string");return Ll(t)=="symbol"?t:t+""}function J6(e,t){if(Ll(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Ll(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var js={name:"BaseComponent",props:{pt:{type:Object,default:void 0},ptOptions:{type:Object,default:void 0},unstyled:{type:Boolean,default:void 0},dt:{type:Object,default:void 0}},inject:{$parentInstance:{default:void 0}},watch:{isUnstyled:{immediate:!0,handler:function(t){cr.off("theme:change",this._loadCoreStyles),t||(this._loadCoreStyles(),this._themeChangeListener(this._loadCoreStyles))}},dt:{immediate:!0,handler:function(t,n){var r=this;cr.off("theme:change",this._themeScopedListener),t?(this._loadScopedThemeStyles(t),this._themeScopedListener=function(){return r._loadScopedThemeStyles(t)},this._themeChangeListener(this._themeScopedListener)):this._unloadScopedThemeStyles()}}},scopedStyleEl:void 0,rootEl:void 0,uid:void 0,$attrSelector:void 0,beforeCreate:function(){var t,n,r,o,i,l,d,p,h,g,y,x=(t=this.pt)===null||t===void 0?void 0:t._usept,C=x?(n=this.pt)===null||n===void 0||(n=n.originalValue)===null||n===void 0?void 0:n[this.$.type.name]:void 0,_=x?(r=this.pt)===null||r===void 0||(r=r.value)===null||r===void 0?void 0:r[this.$.type.name]:this.pt;(o=_||C)===null||o===void 0||(o=o.hooks)===null||o===void 0||(i=o.onBeforeCreate)===null||i===void 0||i.call(o);var k=(l=this.$primevueConfig)===null||l===void 0||(l=l.pt)===null||l===void 0?void 0:l._usept,A=k?(d=this.$primevue)===null||d===void 0||(d=d.config)===null||d===void 0||(d=d.pt)===null||d===void 0?void 0:d.originalValue:void 0,I=k?(p=this.$primevue)===null||p===void 0||(p=p.config)===null||p===void 0||(p=p.pt)===null||p===void 0?void 0:p.value:(h=this.$primevue)===null||h===void 0||(h=h.config)===null||h===void 0?void 0:h.pt;(g=I||A)===null||g===void 0||(g=g[this.$.type.name])===null||g===void 0||(g=g.hooks)===null||g===void 0||(y=g.onBeforeCreate)===null||y===void 0||y.call(g),this.$attrSelector=j6(),this.uid=this.$attrs.id||this.$attrSelector.replace("pc","pv_id_")},created:function(){this._hook("onCreated")},beforeMount:function(){var t;this.rootEl=a6(rd(this.$el)?this.$el:(t=this.$el)===null||t===void 0?void 0:t.parentElement,"[".concat(this.$attrSelector,"]")),this.rootEl&&(this.rootEl.$pc=Me({name:this.$.type.name,attrSelector:this.$attrSelector},this.$params)),this._loadStyles(),this._hook("onBeforeMount")},mounted:function(){this._hook("onMounted")},beforeUpdate:function(){this._hook("onBeforeUpdate")},updated:function(){this._hook("onUpdated")},beforeUnmount:function(){this._hook("onBeforeUnmount")},unmounted:function(){this._removeThemeListeners(),this._unloadScopedThemeStyles(),this._hook("onUnmounted")},methods:{_hook:function(t){if(!this.$options.hostName){var n=this._usePT(this._getPT(this.pt,this.$.type.name),this._getOptionValue,"hooks.".concat(t)),r=this._useDefaultPT(this._getOptionValue,"hooks.".concat(t));n==null||n(),r==null||r()}},_mergeProps:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return n0(t)?t.apply(void 0,r):pe.apply(void 0,r)},_load:function(){Pi.isStyleNameLoaded("base")||(mn.loadCSS(this.$styleOptions),this._loadGlobalStyles(),Pi.setLoadedStyleName("base")),this._loadThemeStyles()},_loadStyles:function(){this._load(),this._themeChangeListener(this._load)},_loadCoreStyles:function(){var t,n;!Pi.isStyleNameLoaded((t=this.$style)===null||t===void 0?void 0:t.name)&&(n=this.$style)!==null&&n!==void 0&&n.name&&(fC.loadCSS(this.$styleOptions),this.$options.style&&this.$style.loadCSS(this.$styleOptions),Pi.setLoadedStyleName(this.$style.name))},_loadGlobalStyles:function(){var t=this._useGlobalPT(this._getOptionValue,"global.css",this.$params);Cn(t)&&mn.load(t,Me({name:"global"},this.$styleOptions))},_loadThemeStyles:function(){var t,n;if(!(this.isUnstyled||this.$theme==="none")){if(!en.isStyleNameLoaded("common")){var r,o,i=((r=this.$style)===null||r===void 0||(o=r.getCommonTheme)===null||o===void 0?void 0:o.call(r))||{},l=i.primitive,d=i.semantic,p=i.global,h=i.style;mn.load(l==null?void 0:l.css,Me({name:"primitive-variables"},this.$styleOptions)),mn.load(d==null?void 0:d.css,Me({name:"semantic-variables"},this.$styleOptions)),mn.load(p==null?void 0:p.css,Me({name:"global-variables"},this.$styleOptions)),mn.loadStyle(Me({name:"global-style"},this.$styleOptions),h),en.setLoadedStyleName("common")}if(!en.isStyleNameLoaded((t=this.$style)===null||t===void 0?void 0:t.name)&&(n=this.$style)!==null&&n!==void 0&&n.name){var g,y,x,C,_=((g=this.$style)===null||g===void 0||(y=g.getComponentTheme)===null||y===void 0?void 0:y.call(g))||{},k=_.css,A=_.style;(x=this.$style)===null||x===void 0||x.load(k,Me({name:"".concat(this.$style.name,"-variables")},this.$styleOptions)),(C=this.$style)===null||C===void 0||C.loadStyle(Me({name:"".concat(this.$style.name,"-style")},this.$styleOptions),A),en.setLoadedStyleName(this.$style.name)}if(!en.isStyleNameLoaded("layer-order")){var I,N,D=(I=this.$style)===null||I===void 0||(N=I.getLayerOrderThemeCSS)===null||N===void 0?void 0:N.call(I);mn.load(D,Me({name:"layer-order",first:!0},this.$styleOptions)),en.setLoadedStyleName("layer-order")}}},_loadScopedThemeStyles:function(t){var n,r,o,i=((n=this.$style)===null||n===void 0||(r=n.getPresetTheme)===null||r===void 0?void 0:r.call(n,t,"[".concat(this.$attrSelector,"]")))||{},l=i.css,d=(o=this.$style)===null||o===void 0?void 0:o.load(l,Me({name:"".concat(this.$attrSelector,"-").concat(this.$style.name)},this.$styleOptions));this.scopedStyleEl=d.el},_unloadScopedThemeStyles:function(){var t;(t=this.scopedStyleEl)===null||t===void 0||(t=t.value)===null||t===void 0||t.remove()},_themeChangeListener:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){};Pi.clearLoadedStyleNames(),cr.on("theme:change",t)},_removeThemeListeners:function(){cr.off("theme:change",this._loadCoreStyles),cr.off("theme:change",this._load),cr.off("theme:change",this._themeScopedListener)},_getHostInstance:function(t){return t?this.$options.hostName?t.$.type.name===this.$options.hostName?t:this._getHostInstance(t.$parentInstance):t.$parentInstance:void 0},_getPropValue:function(t){var n;return this[t]||((n=this._getHostInstance(this))===null||n===void 0?void 0:n[t])},_getOptionValue:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r0(t,n,r)},_getPTValue:function(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,l=/./g.test(r)&&!!o[r.split(".")[0]],d=this._getPropValue("ptOptions")||((t=this.$primevueConfig)===null||t===void 0?void 0:t.ptOptions)||{},p=d.mergeSections,h=p===void 0?!0:p,g=d.mergeProps,y=g===void 0?!1:g,x=i?l?this._useGlobalPT(this._getPTClassValue,r,o):this._useDefaultPT(this._getPTClassValue,r,o):void 0,C=l?void 0:this._getPTSelf(n,this._getPTClassValue,r,Me(Me({},o),{},{global:x||{}})),_=this._getPTDatasets(r);return h||!h&&C?y?this._mergeProps(y,x,C,_):Me(Me(Me({},x),C),_):Me(Me({},C),_)},_getPTSelf:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return pe(this._usePT.apply(this,[this._getPT(t,this.$name)].concat(r)),this._usePT.apply(this,[this.$_attrsPT].concat(r)))},_getPTDatasets:function(){var t,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o="data-pc-",i=r==="root"&&Cn((t=this.pt)===null||t===void 0?void 0:t["data-pc-section"]);return r!=="transition"&&Me(Me({},r==="root"&&Me(Me(dl({},"".concat(o,"name"),pa(i?(n=this.pt)===null||n===void 0?void 0:n["data-pc-section"]:this.$.type.name)),i&&dl({},"".concat(o,"extend"),pa(this.$.type.name))),{},dl({},"".concat(this.$attrSelector),""))),{},dl({},"".concat(o,"section"),pa(r)))},_getPTClassValue:function(){var t=this._getOptionValue.apply(this,arguments);return ro(t)||$p(t)?{class:t}:t},_getPT:function(t){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0,i=function(d){var p,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,g=o?o(d):d,y=pa(r),x=pa(n.$name);return(p=h?y!==x?g==null?void 0:g[y]:void 0:g==null?void 0:g[y])!==null&&p!==void 0?p:g};return t!=null&&t.hasOwnProperty("_usept")?{_usept:t._usept,originalValue:i(t.originalValue),value:i(t.value)}:i(t,!0)},_usePT:function(t,n,r,o){var i=function(k){return n(k,r,o)};if(t!=null&&t.hasOwnProperty("_usept")){var l,d=t._usept||((l=this.$primevueConfig)===null||l===void 0?void 0:l.ptOptions)||{},p=d.mergeSections,h=p===void 0?!0:p,g=d.mergeProps,y=g===void 0?!1:g,x=i(t.originalValue),C=i(t.value);return x===void 0&&C===void 0?void 0:ro(C)?C:ro(x)?x:h||!h&&C?y?this._mergeProps(y,x,C):Me(Me({},x),C):C}return i(t)},_useGlobalPT:function(t,n,r){return this._usePT(this.globalPT,t,n,r)},_useDefaultPT:function(t,n,r){return this._usePT(this.defaultPT,t,n,r)},ptm:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._getPTValue(this.pt,t,Me(Me({},this.$params),n))},ptmi:function(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=pe(this.$_attrsWithoutPT,this.ptm(n,r));return o!=null&&o.hasOwnProperty("id")&&((t=o.id)!==null&&t!==void 0||(o.id=this.$id)),o},ptmo:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._getPTValue(t,n,Me({instance:this},r),!1)},cx:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.isUnstyled?void 0:this._getOptionValue(this.$style.classes,t,Me(Me({},this.$params),n))},sx:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n){var o=this._getOptionValue(this.$style.inlineStyles,t,Me(Me({},this.$params),r)),i=this._getOptionValue(fC.inlineStyles,t,Me(Me({},this.$params),r));return[i,o]}}},computed:{globalPT:function(){var t,n=this;return this._getPT((t=this.$primevueConfig)===null||t===void 0?void 0:t.pt,void 0,function(r){return Io(r,{instance:n})})},defaultPT:function(){var t,n=this;return this._getPT((t=this.$primevueConfig)===null||t===void 0?void 0:t.pt,void 0,function(r){return n._getOptionValue(r,n.$name,Me({},n.$params))||Io(r,Me({},n.$params))})},isUnstyled:function(){var t;return this.unstyled!==void 0?this.unstyled:(t=this.$primevueConfig)===null||t===void 0?void 0:t.unstyled},$id:function(){return this.$attrs.id||this.uid},$inProps:function(){var t,n=Object.keys(((t=this.$.vnode)===null||t===void 0?void 0:t.props)||{});return Object.fromEntries(Object.entries(this.$props).filter(function(r){var o=sl(r,1),i=o[0];return n==null?void 0:n.includes(i)}))},$theme:function(){var t;return(t=this.$primevueConfig)===null||t===void 0?void 0:t.theme},$style:function(){return Me(Me({classes:void 0,inlineStyles:void 0,load:function(){},loadCSS:function(){},loadStyle:function(){}},(this._getHostInstance(this)||{}).$style),this.$options.style)},$styleOptions:function(){var t;return{nonce:(t=this.$primevueConfig)===null||t===void 0||(t=t.csp)===null||t===void 0?void 0:t.nonce}},$primevueConfig:function(){var t;return(t=this.$primevue)===null||t===void 0?void 0:t.config},$name:function(){return this.$options.hostName||this.$.type.name},$params:function(){var t=this._getHostInstance(this)||this.$parent;return{instance:this,props:this.$props,state:this.$data,attrs:this.$attrs,parent:{instance:t,props:t==null?void 0:t.$props,state:t==null?void 0:t.$data,attrs:t==null?void 0:t.$attrs}}},$_attrsPT:function(){return Object.entries(this.$attrs||{}).filter(function(t){var n=sl(t,1),r=n[0];return r==null?void 0:r.startsWith("pt:")}).reduce(function(t,n){var r=sl(n,2),o=r[0],i=r[1],l=o.split(":"),d=K6(l),p=d.slice(1);return p==null||p.reduce(function(h,g,y,x){return!h[g]&&(h[g]=y===x.length-1?i:{}),h[g]},t),t},{})},$_attrsWithoutPT:function(){return Object.entries(this.$attrs||{}).filter(function(t){var n=sl(t,1),r=n[0];return!(r!=null&&r.startsWith("pt:"))}).reduce(function(t,n){var r=sl(n,2),o=r[0],i=r[1];return t[o]=i,t},{})}}},Z6=`
.p-icon {
    display: inline-block;
    vertical-align: baseline;
}

.p-icon-spin {
    -webkit-animation: p-icon-spin 2s infinite linear;
    animation: p-icon-spin 2s infinite linear;
}

@-webkit-keyframes p-icon-spin {
    0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100% {
        -webkit-transform: rotate(359deg);
        transform: rotate(359deg);
    }
}

@keyframes p-icon-spin {
    0% {
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100% {
        -webkit-transform: rotate(359deg);
        transform: rotate(359deg);
    }
}
`,tW=mn.extend({name:"baseicon",css:Z6});function Wl(e){"@babel/helpers - typeof";return Wl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wl(e)}function mC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function gC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mC(Object(n),!0).forEach(function(r){eW(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function eW(e,t,n){return(t=nW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nW(e){var t=rW(e,"string");return Wl(t)=="symbol"?t:t+""}function rW(e,t){if(Wl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Wl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Bp={name:"BaseIcon",extends:js,props:{label:{type:String,default:void 0},spin:{type:Boolean,default:!1}},style:tW,provide:function(){return{$pcIcon:this,$parentInstance:this}},methods:{pti:function(){var t=qs(this.label);return gC(gC({},!this.isUnstyled&&{class:["p-icon",{"p-icon-spin":this.spin}]}),{},{role:t?void 0:"img","aria-label":t?void 0:this.label,"aria-hidden":t})}}},_E={name:"PlusIcon",extends:Bp};function oW(e,t,n,r,o,i){return de(),He("svg",pe({width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e.pti()),t[0]||(t[0]=[Ve("path",{d:"M7.67742 6.32258V0.677419C7.67742 0.497757 7.60605 0.325452 7.47901 0.198411C7.35197 0.0713707 7.17966 0 7 0C6.82034 0 6.64803 0.0713707 6.52099 0.198411C6.39395 0.325452 6.32258 0.497757 6.32258 0.677419V6.32258H0.677419C0.497757 6.32258 0.325452 6.39395 0.198411 6.52099C0.0713707 6.64803 0 6.82034 0 7C0 7.17966 0.0713707 7.35197 0.198411 7.47901C0.325452 7.60605 0.497757 7.67742 0.677419 7.67742H6.32258V13.3226C6.32492 13.5015 6.39704 13.6725 6.52358 13.799C6.65012 13.9255 6.82106 13.9977 7 14C7.17966 14 7.35197 13.9286 7.47901 13.8016C7.60605 13.6745 7.67742 13.5022 7.67742 13.3226V7.67742H13.3226C13.5022 7.67742 13.6745 7.60605 13.8016 7.47901C13.9286 7.35197 14 7.17966 14 7C13.9977 6.82106 13.9255 6.65012 13.799 6.52358C13.6725 6.39704 13.5015 6.32492 13.3226 6.32258H7.67742Z",fill:"currentColor"},null,-1)]),16)}_E.render=oW;var Lp={name:"TimesIcon",extends:Bp};function aW(e,t,n,r,o,i){return de(),He("svg",pe({width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e.pti()),t[0]||(t[0]=[Ve("path",{d:"M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z",fill:"currentColor"},null,-1)]),16)}Lp.render=aW;var EE={name:"UploadIcon",extends:Bp};function iW(e,t,n,r,o,i){return de(),He("svg",pe({width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e.pti()),t[0]||(t[0]=[Ve("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.58942 9.82197C6.70165 9.93405 6.85328 9.99793 7.012 10C7.17071 9.99793 7.32234 9.93405 7.43458 9.82197C7.54681 9.7099 7.61079 9.55849 7.61286 9.4V2.04798L9.79204 4.22402C9.84752 4.28011 9.91365 4.32457 9.98657 4.35479C10.0595 4.38502 10.1377 4.40039 10.2167 4.40002C10.2956 4.40039 10.3738 4.38502 10.4467 4.35479C10.5197 4.32457 10.5858 4.28011 10.6413 4.22402C10.7538 4.11152 10.817 3.95902 10.817 3.80002C10.817 3.64102 10.7538 3.48852 10.6413 3.37602L7.45127 0.190618C7.44656 0.185584 7.44176 0.180622 7.43687 0.175736C7.32419 0.063214 7.17136 0 7.012 0C6.85264 0 6.69981 0.063214 6.58712 0.175736C6.58181 0.181045 6.5766 0.186443 6.5715 0.191927L3.38282 3.37602C3.27669 3.48976 3.2189 3.6402 3.22165 3.79564C3.2244 3.95108 3.28746 4.09939 3.39755 4.20932C3.50764 4.31925 3.65616 4.38222 3.81182 4.38496C3.96749 4.3877 4.11814 4.33001 4.23204 4.22402L6.41113 2.04807V9.4C6.41321 9.55849 6.47718 9.7099 6.58942 9.82197ZM11.9952 14H2.02883C1.751 13.9887 1.47813 13.9228 1.22584 13.8061C0.973545 13.6894 0.746779 13.5241 0.558517 13.3197C0.370254 13.1154 0.22419 12.876 0.128681 12.6152C0.0331723 12.3545 -0.00990605 12.0775 0.0019109 11.8V9.40005C0.0019109 9.24092 0.065216 9.08831 0.1779 8.97579C0.290584 8.86326 0.443416 8.80005 0.602775 8.80005C0.762134 8.80005 0.914966 8.86326 1.02765 8.97579C1.14033 9.08831 1.20364 9.24092 1.20364 9.40005V11.8C1.18295 12.0376 1.25463 12.274 1.40379 12.4602C1.55296 12.6463 1.76817 12.7681 2.00479 12.8H11.9952C12.2318 12.7681 12.447 12.6463 12.5962 12.4602C12.7453 12.274 12.817 12.0376 12.7963 11.8V9.40005C12.7963 9.24092 12.8596 9.08831 12.9723 8.97579C13.085 8.86326 13.2378 8.80005 13.3972 8.80005C13.5565 8.80005 13.7094 8.86326 13.8221 8.97579C13.9347 9.08831 13.998 9.24092 13.998 9.40005V11.8C14.022 12.3563 13.8251 12.8996 13.45 13.3116C13.0749 13.7236 12.552 13.971 11.9952 14Z",fill:"currentColor"},null,-1)]),16)}EE.render=iW;var kE={name:"SpinnerIcon",extends:Bp};function sW(e,t,n,r,o,i){return de(),He("svg",pe({width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e.pti()),t[0]||(t[0]=[Ve("path",{d:"M6.99701 14C5.85441 13.999 4.72939 13.7186 3.72012 13.1832C2.71084 12.6478 1.84795 11.8737 1.20673 10.9284C0.565504 9.98305 0.165424 8.89526 0.041387 7.75989C-0.0826496 6.62453 0.073125 5.47607 0.495122 4.4147C0.917119 3.35333 1.59252 2.4113 2.46241 1.67077C3.33229 0.930247 4.37024 0.413729 5.4857 0.166275C6.60117 -0.0811796 7.76026 -0.0520535 8.86188 0.251112C9.9635 0.554278 10.9742 1.12227 11.8057 1.90555C11.915 2.01493 11.9764 2.16319 11.9764 2.31778C11.9764 2.47236 11.915 2.62062 11.8057 2.73C11.7521 2.78503 11.688 2.82877 11.6171 2.85864C11.5463 2.8885 11.4702 2.90389 11.3933 2.90389C11.3165 2.90389 11.2404 2.8885 11.1695 2.85864C11.0987 2.82877 11.0346 2.78503 10.9809 2.73C9.9998 1.81273 8.73246 1.26138 7.39226 1.16876C6.05206 1.07615 4.72086 1.44794 3.62279 2.22152C2.52471 2.99511 1.72683 4.12325 1.36345 5.41602C1.00008 6.70879 1.09342 8.08723 1.62775 9.31926C2.16209 10.5513 3.10478 11.5617 4.29713 12.1803C5.48947 12.7989 6.85865 12.988 8.17414 12.7157C9.48963 12.4435 10.6711 11.7264 11.5196 10.6854C12.3681 9.64432 12.8319 8.34282 12.8328 7C12.8328 6.84529 12.8943 6.69692 13.0038 6.58752C13.1132 6.47812 13.2616 6.41667 13.4164 6.41667C13.5712 6.41667 13.7196 6.47812 13.8291 6.58752C13.9385 6.69692 14 6.84529 14 7C14 8.85651 13.2622 10.637 11.9489 11.9497C10.6356 13.2625 8.85432 14 6.99701 14Z",fill:"currentColor"},null,-1)]),16)}kE.render=sW;var uW=({dt:e})=>`
.p-badge {
    display: inline-flex;
    border-radius: ${e("badge.border.radius")};
    align-items: center;
    justify-content: center;
    padding: ${e("badge.padding")};
    background: ${e("badge.primary.background")};
    color: ${e("badge.primary.color")};
    font-size: ${e("badge.font.size")};
    font-weight: ${e("badge.font.weight")};
    min-width: ${e("badge.min.width")};
    height: ${e("badge.height")};
}

.p-badge-dot {
    width: ${e("badge.dot.size")};
    min-width: ${e("badge.dot.size")};
    height: ${e("badge.dot.size")};
    border-radius: 50%;
    padding: 0;
}

.p-badge-circle {
    padding: 0;
    border-radius: 50%;
}

.p-badge-secondary {
    background: ${e("badge.secondary.background")};
    color: ${e("badge.secondary.color")};
}

.p-badge-success {
    background: ${e("badge.success.background")};
    color: ${e("badge.success.color")};
}

.p-badge-info {
    background: ${e("badge.info.background")};
    color: ${e("badge.info.color")};
}

.p-badge-warn {
    background: ${e("badge.warn.background")};
    color: ${e("badge.warn.color")};
}

.p-badge-danger {
    background: ${e("badge.danger.background")};
    color: ${e("badge.danger.color")};
}

.p-badge-contrast {
    background: ${e("badge.contrast.background")};
    color: ${e("badge.contrast.color")};
}

.p-badge-sm {
    font-size: ${e("badge.sm.font.size")};
    min-width: ${e("badge.sm.min.width")};
    height: ${e("badge.sm.height")};
}

.p-badge-lg {
    font-size: ${e("badge.lg.font.size")};
    min-width: ${e("badge.lg.min.width")};
    height: ${e("badge.lg.height")};
}

.p-badge-xl {
    font-size: ${e("badge.xl.font.size")};
    min-width: ${e("badge.xl.min.width")};
    height: ${e("badge.xl.height")};
}
`,cW={root:function(t){var n=t.props,r=t.instance;return["p-badge p-component",{"p-badge-circle":Cn(n.value)&&String(n.value).length===1,"p-badge-dot":qs(n.value)&&!r.$slots.default,"p-badge-sm":n.size==="small","p-badge-lg":n.size==="large","p-badge-xl":n.size==="xlarge","p-badge-info":n.severity==="info","p-badge-success":n.severity==="success","p-badge-warn":n.severity==="warn","p-badge-danger":n.severity==="danger","p-badge-secondary":n.severity==="secondary","p-badge-contrast":n.severity==="contrast"}]}},lW=mn.extend({name:"badge",style:uW,classes:cW}),dW={name:"BaseBadge",extends:js,props:{value:{type:[String,Number],default:null},severity:{type:String,default:null},size:{type:String,default:null}},style:lW,provide:function(){return{$pcBadge:this,$parentInstance:this}}},o0={name:"Badge",extends:dW,inheritAttrs:!1};function fW(e,t,n,r,o,i){return de(),He("span",pe({class:e.cx("root")},e.ptmi("root")),[Qn(e.$slots,"default",{},function(){return[Us(va(e.value),1)]})],16)}o0.render=fW;var Oi=gE();function Ul(e){"@babel/helpers - typeof";return Ul=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ul(e)}function vC(e,t){return gW(e)||mW(e,t)||hW(e,t)||pW()}function pW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hW(e,t){if(e){if(typeof e=="string")return yC(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yC(e,t):void 0}}function yC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function mW(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,o,i,l,d=[],p=!0,h=!1;try{if(i=(n=n.call(e)).next,t!==0)for(;!(p=(r=i.call(n)).done)&&(d.push(r.value),d.length!==t);p=!0);}catch(g){h=!0,o=g}finally{try{if(!p&&n.return!=null&&(l=n.return(),Object(l)!==l))return}finally{if(h)throw o}}return d}}function gW(e){if(Array.isArray(e))return e}function bC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bC(Object(n),!0).forEach(function(r){jg(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function jg(e,t,n){return(t=vW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vW(e){var t=yW(e,"string");return Ul(t)=="symbol"?t:t+""}function yW(e,t){if(Ul(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Ul(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ke={_getMeta:function(){return[xa(arguments.length<=0?void 0:arguments[0])||arguments.length<=0?void 0:arguments[0],Io(xa(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:arguments.length<=1?void 0:arguments[1])]},_getConfig:function(t,n){var r,o,i;return(r=(t==null||(o=t.instance)===null||o===void 0?void 0:o.$primevue)||(n==null||(i=n.ctx)===null||i===void 0||(i=i.appContext)===null||i===void 0||(i=i.config)===null||i===void 0||(i=i.globalProperties)===null||i===void 0?void 0:i.$primevue))===null||r===void 0?void 0:r.config},_getOptionValue:r0,_getPTValue:function(){var t,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,p=function(){var N=ke._getOptionValue.apply(ke,arguments);return ro(N)||$p(N)?{class:N}:N},h=((t=r.binding)===null||t===void 0||(t=t.value)===null||t===void 0?void 0:t.ptOptions)||((n=r.$primevueConfig)===null||n===void 0?void 0:n.ptOptions)||{},g=h.mergeSections,y=g===void 0?!0:g,x=h.mergeProps,C=x===void 0?!1:x,_=d?ke._useDefaultPT(r,r.defaultPT(),p,i,l):void 0,k=ke._usePT(r,ke._getPT(o,r.$name),p,i,ze(ze({},l),{},{global:_||{}})),A=ke._getPTDatasets(r,i);return y||!y&&k?C?ke._mergeProps(r,C,_,k,A):ze(ze(ze({},_),k),A):ze(ze({},k),A)},_getPTDatasets:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r="data-pc-";return ze(ze({},n==="root"&&jg({},"".concat(r,"name"),pa(t.$name))),{},jg({},"".concat(r,"section"),pa(n)))},_getPT:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,o=function(l){var d,p=r?r(l):l,h=pa(n);return(d=p==null?void 0:p[h])!==null&&d!==void 0?d:p};return t&&Object.hasOwn(t,"_usept")?{_usept:t._usept,originalValue:o(t.originalValue),value:o(t.value)}:o(t)},_usePT:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,l=function(A){return r(A,o,i)};if(n&&Object.hasOwn(n,"_usept")){var d,p=n._usept||((d=t.$primevueConfig)===null||d===void 0?void 0:d.ptOptions)||{},h=p.mergeSections,g=h===void 0?!0:h,y=p.mergeProps,x=y===void 0?!1:y,C=l(n.originalValue),_=l(n.value);return C===void 0&&_===void 0?void 0:ro(_)?_:ro(C)?C:g||!g&&_?x?ke._mergeProps(t,x,C,_):ze(ze({},C),_):_}return l(n)},_useDefaultPT:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return ke._usePT(t,n,r,o,i)},_loadStyles:function(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,i=ke._getConfig(r,o),l={nonce:i==null||(t=i.csp)===null||t===void 0?void 0:t.nonce};ke._loadCoreStyles(n,l),ke._loadThemeStyles(n,l),ke._loadScopedThemeStyles(n,l),ke._removeThemeListeners(n),n.$loadStyles=function(){return ke._loadThemeStyles(n,l)},ke._themeChangeListener(n.$loadStyles)},_loadCoreStyles:function(){var t,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;if(!Pi.isStyleNameLoaded((t=r.$style)===null||t===void 0?void 0:t.name)&&(n=r.$style)!==null&&n!==void 0&&n.name){var i;mn.loadCSS(o),(i=r.$style)===null||i===void 0||i.loadCSS(o),Pi.setLoadedStyleName(r.$style.name)}},_loadThemeStyles:function(){var t,n,r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(!(o!=null&&o.isUnstyled()||(o==null||(t=o.theme)===null||t===void 0?void 0:t.call(o))==="none")){if(!en.isStyleNameLoaded("common")){var l,d,p=((l=o.$style)===null||l===void 0||(d=l.getCommonTheme)===null||d===void 0?void 0:d.call(l))||{},h=p.primitive,g=p.semantic,y=p.global,x=p.style;mn.load(h==null?void 0:h.css,ze({name:"primitive-variables"},i)),mn.load(g==null?void 0:g.css,ze({name:"semantic-variables"},i)),mn.load(y==null?void 0:y.css,ze({name:"global-variables"},i)),mn.loadStyle(ze({name:"global-style"},i),x),en.setLoadedStyleName("common")}if(!en.isStyleNameLoaded((n=o.$style)===null||n===void 0?void 0:n.name)&&(r=o.$style)!==null&&r!==void 0&&r.name){var C,_,k,A,I=((C=o.$style)===null||C===void 0||(_=C.getDirectiveTheme)===null||_===void 0?void 0:_.call(C))||{},N=I.css,D=I.style;(k=o.$style)===null||k===void 0||k.load(N,ze({name:"".concat(o.$style.name,"-variables")},i)),(A=o.$style)===null||A===void 0||A.loadStyle(ze({name:"".concat(o.$style.name,"-style")},i),D),en.setLoadedStyleName(o.$style.name)}if(!en.isStyleNameLoaded("layer-order")){var M,F,W=(M=o.$style)===null||M===void 0||(F=M.getLayerOrderThemeCSS)===null||F===void 0?void 0:F.call(M);mn.load(W,ze({name:"layer-order",first:!0},i)),en.setLoadedStyleName("layer-order")}}},_loadScopedThemeStyles:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=t.preset();if(r&&t.$attrSelector){var o,i,l,d=((o=t.$style)===null||o===void 0||(i=o.getPresetTheme)===null||i===void 0?void 0:i.call(o,r,"[".concat(t.$attrSelector,"]")))||{},p=d.css,h=(l=t.$style)===null||l===void 0?void 0:l.load(p,ze({name:"".concat(t.$attrSelector,"-").concat(t.$style.name)},n));t.scopedStyleEl=h.el}},_themeChangeListener:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){};Pi.clearLoadedStyleNames(),cr.on("theme:change",t)},_removeThemeListeners:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};cr.off("theme:change",t.$loadStyles)},_hook:function(t,n,r,o,i,l){var d,p,h="on".concat(y6(n)),g=ke._getConfig(o,i),y=r==null?void 0:r.$instance,x=ke._usePT(y,ke._getPT(o==null||(d=o.value)===null||d===void 0?void 0:d.pt,t),ke._getOptionValue,"hooks.".concat(h)),C=ke._useDefaultPT(y,g==null||(p=g.pt)===null||p===void 0||(p=p.directives)===null||p===void 0?void 0:p[t],ke._getOptionValue,"hooks.".concat(h)),_={el:r,binding:o,vnode:i,prevVnode:l};x==null||x(y,_),C==null||C(y,_)},_mergeProps:function(){for(var t=arguments.length>1?arguments[1]:void 0,n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return n0(t)?t.apply(void 0,r):pe.apply(void 0,r)},_extend:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=function(d,p,h,g,y){var x,C,_,k;p._$instances=p._$instances||{};var A=ke._getConfig(h,g),I=p._$instances[t]||{},N=qs(I)?ze(ze({},n),n==null?void 0:n.methods):{};p._$instances[t]=ze(ze({},I),{},{$name:t,$host:p,$binding:h,$modifiers:h==null?void 0:h.modifiers,$value:h==null?void 0:h.value,$el:I.$el||p||void 0,$style:ze({classes:void 0,inlineStyles:void 0,load:function(){},loadCSS:function(){},loadStyle:function(){}},n==null?void 0:n.style),$primevueConfig:A,$attrSelector:(x=p.$pd)===null||x===void 0||(x=x[t])===null||x===void 0?void 0:x.attrSelector,defaultPT:function(){return ke._getPT(A==null?void 0:A.pt,void 0,function(M){var F;return M==null||(F=M.directives)===null||F===void 0?void 0:F[t]})},isUnstyled:function(){var M,F;return((M=p._$instances[t])===null||M===void 0||(M=M.$binding)===null||M===void 0||(M=M.value)===null||M===void 0?void 0:M.unstyled)!==void 0?(F=p._$instances[t])===null||F===void 0||(F=F.$binding)===null||F===void 0||(F=F.value)===null||F===void 0?void 0:F.unstyled:A==null?void 0:A.unstyled},theme:function(){var M;return(M=p._$instances[t])===null||M===void 0||(M=M.$primevueConfig)===null||M===void 0?void 0:M.theme},preset:function(){var M;return(M=p._$instances[t])===null||M===void 0||(M=M.$binding)===null||M===void 0||(M=M.value)===null||M===void 0?void 0:M.dt},ptm:function(){var M,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ke._getPTValue(p._$instances[t],(M=p._$instances[t])===null||M===void 0||(M=M.$binding)===null||M===void 0||(M=M.value)===null||M===void 0?void 0:M.pt,F,ze({},W))},ptmo:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ke._getPTValue(p._$instances[t],M,F,W,!1)},cx:function(){var M,F,W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(M=p._$instances[t])!==null&&M!==void 0&&M.isUnstyled()?void 0:ke._getOptionValue((F=p._$instances[t])===null||F===void 0||(F=F.$style)===null||F===void 0?void 0:F.classes,W,ze({},L))},sx:function(){var M,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return W?ke._getOptionValue((M=p._$instances[t])===null||M===void 0||(M=M.$style)===null||M===void 0?void 0:M.inlineStyles,F,ze({},L)):void 0}},N),p.$instance=p._$instances[t],(C=(_=p.$instance)[d])===null||C===void 0||C.call(_,p,h,g,y),p["$".concat(t)]=p.$instance,ke._hook(t,d,p,h,g,y),p.$pd||(p.$pd={}),p.$pd[t]=ze(ze({},(k=p.$pd)===null||k===void 0?void 0:k[t]),{},{name:t,instance:p._$instances[t]})},o=function(d){var p,h,g,y=d._$instances[t],x=y==null?void 0:y.watch,C=function(A){var I,N=A.newValue,D=A.oldValue;return x==null||(I=x.config)===null||I===void 0?void 0:I.call(y,N,D)},_=function(A){var I,N=A.newValue,D=A.oldValue;return x==null||(I=x["config.ripple"])===null||I===void 0?void 0:I.call(y,N,D)};y.$watchersCallback={config:C,"config.ripple":_},x==null||(p=x.config)===null||p===void 0||p.call(y,y==null?void 0:y.$primevueConfig),Oi.on("config:change",C),x==null||(h=x["config.ripple"])===null||h===void 0||h.call(y,y==null||(g=y.$primevueConfig)===null||g===void 0?void 0:g.ripple),Oi.on("config:ripple:change",_)},i=function(d){var p=d._$instances[t].$watchersCallback;p&&(Oi.off("config:change",p.config),Oi.off("config:ripple:change",p["config.ripple"]))};return{created:function(d,p,h,g){d.$pd||(d.$pd={}),d.$pd[t]={name:t,attrSelector:b6("pd")},r("created",d,p,h,g)},beforeMount:function(d,p,h,g){var y;ke._loadStyles((y=d.$pd[t])===null||y===void 0?void 0:y.instance,p,h),r("beforeMount",d,p,h,g),o(d)},mounted:function(d,p,h,g){var y;ke._loadStyles((y=d.$pd[t])===null||y===void 0?void 0:y.instance,p,h),r("mounted",d,p,h,g)},beforeUpdate:function(d,p,h,g){r("beforeUpdate",d,p,h,g)},updated:function(d,p,h,g){var y;ke._loadStyles((y=d.$pd[t])===null||y===void 0?void 0:y.instance,p,h),r("updated",d,p,h,g)},beforeUnmount:function(d,p,h,g){var y;i(d),ke._removeThemeListeners((y=d.$pd[t])===null||y===void 0?void 0:y.instance),r("beforeUnmount",d,p,h,g)},unmounted:function(d,p,h,g){var y;(y=d.$pd[t])===null||y===void 0||(y=y.instance)===null||y===void 0||(y=y.scopedStyleEl)===null||y===void 0||(y=y.value)===null||y===void 0||y.remove(),r("unmounted",d,p,h,g)}}},extend:function(){var t=ke._getMeta.apply(ke,arguments),n=vC(t,2),r=n[0],o=n[1];return ze({extend:function(){var l=ke._getMeta.apply(ke,arguments),d=vC(l,2),p=d[0],h=d[1];return ke.extend(p,ze(ze(ze({},o),o==null?void 0:o.methods),h))}},ke._extend(r,o))}},bW=({dt:e})=>`
.p-ink {
    display: block;
    position: absolute;
    background: ${e("ripple.background")};
    border-radius: 100%;
    transform: scale(0);
    pointer-events: none;
}

.p-ink-active {
    animation: ripple 0.4s linear;
}

@keyframes ripple {
    100% {
        opacity: 0;
        transform: scale(2.5);
    }
}
`,xW={root:"p-ink"},wW=mn.extend({name:"ripple-directive",style:bW,classes:xW}),CW=ke.extend({style:wW});function zl(e){"@babel/helpers - typeof";return zl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zl(e)}function SW(e){return RW(e)||kW(e)||EW(e)||_W()}function _W(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EW(e,t){if(e){if(typeof e=="string")return Kg(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kg(e,t):void 0}}function kW(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function RW(e){if(Array.isArray(e))return Kg(e)}function Kg(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function xC(e,t,n){return(t=TW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TW(e){var t=DW(e,"string");return zl(t)=="symbol"?t:t+""}function DW(e,t){if(zl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(zl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var a0=CW.extend("ripple",{watch:{"config.ripple":function(t){t?(this.createRipple(this.$host),this.bindEvents(this.$host),this.$host.setAttribute("data-pd-ripple",!0),this.$host.style.overflow="hidden",this.$host.style.position="relative"):(this.remove(this.$host),this.$host.removeAttribute("data-pd-ripple"))}},unmounted:function(t){this.remove(t)},timeout:void 0,methods:{bindEvents:function(t){t.addEventListener("mousedown",this.onMouseDown.bind(this))},unbindEvents:function(t){t.removeEventListener("mousedown",this.onMouseDown.bind(this))},createRipple:function(t){var n=this.getInk(t);n||(n=o6("span",xC(xC({role:"presentation","aria-hidden":!0,"data-p-ink":!0,"data-p-ink-active":!1,class:!this.isUnstyled()&&this.cx("root"),onAnimationEnd:this.onAnimationEnd.bind(this)},this.$attrSelector,""),"p-bind",this.ptm("root"))),t.appendChild(n),this.$el=n)},remove:function(t){var n=this.getInk(t);n&&(this.$host.style.overflow="",this.$host.style.position="",this.unbindEvents(t),n.removeEventListener("animationend",this.onAnimationEnd),n.remove())},onMouseDown:function(t){var n=this,r=t.currentTarget,o=this.getInk(r);if(!(!o||getComputedStyle(o,null).display==="none")){if(!this.isUnstyled()&&_l(o,"p-ink-active"),o.setAttribute("data-p-ink-active","false"),!tC(o)&&!eC(o)){var i=Math.max(e6(r),u6(r));o.style.height=i+"px",o.style.width=i+"px"}var l=s6(r),d=t.pageX-l.left+document.body.scrollTop-eC(o)/2,p=t.pageY-l.top+document.body.scrollLeft-tC(o)/2;o.style.top=p+"px",o.style.left=d+"px",!this.isUnstyled()&&pE(o,"p-ink-active"),o.setAttribute("data-p-ink-active","true"),this.timeout=setTimeout(function(){o&&(!n.isUnstyled()&&_l(o,"p-ink-active"),o.setAttribute("data-p-ink-active","false"))},401)}},onAnimationEnd:function(t){this.timeout&&clearTimeout(this.timeout),!this.isUnstyled()&&_l(t.currentTarget,"p-ink-active"),t.currentTarget.setAttribute("data-p-ink-active","false")},getInk:function(t){return t&&t.children?SW(t.children).find(function(n){return i6(n,"data-pc-name")==="ripple"}):void 0}}}),AW=({dt:e})=>`
.p-button {
    display: inline-flex;
    cursor: pointer;
    user-select: none;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    color: ${e("button.primary.color")};
    background: ${e("button.primary.background")};
    border: 1px solid ${e("button.primary.border.color")};
    padding: ${e("button.padding.y")} ${e("button.padding.x")};
    font-size: 1rem;
    font-family: inherit;
    font-feature-settings: inherit;
    transition: background ${e("button.transition.duration")}, color ${e("button.transition.duration")}, border-color ${e("button.transition.duration")},
            outline-color ${e("button.transition.duration")}, box-shadow ${e("button.transition.duration")};
    border-radius: ${e("button.border.radius")};
    outline-color: transparent;
    gap: ${e("button.gap")};
}

.p-button:disabled {
    cursor: default;
}

.p-button-icon-right {
    order: 1;
}

.p-button-icon-right:dir(rtl) {
    order: -1;
}

.p-button:not(.p-button-vertical) .p-button-icon:not(.p-button-icon-right):dir(rtl) {
    order: 1;
}

.p-button-icon-bottom {
    order: 2;
}

.p-button-icon-only {
    width: ${e("button.icon.only.width")};
    padding-inline-start: 0;
    padding-inline-end: 0;
    gap: 0;
}

.p-button-icon-only.p-button-rounded {
    border-radius: 50%;
    height: ${e("button.icon.only.width")};
}

.p-button-icon-only .p-button-label {
    visibility: hidden;
    width: 0;
}

.p-button-sm {
    font-size: ${e("button.sm.font.size")};
    padding: ${e("button.sm.padding.y")} ${e("button.sm.padding.x")};
}

.p-button-sm .p-button-icon {
    font-size: ${e("button.sm.font.size")};
}

.p-button-sm.p-button-icon-only {
    width: ${e("button.sm.icon.only.width")};
}

.p-button-sm.p-button-icon-only.p-button-rounded {
    height: ${e("button.sm.icon.only.width")};
}

.p-button-lg {
    font-size: ${e("button.lg.font.size")};
    padding: ${e("button.lg.padding.y")} ${e("button.lg.padding.x")};
}

.p-button-lg .p-button-icon {
    font-size: ${e("button.lg.font.size")};
}

.p-button-lg.p-button-icon-only {
    width: ${e("button.lg.icon.only.width")};
}

.p-button-lg.p-button-icon-only.p-button-rounded {
    height: ${e("button.lg.icon.only.width")};
}

.p-button-vertical {
    flex-direction: column;
}

.p-button-label {
    font-weight: ${e("button.label.font.weight")};
}

.p-button-fluid {
    width: 100%;
}

.p-button-fluid.p-button-icon-only {
    width: ${e("button.icon.only.width")};
}

.p-button:not(:disabled):hover {
    background: ${e("button.primary.hover.background")};
    border: 1px solid ${e("button.primary.hover.border.color")};
    color: ${e("button.primary.hover.color")};
}

.p-button:not(:disabled):active {
    background: ${e("button.primary.active.background")};
    border: 1px solid ${e("button.primary.active.border.color")};
    color: ${e("button.primary.active.color")};
}

.p-button:focus-visible {
    box-shadow: ${e("button.primary.focus.ring.shadow")};
    outline: ${e("button.focus.ring.width")} ${e("button.focus.ring.style")} ${e("button.primary.focus.ring.color")};
    outline-offset: ${e("button.focus.ring.offset")};
}

.p-button .p-badge {
    min-width: ${e("button.badge.size")};
    height: ${e("button.badge.size")};
    line-height: ${e("button.badge.size")};
}

.p-button-raised {
    box-shadow: ${e("button.raised.shadow")};
}

.p-button-rounded {
    border-radius: ${e("button.rounded.border.radius")};
}

.p-button-secondary {
    background: ${e("button.secondary.background")};
    border: 1px solid ${e("button.secondary.border.color")};
    color: ${e("button.secondary.color")};
}

.p-button-secondary:not(:disabled):hover {
    background: ${e("button.secondary.hover.background")};
    border: 1px solid ${e("button.secondary.hover.border.color")};
    color: ${e("button.secondary.hover.color")};
}

.p-button-secondary:not(:disabled):active {
    background: ${e("button.secondary.active.background")};
    border: 1px solid ${e("button.secondary.active.border.color")};
    color: ${e("button.secondary.active.color")};
}

.p-button-secondary:focus-visible {
    outline-color: ${e("button.secondary.focus.ring.color")};
    box-shadow: ${e("button.secondary.focus.ring.shadow")};
}

.p-button-success {
    background: ${e("button.success.background")};
    border: 1px solid ${e("button.success.border.color")};
    color: ${e("button.success.color")};
}

.p-button-success:not(:disabled):hover {
    background: ${e("button.success.hover.background")};
    border: 1px solid ${e("button.success.hover.border.color")};
    color: ${e("button.success.hover.color")};
}

.p-button-success:not(:disabled):active {
    background: ${e("button.success.active.background")};
    border: 1px solid ${e("button.success.active.border.color")};
    color: ${e("button.success.active.color")};
}

.p-button-success:focus-visible {
    outline-color: ${e("button.success.focus.ring.color")};
    box-shadow: ${e("button.success.focus.ring.shadow")};
}

.p-button-info {
    background: ${e("button.info.background")};
    border: 1px solid ${e("button.info.border.color")};
    color: ${e("button.info.color")};
}

.p-button-info:not(:disabled):hover {
    background: ${e("button.info.hover.background")};
    border: 1px solid ${e("button.info.hover.border.color")};
    color: ${e("button.info.hover.color")};
}

.p-button-info:not(:disabled):active {
    background: ${e("button.info.active.background")};
    border: 1px solid ${e("button.info.active.border.color")};
    color: ${e("button.info.active.color")};
}

.p-button-info:focus-visible {
    outline-color: ${e("button.info.focus.ring.color")};
    box-shadow: ${e("button.info.focus.ring.shadow")};
}

.p-button-warn {
    background: ${e("button.warn.background")};
    border: 1px solid ${e("button.warn.border.color")};
    color: ${e("button.warn.color")};
}

.p-button-warn:not(:disabled):hover {
    background: ${e("button.warn.hover.background")};
    border: 1px solid ${e("button.warn.hover.border.color")};
    color: ${e("button.warn.hover.color")};
}

.p-button-warn:not(:disabled):active {
    background: ${e("button.warn.active.background")};
    border: 1px solid ${e("button.warn.active.border.color")};
    color: ${e("button.warn.active.color")};
}

.p-button-warn:focus-visible {
    outline-color: ${e("button.warn.focus.ring.color")};
    box-shadow: ${e("button.warn.focus.ring.shadow")};
}

.p-button-help {
    background: ${e("button.help.background")};
    border: 1px solid ${e("button.help.border.color")};
    color: ${e("button.help.color")};
}

.p-button-help:not(:disabled):hover {
    background: ${e("button.help.hover.background")};
    border: 1px solid ${e("button.help.hover.border.color")};
    color: ${e("button.help.hover.color")};
}

.p-button-help:not(:disabled):active {
    background: ${e("button.help.active.background")};
    border: 1px solid ${e("button.help.active.border.color")};
    color: ${e("button.help.active.color")};
}

.p-button-help:focus-visible {
    outline-color: ${e("button.help.focus.ring.color")};
    box-shadow: ${e("button.help.focus.ring.shadow")};
}

.p-button-danger {
    background: ${e("button.danger.background")};
    border: 1px solid ${e("button.danger.border.color")};
    color: ${e("button.danger.color")};
}

.p-button-danger:not(:disabled):hover {
    background: ${e("button.danger.hover.background")};
    border: 1px solid ${e("button.danger.hover.border.color")};
    color: ${e("button.danger.hover.color")};
}

.p-button-danger:not(:disabled):active {
    background: ${e("button.danger.active.background")};
    border: 1px solid ${e("button.danger.active.border.color")};
    color: ${e("button.danger.active.color")};
}

.p-button-danger:focus-visible {
    outline-color: ${e("button.danger.focus.ring.color")};
    box-shadow: ${e("button.danger.focus.ring.shadow")};
}

.p-button-contrast {
    background: ${e("button.contrast.background")};
    border: 1px solid ${e("button.contrast.border.color")};
    color: ${e("button.contrast.color")};
}

.p-button-contrast:not(:disabled):hover {
    background: ${e("button.contrast.hover.background")};
    border: 1px solid ${e("button.contrast.hover.border.color")};
    color: ${e("button.contrast.hover.color")};
}

.p-button-contrast:not(:disabled):active {
    background: ${e("button.contrast.active.background")};
    border: 1px solid ${e("button.contrast.active.border.color")};
    color: ${e("button.contrast.active.color")};
}

.p-button-contrast:focus-visible {
    outline-color: ${e("button.contrast.focus.ring.color")};
    box-shadow: ${e("button.contrast.focus.ring.shadow")};
}

.p-button-outlined {
    background: transparent;
    border-color: ${e("button.outlined.primary.border.color")};
    color: ${e("button.outlined.primary.color")};
}

.p-button-outlined:not(:disabled):hover {
    background: ${e("button.outlined.primary.hover.background")};
    border-color: ${e("button.outlined.primary.border.color")};
    color: ${e("button.outlined.primary.color")};
}

.p-button-outlined:not(:disabled):active {
    background: ${e("button.outlined.primary.active.background")};
    border-color: ${e("button.outlined.primary.border.color")};
    color: ${e("button.outlined.primary.color")};
}

.p-button-outlined.p-button-secondary {
    border-color: ${e("button.outlined.secondary.border.color")};
    color: ${e("button.outlined.secondary.color")};
}

.p-button-outlined.p-button-secondary:not(:disabled):hover {
    background: ${e("button.outlined.secondary.hover.background")};
    border-color: ${e("button.outlined.secondary.border.color")};
    color: ${e("button.outlined.secondary.color")};
}

.p-button-outlined.p-button-secondary:not(:disabled):active {
    background: ${e("button.outlined.secondary.active.background")};
    border-color: ${e("button.outlined.secondary.border.color")};
    color: ${e("button.outlined.secondary.color")};
}

.p-button-outlined.p-button-success {
    border-color: ${e("button.outlined.success.border.color")};
    color: ${e("button.outlined.success.color")};
}

.p-button-outlined.p-button-success:not(:disabled):hover {
    background: ${e("button.outlined.success.hover.background")};
    border-color: ${e("button.outlined.success.border.color")};
    color: ${e("button.outlined.success.color")};
}

.p-button-outlined.p-button-success:not(:disabled):active {
    background: ${e("button.outlined.success.active.background")};
    border-color: ${e("button.outlined.success.border.color")};
    color: ${e("button.outlined.success.color")};
}

.p-button-outlined.p-button-info {
    border-color: ${e("button.outlined.info.border.color")};
    color: ${e("button.outlined.info.color")};
}

.p-button-outlined.p-button-info:not(:disabled):hover {
    background: ${e("button.outlined.info.hover.background")};
    border-color: ${e("button.outlined.info.border.color")};
    color: ${e("button.outlined.info.color")};
}

.p-button-outlined.p-button-info:not(:disabled):active {
    background: ${e("button.outlined.info.active.background")};
    border-color: ${e("button.outlined.info.border.color")};
    color: ${e("button.outlined.info.color")};
}

.p-button-outlined.p-button-warn {
    border-color: ${e("button.outlined.warn.border.color")};
    color: ${e("button.outlined.warn.color")};
}

.p-button-outlined.p-button-warn:not(:disabled):hover {
    background: ${e("button.outlined.warn.hover.background")};
    border-color: ${e("button.outlined.warn.border.color")};
    color: ${e("button.outlined.warn.color")};
}

.p-button-outlined.p-button-warn:not(:disabled):active {
    background: ${e("button.outlined.warn.active.background")};
    border-color: ${e("button.outlined.warn.border.color")};
    color: ${e("button.outlined.warn.color")};
}

.p-button-outlined.p-button-help {
    border-color: ${e("button.outlined.help.border.color")};
    color: ${e("button.outlined.help.color")};
}

.p-button-outlined.p-button-help:not(:disabled):hover {
    background: ${e("button.outlined.help.hover.background")};
    border-color: ${e("button.outlined.help.border.color")};
    color: ${e("button.outlined.help.color")};
}

.p-button-outlined.p-button-help:not(:disabled):active {
    background: ${e("button.outlined.help.active.background")};
    border-color: ${e("button.outlined.help.border.color")};
    color: ${e("button.outlined.help.color")};
}

.p-button-outlined.p-button-danger {
    border-color: ${e("button.outlined.danger.border.color")};
    color: ${e("button.outlined.danger.color")};
}

.p-button-outlined.p-button-danger:not(:disabled):hover {
    background: ${e("button.outlined.danger.hover.background")};
    border-color: ${e("button.outlined.danger.border.color")};
    color: ${e("button.outlined.danger.color")};
}

.p-button-outlined.p-button-danger:not(:disabled):active {
    background: ${e("button.outlined.danger.active.background")};
    border-color: ${e("button.outlined.danger.border.color")};
    color: ${e("button.outlined.danger.color")};
}

.p-button-outlined.p-button-contrast {
    border-color: ${e("button.outlined.contrast.border.color")};
    color: ${e("button.outlined.contrast.color")};
}

.p-button-outlined.p-button-contrast:not(:disabled):hover {
    background: ${e("button.outlined.contrast.hover.background")};
    border-color: ${e("button.outlined.contrast.border.color")};
    color: ${e("button.outlined.contrast.color")};
}

.p-button-outlined.p-button-contrast:not(:disabled):active {
    background: ${e("button.outlined.contrast.active.background")};
    border-color: ${e("button.outlined.contrast.border.color")};
    color: ${e("button.outlined.contrast.color")};
}

.p-button-outlined.p-button-plain {
    border-color: ${e("button.outlined.plain.border.color")};
    color: ${e("button.outlined.plain.color")};
}

.p-button-outlined.p-button-plain:not(:disabled):hover {
    background: ${e("button.outlined.plain.hover.background")};
    border-color: ${e("button.outlined.plain.border.color")};
    color: ${e("button.outlined.plain.color")};
}

.p-button-outlined.p-button-plain:not(:disabled):active {
    background: ${e("button.outlined.plain.active.background")};
    border-color: ${e("button.outlined.plain.border.color")};
    color: ${e("button.outlined.plain.color")};
}

.p-button-text {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.primary.color")};
}

.p-button-text:not(:disabled):hover {
    background: ${e("button.text.primary.hover.background")};
    border-color: transparent;
    color: ${e("button.text.primary.color")};
}

.p-button-text:not(:disabled):active {
    background: ${e("button.text.primary.active.background")};
    border-color: transparent;
    color: ${e("button.text.primary.color")};
}

.p-button-text.p-button-secondary {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.secondary.color")};
}

.p-button-text.p-button-secondary:not(:disabled):hover {
    background: ${e("button.text.secondary.hover.background")};
    border-color: transparent;
    color: ${e("button.text.secondary.color")};
}

.p-button-text.p-button-secondary:not(:disabled):active {
    background: ${e("button.text.secondary.active.background")};
    border-color: transparent;
    color: ${e("button.text.secondary.color")};
}

.p-button-text.p-button-success {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.success.color")};
}

.p-button-text.p-button-success:not(:disabled):hover {
    background: ${e("button.text.success.hover.background")};
    border-color: transparent;
    color: ${e("button.text.success.color")};
}

.p-button-text.p-button-success:not(:disabled):active {
    background: ${e("button.text.success.active.background")};
    border-color: transparent;
    color: ${e("button.text.success.color")};
}

.p-button-text.p-button-info {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.info.color")};
}

.p-button-text.p-button-info:not(:disabled):hover {
    background: ${e("button.text.info.hover.background")};
    border-color: transparent;
    color: ${e("button.text.info.color")};
}

.p-button-text.p-button-info:not(:disabled):active {
    background: ${e("button.text.info.active.background")};
    border-color: transparent;
    color: ${e("button.text.info.color")};
}

.p-button-text.p-button-warn {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.warn.color")};
}

.p-button-text.p-button-warn:not(:disabled):hover {
    background: ${e("button.text.warn.hover.background")};
    border-color: transparent;
    color: ${e("button.text.warn.color")};
}

.p-button-text.p-button-warn:not(:disabled):active {
    background: ${e("button.text.warn.active.background")};
    border-color: transparent;
    color: ${e("button.text.warn.color")};
}

.p-button-text.p-button-help {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.help.color")};
}

.p-button-text.p-button-help:not(:disabled):hover {
    background: ${e("button.text.help.hover.background")};
    border-color: transparent;
    color: ${e("button.text.help.color")};
}

.p-button-text.p-button-help:not(:disabled):active {
    background: ${e("button.text.help.active.background")};
    border-color: transparent;
    color: ${e("button.text.help.color")};
}

.p-button-text.p-button-danger {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.danger.color")};
}

.p-button-text.p-button-danger:not(:disabled):hover {
    background: ${e("button.text.danger.hover.background")};
    border-color: transparent;
    color: ${e("button.text.danger.color")};
}

.p-button-text.p-button-danger:not(:disabled):active {
    background: ${e("button.text.danger.active.background")};
    border-color: transparent;
    color: ${e("button.text.danger.color")};
}

.p-button-text.p-button-contrast {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.contrast.color")};
}

.p-button-text.p-button-contrast:not(:disabled):hover {
    background: ${e("button.text.contrast.hover.background")};
    border-color: transparent;
    color: ${e("button.text.contrast.color")};
}

.p-button-text.p-button-contrast:not(:disabled):active {
    background: ${e("button.text.contrast.active.background")};
    border-color: transparent;
    color: ${e("button.text.contrast.color")};
}

.p-button-text.p-button-plain {
    background: transparent;
    border-color: transparent;
    color: ${e("button.text.plain.color")};
}

.p-button-text.p-button-plain:not(:disabled):hover {
    background: ${e("button.text.plain.hover.background")};
    border-color: transparent;
    color: ${e("button.text.plain.color")};
}

.p-button-text.p-button-plain:not(:disabled):active {
    background: ${e("button.text.plain.active.background")};
    border-color: transparent;
    color: ${e("button.text.plain.color")};
}

.p-button-link {
    background: transparent;
    border-color: transparent;
    color: ${e("button.link.color")};
}

.p-button-link:not(:disabled):hover {
    background: transparent;
    border-color: transparent;
    color: ${e("button.link.hover.color")};
}

.p-button-link:not(:disabled):hover .p-button-label {
    text-decoration: underline;
}

.p-button-link:not(:disabled):active {
    background: transparent;
    border-color: transparent;
    color: ${e("button.link.active.color")};
}
`;function Vl(e){"@babel/helpers - typeof";return Vl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vl(e)}function sa(e,t,n){return(t=IW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IW(e){var t=NW(e,"string");return Vl(t)=="symbol"?t:t+""}function NW(e,t){if(Vl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Vl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PW={root:function(t){var n=t.instance,r=t.props;return["p-button p-component",sa(sa(sa(sa(sa(sa(sa(sa(sa({"p-button-icon-only":n.hasIcon&&!r.label&&!r.badge,"p-button-vertical":(r.iconPos==="top"||r.iconPos==="bottom")&&r.label,"p-button-loading":r.loading,"p-button-link":r.link||r.variant==="link"},"p-button-".concat(r.severity),r.severity),"p-button-raised",r.raised),"p-button-rounded",r.rounded),"p-button-text",r.text||r.variant==="text"),"p-button-outlined",r.outlined||r.variant==="outlined"),"p-button-sm",r.size==="small"),"p-button-lg",r.size==="large"),"p-button-plain",r.plain),"p-button-fluid",n.hasFluid)]},loadingIcon:"p-button-loading-icon",icon:function(t){var n=t.props;return["p-button-icon",sa({},"p-button-icon-".concat(n.iconPos),n.label)]},label:"p-button-label"},MW=mn.extend({name:"button",style:AW,classes:PW}),OW={name:"BaseButton",extends:js,props:{label:{type:String,default:null},icon:{type:String,default:null},iconPos:{type:String,default:"left"},iconClass:{type:[String,Object],default:null},badge:{type:String,default:null},badgeClass:{type:[String,Object],default:null},badgeSeverity:{type:String,default:"secondary"},loading:{type:Boolean,default:!1},loadingIcon:{type:String,default:void 0},as:{type:[String,Object],default:"BUTTON"},asChild:{type:Boolean,default:!1},link:{type:Boolean,default:!1},severity:{type:String,default:null},raised:{type:Boolean,default:!1},rounded:{type:Boolean,default:!1},text:{type:Boolean,default:!1},outlined:{type:Boolean,default:!1},size:{type:String,default:null},variant:{type:String,default:null},plain:{type:Boolean,default:!1},fluid:{type:Boolean,default:null}},style:MW,provide:function(){return{$pcButton:this,$parentInstance:this}}},i0={name:"Button",extends:OW,inheritAttrs:!1,inject:{$pcFluid:{default:null}},methods:{getPTOptions:function(t){var n=t==="root"?this.ptmi:this.ptm;return n(t,{context:{disabled:this.disabled}})}},computed:{disabled:function(){return this.$attrs.disabled||this.$attrs.disabled===""||this.loading},defaultAriaLabel:function(){return this.label?this.label+(this.badge?" "+this.badge:""):this.$attrs.ariaLabel},hasIcon:function(){return this.icon||this.$slots.icon},attrs:function(){return pe(this.asAttrs,this.a11yAttrs,this.getPTOptions("root"))},asAttrs:function(){return this.as==="BUTTON"?{type:"button",disabled:this.disabled}:void 0},a11yAttrs:function(){return{"aria-label":this.defaultAriaLabel,"data-pc-name":"button","data-p-disabled":this.disabled,"data-p-severity":this.severity}},hasFluid:function(){return qs(this.fluid)?!!this.$pcFluid:this.fluid}},components:{SpinnerIcon:kE,Badge:o0},directives:{ripple:a0}};function FW(e,t,n,r,o,i){var l=Ao("SpinnerIcon"),d=Ao("Badge"),p=W_("ripple");return e.asChild?Qn(e.$slots,"default",{key:1,class:no(e.cx("root")),a11yAttrs:i.a11yAttrs}):$g((de(),Vn(Ts(e.as),pe({key:0,class:e.cx("root")},i.attrs),{default:zo(function(){return[Qn(e.$slots,"default",{},function(){return[e.loading?Qn(e.$slots,"loadingicon",pe({key:0,class:[e.cx("loadingIcon"),e.cx("icon")]},e.ptm("loadingIcon")),function(){return[e.loadingIcon?(de(),He("span",pe({key:0,class:[e.cx("loadingIcon"),e.cx("icon"),e.loadingIcon]},e.ptm("loadingIcon")),null,16)):(de(),Vn(l,pe({key:1,class:[e.cx("loadingIcon"),e.cx("icon")],spin:""},e.ptm("loadingIcon")),null,16,["class"]))]}):Qn(e.$slots,"icon",pe({key:1,class:[e.cx("icon")]},e.ptm("icon")),function(){return[e.icon?(de(),He("span",pe({key:0,class:[e.cx("icon"),e.icon,e.iconClass]},e.ptm("icon")),null,16)):Hn("",!0)]}),!i.hasIcon||e.label?(de(),He("span",pe({key:2,class:e.cx("label")},e.ptm("label")),va(e.label||" "),17)):Hn("",!0),e.badge?(de(),Vn(d,{key:3,value:e.badge,class:no(e.badgeClass),severity:e.badgeSeverity,unstyled:e.unstyled,pt:e.ptm("pcBadge")},null,8,["value","class","severity","unstyled","pt"])):Hn("",!0)]})]}),_:3},16,["class"])),[[p]])}i0.render=FW;var $W=({dt:e})=>`
.p-message {
    border-radius: ${e("message.border.radius")};
    outline-width: ${e("message.border.width")};
    outline-style: solid;
}

.p-message-content {
    display: flex;
    align-items: center;
    padding: ${e("message.content.padding")};
    gap: ${e("message.content.gap")};
    height: 100%;
}

.p-message-icon {
    flex-shrink: 0;
}

.p-message-close-button {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-inline-start: auto;
    overflow: hidden;
    position: relative;
    width: ${e("message.close.button.width")};
    height: ${e("message.close.button.height")};
    border-radius: ${e("message.close.button.border.radius")};
    background: transparent;
    transition: background ${e("message.transition.duration")}, color ${e("message.transition.duration")}, outline-color ${e("message.transition.duration")}, box-shadow ${e("message.transition.duration")}, opacity 0.3s;
    outline-color: transparent;
    color: inherit;
    padding: 0;
    border: none;
    cursor: pointer;
    user-select: none;
}

.p-message-close-icon {
    font-size: ${e("message.close.icon.size")};
    width: ${e("message.close.icon.size")};
    height: ${e("message.close.icon.size")};
}

.p-message-close-button:focus-visible {
    outline-width: ${e("message.close.button.focus.ring.width")};
    outline-style: ${e("message.close.button.focus.ring.style")};
    outline-offset: ${e("message.close.button.focus.ring.offset")};
}

.p-message-info {
    background: ${e("message.info.background")};
    outline-color: ${e("message.info.border.color")};
    color: ${e("message.info.color")};
    box-shadow: ${e("message.info.shadow")};
}

.p-message-info .p-message-close-button:focus-visible {
    outline-color: ${e("message.info.close.button.focus.ring.color")};
    box-shadow: ${e("message.info.close.button.focus.ring.shadow")};
}

.p-message-info .p-message-close-button:hover {
    background: ${e("message.info.close.button.hover.background")};
}

.p-message-info.p-message-outlined {
    color: ${e("message.info.outlined.color")};
    outline-color: ${e("message.info.outlined.border.color")};
}

.p-message-info.p-message-simple {
    color: ${e("message.info.simple.color")};
}

.p-message-success {
    background: ${e("message.success.background")};
    outline-color: ${e("message.success.border.color")};
    color: ${e("message.success.color")};
    box-shadow: ${e("message.success.shadow")};
}

.p-message-success .p-message-close-button:focus-visible {
    outline-color: ${e("message.success.close.button.focus.ring.color")};
    box-shadow: ${e("message.success.close.button.focus.ring.shadow")};
}

.p-message-success .p-message-close-button:hover {
    background: ${e("message.success.close.button.hover.background")};
}

.p-message-success.p-message-outlined {
    color: ${e("message.success.outlined.color")};
    outline-color: ${e("message.success.outlined.border.color")};
}

.p-message-success.p-message-simple {
    color: ${e("message.success.simple.color")};
}

.p-message-warn {
    background: ${e("message.warn.background")};
    outline-color: ${e("message.warn.border.color")};
    color: ${e("message.warn.color")};
    box-shadow: ${e("message.warn.shadow")};
}

.p-message-warn .p-message-close-button:focus-visible {
    outline-color: ${e("message.warn.close.button.focus.ring.color")};
    box-shadow: ${e("message.warn.close.button.focus.ring.shadow")};
}

.p-message-warn .p-message-close-button:hover {
    background: ${e("message.warn.close.button.hover.background")};
}

.p-message-warn.p-message-outlined {
    color: ${e("message.warn.outlined.color")};
    outline-color: ${e("message.warn.outlined.border.color")};
}

.p-message-warn.p-message-simple {
    color: ${e("message.warn.simple.color")};
}

.p-message-error {
    background: ${e("message.error.background")};
    outline-color: ${e("message.error.border.color")};
    color: ${e("message.error.color")};
    box-shadow: ${e("message.error.shadow")};
}

.p-message-error .p-message-close-button:focus-visible {
    outline-color: ${e("message.error.close.button.focus.ring.color")};
    box-shadow: ${e("message.error.close.button.focus.ring.shadow")};
}

.p-message-error .p-message-close-button:hover {
    background: ${e("message.error.close.button.hover.background")};
}

.p-message-error.p-message-outlined {
    color: ${e("message.error.outlined.color")};
    outline-color: ${e("message.error.outlined.border.color")};
}

.p-message-error.p-message-simple {
    color: ${e("message.error.simple.color")};
}

.p-message-secondary {
    background: ${e("message.secondary.background")};
    outline-color: ${e("message.secondary.border.color")};
    color: ${e("message.secondary.color")};
    box-shadow: ${e("message.secondary.shadow")};
}

.p-message-secondary .p-message-close-button:focus-visible {
    outline-color: ${e("message.secondary.close.button.focus.ring.color")};
    box-shadow: ${e("message.secondary.close.button.focus.ring.shadow")};
}

.p-message-secondary .p-message-close-button:hover {
    background: ${e("message.secondary.close.button.hover.background")};
}

.p-message-secondary.p-message-outlined {
    color: ${e("message.secondary.outlined.color")};
    outline-color: ${e("message.secondary.outlined.border.color")};
}

.p-message-secondary.p-message-simple {
    color: ${e("message.secondary.simple.color")};
}

.p-message-contrast {
    background: ${e("message.contrast.background")};
    outline-color: ${e("message.contrast.border.color")};
    color: ${e("message.contrast.color")};
    box-shadow: ${e("message.contrast.shadow")};
}

.p-message-contrast .p-message-close-button:focus-visible {
    outline-color: ${e("message.contrast.close.button.focus.ring.color")};
    box-shadow: ${e("message.contrast.close.button.focus.ring.shadow")};
}

.p-message-contrast .p-message-close-button:hover {
    background: ${e("message.contrast.close.button.hover.background")};
}

.p-message-contrast.p-message-outlined {
    color: ${e("message.contrast.outlined.color")};
    outline-color: ${e("message.contrast.outlined.border.color")};
}

.p-message-contrast.p-message-simple {
    color: ${e("message.contrast.simple.color")};
}

.p-message-text {
    font-size: ${e("message.text.font.size")};
    font-weight: ${e("message.text.font.weight")};
}

.p-message-icon {
    font-size: ${e("message.icon.size")};
    width: ${e("message.icon.size")};
    height: ${e("message.icon.size")};
}

.p-message-enter-from {
    opacity: 0;
}

.p-message-enter-active {
    transition: opacity 0.3s;
}

.p-message.p-message-leave-from {
    max-height: 1000px;
}

.p-message.p-message-leave-to {
    max-height: 0;
    opacity: 0;
    margin: 0;
}

.p-message-leave-active {
    overflow: hidden;
    transition: max-height 0.45s cubic-bezier(0, 1, 0, 1), opacity 0.3s, margin 0.3s;
}

.p-message-leave-active .p-message-close-button {
    opacity: 0;
}

.p-message-sm .p-message-content {
    padding: ${e("message.content.sm.padding")};
}

.p-message-sm .p-message-text {
    font-size: ${e("message.text.sm.font.size")};
}

.p-message-sm .p-message-icon {
    font-size: ${e("message.icon.sm.size")};
    width: ${e("message.icon.sm.size")};
    height: ${e("message.icon.sm.size")};
}

.p-message-sm .p-message-close-icon {
    font-size: ${e("message.close.icon.sm.size")};
    width: ${e("message.close.icon.sm.size")};
    height: ${e("message.close.icon.sm.size")};
}

.p-message-lg .p-message-content {
    padding: ${e("message.content.lg.padding")};
}

.p-message-lg .p-message-text {
    font-size: ${e("message.text.lg.font.size")};
}

.p-message-lg .p-message-icon {
    font-size: ${e("message.icon.lg.size")};
    width: ${e("message.icon.lg.size")};
    height: ${e("message.icon.lg.size")};
}

.p-message-lg .p-message-close-icon {
    font-size: ${e("message.close.icon.lg.size")};
    width: ${e("message.close.icon.lg.size")};
    height: ${e("message.close.icon.lg.size")};
}

.p-message-outlined {
    background: transparent;
    outline-width: ${e("message.outlined.border.width")};
}

.p-message-simple {
    background: transparent;
    outline-color: transparent;
    box-shadow: none;
}

.p-message-simple .p-message-content {
    padding: ${e("message.simple.content.padding")};
}

.p-message-outlined .p-message-close-button:hover,
.p-message-simple .p-message-close-button:hover {
    background: transparent;
}
`,BW={root:function(t){var n=t.props;return["p-message p-component p-message-"+n.severity,{"p-message-outlined":n.variant==="outlined","p-message-simple":n.variant==="simple","p-message-sm":n.size==="small","p-message-lg":n.size==="large"}]},content:"p-message-content",icon:"p-message-icon",text:"p-message-text",closeButton:"p-message-close-button",closeIcon:"p-message-close-icon"},LW=mn.extend({name:"message",style:$W,classes:BW}),WW={name:"BaseMessage",extends:js,props:{severity:{type:String,default:"info"},closable:{type:Boolean,default:!1},life:{type:Number,default:null},icon:{type:String,default:void 0},closeIcon:{type:String,default:void 0},closeButtonProps:{type:null,default:null},size:{type:String,default:null},variant:{type:String,default:null}},style:LW,provide:function(){return{$pcMessage:this,$parentInstance:this}}},RE={name:"Message",extends:WW,inheritAttrs:!1,emits:["close","life-end"],timeout:null,data:function(){return{visible:!0}},mounted:function(){var t=this;this.life&&setTimeout(function(){t.visible=!1,t.$emit("life-end")},this.life)},methods:{close:function(t){this.visible=!1,this.$emit("close",t)}},computed:{closeAriaLabel:function(){return this.$primevue.config.locale.aria?this.$primevue.config.locale.aria.close:void 0}},directives:{ripple:a0},components:{TimesIcon:Lp}};function Hl(e){"@babel/helpers - typeof";return Hl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hl(e)}function wC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function CC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wC(Object(n),!0).forEach(function(r){UW(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function UW(e,t,n){return(t=zW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zW(e){var t=VW(e,"string");return Hl(t)=="symbol"?t:t+""}function VW(e,t){if(Hl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Hl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var HW=["aria-label"];function GW(e,t,n,r,o,i){var l=Ao("TimesIcon"),d=W_("ripple");return de(),Vn(R5,pe({name:"p-message",appear:""},e.ptmi("transition")),{default:zo(function(){return[$g(Ve("div",pe({class:e.cx("root"),role:"alert","aria-live":"assertive","aria-atomic":"true"},e.ptm("root")),[e.$slots.container?Qn(e.$slots,"container",{key:0,closeCallback:i.close}):(de(),He("div",pe({key:1,class:e.cx("content")},e.ptm("content")),[Qn(e.$slots,"icon",{class:no(e.cx("icon"))},function(){return[(de(),Vn(Ts(e.icon?"span":null),pe({class:[e.cx("icon"),e.icon]},e.ptm("icon")),null,16,["class"]))]}),e.$slots.default?(de(),He("div",pe({key:0,class:e.cx("text")},e.ptm("text")),[Qn(e.$slots,"default")],16)):Hn("",!0),e.closable?$g((de(),He("button",pe({key:1,class:e.cx("closeButton"),"aria-label":i.closeAriaLabel,type:"button",onClick:t[0]||(t[0]=function(p){return i.close(p)})},CC(CC({},e.closeButtonProps),e.ptm("closeButton"))),[Qn(e.$slots,"closeicon",{},function(){return[e.closeIcon?(de(),He("i",pe({key:0,class:[e.cx("closeIcon"),e.closeIcon]},e.ptm("closeIcon")),null,16)):(de(),Vn(l,pe({key:1,class:[e.cx("closeIcon"),e.closeIcon]},e.ptm("closeIcon")),null,16,["class"]))]})],16,HW)),[[d]]):Hn("",!0)],16))],16),[[P5,o.visible]])]}),_:3},16)}RE.render=GW;var qW=({dt:e})=>`
.p-progressbar {
    position: relative;
    overflow: hidden;
    height: ${e("progressbar.height")};
    background: ${e("progressbar.background")};
    border-radius: ${e("progressbar.border.radius")};
}

.p-progressbar-value {
    margin: 0;
    background: ${e("progressbar.value.background")};
}

.p-progressbar-label {
    color: ${e("progressbar.label.color")};
    font-size: ${e("progressbar.label.font.size")};
    font-weight: ${e("progressbar.label.font.weight")};
}

.p-progressbar-determinate .p-progressbar-value {
    height: 100%;
    width: 0%;
    position: absolute;
    display: none;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transition: width 1s ease-in-out;
}

.p-progressbar-determinate .p-progressbar-label {
    display: inline-flex;
}

.p-progressbar-indeterminate .p-progressbar-value::before {
    content: "";
    position: absolute;
    background: inherit;
    inset-block-start: 0;
    inset-inline-start: 0;
    inset-block-end: 0;
    will-change: inset-inline-start, inset-inline-end;
    animation: p-progressbar-indeterminate-anim 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
}

.p-progressbar-indeterminate .p-progressbar-value::after {
    content: "";
    position: absolute;
    background: inherit;
    inset-block-start: 0;
    inset-inline-start: 0;
    inset-block-end: 0;
    will-change: inset-inline-start, inset-inline-end;
    animation: p-progressbar-indeterminate-anim-short 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) infinite;
    animation-delay: 1.15s;
}

@keyframes p-progressbar-indeterminate-anim {
    0% {
        inset-inline-start: -35%;
        inset-inline-end: 100%;
    }
    60% {
        inset-inline-start: 100%;
        inset-inline-end: -90%;
    }
    100% {
        inset-inline-start: 100%;
        inset-inline-end: -90%;
    }
}
@-webkit-keyframes p-progressbar-indeterminate-anim {
    0% {
        inset-inline-start: -35%;
        inset-inline-end: 100%;
    }
    60% {
        inset-inline-start: 100%;
        inset-inline-end: -90%;
    }
    100% {
        inset-inline-start: 100%;
        inset-inline-end: -90%;
    }
}

@keyframes p-progressbar-indeterminate-anim-short {
    0% {
        inset-inline-start: -200%;
        inset-inline-end: 100%;
    }
    60% {
        inset-inline-start: 107%;
        inset-inline-end: -8%;
    }
    100% {
        inset-inline-start: 107%;
        inset-inline-end: -8%;
    }
}
@-webkit-keyframes p-progressbar-indeterminate-anim-short {
    0% {
        inset-inline-start: -200%;
        inset-inline-end: 100%;
    }
    60% {
        inset-inline-start: 107%;
        inset-inline-end: -8%;
    }
    100% {
        inset-inline-start: 107%;
        inset-inline-end: -8%;
    }
}
`,jW={root:function(t){var n=t.instance;return["p-progressbar p-component",{"p-progressbar-determinate":n.determinate,"p-progressbar-indeterminate":n.indeterminate}]},value:"p-progressbar-value",label:"p-progressbar-label"},KW=mn.extend({name:"progressbar",style:qW,classes:jW}),XW={name:"BaseProgressBar",extends:js,props:{value:{type:Number,default:null},mode:{type:String,default:"determinate"},showValue:{type:Boolean,default:!0}},style:KW,provide:function(){return{$pcProgressBar:this,$parentInstance:this}}},TE={name:"ProgressBar",extends:XW,inheritAttrs:!1,computed:{progressStyle:function(){return{width:this.value+"%",display:"flex"}},indeterminate:function(){return this.mode==="indeterminate"},determinate:function(){return this.mode==="determinate"}}},YW=["aria-valuenow"];function QW(e,t,n,r,o,i){return de(),He("div",pe({role:"progressbar",class:e.cx("root"),"aria-valuemin":"0","aria-valuenow":e.value,"aria-valuemax":"100"},e.ptmi("root")),[i.determinate?(de(),He("div",pe({key:0,class:e.cx("value"),style:i.progressStyle},e.ptm("value")),[e.value!=null&&e.value!==0&&e.showValue?(de(),He("div",pe({key:0,class:e.cx("label")},e.ptm("label")),[Qn(e.$slots,"default",{},function(){return[Us(va(e.value+"%"),1)]})],16)):Hn("",!0)],16)):i.indeterminate?(de(),He("div",pe({key:1,class:e.cx("value")},e.ptm("value")),null,16)):Hn("",!0)],16,YW)}TE.render=QW;var JW=({dt:e})=>`
.p-fileupload input[type="file"] {
    display: none;
}

.p-fileupload-advanced {
    border: 1px solid ${e("fileupload.border.color")};
    border-radius: ${e("fileupload.border.radius")};
    background: ${e("fileupload.background")};
    color: ${e("fileupload.color")};
}

.p-fileupload-header {
    display: flex;
    align-items: center;
    padding: ${e("fileupload.header.padding")};
    background: ${e("fileupload.header.background")};
    color: ${e("fileupload.header.color")};
    border-style: solid;
    border-width: ${e("fileupload.header.border.width")};
    border-color: ${e("fileupload.header.border.color")};
    border-radius: ${e("fileupload.header.border.radius")};
    gap: ${e("fileupload.header.gap")};
}

.p-fileupload-content {
    border: 1px solid transparent;
    display: flex;
    flex-direction: column;
    gap: ${e("fileupload.content.gap")};
    transition: border-color ${e("fileupload.transition.duration")};
    padding: ${e("fileupload.content.padding")};
}

.p-fileupload-content .p-progressbar {
    width: 100%;
    height: ${e("fileupload.progressbar.height")};
}

.p-fileupload-file-list {
    display: flex;
    flex-direction: column;
    gap: ${e("fileupload.filelist.gap")};
}

.p-fileupload-file {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    padding: ${e("fileupload.file.padding")};
    border-block-end: 1px solid ${e("fileupload.file.border.color")};
    gap: ${e("fileupload.file.gap")};
}

.p-fileupload-file:last-child {
    border-block-end: 0;
}

.p-fileupload-file-info {
    display: flex;
    flex-direction: column;
    gap: ${e("fileupload.file.info.gap")};
}

.p-fileupload-file-thumbnail {
    flex-shrink: 0;
}

.p-fileupload-file-actions {
    margin-inline-start: auto;
}

.p-fileupload-highlight {
    border: 1px dashed ${e("fileupload.content.highlight.border.color")};
}

.p-fileupload-basic {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: ${e("fileupload.basic.gap")};
}
`,ZW={root:function(t){var n=t.props;return["p-fileupload p-fileupload-".concat(n.mode," p-component")]},header:"p-fileupload-header",pcChooseButton:"p-fileupload-choose-button",pcUploadButton:"p-fileupload-upload-button",pcCancelButton:"p-fileupload-cancel-button",content:"p-fileupload-content",fileList:"p-fileupload-file-list",file:"p-fileupload-file",fileThumbnail:"p-fileupload-file-thumbnail",fileInfo:"p-fileupload-file-info",fileName:"p-fileupload-file-name",fileSize:"p-fileupload-file-size",pcFileBadge:"p-fileupload-file-badge",fileActions:"p-fileupload-file-actions",pcFileRemoveButton:"p-fileupload-file-remove-button"},tU=mn.extend({name:"fileupload",style:JW,classes:ZW}),eU={name:"BaseFileUpload",extends:js,props:{name:{type:String,default:null},url:{type:String,default:null},mode:{type:String,default:"advanced"},multiple:{type:Boolean,default:!1},accept:{type:String,default:null},disabled:{type:Boolean,default:!1},auto:{type:Boolean,default:!1},maxFileSize:{type:Number,default:null},invalidFileSizeMessage:{type:String,default:"{0}: Invalid file size, file size should be smaller than {1}."},invalidFileTypeMessage:{type:String,default:"{0}: Invalid file type, allowed file types: {1}."},fileLimit:{type:Number,default:null},invalidFileLimitMessage:{type:String,default:"Maximum number of files exceeded, limit is {0} at most."},withCredentials:{type:Boolean,default:!1},previewWidth:{type:Number,default:50},chooseLabel:{type:String,default:null},uploadLabel:{type:String,default:null},cancelLabel:{type:String,default:null},customUpload:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!0},chooseIcon:{type:String,default:void 0},uploadIcon:{type:String,default:void 0},cancelIcon:{type:String,default:void 0},style:null,class:null,chooseButtonProps:{type:null,default:null},uploadButtonProps:{type:Object,default:function(){return{severity:"secondary"}}},cancelButtonProps:{type:Object,default:function(){return{severity:"secondary"}}}},style:tU,provide:function(){return{$pcFileUpload:this,$parentInstance:this}}},DE={name:"FileContent",hostName:"FileUpload",extends:js,emits:["remove"],props:{files:{type:Array,default:function(){return[]}},badgeSeverity:{type:String,default:"warn"},badgeValue:{type:String,default:null},previewWidth:{type:Number,default:50},templates:{type:null,default:null}},methods:{formatSize:function(t){var n,r=1024,o=3,i=((n=this.$primevue.config.locale)===null||n===void 0?void 0:n.fileSizeTypes)||["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(t===0)return"0 ".concat(i[0]);var l=Math.floor(Math.log(t)/Math.log(r)),d=parseFloat((t/Math.pow(r,l)).toFixed(o));return"".concat(d," ").concat(i[l])}},components:{Button:i0,Badge:o0,TimesIcon:Lp}},nU=["alt","src","width"];function rU(e,t,n,r,o,i){var l=Ao("Badge"),d=Ao("TimesIcon"),p=Ao("Button");return de(!0),He(kr,null,Lg(n.files,function(h,g){return de(),He("div",pe({key:h.name+h.type+h.size,class:e.cx("file"),ref_for:!0},e.ptm("file")),[Ve("img",pe({role:"presentation",class:e.cx("fileThumbnail"),alt:h.name,src:h.objectURL,width:n.previewWidth,ref_for:!0},e.ptm("fileThumbnail")),null,16,nU),Ve("div",pe({class:e.cx("fileInfo"),ref_for:!0},e.ptm("fileInfo")),[Ve("div",pe({class:e.cx("fileName"),ref_for:!0},e.ptm("fileName")),va(h.name),17),Ve("span",pe({class:e.cx("fileSize"),ref_for:!0},e.ptm("fileSize")),va(i.formatSize(h.size)),17)],16),In(l,{value:n.badgeValue,class:no(e.cx("pcFileBadge")),severity:n.badgeSeverity,unstyled:e.unstyled,pt:e.ptm("pcFileBadge")},null,8,["value","class","severity","unstyled","pt"]),Ve("div",pe({class:e.cx("fileActions"),ref_for:!0},e.ptm("fileActions")),[In(p,{onClick:function(x){return e.$emit("remove",g)},text:"",rounded:"",severity:"danger",class:no(e.cx("pcFileRemoveButton")),unstyled:e.unstyled,pt:e.ptm("pcFileRemoveButton")},{icon:zo(function(y){return[n.templates.fileremoveicon?(de(),Vn(Ts(n.templates.fileremoveicon),{key:0,class:no(y.class),file:h,index:g},null,8,["class","file","index"])):(de(),Vn(d,pe({key:1,class:y.class,"aria-hidden":"true",ref_for:!0},e.ptm("pcFileRemoveButton").icon),null,16,["class"]))]}),_:2},1032,["onClick","class","unstyled","pt"])],16)],16)}),128)}DE.render=rU;function lg(e){return iU(e)||aU(e)||AE(e)||oU()}function oU(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aU(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function iU(e){if(Array.isArray(e))return Xg(e)}function Ef(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=AE(e))||t){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(h){throw h},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,l=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var h=n.next();return l=h.done,h},e:function(h){d=!0,i=h},f:function(){try{l||n.return==null||n.return()}finally{if(d)throw i}}}}function AE(e,t){if(e){if(typeof e=="string")return Xg(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xg(e,t):void 0}}function Xg(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var IE={name:"FileUpload",extends:eU,inheritAttrs:!1,emits:["select","uploader","before-upload","progress","upload","error","before-send","clear","remove","remove-uploaded-file"],duplicateIEEvent:!1,data:function(){return{uploadedFileCount:0,files:[],messages:[],focused:!1,progress:null,uploadedFiles:[]}},methods:{upload:function(){this.hasFiles&&this.uploader()},onBasicUploaderClick:function(t){t.button===0&&this.$refs.fileInput.click()},onFileSelect:function(t){if(t.type!=="drop"&&this.isIE11()&&this.duplicateIEEvent){this.duplicateIEEvent=!1;return}this.isBasic&&this.hasFiles&&(this.files=[]),this.messages=[],this.files=this.files||[];var n=t.dataTransfer?t.dataTransfer.files:t.target.files,r=Ef(n),o;try{for(r.s();!(o=r.n()).done;){var i=o.value;!this.isFileSelected(i)&&!this.isFileLimitExceeded()&&this.validate(i)&&(this.isImage(i)&&(i.objectURL=window.URL.createObjectURL(i)),this.files.push(i))}}catch(l){r.e(l)}finally{r.f()}this.$emit("select",{originalEvent:t,files:this.files}),this.fileLimit&&this.checkFileLimit(),this.auto&&this.hasFiles&&!this.isFileLimitExceeded()&&this.uploader(),t.type!=="drop"&&this.isIE11()?this.clearIEInput():this.clearInputElement()},choose:function(){this.$refs.fileInput.click()},uploader:function(){var t=this;if(this.customUpload)this.fileLimit&&(this.uploadedFileCount+=this.files.length),this.$emit("uploader",{files:this.files}),this.clear();else{var n=new XMLHttpRequest,r=new FormData;this.$emit("before-upload",{xhr:n,formData:r});var o=Ef(this.files),i;try{for(o.s();!(i=o.n()).done;){var l=i.value;r.append(this.name,l,l.name)}}catch(d){o.e(d)}finally{o.f()}n.upload.addEventListener("progress",function(d){d.lengthComputable&&(t.progress=Math.round(d.loaded*100/d.total)),t.$emit("progress",{originalEvent:d,progress:t.progress})}),n.onreadystatechange=function(){if(n.readyState===4){var d;t.progress=0,n.status>=200&&n.status<300?(t.fileLimit&&(t.uploadedFileCount+=t.files.length),t.$emit("upload",{xhr:n,files:t.files})):t.$emit("error",{xhr:n,files:t.files}),(d=t.uploadedFiles).push.apply(d,lg(t.files)),t.clear()}},this.url&&(n.open("POST",this.url,!0),this.$emit("before-send",{xhr:n,formData:r}),n.withCredentials=this.withCredentials,n.send(r))}},clear:function(){this.files=[],this.messages=null,this.$emit("clear"),this.isAdvanced&&this.clearInputElement()},onFocus:function(){this.focused=!0},onBlur:function(){this.focused=!1},isFileSelected:function(t){if(this.files&&this.files.length){var n=Ef(this.files),r;try{for(n.s();!(r=n.n()).done;){var o=r.value;if(o.name+o.type+o.size===t.name+t.type+t.size)return!0}}catch(i){n.e(i)}finally{n.f()}}return!1},isIE11:function(){return!!window.MSInputMethodContext&&!!document.documentMode},validate:function(t){return this.accept&&!this.isFileTypeValid(t)?(this.messages.push(this.invalidFileTypeMessage.replace("{0}",t.name).replace("{1}",this.accept)),!1):this.maxFileSize&&t.size>this.maxFileSize?(this.messages.push(this.invalidFileSizeMessage.replace("{0}",t.name).replace("{1}",this.formatSize(this.maxFileSize))),!1):!0},isFileTypeValid:function(t){var n=this.accept.split(",").map(function(d){return d.trim()}),r=Ef(n),o;try{for(r.s();!(o=r.n()).done;){var i=o.value,l=this.isWildcard(i)?this.getTypeClass(t.type)===this.getTypeClass(i):t.type==i||this.getFileExtension(t).toLowerCase()===i.toLowerCase();if(l)return!0}}catch(d){r.e(d)}finally{r.f()}return!1},getTypeClass:function(t){return t.substring(0,t.indexOf("/"))},isWildcard:function(t){return t.indexOf("*")!==-1},getFileExtension:function(t){return"."+t.name.split(".").pop()},isImage:function(t){return/^image\//.test(t.type)},onDragEnter:function(t){this.disabled||(t.stopPropagation(),t.preventDefault())},onDragOver:function(t){this.disabled||(!this.isUnstyled&&pE(this.$refs.content,"p-fileupload-highlight"),this.$refs.content.setAttribute("data-p-highlight",!0),t.stopPropagation(),t.preventDefault())},onDragLeave:function(){this.disabled||(!this.isUnstyled&&_l(this.$refs.content,"p-fileupload-highlight"),this.$refs.content.setAttribute("data-p-highlight",!1))},onDrop:function(t){if(!this.disabled){!this.isUnstyled&&_l(this.$refs.content,"p-fileupload-highlight"),this.$refs.content.setAttribute("data-p-highlight",!1),t.stopPropagation(),t.preventDefault();var n=t.dataTransfer?t.dataTransfer.files:t.target.files,r=this.multiple||n&&n.length===1;r&&this.onFileSelect(t)}},remove:function(t){this.clearInputElement();var n=this.files.splice(t,1)[0];this.files=lg(this.files),this.$emit("remove",{file:n,files:this.files})},removeUploadedFile:function(t){var n=this.uploadedFiles.splice(t,1)[0];this.uploadedFiles=lg(this.uploadedFiles),this.$emit("remove-uploaded-file",{file:n,files:this.uploadedFiles})},clearInputElement:function(){this.$refs.fileInput.value=""},clearIEInput:function(){this.$refs.fileInput&&(this.duplicateIEEvent=!0,this.$refs.fileInput.value="")},formatSize:function(t){var n,r=1024,o=3,i=((n=this.$primevue.config.locale)===null||n===void 0?void 0:n.fileSizeTypes)||["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(t===0)return"0 ".concat(i[0]);var l=Math.floor(Math.log(t)/Math.log(r)),d=parseFloat((t/Math.pow(r,l)).toFixed(o));return"".concat(d," ").concat(i[l])},isFileLimitExceeded:function(){return this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount&&this.focused&&(this.focused=!1),this.fileLimit&&this.fileLimit<this.files.length+this.uploadedFileCount},checkFileLimit:function(){this.isFileLimitExceeded()&&this.messages.push(this.invalidFileLimitMessage.replace("{0}",this.fileLimit.toString()))},onMessageClose:function(){this.messages=null}},computed:{isAdvanced:function(){return this.mode==="advanced"},isBasic:function(){return this.mode==="basic"},chooseButtonClass:function(){return[this.cx("pcChooseButton"),this.class]},basicFileChosenLabel:function(){var t;if(this.auto)return this.chooseButtonLabel;if(this.hasFiles){var n;return this.files&&this.files.length===1?this.files[0].name:(n=this.$primevue.config.locale)===null||n===void 0||(n=n.fileChosenMessage)===null||n===void 0?void 0:n.replace("{0}",this.files.length)}return((t=this.$primevue.config.locale)===null||t===void 0?void 0:t.noFileChosenMessage)||""},hasFiles:function(){return this.files&&this.files.length>0},hasUploadedFiles:function(){return this.uploadedFiles&&this.uploadedFiles.length>0},chooseDisabled:function(){return this.disabled||this.fileLimit&&this.fileLimit<=this.files.length+this.uploadedFileCount},uploadDisabled:function(){return this.disabled||!this.hasFiles||this.fileLimit&&this.fileLimit<this.files.length},cancelDisabled:function(){return this.disabled||!this.hasFiles},chooseButtonLabel:function(){return this.chooseLabel||this.$primevue.config.locale.choose},uploadButtonLabel:function(){return this.uploadLabel||this.$primevue.config.locale.upload},cancelButtonLabel:function(){return this.cancelLabel||this.$primevue.config.locale.cancel},completedLabel:function(){return this.$primevue.config.locale.completed},pendingLabel:function(){return this.$primevue.config.locale.pending}},components:{Button:i0,ProgressBar:TE,Message:RE,FileContent:DE,PlusIcon:_E,UploadIcon:EE,TimesIcon:Lp},directives:{ripple:a0}},sU=["multiple","accept","disabled"],uU=["files"],cU=["accept","disabled","multiple"];function lU(e,t,n,r,o,i){var l=Ao("Button"),d=Ao("ProgressBar"),p=Ao("Message"),h=Ao("FileContent");return i.isAdvanced?(de(),He("div",pe({key:0,class:e.cx("root")},e.ptmi("root")),[Ve("input",pe({ref:"fileInput",type:"file",onChange:t[0]||(t[0]=function(){return i.onFileSelect&&i.onFileSelect.apply(i,arguments)}),multiple:e.multiple,accept:e.accept,disabled:i.chooseDisabled},e.ptm("input")),null,16,sU),Ve("div",pe({class:e.cx("header")},e.ptm("header")),[Qn(e.$slots,"header",{files:o.files,uploadedFiles:o.uploadedFiles,chooseCallback:i.choose,uploadCallback:i.uploader,clearCallback:i.clear},function(){return[In(l,pe({label:i.chooseButtonLabel,class:i.chooseButtonClass,style:e.style,disabled:e.disabled,unstyled:e.unstyled,onClick:i.choose,onKeydown:Q2(i.choose,["enter"]),onFocus:i.onFocus,onBlur:i.onBlur},e.chooseButtonProps,{pt:e.ptm("pcChooseButton")}),{icon:zo(function(g){return[Qn(e.$slots,"chooseicon",{},function(){return[(de(),Vn(Ts(e.chooseIcon?"span":"PlusIcon"),pe({class:[g.class,e.chooseIcon],"aria-hidden":"true"},e.ptm("pcChooseButton").icon),null,16,["class"]))]})]}),_:3},16,["label","class","style","disabled","unstyled","onClick","onKeydown","onFocus","onBlur","pt"]),e.showUploadButton?(de(),Vn(l,pe({key:0,class:e.cx("pcUploadButton"),label:i.uploadButtonLabel,onClick:i.uploader,disabled:i.uploadDisabled,unstyled:e.unstyled},e.uploadButtonProps,{pt:e.ptm("pcUploadButton")}),{icon:zo(function(g){return[Qn(e.$slots,"uploadicon",{},function(){return[(de(),Vn(Ts(e.uploadIcon?"span":"UploadIcon"),pe({class:[g.class,e.uploadIcon],"aria-hidden":"true"},e.ptm("pcUploadButton").icon,{"data-pc-section":"uploadbuttonicon"}),null,16,["class"]))]})]}),_:3},16,["class","label","onClick","disabled","unstyled","pt"])):Hn("",!0),e.showCancelButton?(de(),Vn(l,pe({key:1,class:e.cx("pcCancelButton"),label:i.cancelButtonLabel,onClick:i.clear,disabled:i.cancelDisabled,unstyled:e.unstyled},e.cancelButtonProps,{pt:e.ptm("pcCancelButton")}),{icon:zo(function(g){return[Qn(e.$slots,"cancelicon",{},function(){return[(de(),Vn(Ts(e.cancelIcon?"span":"TimesIcon"),pe({class:[g.class,e.cancelIcon],"aria-hidden":"true"},e.ptm("pcCancelButton").icon,{"data-pc-section":"cancelbuttonicon"}),null,16,["class"]))]})]}),_:3},16,["class","label","onClick","disabled","unstyled","pt"])):Hn("",!0)]})],16),Ve("div",pe({ref:"content",class:e.cx("content"),onDragenter:t[1]||(t[1]=function(){return i.onDragEnter&&i.onDragEnter.apply(i,arguments)}),onDragover:t[2]||(t[2]=function(){return i.onDragOver&&i.onDragOver.apply(i,arguments)}),onDragleave:t[3]||(t[3]=function(){return i.onDragLeave&&i.onDragLeave.apply(i,arguments)}),onDrop:t[4]||(t[4]=function(){return i.onDrop&&i.onDrop.apply(i,arguments)})},e.ptm("content"),{"data-p-highlight":!1}),[Qn(e.$slots,"content",{files:o.files,uploadedFiles:o.uploadedFiles,removeUploadedFileCallback:i.removeUploadedFile,removeFileCallback:i.remove,progress:o.progress,messages:o.messages},function(){return[i.hasFiles?(de(),Vn(d,{key:0,value:o.progress,showValue:!1,unstyled:e.unstyled,pt:e.ptm("pcProgressbar")},null,8,["value","unstyled","pt"])):Hn("",!0),(de(!0),He(kr,null,Lg(o.messages,function(g){return de(),Vn(p,{key:g,severity:"error",onClose:i.onMessageClose,unstyled:e.unstyled,pt:e.ptm("pcMessage")},{default:zo(function(){return[Us(va(g),1)]}),_:2},1032,["onClose","unstyled","pt"])}),128)),i.hasFiles?(de(),He("div",{key:1,class:no(e.cx("fileList"))},[In(h,{files:o.files,onRemove:i.remove,badgeValue:i.pendingLabel,previewWidth:e.previewWidth,templates:e.$slots,unstyled:e.unstyled,pt:e.pt},null,8,["files","onRemove","badgeValue","previewWidth","templates","unstyled","pt"])],2)):Hn("",!0),i.hasUploadedFiles?(de(),He("div",{key:2,class:no(e.cx("fileList"))},[In(h,{files:o.uploadedFiles,onRemove:i.removeUploadedFile,badgeValue:i.completedLabel,badgeSeverity:"success",previewWidth:e.previewWidth,templates:e.$slots,unstyled:e.unstyled,pt:e.pt},null,8,["files","onRemove","badgeValue","previewWidth","templates","unstyled","pt"])],2)):Hn("",!0)]}),e.$slots.empty&&!i.hasFiles&&!i.hasUploadedFiles?(de(),He("div",PB(pe({key:0},e.ptm("empty"))),[Qn(e.$slots,"empty")],16)):Hn("",!0)],16)],16)):i.isBasic?(de(),He("div",pe({key:1,class:e.cx("root")},e.ptmi("root")),[(de(!0),He(kr,null,Lg(o.messages,function(g){return de(),Vn(p,{key:g,severity:"error",onClose:i.onMessageClose,unstyled:e.unstyled,pt:e.ptm("pcMessage")},{default:zo(function(){return[Us(va(g),1)]}),_:2},1032,["onClose","unstyled","pt"])}),128)),In(l,pe({label:i.chooseButtonLabel,class:i.chooseButtonClass,style:e.style,disabled:e.disabled,unstyled:e.unstyled,onMouseup:i.onBasicUploaderClick,onKeydown:Q2(i.choose,["enter"]),onFocus:i.onFocus,onBlur:i.onBlur},e.chooseButtonProps,{pt:e.ptm("pcChooseButton")}),{icon:zo(function(g){return[Qn(e.$slots,"chooseicon",{},function(){return[(de(),Vn(Ts(e.chooseIcon?"span":"PlusIcon"),pe({class:[g.class,e.chooseIcon],"aria-hidden":"true"},e.ptm("pcChooseButton").icon),null,16,["class"]))]})]}),_:3},16,["label","class","style","disabled","unstyled","onMouseup","onKeydown","onFocus","onBlur","pt"]),e.auto?Hn("",!0):Qn(e.$slots,"filelabel",{key:0,class:no(e.cx("filelabel"))},function(){return[Ve("span",{class:no(e.cx("filelabel")),files:o.files},va(i.basicFileChosenLabel),11,uU)]}),Ve("input",pe({ref:"fileInput",type:"file",accept:e.accept,disabled:e.disabled,multiple:e.multiple,onChange:t[5]||(t[5]=function(){return i.onFileSelect&&i.onFileSelect.apply(i,arguments)}),onFocus:t[6]||(t[6]=function(){return i.onFocus&&i.onFocus.apply(i,arguments)}),onBlur:t[7]||(t[7]=function(){return i.onBlur&&i.onBlur.apply(i,arguments)})},e.ptm("input")),null,16,cU)],16)):Hn("",!0)}IE.render=lU;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var dU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function Za(e,t){function n(){this.constructor=e}dU(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Je(e,t,n,r){return new(n||(n=Promise))(function(o,i){function l(h){try{p(r.next(h))}catch(g){i(g)}}function d(h){try{p(r.throw(h))}catch(g){i(g)}}function p(h){h.done?o(h.value):new n(function(g){g(h.value)}).then(l,d)}p((r=r.apply(e,[])).next())})}function Ze(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function d(p){return function(h){return function(g){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&g[0]?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[2&g[0],o.value]),g[0]){case 0:case 1:o=g;break;case 4:return l.label++,{value:g[1],done:!1};case 5:l.label++,r=g[1],g=[0];continue;case 7:g=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){l=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){l.label=g[1];break}if(g[0]===6&&l.label<o[1]){l.label=o[1],o=g;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(g);break}o[2]&&l.ops.pop(),l.trys.pop();continue}g=t.call(e,l)}catch(y){g=[6,y],r=0}finally{n=o=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([p,h])}}}var $u={},dg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ti(e){e in $u||(document.createElement("canvas").addEventListener("webglcontextlost",function(n){n.preventDefault(),delete $u[e]},!1),$u[e]=fU(e));var t=$u[e];return t.isContextLost()?(delete $u[e],ti(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),$u[e])}function fU(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return e===1?t.getContext("webgl",dg)||t.getContext("experimental-webgl",dg):t.getContext("webgl2",dg)}function pU(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function Yg(e,t,n){return Math.max(e,Math.min(t,n))}function Gl(e){return e%2==0?e:e+1}function hU(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function mU(e,t){var n=Math.random();return t*n+(1-n)*e}function et(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function on(e,t,n){n===void 0&&(n=""),et(Ar(e,t),n+" Shapes "+e+" and "+t+" must match")}function pc(e){et(e!=null,"The input to the tensor constructor must be a non-null value.")}function ic(e,t){if(t===void 0&&(t=[]),Array.isArray(e)||Ka(e))for(var n=0;n<e.length;++n)ic(e[n],t);else t.push(e);return t}function ue(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ar(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Mo(e){return e%1==0}function gU(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function vU(e){for(var t=Math.floor(Math.sqrt(e));t>1;--t)if(e%t==0)return[t,e/t];return[1,e]}function Qu(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function SC(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,l=function(){if(e())r();else{var d=t(++i);n!=null&&i>=n?o():setTimeout(l,d)}};l()})}function yU(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function Ks(e,t){for(var n=[],r=[],o=0,i=0;i<e.length;++i){if(t!=null){if(t[o]===i&&e[i]!==1)throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(t[o]==null||t[o]>i)&&e[i]===1&&(n.push(e[i]),r.push(i)),t[o]<=i&&o++}e[i]!==1&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function Qg(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function NE(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function bU(e,t,n){if(t==="float32"){for(var r=0;r<e.length;r++)if(isNaN(e[r]))throw Error("The result of the '"+n+"' has NaNs.")}}function xU(e,t){if(t!=="float32"){for(var n=0;n<e.length;n++)if(isNaN(e[n]))throw Error("NaN is not a valid value for dtype: '"+t+"'.")}}function wU(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function Ka(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function PE(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function CU(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=2*n.length}),t}function ME(e){return typeof e=="string"||e instanceof String}function SU(e){return typeof e=="boolean"}function _U(e){return typeof e=="number"}function Wp(e){return e instanceof Array?Wp(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":_U(e)?"float32":ME(e)?"string":SU(e)?"bool":"float32"}function Jg(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Zg(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Xs(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function OE(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(EU(e,t))return e;if(Array.isArray(e)&&(e=ic(e)),t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return n&&xU(e,t),new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function EU(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function FE(e,t){for(var n=od(e,t),r=0;r<n.length;r++)n[r]=1;return n}function od(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function np(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}var kU=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new RU)}return e.prototype.profileKernel=function(t,n){var r,o=this,i=this.backendTimer.time(function(){r=n()});return(Array.isArray(r)?r:[r]).forEach(function(l){var d=l.dataSync();bU(d,l.dtype,t),i.then(function(p){var h="";p.getExtraProfileInfo!=null&&(h=p.getExtraProfileInfo()),o.logger.logKernelProfile(t,l,d,p.kernelMs,h)})}),r},e}(),RU=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,i){var l=Qu(o+"ms",9),d=Qu(t,25),p=n.rank,h=n.size,g=Qu(n.shape.toString(),14);console.log("%c"+d+"	%c"+l+"	%c"+p+"D "+g+"	%c"+h+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}(),_C=20,ul=3,fg=7;function TU(e,t,n,r){var o=Xs(t),i=DU(e,t,n,o),l=t.length,d=Hf(e,t,n,o,i),p=["Tensor"];return r&&(p.push("  dtype: "+n),p.push("  rank: "+l),p.push("  shape: ["+t+"]"),p.push("  values:")),p.push(d.map(function(h){return"    "+h}).join(`
`)),p.join(`
`)}function DU(e,t,n,r){var o=ue(t),i=r[r.length-1],l=new Array(i).fill(0),d=t.length,p=n==="complex64"?pl(e):e;if(d>1)for(var h=0;h<o/i;h++)for(var g=h*i,y=0;y<i;y++)l[y]=Math.max(l[y],fl(p[g+y],0).length);return l}function fl(e,t){return Qu(Array.isArray(e)?parseFloat(e[0].toFixed(fg))+" + "+parseFloat(e[1].toFixed(fg))+"j":ME(e)?"'"+e+"'":parseFloat(e.toFixed(fg)).toString(),t)}function Hf(e,t,n,r,o,i){i===void 0&&(i=!0);var l=n==="complex64"?2:1,d=t[0],p=t.length;if(p===0)return n==="complex64"?[fl(pl(e)[0],0)]:[e[0].toString()];if(p===1){if(d>_C){var h=ul*l,g=Array.from(e.slice(0,h)),y=Array.from(e.slice(d-ul*l,d));return n==="complex64"&&(g=pl(g),y=pl(y)),["["+g.map(function(F,W){return fl(F,o[W])}).join(", ")+", ..., "+y.map(function(F,W){return fl(F,o[d-ul+W])}).join(", ")+"]"]}return["["+(n==="complex64"?pl(e):Array.from(e)).map(function(F,W){return fl(F,o[W])}).join(", ")+"]"]}var x=t.slice(1),C=r.slice(1),_=r[0]*l,k=[];if(d>_C){for(var A=0;A<ul;A++){var I=(N=A*_)+_;k.push.apply(k,Hf(e.slice(N,I),x,n,C,o,!1))}for(k.push("..."),A=d-ul;A<d;A++)I=(N=A*_)+_,k.push.apply(k,Hf(e.slice(N,I),x,n,C,o,A===d-1))}else for(A=0;A<d;A++){var N;I=(N=A*_)+_,k.push.apply(k,Hf(e.slice(N,I),x,n,C,o,A===d-1))}var D=p===2?",":"";for(k[0]="["+k[0]+D,A=1;A<k.length-1;A++)k[A]=" "+k[A]+D;var M=`,
`;for(A=2;A<p;A++)M+=`
`;return k[k.length-1]=" "+k[k.length-1]+"]"+(i?"":M),k}function pl(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ql=function(){function e(t,n,r){if(this.dtype=n,this.shape=t.slice(),this.size=ue(t),r!=null){var o=r.length;et(o===this.size,"Length of values '"+o+"' does not match the size inferred by the shape '"+this.size+"'.")}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||NE(n,ue(this.shape)),this.strides=Xs(t)}return e.prototype.set=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];n.length===0&&(n=[0]),et(n.length===this.rank,"The number of provided coordinates ("+n.length+") must match the rank ("+this.rank+")");var o=this.locToIndex(n);this.values[o]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.values[r]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return zt.make(this.shape,{values:this.values},this.dtype)},e}(),Ro=null,xt=null;function s0(e){Ro=e}function AU(e){xt=e}var zt=function(){function e(t,n,r,o){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ue(t),this.strides=Xs(t),this.dataId=o??{},this.id=Ro().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ro().registerTensor(this),r!=null&&Ro().write(this.dataId,r)}return e.make=function(t,n,r){return new e(t,r,n.values,n.dataId)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),et(this.size===1,"The array must have only 1 element."),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,i){return this.throwIfDisposed(),this.reshape([t,n,r,o,i])},e.prototype.asType=function(t){return this.throwIfDisposed(),xt.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];et(t.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),et(this.dtype!=="complex64","Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),t.length===0&&(t=[0]);for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.dataSync()[r]},e.prototype.buffer=function(){return xt.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.data=function(){return Je(this,void 0,void 0,function(){return Ze(this,function(t){return this.throwIfDisposed(),[2,Ro().read(this.dataId)]})})},e.prototype.dataSync=function(){return this.throwIfDisposed(),Ro().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(Ro().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),xt.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),xt.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),xt.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),xt.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),xt.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),xt.clone(this)},e.prototype.toString=function(t){return t===void 0&&(t=!1),TU(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),xt.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),xt.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),xt.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),xt.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),xt.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),xt.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),xt.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),xt.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),xt.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),xt.stack([this,t],n)},e.prototype.unstack=function(t,n){return n===void 0&&(n=0),xt.unstack(this,n)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),xt.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,i){return r===void 0&&(r=.001),this.throwIfDisposed(),xt.batchNormalization(this,t,n,r,o,i)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),xt.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),xt.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),xt.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),xt.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),xt.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),xt.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),xt.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),xt.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),xt.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),xt.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),xt.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),xt.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),xt.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),xt.div(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),xt.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),xt.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),xt.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),xt.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),xt.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),xt.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),xt.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),xt.modStrict(this,t)},e.prototype.squaredDifference=function(t){return this.throwIfDisposed(),xt.squaredDifference(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),xt.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),xt.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),xt.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),xt.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),xt.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),xt.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),xt.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),xt.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),xt.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),xt.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),xt.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),xt.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),xt.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),xt.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),xt.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),xt.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),xt.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),xt.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),xt.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),xt.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),xt.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),xt.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),xt.sign(this)},e.prototype.exp=function(){return this.throwIfDisposed(),xt.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),xt.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),xt.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),xt.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),xt.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),xt.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),xt.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),xt.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),xt.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),xt.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),xt.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),xt.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),xt.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),xt.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),xt.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),xt.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),xt.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),xt.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),xt.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),xt.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),xt.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),xt.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),xt.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),xt.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),xt.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),xt.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),xt.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),xt.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),xt.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),xt.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),xt.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),xt.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),xt.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),xt.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),xt.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),xt.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),xt.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),xt.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),xt.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,i,l){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),xt.conv1d(this,t,n,r,o,i,l)},e.prototype.conv2d=function(t,n,r,o,i,l){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),xt.conv2d(this,t,n,r,o,i,l)},e.prototype.conv2dTranspose=function(t,n,r,o,i){return this.throwIfDisposed(),xt.conv2dTranspose(this,t,n,r,o,i)},e.prototype.depthwiseConv2D=function(t,n,r,o,i,l){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),xt.depthwiseConv2d(this,t,n,r,o,i,l)},e.prototype.separableConv2d=function(t,n,r,o,i,l){return i===void 0&&(i=[1,1]),l===void 0&&(l="NHWC"),this.throwIfDisposed(),xt.separableConv2d(this,t,n,r,o,i,l)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),xt.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),xt.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),xt.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,i){return this.throwIfDisposed(),xt.pool(this,t,n,r,o,i)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),ad.variable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),xt.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),xt.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),xt.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),xt.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,i){return o===void 0&&(o=0),i===void 0&&(i=0),this.throwIfDisposed(),xt.stridedSlice(this,t,n,r,o,i)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),xt.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),xt.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),xt.spectral.ifft(this)},e}();Object.defineProperty(zt,Symbol.hasInstance,{value:function(e){return!!e&&e.shape!=null&&e.dtype!=null}});var ad=function(e){function t(n,r,o){r===void 0&&(r=!0);var i=e.call(this,n.shape,n.dtype,null,n.dataId)||this;i.trainable=r,i.name=o,i.name==null&&(i.name=Ro().nextVariableId().toString());try{Ro().registerVariable(i)}catch(l){throw Ro().disposeTensor(i),l}return i}return Za(t,e),t.variable=function(n,r,o,i){return r===void 0&&(r=!0),i!=null&&i!==n.dtype&&(n=n.asType(i)),new t(n,r,o)},t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!Ar(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Ro().disposeTensor(this),this.dataId=n.dataId,Ro().registerTensor(this)},t}(zt);Object.defineProperty(ad,Symbol.hasInstance,{value:function(e){return e instanceof zt&&e.assign!=null&&e.assign instanceof Function}});var EC,tv,ev,nv,rv;ad.variable;function IU(e,t,n){for(var r={},o={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var l=(_=e[i]).inputs;for(var d in l){for(var p=l[d],h=!1,g=0;g<t.length;g++)if(r[p.id]){_.outputs.forEach(function(N){return r[N.id]=!0}),h=!0,o[_.id]=!0;break}if(h)break}}var y={};y[n.id]=!0;var x={};for(i=e.length-1;i>=0;i--)for(l=(_=e[i]).inputs,g=0;g<_.outputs.length;g++)if(y[_.outputs[g].id]){for(var d in l)y[l[d].id]=!0,x[_.id]=!0;break}var C=[];for(i=0;i<e.length;i++){var _;if(o[(_=e[i]).id]&&x[_.id]){var k={};for(var d in _.inputs){var A=_.inputs[d];r[A.id]&&(k[d]=A)}var I=Object.assign({},_);I.inputs=k,I.outputs=_.outputs,C.push(I)}}return C}function NU(e,t){for(var n=function(o){var i=t[o],l=[];if(i.outputs.forEach(function(x){var C=e[x.id];if(C!=null)l.push(C);else{var _=zt.make(x.shape,{values:od(x.size,x.dtype)},x.dtype);l.push(_)}}),i.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var d=i.gradient(i.outputs.length===1?l[0]:l);for(var p in i.inputs){if(!(p in d))throw new Error("Cannot backprop through input "+p+". Available gradients found: "+Object.keys(d)+".");var h=d[p]();if(h.dtype!=="float32")throw new Error("Error in gradient for op "+i.name+". The gradient of input "+p+" must have 'float32' dtype, but has '"+h.dtype+"'");var g=i.inputs[p];if(!Ar(h.shape,g.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+p+"' has shape '"+h.shape+"', which does not match the shape of the input '"+g.shape+"'");if(e[g.id]==null)e[g.id]=h;else{var y=e[g.id];e[g.id]=y.add(h),y.dispose()}}},r=t.length-1;r>=0;r--)n(r)}(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(EC||(EC={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(tv||(tv={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ev||(ev={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(nv||(nv={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(rv||(rv={}));var PU={float32:nv,int32:tv,bool:ev,complex64:rv};function lr(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return PU[e][t]}function pg(e){return lr(e,"int32")}function gr(e,t){if(e.dtype===t.dtype)return[e,t];var n=lr(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function MU(e,t){et(e.dtype===t.dtype,"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match")}function OU(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1}function $E(e){var t=[];return BE(e,t,new Set),t}function BE(e,t,n){if(e!=null){if(e instanceof zt)t.push(e);else if(FU(e)){var r=e;for(var o in r){var i=r[o];n.has(i)||(n.add(i),BE(i,t,n))}}}}function FU(e){return Array.isArray(e)||typeof e=="object"}var fn,$U=function(){function e(t,n,r){this.backend=t,this.safeMode=n,this.debugMode=r,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.scopeStack=[],this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.profiler=new kU(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.moveData=function(t){this.write(t,this.readSync(t))},e.prototype.tidy=function(t,n,r){var o=this;r===void 0&&(r=!1);var i,l=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");l=t}return this.scopedRun(function(){return o.startScope(l,r)},function(){return o.endScope(i,r)},function(){return(i=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(i){throw n(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.runKernel=function(t,n,r){var o,i=this,l=[],d=function(x){return l.push(x),x},p=this.activeScope.name,h=this.numBytes,g=this.numTensors;if(this.scopedRun(function(){return i.customGradientDepth++},function(){return i.customGradientDepth--},function(){o=i.debugMode()?i.profiler.profileKernel(p,function(){return t(i.backend,d)}):t(i.backend,d)}),this.shouldRecord()){var y={id:this.nextTapeNodeId++,name:p,inputs:n,outputs:Array.isArray(o)?o:[o]};r!=null&&(y.gradient=function(x){return r(x,l)}),this.activeTape.push(y)}return this.profiling&&this.activeProfile.kernels.push({name:p,bytesAdded:this.numBytes-h,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-g,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(n).map(function(x){return n[x].shape}),outputShape:Array.isArray(o)?o.map(function(x){return x.shape}):o.shape}),o},e.prototype.registerTensor=function(t){var n=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,t.dtype==="string"&&this.numStringTensors++,n===0){this.numDataBuffers++;var r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=ue(t.shape)*PE(t.dtype)),this.tensorInfo.set(t.dataId,{backend:this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.numBytes+=r,this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof ad||this.track(t)},e.prototype.registerVariable=function(t){if(this.registeredVariables[t.name]!=null)throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},e.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--,t.dtype==="string"&&this.numStringTensors--;var n=this.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.numBytes-=n.bytes),this.numDataBuffers--,n.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var n=this.registeredVariables[t];this.disposeTensor(n),delete this.registeredVariables[t]}},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return Je(this,void 0,void 0,function(){var n,r;return Ze(this,function(o){return this.profiling=!0,n=this.numBytes,r=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-n,this.activeProfile.newTensors=this.numTensors-r,[2,this.activeProfile]})})},e.prototype.shouldRecord=function(){return this.activeTape!=null&&this.customGradientDepth===0},e.prototype.addTapeNode=function(t,n,r){var o={};t.forEach(function(l,d){o[d]=l});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:o,outputs:[n],gradient:function(l){var d={};return r(l).forEach(function(p,h){d[h]=function(){return p}}),d}};this.activeTape.push(i)},e.prototype.keep=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},e.prototype.startScope=function(t,n){n===void 0&&(n=!1),n&&this.gradientScopeCount===0&&(this.activeTape=[]),n&&this.gradientScopeCount++;var r={track:[],name:"unnamed scope"};t&&(r.name=t),this.scopeStack.push(r),this.activeScope=r},e.prototype.endScope=function(t,n){var r=this;n===void 0&&(n=!1),n&&(this.gradientScopeCount--,this.gradientScopeCount===0&&(this.activeTape=null));var o=new Set(this.keepTensors),i=$E(t);i.forEach(function(h){return o.add(h.id)});for(var l=0;l<this.activeScope.track.length;l++){var d=this.activeScope.track[l];o.has(d.id)||(this.activeTape!=null?i.push(d):d.dispose())}var p=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],i.forEach(function(h){!r.keepTensors.has(h.id)&&OU(h,p.track)&&r.track(h)})},e.prototype.gradients=function(t,n,r,o){var i=this;if(o===void 0&&(o=!1),et(n.length>0,"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");return this.tidy("gradients",function(){var l=t();et(l instanceof zt,"The result y returned by f() must be a tensor.");var d=IU(i.activeTape,n,l);if(!o&&d.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var p={};return p[l.id]=r??BU(l.shape),NU(p,d),{value:l,grads:n.map(function(h){return p[h.id]})}},!0)},e.prototype.customGrad=function(t){var n=this;return et(Jg(t),"The f passed in customGrad(f) must be a function."),function(){for(var r,o,i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];return et(i.every(function(d){return d instanceof zt}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),n.scopedRun(function(){return n.customGradientDepth++},function(){return n.customGradientDepth--},function(){o=n.tidy(t.name,function(){var d=t.apply(void 0,i),p=d.value,h=d.gradFunc;return et(p instanceof zt,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),et(Jg(h),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r=h,p},!0)}),n.shouldRecord()&&n.addTapeNode(i,o,function(d){var p=r(d),h=Array.isArray(p)?p:[p];return et(h.length===i.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),et(h.every(function(g){return g instanceof zt}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),h}),o}},e.prototype.write=function(t,n){var r=this.tensorInfo.get(t);if(r.dtype==="string"){var o=CU(n);this.numBytes+=o-r.bytes,r.bytes=o}this.backend!==r.backend&&(r.backend.disposeData(t),r.backend=this.backend,this.backend.register(t,r.shape,r.dtype)),this.backend.write(t,n)},e.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},e.prototype.fromPixels=function(t,n){return this.backend.fromPixels(t,n)},e.prototype.time=function(t){return Je(this,void 0,void 0,function(){var n,r;return Ze(this,function(o){switch(o.label){case 0:return n=np(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=np()-n,[2,r]}})})},e.prototype.track=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&this.activeScope.track.push(t),t},e.nextTensorId=0,e.nextVariableId=0,e}();function BU(e){var t=FE(ue(e),"float32");return zt.make(e,{values:t})}(function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"})(fn||(fn={}));var hg,LU=[{name:"DEBUG",type:fn.BOOLEAN},{name:"IS_BROWSER",type:fn.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:fn.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:fn.BOOLEAN},{name:"WEBGL_PACK",type:fn.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:fn.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:fn.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:fn.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:fn.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:fn.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:fn.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:fn.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:fn.BOOLEAN},{name:"WEBGL_VERSION",type:fn.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:fn.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:fn.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:fn.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:fn.NUMBER},{name:"BACKEND",type:fn.STRING},{name:"EPSILON",type:fn.NUMBER},{name:"PROD",type:fn.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:fn.BOOLEAN}];function kC(e){try{if(ti(e)!=null)return!0}catch{return!1}return!1}function WU(e){if(hg==null){var t=ti(e);hg=t.getParameter(t.MAX_TEXTURE_SIZE)}return hg}function UU(e){if(e===0)return 0;var t=ti(e);return $s(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:$s(t,"EXT_disjoint_timer_query")?1:0}function zU(e){if(e===0)return!1;var t=ti(e);if(e===1){if(!$s(t,"OES_texture_float"))return!1}else if(!$s(t,"EXT_color_buffer_float"))return!1;return WE(t,e)}function VU(e){if(e===0)return!1;var t=ti(e);if(e===1){if(!$s(t,"OES_texture_float")||!$s(t,"WEBGL_color_buffer_float"))return!1}else if(!$s(t,"EXT_color_buffer_float"))return!1;return WE(t,e)}function HU(e){return e===2&&ti(e).fenceSync!=null}function GU(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var RC="tfjsflags";function LE(){var e={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return e;var t=qU(window.location.search);if(RC in t){var n={};t[RC].split(",").forEach(function(r){var o=r.split(":"),i=o[0],l=o[1];n[i]=l}),LU.forEach(function(r){r.name in n&&(console.log("Setting feature override from URL "+r.name+": "+n[r.name]),r.type===fn.NUMBER?e[r.name]=+n[r.name]:r.type===fn.BOOLEAN?e[r.name]=n[r.name]==="true":r.type===fn.STRING?e[r.name]=n[r.name]:console.warn("Unknown URL param: "+r.name+"."))})}return e}function $s(e,t){return e.getExtension(t)!=null}function WE(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var o=t===2?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),i}function qU(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(n){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return jU(t,r[0],r[1]),r.join("=")}),t}function jU(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}var KU=1e-4,XU=.1,YU=1e-7,QU=.001,Sa=function(){function e(t){this.features={},this.registry={},t!=null&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(t,n){if(!(t in rt.registry))throw new Error("Backend name '"+t+"' not found in registry");rt.engine.backend=rt.findBackend(t),rt.backendName=t},e.getBackend=function(){return rt.initEngine(),rt.backendName},e.disposeVariables=function(){rt.engine.disposeVariables()},e.memory=function(){return rt.engine.memory()},e.profile=function(t){return rt.engine.profile(t)},e.tidy=function(t,n){return rt.engine.tidy(t,n)},e.dispose=function(t){$E(t).forEach(function(n){return n.dispose()})},e.keep=function(t){return rt.engine.keep(t)},e.time=function(t){return rt.engine.time(t)},e.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(t,n){this.features[t]=n},e.prototype.getBestBackendName=function(){var t=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(n){return{name:n,entry:t.registry[n]}}).sort(function(n,r){return r.entry.priority-n.entry.priority})[0].name},e.prototype.evaluateFeature=function(t){if(t==="DEBUG")return!1;if(t==="IS_BROWSER")return typeof window<"u";if(t==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(t==="IS_CHROME")return GU();if(t==="WEBGL_CPU_FORWARD")return!0;if(t==="WEBGL_PACK")return!1;if(t==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(t==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(t==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(t==="WEBGL_PAGING_ENABLED")return this.get("IS_BROWSER")&&!this.get("PROD");if(t==="WEBGL_MAX_TEXTURE_SIZE")return WU(this.get("WEBGL_VERSION"));if(t==="IS_TEST")return!1;if(t==="BACKEND")return this.getBestBackendName();if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var n=this.get("WEBGL_VERSION");return n===0?0:UU(n)}if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!pU();if(t==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(t==="WEBGL_VERSION")return kC(2)?2:kC(1)?1:0;if(t==="WEBGL_RENDER_FLOAT32_ENABLED")return zU(this.get("WEBGL_VERSION"));if(t==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return VU(this.get("WEBGL_VERSION"));if(t==="WEBGL_FENCE_API_ENABLED")return HU(this.get("WEBGL_VERSION"));if(t==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(t==="TEST_EPSILON")return this.backend.floatPrecision()===32?QU:XU;if(t==="EPSILON")return this.backend.floatPrecision()===32?YU:KU;if(t==="PROD")return!1;if(t==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");throw new Error("Unknown feature "+t+".")},e.prototype.setFeatures=function(t){this.features=Object.assign({},t)},e.prototype.reset=function(){this.features=LE(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(e.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),e.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},e.prototype.registerBackend=function(t,n,r,o){var i=this;if(r===void 0&&(r=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),o!=null&&o(function(){return i.engine}),!1;try{var l=n();return l.setDataMover({moveData:function(d){return i.engine.moveData(d)}}),this.registry[t]={backend:l,priority:r},!0}catch(d){return console.warn("Registration of backend "+t+" failed"),console.warn(d.stack||d.message),!1}},e.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){var t=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var n=this.findBackend(this.backendName);this.globalEngine=new $U(n,!1,function(){return t.get("DEBUG")})}},e}();function JU(){var e;if(typeof window<"u")e=window;else{if(typeof process>"u")throw new Error("Could not find a global object");e=process}return e}function ZU(){var e=JU();return e.ENV==null&&(e.ENV=new Sa(LE()),s0(function(){return e.ENV.engine})),e.ENV}var rt=ZU();function tz(e,t){if(et(Jg(e),"The f passed in variableGrads(f) must be a function"),et(t==null||Array.isArray(t)&&t.every(function(p){return p instanceof ad}),"The varList passed in variableGrads(f, varList) must be an array of variables"),t==null)for(var n in t=[],rt.engine.registeredVariables)t.push(rt.engine.registeredVariables[n]);var r=t.length;et((t=t.filter(function(p){return p.trainable})).length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var o=rt.engine.gradients(e,t,null,!0),i=o.value,l=o.grads;et(l.some(function(p){return p!=null}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),et(i.rank===0,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor");var d={};return t.forEach(function(p,h){l[h]!=null&&(d[p.name]=l[h])}),{value:i,grads:d}}function id(e){return rt.engine.customGrad(e)}var ve=Sa.tidy,xn=Sa.keep,ez=Sa.dispose;Sa.time;Sa.profile;function ov(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];rt.get("IS_TEST")||console.warn.apply(console,e)}function rp(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,l=0;l<i;++l)o=o.concat([e[l+1]/t[l],t[l]]);o=o.concat(e.slice(i+1))}return o}function op(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],l=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?l.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,l)}return r}function ap(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function UE(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function zE(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function VE(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function nz(e,t,n){for(var r=e.length+t.length,o=[],i=0,l=0,d=0;d<r;d++)n.indexOf(d)===-1?o.push(e[i++]):o.push(t[l++]);return o}function sr(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(i){return e[i]})]}function Oo(e,t){return nz(e,t.map(function(n){return 1}),t)}function Mr(e,t){var n=t.length;return et((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e),et(e.every(function(r){return Mo(r)}),"All values in axis param must be integers but got axis "+e),e.map(function(r){return r<0?n+r:r})}function Qr(e,t,n){et(VE(t,n),e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input.")}function _a(e,t){if(VE(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function u0(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function Ea(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function rz(e,t){var n=e[0].length;e.forEach(function(o,i){et(o.length===n,"Error in concat"+n+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+n+")")}),et(t>=0&&t<n,"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+".");var r=e[0];e.forEach(function(o,i){for(var l=0;l<n;l++)et(l===t||o[l]===r[l],"Error in concat"+n+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+".")})}function jl(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function HE(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var l=e.shape,d=n.slice();d.pop();var p=1;for(i=r;i<e.rank;++i)p*=l[i],d.push(l[i]);var h=Xs(e.shape).map(function(g){return g/p}).concat([1]).slice(0,r);return[d,o,p,h]}var GE=30;function TC(e){return e<=GE?e:Zg(e,Math.floor(Math.sqrt(e)))}function oz(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var l=0;l<o;++l)if(n.shape[l]!==t.shape[l])throw new Error(i+" updates.shape["+l+"] ("+n.shape[l]+") != indices.shape["+l+"] ("+t.shape[l]+").");for(l=0;l<n.rank-o;++l)if(n.shape[l+o]!==e[l+r])throw new Error(i+" updates.shape["+(l+o)+"] ("+n.shape[l+o]+") != shape["+(l+o)+"] ("+e[l+o]+")")}function az(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}oz(n,t,e)}function ip(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=n.length,i=1,l=r;l<o;++l)i*=n[l];var d=r<1?1:r,p=t.size/d,h=Xs(n).concat([1]);return{sliceRank:r,numUpdates:p,sliceSize:i,strides:h.slice(h.length-r,h.length),outputSize:ue(n)}}function iz(e,t){var n,r=!1;for(e<=GE?(n=e,r=!0):n=Zg(e,Math.floor(Math.sqrt(e)));!r;){if(n>t||n===e){r=!0;break}n=Zg(e,n+1)}return n}function sz(e,t,n){for(var r=[],o=e.length,i=0;i<o;i++)i!==t?r.push(e[i]):r.push(n);return r}function uz(e,t,n){et(e.rank===t.length,"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."),et(e.rank===n.length,"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+").");for(var r=0;r<e.rank;++r)et(t[r]+n[r]<=e.shape[r],"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")")}function qE(e,t,n,r,o,i,l,d,p){if(o===void 0&&(o=0),i===void 0&&(i=0),l===void 0&&(l=0),d===void 0&&(d=0),p===void 0&&(p=0),l!==0)throw new Error("ellipsis mask is not yet supported");if(d!==0)throw new Error("new axis mask is not yet supported");for(var h=[],g=[],y=[],x=0;x<e.length;x++)h[x]=cz(o,t,r,e,x),g[x]=lz(i,n,r,e,x),p&1<<x&&(g[x]=h[x]+1,y.push(x));var C=new Array(e.length).fill(0);return C=C.map(function(_,k){for(var A=0,I=h[k];!(r[k]>0?I>=g[k]:I<=g[k]);I+=r[k])A+=1;return A}),[h,C,y]}function cz(e,t,n,r,o){var i=t[o];e&1<<o&&(i=n[o]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var l=r[o];return i<0&&(i+=l),i=Yg(0,i,l-1)}function lz(e,t,n,r,o){var i=t[o];e&1<<o&&(i=n[o]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var l=r[o];return i<0&&(i+=l),i=n[o]>0?Yg(0,i,l):Yg(-1,i,l-1)}function Ji(e){var t=e;if(Ka(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];t instanceof Array||Ka(t);)n.push(t.length),t=t[0];return e instanceof Array&&rt.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&jE(e,n,[]),n}function jE(e,t,n){if(n=n||[],e instanceof Array||Ka(e)){et(t.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),et(e.length===t[0],function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"});for(var r=t.slice(1),o=0;o<e.length;++o)jE(e[o],r,n.concat(o))}else et(t.length===0,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function DC(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function H(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof zt)return DC(r,e.dtype,t,n),e;var o=Wp(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),DC(r,o,t,n),!Ka(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+e.constructor.name+"'");var i=Ji(e);Ka(e)||Array.isArray(e)||(e=[e]);var l=o!=="string"?OE(e,o,rt.get("DEBUG")):ic(e);return zt.make(i,{values:l},o)}function sp(e,t,n){if(!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(r,o){return H(r,t+"["+o+"]",n)})}function ut(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];rt.engine.startScope(n);try{var d=r.apply(void 0,i);return d instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),rt.engine.endScope(d),d}catch(p){throw rt.engine.endScope(null),p}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}function dz(e,t){t===void 0&&(t=-1);var n=H(e,"logits","softmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return id(function(r){var o=r.logSumExp([t],!0),i=r.toFloat().sub(o).exp();return{value:i,gradFunc:function(l){var d=l.mul(i);return d.sub(d.sum([t],!0).mul(i))}}})(n)}function fz(e,t){t===void 0&&(t=-1);var n=H(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return id(function(r){var o=r.max(t,!0),i=r.sub(o),l=i.toFloat().sub(i.exp().sum(t,!0).log());return{value:l,gradFunc:function(d){var p=l.exp();return d.sub(d.sum(t,!0).mul(p))}}})(n)}var Ys=ut({softmax_:dz}),pz=ut({logSoftmax_:fz});function hz(e,t){var n=H(e,"real","complex"),r=H(t,"imag","complex");return on(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),rt.engine.runKernel(function(o){return o.complex(n,r)},{$real:n,$imag:r})}function mz(e){var t=H(e,"input","real");return rt.engine.runKernel(function(n){return n.real(t)},{$input:t})}function gz(e){var t=H(e,"input","imag");return rt.engine.runKernel(function(n){return n.imag(t)},{$input:t})}var Xr=ut({complex_:hz}),Ga=ut({real_:mz}),Ds=ut({imag_:gz});function Kn(e,t,n){if(n==null&&(n=Wp(e)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ka(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=Ji(e);if(t!=null){var o=ue(t),i=ue(r);et(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var l=0;l<r.length;++l){var d=r[l],p=l!==r.length-1||d!==ue(t.slice(l));et(r[l]===t[l]||!p,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return Ka(e)||Array.isArray(e)||(e=[e]),t=t||r,e=n!=="string"?OE(e,n,rt.get("DEBUG")):ic(e),zt.make(t,{values:e},n)}function Ot(e,t){if((Ka(e)||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Kn(e,[],t)}function eo(e,t){pc(e);var n=Ji(e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Kn(e,n,t)}function Up(e,t,n){if(pc(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ji(e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Kn(e,t=t||r,n)}function c0(e,t,n){if(pc(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ji(e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Kn(e,t=t||r,n)}function lo(e,t,n){if(pc(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ji(e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Kn(e,t=t||r,n)}function vz(e,t,n){if(pc(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ji(e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Kn(e,t=t||r,n)}function yz(e,t,n){if(pc(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ji(e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Kn(e,t=t||r,n)}function Hi(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Hi(e,"float32"),r=Hi(e,"float32");return Xr(n,r)}var o=FE(ue(e),t);return zt.make(e,{values:o},t)}function Fn(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Fn(e,"float32"),r=Fn(e,"float32");return Xr(n,r)}var o=od(ue(e),t);return zt.make(e,{values:o},t)}function Rl(e,t,n){var r=NE(n=n||Wp(t),ue(e));return r.fill(t),zt.make(e,{values:r},n)}function bz(e){var t=H(e,"x","onesLike");return Hi(t.shape,t.dtype)}function xz(e){var t=H(e,"x","zerosLike");return Fn(t.shape,t.dtype)}function wz(e,t,n){if(n===0)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),o=od(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return eo(o,"float32")}function KE(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Fn([0],r);var o=od(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return eo(o,r)}var Cz=ut({onesLike_:bz}),Sn=ut({zerosLike_:xz}),XE=function(){function e(t){this.dataMover=t,this.data=new WeakMap}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},e.prototype.set=function(t,n){this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.data.delete(t)},e}();function YE(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Fn(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!wU(e.dtype,t))return zt.make(e.shape,{dataId:e.dataId},t);if(e.dtype==="complex64"){var l=n.real(e);return i=l.cast(t),l.dispose(),i}if(t==="int32")return n.int(e);if(t==="bool"){var d=Ot(0,e.dtype);return i=n.notEqual(e,d),d.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function av(e,t){return zt.make(t,{dataId:e.dataId},e.dtype)}function QE(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Sz(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function _z(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function Ez(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function AC(e,t){return{real:e[2*t],imag:e[2*t+1]}}function kz(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Rz(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var i=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}function Tz(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function l0(e,t,n,r,o){for(var i=Array.from(t).map(function(C,_){return{score:C,boxIndex:_}}).filter(function(C){return C.score>o}).sort(function(C,_){return _.score-C.score}),l=[],d=0;d<i.length;d++){var p=i[d],h=p.score,g=p.boxIndex;if(h<o)break;for(var y=!1,x=l.length-1;x>=0;--x)if(Dz(e,g,l[x])>=r){y=!0;break}if(!y&&(l.push(g),l.length>=n))break}return eo(l,"int32")}function Dz(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),l=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),h=Math.min(o[0],o[2]),g=Math.min(o[1],o[3]),y=Math.max(o[0],o[2]),x=Math.max(o[1],o[3]),C=(d-i)*(p-l),_=(y-h)*(x-g);if(C<=0||_<=0)return 0;var k=Math.max(i,h),A=Math.max(l,g),I=Math.min(d,y),N=Math.min(p,x),D=Math.max(I-k,0)*Math.max(N-A,0);return D/(C+_-D)}function JE(e,t,n){var r=Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(i){o[n]=i;var l=e.slice(r,o);return r[n]+=i,l})}function ZE(e,t,n,r,o){for(var i=t[t.length-1],l=[e.length/i,i],d=l[0],p=l[1],h=Qg(n,d*r),g=Qg("int32",d*r),y=0;y<d;y++){for(var x=y*p,C=e.subarray(x,x+p),_=[],k=0;k<C.length;k++)_.push({value:C[k],index:k});_.sort(function(M,F){return F.value-M.value});var A=y*r,I=h.subarray(A,A+r),N=g.subarray(A,A+r);for(k=0;k<r;k++)I[k]=_[k].value,N[k]=_[k].index}var D=t.slice();return D[D.length-1]=r,[Kn(h,D,n),Kn(g,D,"int32")]}var Az=function(){return function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,l=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,l];var d=t==="max"?">":"<",p=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+p+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+d+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}(),Iz=function(){return function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,l=e.dilationWidth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=d-1-e.padInfo.top,g=p-1-e.padInfo.left,y=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+g+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+p+`;
            wC+= `+l+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}();function As(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,l=e[i]||1;(t[t.length-1-o]||1)>1&&l===1&&r.unshift(i)}return r}function hr(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,l=t[i];(o==null||o===1&&l>1)&&n.unshift(i)}return n}function Nz(e){for(var t=0;t<e.length;t++)if(e[t]!==t)return!1;return!0}function qe(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var l=t[t.length-o-1];if(l==null&&(l=1),i===1)n.unshift(l);else if(l===1)n.unshift(i);else{if(i!==l)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}var Pz=function(){return function(e,t,n,r,o,i){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],qe(e,t),qe(e,n);var l="0.0";r!=null&&(qe(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var d="1.0";o!=null&&(qe(e,o),this.variableNames.push("scale"),d="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+l+`;
        float scale = `+d+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),Mz=function(){return function(e,t,n,r,o,i){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],qe(e,t),qe(e,n);var l="vec4(0.0)";r!=null&&(qe(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var d="vec4(1.0)";o!=null&&(qe(e,o),this.variableNames.push("scale"),d="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+l+`;
        vec4 scale = `+d+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),IC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},NC=function(){return function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=qe(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),d0=`
  if (isNaN(a)) return a;
  if (isNaN(b)) return b;
`,PC="return a + b;",MC="return a - b;",Oz="return a * b;",Fz=`if (a == b) return 1.0;
  return a / b;`,$z=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,Bz=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Lz="return (a - b) * (a - b);",Wz="return float(a == b);",Uz="return float(a != b);",zz="return float(a < b);",Vz="return float(a <= b);",Hz="return float(a > b);",Gz="return float(a >= b);",qz="return float(a >= 1.0 && b >= 1.0);",jz="return float(a >= 1.0 || b >= 1.0);",Kz=d0+`
  return max(a, b);
`,Xz=d0+`
  return min(a, b);
`,Yz=`if (b == 0.0) return NAN;
  return mod(a, b);`,Qz=d0+`
  return atan(a, b);
`,Jz="return (b >= 1.0) ? a : a * (b + 1.0);",Bn=function(){function e(t,n,r){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=qe(n,r),this.userCode=`
      uniform float NAN;
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}return e.prototype.getCustomSetupFunc=function(){var t=this;return function(n,r){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(r,"NAN"),t.startLoc==null)||n.gl.uniform1f(t.startLoc,NaN)}},e}(),Zz=function(){return function(e,t,n){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      void main() {
        float value = getAAtOutCoords();
        if (isNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, float(`+t+"), float("+n+`)));
      }
    `}}(),tV=function(){return function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (hasNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(`+t+"), vec4("+n+`)));
      }
    `}}(),eV=function(){return function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),nV=function(){return function(e,t){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=jl([e,t],1),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        float value = 0.0;
        if (yC < `+e[1]+`) {
          value = getA(yR, yC);
        } else {
          yC -= `+e[1]+`;
          value = getB(yR, yC);
        }

        setOutput(value);
      }
    `}}(),rV=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),oV=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,l=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),aV=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,l=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+l+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),iV=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,d=t-1-e.padInfo.front,p=n-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+l+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),sV=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),uV=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,l=n-1-e.padInfo.left,d=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+d+`; dm++) {
              int d2 = d1 * `+d+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),cV=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,l=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),g=e.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+o+`);
      const ivec2 pads = ivec2(`+t+", "+n+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+i+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(g===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+h+`) *
                getW(wR, wC, `+h+`, d2);
            } else if (`+(g===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(g===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1),
                getX(batch, xR, xC, `+h+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),lV=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,p=e.dilationHeight,h=e.dilationWidth,g=e.filterDepth,y=e.filterHeight,x=e.filterWidth,C=4*Math.floor(e.inChannels/4),_=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+l+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+g+`; wF++) {
          int xF = xFCorner + wF * `+d+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+y+`; wR++) {
            int xR = xRCorner + wR * `+p+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+C+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(_===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+C+`) *
                  getW(wF, wR, wC, `+C+`, d2);
              } else if (`+(_===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+C+`),
                  getX(batch, xF, xR, xC, `+C+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+C+`, d2),
                  getW(wF, wR, wC, `+C+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(_===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+C+`),
                  getX(batch, xF, xR, xC, `+C+` + 1),
                  getX(batch, xF, xR, xC, `+C+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+C+`, d2),
                  getW(wF, wR, wC, `+C+` + 1, d2),
                  getW(wF, wR, wC, `+C+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),dV=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,h=e.filterHeight,g=e.filterWidth,y=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+l+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+y+`;
        int q = d2 - d1 * `+y+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+t+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+n+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),fV=function(){return function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.strideHeight,l=e.strideWidth,d=e.filterHeight,p=e.filterWidth,h=Math.ceil((p+1)/2),g="int xR; int xC;",y=0;y<d;y++){for(var x=-o;x<2*h;x++)g+="vec4 "+Eo(y,x)+" = vec4(0.);";for(x=0;x<p;x++)g+=`
          vec4 wR`+y+"C"+x+` = vec4(0.);
          vec4 xR`+y+"C"+x+" = vec4(0.);"}for(y=0;y<d;y++)for(x=0;x<h;x++){var C=2*x,_=2*x+o;g+=`
          xR = xRCorner + `+y+`;
          xC = xCCorner + `+_+`;

          if(xR >= 0 && xR < `+t+" && xC >= 0 && xC < "+n+`) {
            `+Eo(y,_)+` = getX(batch, xR, xC, d1);
          }`,o===0?C<p&&x===h-1&&(l>1&&(g+=`
                vec4 `+Eo(y,_+2)+` = vec4(0.);

                if(xR >= 0 && xR < `+t+" && xC + 2 < "+n+`) {
                  `+Eo(y,_+2)+` = getX(batch, xR, xC + 2, d1);
                }`),g+=`
              xR`+y+"C"+_+" = "+mg(y,_,l,o)+`;
            `):x===0&&(g+=`
            if(xR >= 0 && xR < `+t+` && xC - 2 >= 0) {
              `+Eo(y,_-2)+` = getX(batch, xR, xC - 2, d1);
            }`),C>0&&(g+="xR"+y+"C"+(_-2)+` =
            `+mg(y,_-2,l,o)+";"),_-1>=0&&_-1<p&&(g+="xR"+y+"C"+(_-1)+` =
              `+mg(y,_-1,l,o)+";"),C<p&&(g+=`
            vec4 wTexel`+y+"C"+C+" = getW("+y+", "+C+`, d1, q);
            wR`+y+"C"+C+" = vec4(wTexel"+y+"C"+C+".xz, wTexel"+y+"C"+C+`.xz);
          `,C+1<p&&(g+=`
              vec4 wTexelR`+y+"C"+(C+1)+" = getW("+y+", "+(C+1)+`, d1, q);
              wR`+y+"C"+(C+1)+` =
                vec4(wTexelR`+y+"C"+(C+1)+".xz, wTexelR"+y+"C"+(C+1)+".xz);"))}for(y=0;y<d;y++)for(x=0;x<p;x++)g+="result += xR"+y+"C"+x+" * wR"+y+"C"+x+";";this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+l+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+g+`

        setOutput(result);
      }
    `}}();function Eo(e,t){return"xTexelR"+e+"C"+(t<0?"minus"+Math.abs(t).toString():t)}function mg(e,t,n,r){return n===1?r%2==t%2?Eo(e,t):"vec4("+Eo(e,t-1)+".zw, "+Eo(e,t+1)+".xy)":r%2==t%2?"vec4("+Eo(e,t)+".xy, "+Eo(e,t+2)+".xy)":"vec4("+Eo(e,t-1)+".zw, "+Eo(e,t+1)+".zw)"}var pV=function(){return function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],l=e[1],d=e[2],p=e[3],h=t[0],g=n[0],y=n[1];this.outputShape=[h,g,y,p];var x=r==="bilinear"?1:0,C=[l-1+".0",d-1+".0"],_=C[0],k=C[1],A=g>1?[""+(l-1)/(g-1),"(y2-y1) * height_ratio","y1*"+_+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+_],I=A[0],N=A[1],D=A[2],M=y>1?[""+(d-1)/(y-1),"(x2-x1) * width_ratio","x1*"+k+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+k],F=M[0],W=M[1],L=M[2];this.userCode=`
      const float height_ratio = float(`+I+`);
      const float width_ratio = float(`+F+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+N+`;
        float width_scale = `+W+`;

        float in_y = `+D+`;
        if( in_y < 0.0 || in_y > `+_+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+L+`;
        if( in_x < 0.0 || in_x > `+k+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexRC = vec2(in_y,in_x);
        if(`+x+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));

          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);
          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);
          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);
          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);

          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

          float top = topLeft + (topRight - topLeft) * fracRC.y;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          float newValue = top + (bottom - top) * fracRC.x;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestRC = ivec2(floor(
            sourceFracIndexRC + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);
          setOutput(newValue);
        }
      }
    `}}();function sd(e,t,n){n===void 0&&(n="index");var r=Xs(t);return r.map(function(o,i){return"int "+e[i]+" = "+n+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"}).join("")}function kf(e){return e.length===1?""+e[0]:"vec"+e.length+"("+e.join(",")+")"}function hV(e,t){if(e.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+e.length+" and "+t.length);for(var n=[],r=Math.floor(e.length/4),o=e.length%4,i=0;i<r;i++){var l=e.slice(4*i,4*i+4),d=t.slice(4*i,4*i+4);n.push(kf(l)+", "+kf(d))}return o!==0&&(l=e.slice(4*r),d=t.slice(4*r),l.length===1&&(l=l.map(function(p){return"float("+p+")"}),d=d.map(function(p){return"float("+p+")"})),n.push(kf(l)+", "+kf(d))),n.map(function(p,h){return"dot("+p+")"}).join("+")}function mV(e,t,n,r,o){var i=e.map(function(y){var x=ue(y.shapeInfo.logicalShape);return y.shapeInfo.isUniform?"uniform float "+y.name+(x>1?"["+x+"]":"")+";":"uniform sampler2D "+y.name+";"});i=i.join(`
`);var l,d,p=e.map(function(y){return gV(y,t,r,o)}).join(`
`),h=t.texShape,g=TV;return t.isPacked?(l=vV(t.logicalShape,h),d=RV):(l=yV(t.logicalShape,h),d=kV),o&&(g+=DV),[g,EV,d,i,l,p,n].join(`
`)}function hc(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return UV(e);case 1:return VV(e);case 2:return GV(e);case 3:return jV(e);case 4:return XV(e);case 5:return YV(e);case 6:return QV(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function tk(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return WV(e);case 1:return zV(e);case 2:return HV(e);case 3:return qV(e);case 4:return KV(e);default:throw new Error("Packed "+t.length+"-D input sampling is not yet supported")}}function gV(e,t,n,r){r===void 0&&(r=!1);var o=JV(e);return o+=r?tk(e):hc(e),(n||Ar(e.shapeInfo.logicalShape,t.logicalShape))&&(o+=r?tH(e,t):eH(e,t,n)),o}function vV(e,t){switch(e.length){case 0:return ek();case 1:return AV(e,t);case 2:return BV(e,t);case 3:return NV(e,t);case 4:return MV(e,t);default:throw new Error(e.length+"-D packed output coordinate fetching is not yet supported")}}function yV(e,t){switch(e.length){case 0:return ek();case 1:return IV(e,t);case 2:return LV(e,t);case 3:return PV(e,t);case 4:return OV(e,t);case 5:return FV(e,t);case 6:return $V(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}}var bV=`
vec2 UVfrom1D(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xV=`
vec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {
  int index = row * numC + col;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wV=`
vec2 UVfrom3D(int texNumR, int texNumC, int stride0,
    int stride1, int row, int col, int depth) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CV=`
vec2 UVfrom4D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int row, int col, int depth,
    int depth2) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,
    int texelsInBatch, int texelsInLogicalRow, int b2, int b,
    int row, int col) {
  int index = b2 * texelsInBatch2 + b * texelsInBatch +
    (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SV=`
vec2 UVfrom5D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int row, int col, int depth,
    int depth2, int depth3) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 +
              depth * stride2 + depth2 * stride3 + depth3;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_V=`
vec2 UVfrom6D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int stride4,
    int row, int col, int depth, int depth2, int depth3, int depth4) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *
    stride3 + depth3 * stride4 + depth4;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,EV=`
  float sampleTexture(sampler2D textureSampler, vec2 uv) {
    return texture2D(textureSampler, uv).r;
  }
`,kV=`
  void setOutput(float val) {
    gl_FragColor = vec4(val, 0, 0, 0);
  }
`,RV=`
  void setOutput(vec4 val) {
    gl_FragColor = val;
  }
`,TV=`
  precision highp float;
  precision highp int;
  varying vec2 resultUV;
  const vec2 halfCR = vec2(0.5, 0.5);

  struct ivec5
  {
    int x;
    int y;
    int z;
    int w;
    int u;
  };

  struct ivec6
  {
    int x;
    int y;
    int z;
    int w;
    int u;
    int v;
  };

  `+(rt.get("PROD")?`
    bool isNaN(float val) {
      return false;
    }

    bool hasNaN(vec4 values) {
      return false;
    }
  `:`
    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    bool hasNaN(vec4 values) {
      return any(bvec4(
        isNaN(values.x),
        isNaN(values.y),
        isNaN(values.z),
        isNaN(values.w)
      ));
    }
  `)+`

  float getNaN(vec4 values) {
    return dot(vec4(1), values);
  }

  int round(float value) {
    return int(floor(value + 0.5));
  }

  int imod(int x, int y) {
    return x - y * (x / y);
  }

  //Based on the work of Dave Hoskins
  //https://www.shadertoy.com/view/4djSRW
  #define HASHSCALE1 443.8975
  float random(float seed){
    vec2 p = resultUV * seed;
    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
  }

  `+bV+`
  `+xV+`
  `+wV+`
  `+CV+`
  `+SV+`
  `+_V+`
`,DV=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ek(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function AV(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return t[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+n[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+n[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      return resTexRC.x * `+n[1]+` + resTexRC.y;
    }
  `}function IV(e,t){return t[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+t[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+t[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      return resTexRC.x * `+t[1]+` + resTexRC.y;
    }
  `}function NV(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec3(b, r, c);
    }
  `}function PV(e,t){var n=sd(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+n+`
      return ivec3(r, c, d);
    }
  `}function MV(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[3]/2),o=r*Math.ceil(e[2]/2),i=o*e[1];return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b2 = index / `+i+`;
      index -= b2 * `+i+`;

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec4(b2, b, r, c);
    }
  `}function OV(e,t){var n=sd(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+n+`
      return ivec4(r, c, d, d2);
    }
  `}function FV(e,t){var n=sd(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+t[0]+`,
                             `+t[1]+`));

      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+n+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function $V(e,t){var n=sd(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+n+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function BV(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ar(e,t))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+n[0]+", "+n[1]+`));
      }
    `;var r=Math.ceil(e[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));

      int index = resTexRC.x * `+n[1]+` + resTexRC.y;
      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec2(r, c);
    }
  `}function LV(e,t){return Ar(e,t)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+t[0]+", "+t[1]+`));
      }
    `:e[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      int r = index / `+e[1]+`;
      int c = index - r * `+e[1]+`;
      return ivec2(r, c);
    }
  `}function WV(e){var t=e.name;return`
    vec4 `+("get"+t.charAt(0).toUpperCase()+t.slice(1))+`() {
      return texture2D(`+t+`, halfCR);
    }
  `}function UV(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);return e.shapeInfo.isUniform?"float "+n+"() {return "+t+";}":`
    float `+n+`() {
      return sampleTexture(`+t+`, halfCR);
    }
  `}function zV(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 `+n+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return texture2D(`+t+`, uv);
    }
  `}function VV(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);return`
    float `+n+`(int index) {
      return `+n+`Flat(index);
    }
  `}function HV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=o[0],l=o[1];if(o!=null&&Ar(t,o))return`
      vec4 `+r+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+i+`.0);

        return texture2D(`+n+`, uv);
      }
    `;var d=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 `+r+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(t[1]/2)+", "+d[0]+", "+d[1]+`, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function GV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(o!=null&&Ar(t,o)){var i=o[0];return`
    float `+r+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+o[1]+".0, "+i+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `}var l=Ks(t),d=l.newShape,p=l.keptDims,h=d;if(h.length<t.length)return`
      `+hc(mc(e,h))+`
      float `+r+`(int row, int col) {
        return `+r+"("+gc(["row","col"],p)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col) {
        float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=o[0],y=o[1];return y===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:g===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      vec2 uv = vec2((index + 0.5) / `+y+`.0, 0.5);
      return sampleTexture(`+n+`, uv);
    }
  `:`
  float `+r+`(int row, int col) {
    vec2 uv = UVfrom2D(`+g+", "+y+", "+t[1]+`, row, col);
    return sampleTexture(`+n+`, uv);
  }
`}function qV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1)return`
        `+tk(mc(e,t.slice(1)))+`
        vec4 `+r+`(int b, int row, int col) {
          return `+r+"("+gc(["b","row","col"],[1,2])+`);
        }
      `;var l=i[0],d=i[1],p=Math.ceil(t[2]/2);return`
    vec4 `+r+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+l+", "+d+", "+p*Math.ceil(t[1]/2)+", "+p+`, b, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function jV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],i=t[2],l=Ks(t),d=l.newShape,p=l.keptDims,h=d;if(h.length<t.length)return`
        `+hc(mc(e,h))+`
        float `+r+`(int row, int col, int depth) {
          return `+r+"("+gc(["row","col","depth"],p)+`);
        }
      `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth) {
        float index = dot(vec3(row, col, depth),
                          vec3(`+o+", "+i+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=e.shapeInfo.texShape,y=g[0],x=g[1];return x===o?`
        float `+r+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+i+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+y+`.0);
          return sampleTexture(`+n+`, uv);
        }
      `:x===i?`
    float `+r+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+y+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:`
      float `+r+`(int row, int col, int depth) {
        vec2 uv = UVfrom3D(
            `+y+", "+x+", "+o+", "+i+`, row, col, depth);
        return sampleTexture(`+n+`, uv);
      }
  `}function KV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=i[0],d=i[1],p=Math.ceil(t[3]/2),h=p*Math.ceil(t[2]/2);return`
    vec4 `+r+`(int b2, int b, int row, int col) {
      vec2 uv = packedUVfrom4D(
        `+l+", "+d+", "+h*t[1]+`,
        `+h+", "+p+`, b2, b, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function XV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],i=t[2]*o,l=t[1]*i,d=Ks(t),p=d.newShape,h=d.keptDims;if(p.length<t.length)return`
      `+hc(mc(e,p))+`
      float `+r+`(int row, int col, int depth, int depth2) {
        return `+r+"("+gc(["row","col","depth","depth2"],h)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2) {
        float index = dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+i+", "+o+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=e.shapeInfo.texShape,y=g[0],x=g[1];return x===l?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2), vec3(`+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:x===o?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2) {
      vec2 uv = UVfrom4D(`+y+", "+x+", "+l+", "+i+`,
          `+o+`, row, col, depth, depth2);
      return sampleTexture(`+n+`, uv);
    }
  `}function YV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],i=t[3]*o,l=t[2]*i,d=t[1]*l,p=Ks(t),h=p.newShape,g=p.keptDims;if(h.length<t.length)return`
      `+hc(mc(e,h))+`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        return `+r+"("+gc(["row","col","depth","depth2","depth3"],g)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+d+", "+l+", "+i+", "+o+`)) +
          depth3;
        return `+r+`Flat(index);
      }
    `;var y=e.shapeInfo.texShape,x=y[0],C=y[1];return C===d?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+l+", "+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+x+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:C===o?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]+", "+t[2]*t[3]+`,
            `+t[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+x+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2, int depth3) {
      vec2 uv = UVfrom5D(`+x+", "+C+", "+d+", "+l+`,
          `+i+", "+o+`, row, col, depth, depth2, depth3);
      return sampleTexture(`+n+`, uv);
    }
  `}function QV(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[5],i=t[4]*o,l=t[3]*i,d=t[2]*l,p=t[1]*d,h=Ks(t),g=h.newShape,y=h.keptDims;if(g.length<t.length)return`
      `+hc(mc(e,g))+`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+r+"("+gc(["row","col","depth","depth2","depth3","depth4"],y)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+l+", "+i+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+o+`, 1));
        return `+r+`Flat(index);
      }
    `;var x=e.shapeInfo.texShape,C=x[0],_=x[1];return _===p?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+l+", "+i+", "+o+`)) + depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:_===o?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]*t[4]+`,
               `+t[2]*t[3]*t[4]+`,
               `+t[3]*t[4]+`,
               `+t[4]+`)) + depth3;
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      vec2 uv = UVfrom6D(`+C+", "+_+", "+p+", "+d+`,
          `+l+", "+i+", "+o+`
          ,row, col, depth, depth2, depth3, depth4);
      return sampleTexture(`+n+`, uv);
    }
  `}function JV(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1)+"Flat",r=ue(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform)return r===1?"float "+n+"(int index) {return "+t+";}":`
      float `+n+`(int index) {
        for (int i = 0; i < `+r+`; i++) {
          if (i == index) {
            return `+t+`[i];
          }
        }
      }
    `;var o=e.shapeInfo.texShape,i=o[0],l=o[1];return l===1&&i===1?`
      float `+n+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `:l===1?`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index) + 0.5) / `+i+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:i===1?`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index) + 0.5) / `+l+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+n+`(int index) {
      vec2 uv = UVfrom1D(`+i+", "+l+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function ZV(e,t,n,r){var o=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,l="int";i===2?l="ivec2":i===3?l="ivec3":i===4&&(l="ivec4");var d=As(e.shapeInfo.logicalShape,t.logicalShape),p=i-o;return`
    float `+r+`() {
      `+l+` coords = getOutputCoords();
      `+(o===0?"":i<2&&d.length>=1?"coords = 0;":d.map(function(h){return"coords["+(h+p)+"] = 0;"}).join(`
`))+`
      return get`+n+"("+(i<2&&o>0?"coords":e.shapeInfo.logicalShape.map(function(h,g){return"coords["+(g+p)+"]"}).join(", "))+`);
    }
  `}function tH(e,t,n){var r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,l="get"+o+"AtOutCoords",d=t.texShape,p=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=p[0],g=p[1],y=As(e.shapeInfo.logicalShape,t.logicalShape),x=e.shapeInfo.logicalShape.length,C=t.logicalShape.length;if(y.length)throw Error("Packed broadcast sampling is not implemented yet.");if(Ar(e.shapeInfo.texShape,d))return`
      vec4 `+l+`() {
        return texture2D(`+r+`, resultUV);
      }
    `;var _="return texture2D("+r+", uv)";return x===1&&C>1?_=`
      vec4 sample = texture2D(`+r+`, uv);
      return vec4(sample.xy, sample.xy);
    `:x===0&&C>0&&(_=C===1?`
        vec4 sample = texture2D(`+r+`, uv);
        return vec4(sample.x, sample.x, 0., 0.);
      `:`
        vec4 sample = texture2D(`+r+`, uv);
        return vec4(sample.x);
      `),`
    vec4 `+l+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+p[0]+", "+p[1]+`));
      int index = resTexRC.x * `+p[1]+` + resTexRC.y;

      int texR = index / `+g+`;
      int texC = index - texR * `+g+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+", "+h+`);

      `+_+`;
    }
  `}function eH(e,t,n){var r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",l=As(e.shapeInfo.logicalShape,t.logicalShape),d=e.shapeInfo.logicalShape.length,p=t.logicalShape.length,h=n&&(p>d||l.length>0),g=Nz(l),y=e.shapeInfo.isUniform;if(h&&!g)return ZV(e,t,o,i);var x=ue(e.shapeInfo.logicalShape),C="";h&&g&&(C=`
        int mainPart = index / `+x+`;
        index -= mainPart * `+x+`;
      `);var _=t.texShape;if(y)return x===1?"float "+i+"() {return "+r+";}":`
      float `+i+`() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                              vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        `+C+`
        return get`+o+`Flat(index);
      }
    `;var k=e.shapeInfo.texShape;return Ar(k,_)?`
      float `+i+`() {
        return sampleTexture(`+r+`, resultUV);
      }
    `:`
    float `+i+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      `+C+`
      int texR = index / `+k[1]+`;
      int texC = index - texR * `+k[1]+`;
      vec2 uv = (vec2(texC, texR) + halfCR) /
                 vec2(`+k[1]+".0, "+k[0]+`.0);

      return sampleTexture(`+r+`, uv);
    }
  `}function Ir(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function mc(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function gc(e,t){return t.map(function(n){return e[n]}).join(", ")}var nH=function(){return function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ir(r)+` coords = getOutputCoords();
        int end = `+OC(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+OC(r,"coords")+` = idx;
          val += getX(`+rH(r,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function rH(e,t){if(e===1)return""+t;if(e===2)return t+".x, "+t+".y";if(e===3)return t+".x, "+t+".y, "+t+".z";if(e===4)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}function OC(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var oH=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),aH=function(){return function(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isNaN(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        gl_FragColor = encode_float(x);
      }
    `}}(),FC={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},$C=function(){return function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),iH=function(){return function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = texture2D(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),sH=function(){return function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Ir(this.rank),i=uH(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}}();function uH(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(n===1)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<e.length;i++)i===t?o.push("int(getIndices("+r[i]+"))"):o.push(""+r[i]);return o.join()}var ha,Jr,cH=function(){return function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Ir(t.length),o=Ir(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function vc(e,t){return[t,e]}function yc(e,t){return e*t}function lH(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}function dH(e,t,n){var r=yc(e.length,n);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var o=0,i=0;i<e.length;++i)t[o]=e[i],o+=n}function nk(e,t,n){var r=lH(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,i=0;i<e.length;i+=n)t[o++]=e[i]}function Qs(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function zp(e,t){var n=Qs(e,t);return n[0]*n[1]*4}function fH(e,t,n,r,o){var i=zp(n,r);if(o.length<i)throw new Error("packedRGBA length ("+o.length+`) must be >=
        `+i);for(var l=r%2==1,d=n%2==1,p=Math.floor(r/2),h=Math.floor(n/2),g=Math.ceil(r/2),y=g*Math.ceil(n/2),x=Gl(n)*Gl(r),C=0;C<t;C++){for(var _=C*n*r,k=C*x,A=l?4:0,I=r,N=k,D=0;D<h;++D){for(var M=2*D*r,F=0;F<p;++F){var W=_+M+2*F;o[N]=e[W],o[N+1]=e[W+1],o[N+2]=e[W+I],o[N+3]=e[W+I+1],N+=4}N+=A}if(l){W=_+r-1,N=k+4*(g-1);var L=2*r;for(A=4*g,D=0;D<h;++D)o[N]=e[W],o[N+2]=e[W+r],W+=L,N+=A}if(d){for(W=_+(n-1)*r,N=k+4*(y-g),F=0;F<p;++F)o[N++]=e[W++],o[N++]=e[W++],N+=2;l&&d&&(o[k+x-4]=e[W])}}return o}function rk(e,t,n,r,o){var i=n*r;if(o.length<i)throw new Error("matrix length ("+o.length+") must be >= "+i);for(var l=r%2==1,d=n%2==1,p=Math.floor(r/2),h=Math.floor(n/2),g=Math.ceil(r/2),y=g*Math.ceil(n/2),x=Gl(n)*Gl(r),C=0;C<t;C++){for(var _=C*n*r,k=C*x,A=l?4:0,I=r+(l?1:0),N=k,D=_,M=_+r,F=0;F<h;++F){for(var W=0;W<p;++W)o[D++]=e[N++],o[D++]=e[N++],o[M++]=e[N++],o[M++]=e[N++];N+=A,D+=I,M+=I}if(l){N=k+4*(g-1);var L=_+r-1;for(A=4*g,I=2*r,F=0;F<h;++F)o[L]=e[N],o[L+r]=e[N+2],N+=A,L+=I}if(d){for(N=k+4*(y-g),L=_+(n-1)*r,W=0;W<p;++W)o[L++]=e[N++],o[L++]=e[N++],N+=2;l&&(o[_+n*r-1]=e[N])}}return o}function oe(e,t){var n=t();return hH(e),n}(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(ha||(ha={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Jr||(Jr={}));var ok=!1;function pH(e){ok=e}function hH(e){if(ok){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+mH(e,t))}}function mH(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Rf(e,t){return ei(e,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function gH(e,t){var n=ei(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(oe(e,function(){return e.shaderSource(n,t)}),oe(e,function(){return e.compileShader(n)}),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function vH(e,t){var n=ei(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(oe(e,function(){return e.shaderSource(n,t)}),oe(e,function(){return e.compileShader(n)}),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw bH(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var yH=/ERROR: [0-9]+:([0-9]+):/g;function bH(e,t){var n=yH.exec(t);if(n==null)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split(`
`),i=o.length.toString().length+2,l=o.map(function(x,C){return Qu((C+1).toString(),i)+x}),d=0,p=0;p<l.length;p++)d=Math.max(l[p].length,d);var h=l.slice(0,r-1),g=l.slice(r-1,r),y=l.slice(r);console.log(h.join(`
`)),console.log(t.split(`
`)[0]),console.log("%c "+Qu(g[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(y.join(`
`))}function xH(e){return ei(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function wH(e,t){if(oe(e,function(){return e.linkProgram(t)}),e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function gg(e,t){if(oe(e,function(){return e.validateProgram(t)}),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function CH(e,t){var n=ei(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return oe(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),oe(e,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function SH(e,t){var n=ei(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return oe(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)}),oe(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function _H(){return rt.get("WEBGL_VERSION")===2?1:4}function EH(e){return ei(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function ak(e,t){var n=rt.get("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function kH(e){return ei(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function BC(e,t,n,r,o,i,l){var d=e.getAttribLocation(t,n);return d!==-1&&(oe(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),oe(e,function(){return e.vertexAttribPointer(d,o,e.FLOAT,!1,i,l)}),oe(e,function(){return e.enableVertexAttribArray(d)}),!0)}function RH(e,t,n){NH(e,n),oe(e,function(){return e.activeTexture(e.TEXTURE0+n)}),oe(e,function(){return e.bindTexture(e.TEXTURE_2D,t)})}function TH(e,t,n){return ei(e,function(){return e.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function DH(e,t,n){return e.getUniformLocation(t,n)}function AH(e,t,n,r,o){oe(e,function(){return RH(e,n,o)}),oe(e,function(){return e.uniform1i(r,o)})}function vg(e,t,n){oe(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),oe(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})}function LC(e,t){oe(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),oe(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Tf(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+IH(e,t))}function IH(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function ei(e,t,n){var r=oe(e,function(){return t()});if(r==null)throw new Error(n);return r}function NH(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function PH(e,t){t===void 0&&(t=!1);var n=rt.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map(function(i,l){return l>=e.length-2?Gl(e[l]):e[l]})),e.length!==2){var r=Ks(e);e=r.newShape}var o=ue(e);return e.length<=1&&o<=n?[1,o]:e.length===2&&e[0]<=n&&e[1]<=n?e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n?[e[0],e[1]*e[2]*e[3]]:vU(o)}function Bu(e){return e%2==0}function WC(e,t){if(Ar(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Bu(n)&&Bu(r)&&(e[0]===1||t[0]===1))return!0}else if(Bu(e[0])&&Bu(t[0])&&(Bu(e[1])&&Bu(t[1])||e[1]===t[1]))return!0;return!1}function MH(e){return gH(e,`
    precision highp float;
    attribute vec3 clipSpacePos;
    attribute vec2 uv;
    varying vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function OH(e){return CH(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function FH(e){return SH(e,new Uint16Array([0,1,2,2,1,3]))}function $H(e,t){var n,r,o,i,l,d,p,h=e;return rt.get("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,o=h.RGBA32F,i=h.RED,l=4,d=1,p=h.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,o=h.RGBA,i=e.RGBA,l=4,d=4,p=t!=null?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:p}}function ud(e,t,n,r,o,i){ak(t,n);var l=EH(e),d=e.TEXTURE_2D;return oe(e,function(){return e.bindTexture(d,l)}),oe(e,function(){return e.texParameteri(d,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),oe(e,function(){return e.texParameteri(d,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),oe(e,function(){return e.texParameteri(d,e.TEXTURE_MIN_FILTER,e.NEAREST)}),oe(e,function(){return e.texParameteri(d,e.TEXTURE_MAG_FILTER,e.NEAREST)}),oe(e,function(){return e.texImage2D(d,0,r,t,n,0,o,i,null)}),oe(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),l}function BH(e,t,n,r){var o=vc(t,n);return ud(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,e.FLOAT)}function LH(e,t,n,r){var o=vc(t,n);return ud(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function WH(e,t,n,r){var o=vc(t,n);return ud(e,o[0],o[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function UH(e,t,n,r){var o=Qs(t,n);return ud(e,o[0],o[1],r.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function zH(e,t,n,r){var o=Qs(t,n);return ud(e,o[0],o[1],r.internalFormatHalfFloat,e.RGBA,r.textureTypeHalfFloat)}function VH(e,t,n){return oe(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),BC(e,t,"clipSpacePos",n,3,20,0)&&BC(e,t,"uv",n,2,20,12)}function HH(e,t,n){oe(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),oe(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}),oe(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function ik(e,t,n,r,o,i){ak(n,r),oe(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),oe(e,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,i,e.FLOAT,o)}),oe(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function GH(e,t,n,r,o,i,l){var d,p=vc(n,r),h=p[0],g=p[1];l.defaultNumChannels===1?d=o:dH(o,d=new Float32Array(yc(o.length,i)),i),ik(e,t,h,g,d,l.textureFormatFloat)}function qH(e,t,n,r,o,i,l,d,p){var h=Qs(i,l),g=h[0],y=h[1],x=new Float32Array(n*zp(r,o));fH(d,n,r,o,x),ik(e,t,g,y,x,e.RGBA)}function jH(e,t,n,r,o){var i=t;if(rt.get("WEBGL_VERSION")===2){var l=e,d=l.createBuffer();oe(e,function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,d)});var p=4*yc(n*r,o.downloadUnpackNumChannels);oe(e,function(){return e.bufferData(l.PIXEL_PACK_BUFFER,p,e.STATIC_DRAW)}),oe(e,function(){return l.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),oe(e,function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,null)}),i=d}return i}function KH(e,t,n,r,o){var i=e,l=new Float32Array(yc(n*r,o.downloadUnpackNumChannels));i.bindBuffer(e.ARRAY_BUFFER,t),i.getBufferSubData(e.ARRAY_BUFFER,0,l),i.bindBuffer(e.ARRAY_BUFFER,null);var d=new Float32Array(n*r);return nk(l,d,o.downloadUnpackNumChannels),d}function XH(e,t,n,r){var o=vc(t,n),i=o[0],l=o[1],d=new Float32Array(yc(t*n,r.downloadUnpackNumChannels));oe(e,function(){return e.readPixels(0,0,i,l,r.downloadTextureFormat,e.FLOAT,d)});var p=new Float32Array(t*n);return nk(d,p,r.downloadUnpackNumChannels),p}function YH(e,t,n,r){var o=vc(t,n),i=o[0],l=o[1],d=new Uint8Array(yc(t*n,4));return oe(e,function(){return e.readPixels(0,0,i,l,r.downloadTextureFormat,e.UNSIGNED_BYTE,d)}),new Float32Array(d.buffer)}function QH(e,t,n,r,o,i,l,d){var p=e,h=new Float32Array(zp(i,l));p.bindBuffer(e.ARRAY_BUFFER,t),p.getBufferSubData(e.ARRAY_BUFFER,0,h),p.bindBuffer(e.ARRAY_BUFFER,null);var g=new Float32Array(ue([n,r,o]));return rk(h,n,r,o,g),g}function JH(e,t,n,r,o,i,l){var d=Qs(o,i),p=d[0],h=d[1],g=new Float32Array(zp(o,i));oe(e,function(){return e.readPixels(0,0,p,h,e.RGBA,e.FLOAT,g)});var y=new Float32Array(ue([t,n,r]));return rk(g,t,n,r,y)}var ZH=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=t??ti(rt.get("WEBGL_VERSION")),rt.get("WEBGL_VERSION")===1?(this.textureFloatExtension=Rf(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),rt.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Rf(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Rf(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=OH(this.gl),this.indexBuffer=FH(this.gl),this.framebuffer=kH(this.gl),this.textureConfig=$H(this.gl,this.textureHalfFloatExtension)}return e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;oe(n,function(){return n.finish()}),oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),oe(n,function(){return n.deleteFramebuffer(t.framebuffer)}),oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),oe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),oe(n,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,pH(t)},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),BH(this.gl,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),LH(this.gl,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),WH(this.gl,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),HH(this.gl,t,n)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),zH(this.gl,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),UH(this.gl,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(LC(this.gl,this.framebuffer),this.outputTexture=null),oe(this.gl,function(){return n.gl.deleteTexture(t)})},e.prototype.uploadMatrixToTexture=function(t,n,r,o){this.throwIfDisposed();var i=_H();return GH(this.gl,t,n,r,o,i,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(t,n,r,o,i,l,d){return this.throwIfDisposed(),qH(this.gl,t,n,r,o,i,l,d,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return XH(o.gl,n,r,o.textureConfig)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return YH(o.gl,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,i,l){return QH(this.gl,t,n,r,o,i,l,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n,r){return KH(this.gl,t,n,r,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=jH(this.gl,t,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(rt.get("WEBGL_FENCE_API_ENABLED")){var i=t,l=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var d=i.clientWaitSync(l,0,0);return d===i.ALREADY_SIGNALED||d===i.CONDITION_SATISFIED},n=l}else rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r,o,i,l){var d=this;return this.downloadMatrixDriver(t,function(){return JH(d.gl,n,r,o,i,l,d.textureConfig)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=vH(n,t),o=MH(n),i=xH(n);return oe(n,function(){return n.attachShader(i,o)}),oe(n,function(){return n.attachShader(i,r)}),wH(n,i),this.autoDebugValidate&&gg(n,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=VH(n,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&oe(this.gl,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.autoDebugValidate&&gg(this.gl,this.program),oe(this.gl,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?TH(this.gl,t,n):DH(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),oe(this.gl,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),AH(this.gl,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=Qs(n,r),i=o[0],l=o[1];this.setOutputMatrixTextureDriver(t,i,l)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&gg(this.gl,this.program),Tf(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),oe(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),oe(this.gl,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Rf(this.gl,rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return Je(this,void 0,void 0,function(){var n=this;return Ze(this,function(r){switch(r.label){case 0:return[4,SC(function(){return n.disposed||n.isQueryAvailable(t,rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=tG(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||SC(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),vg(this.gl,t,this.framebuffer),this.autoDebugValidate&&Tf(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(vg(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&Tf(this.gl)):LC(this.gl,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;vg(o,t,this.framebuffer),this.autoDebugValidate&&Tf(o),this.outputTexture=t,oe(o,function(){return o.viewport(0,0,n,r)}),oe(o,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var i=this;this.throwIfDisposed(),oe(this.gl,function(){return i.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function tG(e){for(var t=0,n=e.length-1,r=-1;t<=n;){var o=t+n>>1;e[o]()?(r=o,t=o+1):n=o-1}return r}function eG(e,t,n,r){for(var o=t.userCode,i=n.map(function(C,_){var k={logicalShape:C.shape,texShape:C.isUniform?null:C.texData.texShape,isUniform:C.isUniform,isPacked:!C.isUniform&&C.texData.isPacked};return{name:t.variableNames[_],shapeInfo:k}}),l=i.map(function(C){return C.shapeInfo}),d={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked},p=mV(i,d,o,t.supportsBroadcasting===!0,t.usesPackedTextures),h=e.createProgram(p),g={},y=0;y<t.variableNames.length;y++){var x=t.variableNames[y];g[x]=e.getUniformLocation(h,x,!1)}return{program:t,source:p,webGLProgram:h,uniformLocations:g,gpgpu:e,inShapeInfos:l,outShapeInfo:d}}function UC(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,i=t[r],l=i.shape;if(!Ar(o,l))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+l+" must match");if(!n.isUniform||!i.isUniform){var d=n.texShape,p=i.isUniform?null:i.texData.texShape;if(!Ar(d,p))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+d+" and "+p+" must match")}})}function nG(e,t,n,r){UC(e.inShapeInfos,t),UC([e.outShapeInfo],[n]);var o=n.texData.texture,i=n.texData.texShape,l=e.gpgpu;n.texData.isPacked?l.setOutputPackedMatrixTexture(o,i[0],i[1]):l.setOutputMatrixTexture(o,i[0],i[1]),l.setProgram(e.webGLProgram),t.forEach(function(d,p){var h=e.program.variableNames[p],g=e.uniformLocations[h];if(g!=null){if(d.isUniform){if(ue(d.shape)===1)l.gl.uniform1f(g,d.uniformValues[0]);else{var y=d.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),l.gl.uniform1fv(g,y)}return}var x=d.texData.texture;l.setInputMatrixTexture(x,g,p)}}),r!=null&&r(l,e.webGLProgram),l.executeProgram()}function rG(e,t,n){var r="";t.concat(n).forEach(function(d){r+=d.shape+"_"+(d.isUniform?"uniform":d.texData.texShape)});var o=e.userCode,i=(e.supportsBroadcasting===!0).toString(),l=e.constructor.name;return l+="_"+i+"_"+r+"_"+o}var oG=function(){return function(e,t,n){this.variableNames=["A"],this.outputShape=e;var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,l=n.strideHeight,d=n.padInfo,p=n.outWidth,h=n.dilationWidth,g=n.dilationHeight,y=d.left,x=d.top,C=o*r;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+e[1]+" || pos >= "+e[0]+`) continue;

            int offsetY = int(blockIndex / (`+p+")) * "+l+" - "+x+`;
            int d0 = offsetY + `+g+" * (pos / "+C+`);

            if(d0 >= `+t[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+p+".) * "+i+". - "+y+`.);
            int d1 = offsetX + `+h+" * (int(mod(float(pos), "+C+".) / "+o+`.));

            if(d1 >= `+t[1]+` || d1 < 0) continue;

            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), `+o+`.)));
          }
        }

        gl_FragColor = result;
      }
    `}}(),aG=function(){return function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,l=t,d=e[3]-1;this.outputShape=e;var p="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+p+")":o===1?"1.0/("+p+")":"exp(log("+p+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+l+"; j <= "+l+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+d+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `}}(),iG=function(){return function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),sG=function(){return function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,l=o-1-e.padInfo.top,d=i-1-e.padInfo.left,p=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+p+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),uG=function(){return function(e,t,n,r){n===void 0&&(n=!1),r===void 0&&(r=!1),this.variableNames=["matrixA","matrixB"];var o=e[0],i=n?e[2]:e[1],l=r?t[1]:t[2],d=n?e[1]:e[2];this.outputShape=[o,i,l];var p=function(x,C){return n?"batch, "+C+" + "+x+", aRow":"batch, aRow, "+C+" + "+x},h=function(x,C){return r?"batch, bCol, "+C+" + "+x:"batch, "+C+" + "+x+", bCol"},g=4*Math.floor(d/4),y=d%4;this.userCode=` float dotARowBCol(int batch, int aRow, int bCol) {
      float result = 0.0;
      for (int i = 0; i < `+g+`; i += 4) {
        vec4 a = vec4(
          getMatrixA(`+p(0,"i")+`),
          getMatrixA(`+p(1,"i")+`),
          getMatrixA(`+p(2,"i")+`),
          getMatrixA(`+p(3,"i")+`)
        );
        vec4 b = vec4(
          getMatrixB(`+h(0,"i")+`),
          getMatrixB(`+h(1,"i")+`),
          getMatrixB(`+h(2,"i")+`),
          getMatrixB(`+h(3,"i")+`)
        );

        result += dot(a, b);
      }

      if (`+(y===1)+`) {
        result += getMatrixA(`+p(0,g)+`) *
          getMatrixB(`+h(0,g)+`);
      } else if (`+(y===2)+`) {
        vec2 a = vec2(
          getMatrixA(`+p(0,g)+`),
          getMatrixA(`+p(1,g)+`)
        );
        vec2 b = vec2(
          getMatrixB(`+h(0,g)+`),
          getMatrixB(`+h(1,g)+`)
        );
        result += dot(a, b);
      } else if (`+(y===3)+`) {
        vec3 a = vec3(
          getMatrixA(`+p(0,g)+`),
          getMatrixA(`+p(1,g)+`),
          getMatrixA(`+p(2,g)+`)
        );
        vec3 b = vec3(
          getMatrixB(`+h(0,g)+`),
          getMatrixB(`+h(1,g)+`),
          getMatrixB(`+h(2,g)+`)
        );
        result += dot(a, b);
      }

      return result;
    }

    void main() {
      ivec3 resBRC = getOutputCoords();
      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));
    }
    `}}(),zC=function(){return function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=n;var i=r?e[0]:e[1],l=Math.ceil(i/2),d=r?"i * 2, rc.x":"rc.x, i * 2",p=o?"rc.y, i * 2":"i * 2, rc.y",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode=`
      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec2 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(`+d+`);
          vec4 b = getMatrixB(`+p+`);

          result += (`+h[0]+" * "+g[0]+") + ("+h[1]+" * "+g[1]+`);
        }
        return result;
      }

      void main() {
        ivec2 rc = getOutputCoords();
        setOutput(dot2x2ARowBCol(rc));
      }
    `}}(),cG=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),lG=function(){return function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `}}();function dG(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function sk(e,t){return t===1?[e]:dG(e,t)}function fG(e,t){if(e===1)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}var pG=function(){return function(e){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=sk("rc",t),r=Ir(t),o=mG(t,e,n),i=gG(t,e[e.length-1],e[e.length-2],n),l=vG(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+l+`));
          }
        }
      `}}}();function hG(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(r===0?"r":"rp1")+", "+(o===0?"c":"cp1"),l=2;l<e;l++)i=t[t.length-1-l]+","+i;n.push(i)}return n}function mG(e,t,n){if(e===1)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}function gG(e,t,n,r){if(e===1)return"";var o=r.slice(-2);return`
    int r = `+o[0]+`;
    int c = `+o[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+t+`;
    bool rEdge = rp1 >= `+n+`;
  `}function vG(e,t){var n=e.length,r=hG(n,t);return n===1?`getA(rc),
            rc + 1 >= `+e[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+r[0]+`),
          cEdge ? 0. : getA(`+r[1]+`),
          rEdge ? 0. : getA(`+r[2]+`),
          rEdge || cEdge ? 0. : getA(`+r[3]+")"}var yG=function(){return function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(p,h){return p[0]+e[h]+p[1]});var r=e.length,o=Ir(r),i=t.map(function(p){return p[0]}).join(","),l=t.map(function(p,h){return p[0]+e[h]}).join(","),d=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+l+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+d+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+l+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),yg=function(){return function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterHeight,h=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var x=t==="avg",C="0.0";if(x||(C="-1.0 / 0.0"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+g+", "+y+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+p+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+d+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(_="avgValue / count");var k=4*Math.floor(r/4),A=r%4,I=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+g+", "+y+`);
      const float initializationValue = `+C+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+C+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+p+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+k+`; wC += 4) {
            int xC = xCCorner + wC * `+d+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              getValue(batch, xR, xC + 2 * `+d+`, d),
              getValue(batch, xR, xC + 3 * `+d+`, d)
            );

            `+I+`
          }

          int xC = xCCorner + `+k+`;
          if (`+(A===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+I+`
          } else if (`+(A===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              initializationValue,
              initializationValue
            );

            `+I+`
          } else if (`+(A===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              getValue(batch, xR, xC + 2 * `+d+`, d),
              initializationValue
            );

            `+I+`
          }
        }
        setOutput(`+_+`);
      }
    `}}}(),bG=function(){return function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var l="0.0",d="";t==="prod"?l="1.0":t==="min"?(l="1.0 / 0.0",d="min"):t==="max"&&(l="-1.0 / 0.0",d="max");var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?p="sumValue":t==="prod"?p="prodValue":t==="all"?p="allValue":t==="any"&&(p="anyValue");var h=4*Math.floor(n/4),g=n%4,y=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+d+`(values, minMaxValue);
      }
    `,x="vec4";t==="all"?(l="1.0",y=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,x="bvec4"):t==="any"&&(l="0.0",y=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,x="bvec4");var C="";o%n>0&&(C=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+l+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+C+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+l+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+y+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(g===1)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+y+`
        } else if (`+(g===2)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+y+`
        } else if (`+(g===3)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+y+`
        }
        setOutput(`+p+`);
      }
    `}}(),xG=function(){return function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      `+CG(t)+`
      `+wG(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `}}();function wG(e){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+hV(["coords.x","coords.y","coords.z"],Xs(e).map(function(t){return t.toString()}).concat(["1."]))+`);
    }
  `}function CG(e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+sd(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  `}var SG=function(){return function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],l=e.shape,d=l[1],p=l[2],h=[n&&d>1?o-1:o,n&&p>1?i-1:i],g=[n&&d>1?d-1:d,n&&p>1?p-1:p],y=h[0]/g[0],x=h[1]/g[1],C=1/y,_=1/x,k=2*Math.ceil(C)+2,A=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+y+`);
        const float widthScale = float(`+x+`);

        const float invHeightScale = float(`+C+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+k+`);
        const int winWidth = int(`+A+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+d+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+p+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),_G=function(){return function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],l=e[2],d=e[3];this.outputShape=[o,t,n,d];var p=[r&&t>1?i-1:i,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+p[0]/h[0]+`,
          `+p[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),EG=function(){return function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],l=e.shape,d=l[1],p=l[2],h=[n&&d>1?o-1:o,n&&p>1?i-1:i],g=[n&&d>1?d-1:d,n&&p>1?p-1:p],y=h[0]/g[0],x=h[1]/g[1],C=1/y,_=1/x,k=2*Math.ceil(C)+2,A=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+y+`);
        const float widthScale = float(`+x+`);

        const float invHeightScale = float(`+C+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+k+`);
        const int winWidth = int(`+A+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+d+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+p+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+g[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+g[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),kG=function(){return function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],l=e[2],d=e[3];this.outputShape=[o,t,n,d];var p=[r&&t>1?i-1:i,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],g=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+p[0]/h[0]+`,
          `+p[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+g+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),RG=function(){return function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(i,l){return function(d){return t.indexOf(d)!==-1&&e[d]!==1?e[d]+" - coords["+d+"] - 1":"coords["+d+"]"}(l)}).join(","),o=Ir(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `}}(),VC=function(){return function(e,t,n,r,o,i,l){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var d=Ir(o.length),p=Ir(i.length),h="";n===1?h="i":n===2&&(h="i, j");var g="getIndices("+h+")",y="";r===1?y="i":r===2&&(y="i, coords[1]");var x="getUpdates("+y+")",C=t>1?"strides[j]":"strides";this.userCode=`
        `+d+" strides = "+d+"("+o+`);

        void main() {
          `+p+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+g+`);
              flattenedIndex += index * `+C+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+x+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),TG=function(){return function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,l=i*Math.ceil(o/n);this.outputShape=[r,l];var d=4*Math.floor(n/4),p=n%4,h=`
        sumValue += dot(values, filter);
    `,g="";o%n>0&&(g=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var y="";o%n>0&&(y=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+g+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+y+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+d+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+d+`;
        if (`+(p===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(p===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(p===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `}}(),DG=function(){return function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=[],p=0;p<t.length;p++)d.push(""+i[p]),p<e&&l.push(""+i[p]);r=l.join(),o=d.join()}var h=Ir(n);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `}}(),AG=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Ir(this.rank),r=IG(this.rank);this.userCode=`
      uniform `+n+` start;

      void main() {
        `+n+` sourceLoc = start + getOutputCoords();
        setOutput(getSource(`+r+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){if(n.startLoc!=null||(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc!=null))if(n.rank===1)r.gl.uniform1i(n.startLoc,t[0]);else if(n.rank===2)r.gl.uniform2i(n.startLoc,t[0],t[1]);else if(n.rank===3)r.gl.uniform3i(n.startLoc,t[0],t[1],t[2]);else{if(n.rank!==4)throw Error("Slicing for rank "+n.rank+" is not yet supported");r.gl.uniform4i(n.startLoc,t[0],t[1],t[2],t[3])}}},e}();function IG(e){if(e===1)return"sourceLoc";if(e===2)return"sourceLoc.x, sourceLoc.y";if(e===3)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(e===4)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+e+" is not yet supported")}var NG=function(){return function(e,t,n,r){this.variableNames=["x"];var o=n.filter(function(g,y){return r.indexOf(y)===-1});this.outputShape=o;var i=n.length,l=Ir(n.length),d=Ir(o.length),p="";if(i===1)p="coords * strides + begin";else{var h=0;p=n.map(function(g,y){return r.indexOf(y)===-1?(h++,o.length===1?"coords * strides["+y+"] + begin["+y+"]":"coords["+(h-1)+"] * strides["+y+"] + begin["+y+"]"):"begin["+y+"]"}).join(",")}this.userCode=`
      `+l+" begin = "+l+"("+e+`);
      `+l+" strides = "+l+"("+t+`);

      void main() {
        `+d+` coords = getOutputCoords();
        setOutput(getX(`+p+`));
      }
    `}}(),PG=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,i=HC(n,r),l=GC(t,i,r);if(l in this.freeTextures||(this.freeTextures[l]=[]),l in this.usedTextures||(this.usedTextures[l]=[]),this.freeTextures[l].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var d=this.freeTextures[l].shift();return this.usedTextures[l].push(d),d}return this.numUsedTextures++,this.log(),i===Jr.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Jr.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Jr.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Jr.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Jr.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[l].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var i=GC(n,HC(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var l=this.usedTextures[i],d=l.indexOf(t);if(d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(d,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function HC(e,t){if(e===ha.UPLOAD)return t?Jr.PACKED_2X2_FLOAT32:Jr.UNPACKED_FLOAT32;if(e===ha.RENDER||e==null)return t?rt.get("WEBGL_RENDER_FLOAT32_ENABLED")?Jr.PACKED_2X2_FLOAT32:Jr.PACKED_2X2_FLOAT16:rt.get("WEBGL_RENDER_FLOAT32_ENABLED")?Jr.UNPACKED_FLOAT32:Jr.UNPACKED_FLOAT16;if(e===ha.DOWNLOAD||e===ha.PIXELS)return Jr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function GC(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var MG=function(){return function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Ir(this.rank),i=OG(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}}();function OG(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(t===1)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}var FG=function(){return function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Ir(this.rank),i=$G(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `}}();function $G(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}var uk=.3275911,ck=.254829592,lk=-.284496736,dk=1.421413741,fk=-1.453152027,pk=1.061405429,f0=1.7580993408473768,p0=1.0507009873554805,Le=function(){function e(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float NAN;
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}return e.prototype.getCustomSetupFunc=function(){var t=this;return function(n,r){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(r,"NAN"),t.startLoc==null)||n.gl.uniform1f(t.startLoc,NaN)}},e}(),Js="if (isNaN(x)) return x;",BG="return abs(x);",LG=Js+`
  return (x < 0.0) ? 0.0 : x;
`,WG="return (x >= 0.0) ? x : (exp(x) - 1.0);",UG=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+f0+`;
  float scale = `+p0+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function zG(e){return e===void 0&&(e=0),Js+`
    return x > 0.0 ? 1.0 : float(`+e+`);
  `}var VG="return -x;",HG="return ceil(x);",GG="return floor(x);",qG=`
  if (isNaN(x)) { return 0.0; }
  return sign(x);
`,jG=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,KG="return exp(x);",XG="return exp(x) - 1.0;",YG=`if (x < 0.0) return NAN;
  return log(x);`,QG="return log(1.0 + x);",JG="return sqrt(x);",ZG="return inversesqrt(x);",t8="return 1.0 / (1.0 + exp(-1.0 * x));",e8=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,n8=Js+`
  return sin(x);
`,r8=Js+`
  return cos(x);
`,o8="return tan(x);",a8="return asin(x);",i8="return acos(x);",s8=Js+`
  return atan(x);
`,u8=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,c8=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,l8=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,d8="return log(x + sqrt(x * x + 1.0));",f8=Js+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,p8=Js+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,h8=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+uk+`;
  float a1 = `+ck+`;
  float a2 = `+lk+`;
  float a3 = `+dk+`;
  float a4 = `+fk+`;
  float a5 = `+pk+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,m8="return x * x;",g8="return 1.0 / x;",v8="return float(!(x >= 1.0));",y8="return float(int(x));",qC=function(){return function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=sk("rc",t),r=Ir(t),o=fG(t,n),i=n.slice(-2),l=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+l+`));
      }
    `}}();function b8(e){return oo(e,0)}function x8(e,t){return oo(e,t)}function w8(e,t){return oo(e,t)}function C8(e,t){return oo(e,t)}function S8(e,t){t===void 0&&(t=0),et(e.length>=1,"Pass at least one tensor to concat");var n=sp(e,"tensors","concat");t=Mr(t,n[0].shape)[0];var r=jl(n.map(function(l){return l.shape}),t);if(ue(r)===0)return Kn([],r);if((n=n.filter(function(l){return l.size>0})).length===1)return n[0];var o=n.map(function(l){return l.shape});rz(o,t);var i=n;return rt.engine.runKernel(function(l){return l.concat(n,t)},i,function(l){var d=o.map(function(p){return p[t]});return h0(l,d,t).map(function(p){return function(){return p}})})}function _8(e,t,n){n===void 0&&(n=0);var r,o=H(e,"x","split");return n=Mr(n,o.shape)[0],typeof t=="number"?(et(o.shape[n]%t==0,"Number of splits must evenly divide the axis."),r=Array(t).fill(o.shape[n]/t)):(et(o.shape[n]===t.reduce(function(i,l){return i+l}),"The sum of sizes must match the size of the axis dimension."),r=t),rt.engine.runKernel(function(i){return i.split(o,r,n)},{$x:o},function(i){return{$x:function(){return oo(i,n)}}})}var oo=ut({concat_:S8}),E8=ut({concat1d_:b8}),k8=ut({concat2d_:x8}),R8=ut({concat3d_:w8}),T8=ut({concat4d_:C8}),h0=ut({split_:_8});function Zs(e,t){return e(t={exports:{}},t.exports),t.exports}var D8=Zs(function(e){(function(t,n,r){function o(l,d){return d.c=l.c,d.s0=l.s0,d.s1=l.s1,d.s2=l.s2,d}function i(l,d){var p=new function(y){var x,C=this,_=(x=4022871197,function(k){k=k.toString();for(var A=0;A<k.length;A++){var I=.02519603282416938*(x+=k.charCodeAt(A));I-=x=I>>>0,x=(I*=x)>>>0,x+=4294967296*(I-=x)}return 23283064365386963e-26*(x>>>0)});C.next=function(){var k=2091639*C.s0+23283064365386963e-26*C.c;return C.s0=C.s1,C.s1=C.s2,C.s2=k-(C.c=0|k)},C.c=1,C.s0=_(" "),C.s1=_(" "),C.s2=_(" "),C.s0-=_(y),C.s0<0&&(C.s0+=1),C.s1-=_(y),C.s1<0&&(C.s1+=1),C.s2-=_(y),C.s2<0&&(C.s2+=1),_=null}(l),h=d&&d.state,g=p.next;return g.int32=function(){return 4294967296*p.next()|0},g.double=function(){return g()+11102230246251565e-32*(2097152*g()|0)},g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.alea=i})(0,e)}),A8=Zs(function(e){(function(t,n,r){function o(l,d){return d.x=l.x,d.y=l.y,d.z=l.z,d.w=l.w,d}function i(l,d){var p=new function(y){var x=this,C="";x.x=0,x.y=0,x.z=0,x.w=0,x.next=function(){var k=x.x^x.x<<11;return x.x=x.y,x.y=x.z,x.z=x.w,x.w^=x.w>>>19^k^k>>>8},y===(0|y)?x.x=y:C+=y;for(var _=0;_<C.length+64;_++)x.x^=0|C.charCodeAt(_),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xor128=i})(0,e)}),I8=Zs(function(e){(function(t,n,r){function o(l,d){return d.x=l.x,d.y=l.y,d.z=l.z,d.w=l.w,d.v=l.v,d.d=l.d,d}function i(l,d){var p=new function(y){var x=this,C="";x.next=function(){var k=x.x^x.x>>>2;return x.x=x.y,x.y=x.z,x.z=x.w,x.w=x.v,(x.d=x.d+362437|0)+(x.v=x.v^x.v<<4^k^k<<1)|0},x.x=0,x.y=0,x.z=0,x.w=0,x.v=0,y===(0|y)?x.x=y:C+=y;for(var _=0;_<C.length+64;_++)x.x^=0|C.charCodeAt(_),_==C.length&&(x.d=x.x<<10^x.x>>>4),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xorwow=i})(0,e)}),N8=Zs(function(e){(function(t,n,r){function o(l,d){return d.x=l.x.slice(),d.i=l.i,d}function i(l,d){l==null&&(l=+new Date);var p=new function(y){var x=this;x.next=function(){var C,_,k=x.x,A=x.i;return C=k[A],_=(C^=C>>>7)^C<<24,_^=(C=k[A+1&7])^C>>>10,_^=(C=k[A+3&7])^C>>>3,_^=(C=k[A+4&7])^C<<7,C=k[A+7&7],_^=(C^=C<<13)^C<<9,k[A]=_,x.i=A+1&7,_},function(C,_){var k,A=[];if(_===(0|_))A[0]=_;else for(_=""+_,k=0;k<_.length;++k)A[7&k]=A[7&k]<<15^_.charCodeAt(k)+A[k+1&7]<<13;for(;A.length<8;)A.push(0);for(k=0;k<8&&A[k]===0;++k);for(k==8?A[7]=-1:A[k],C.x=A,C.i=0,k=256;k>0;--k)C.next()}(x,y)}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(h.x&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xorshift7=i})(0,e)}),P8=Zs(function(e){(function(t,n,r){function o(l,d){return d.i=l.i,d.w=l.w,d.X=l.X.slice(),d}function i(l,d){l==null&&(l=+new Date);var p=new function(y){var x=this;x.next=function(){var C,_,k=x.w,A=x.X,I=x.i;return x.w=k=k+1640531527|0,_=A[I+34&127],C=A[I=I+1&127],_^=_<<13,C^=C<<17,_^=_>>>15,C^=C>>>12,_=A[I]=_^C,x.i=I,_+(k^k>>>16)|0},function(C,_){var k,A,I,N,D,M=[],F=128;for(_===(0|_)?(A=_,_=null):(_+="\0",A=0,F=Math.max(F,_.length)),I=0,N=-32;N<F;++N)_&&(A^=_.charCodeAt((N+32)%_.length)),N===0&&(D=A),A^=A<<10,A^=A>>>15,A^=A<<4,A^=A>>>13,N>=0&&(D=D+1640531527|0,I=(k=M[127&N]^=A+D)==0?I+1:0);for(I>=128&&(M[127&(_&&_.length||0)]=-1),I=127,N=512;N>0;--N)A=M[I+34&127],k=M[I=I+1&127],A^=A<<13,k^=k<<17,A^=A>>>15,k^=k>>>12,M[I]=A^k;C.w=D,C.X=M,C.i=I}(x,y)}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(h.X&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xor4096=i})(0,e)}),M8=Zs(function(e){(function(t,n,r){function o(l,d){return d.a=l.a,d.b=l.b,d.c=l.c,d.d=l.d,d}function i(l,d){var p=new function(y){var x=this,C="";x.next=function(){var k=x.b,A=x.c,I=x.d,N=x.a;return k=k<<25^k>>>7^A,A=A-I|0,I=I<<24^I>>>8^N,N=N-k|0,x.b=k=k<<20^k>>>12^A,x.c=A=A-I|0,x.d=I<<16^A>>>16^N,x.a=N-k|0},x.a=0,x.b=0,x.c=-1640531527,x.d=1367130551,y===Math.floor(y)?(x.a=y/4294967296|0,x.b=0|y):C+=y;for(var _=0;_<C.length+20;_++)x.b^=0|C.charCodeAt(_),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.tychei=i})(0,e)}),Es=Zs(function(e){(function(t,n){var r,o=this,i=256,l=6,d="random",p=n.pow(i,l),h=n.pow(2,52),g=2*h,y=i-1;function x(A,I,N){var D=[],M=_(function L(X,q){var Q,it=[],at=typeof X;if(q&&at=="object")for(Q in X)try{it.push(L(X[Q],q-1))}catch{}return it.length?it:at=="string"?X:X+"\0"}((I=I==1?{entropy:!0}:I||{}).entropy?[A,k(t)]:A??function(){try{var L;return r&&(L=r.randomBytes)?L=L(i):(L=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(L)),k(L)}catch{var X=o.navigator,q=X&&X.plugins;return[+new Date,o,q,o.screen,k(t)]}}(),3),D),F=new function(L){var X,q=L.length,Q=this,it=0,at=Q.i=Q.j=0,ht=Q.S=[];for(q||(L=[q++]);it<i;)ht[it]=it++;for(it=0;it<i;it++)ht[it]=ht[at=y&at+L[it%q]+(X=ht[it])],ht[at]=X;(Q.g=function(gt){for(var Ct,pt=0,lt=Q.i,ft=Q.j,Tt=Q.S;gt--;)Ct=Tt[lt=y&lt+1],pt=pt*i+Tt[y&(Tt[lt]=Tt[ft=y&ft+Ct])+(Tt[ft]=Ct)];return Q.i=lt,Q.j=ft,pt})(i)}(D),W=function(){for(var L=F.g(l),X=p,q=0;L<h;)L=(L+q)*i,X*=i,q=F.g(1);for(;L>=g;)L/=2,X/=2,q>>>=1;return(L+q)/X};return W.int32=function(){return 0|F.g(4)},W.quick=function(){return F.g(4)/4294967296},W.double=W,_(k(F.S),t),(I.pass||N||function(L,X,q,Q){return Q&&(Q.S&&C(Q,F),L.state=function(){return C(F,{})}),q?(n[d]=L,X):L})(W,M,"global"in I?I.global:this==n,I.state)}function C(A,I){return I.i=A.i,I.j=A.j,I.S=A.S.slice(),I}function _(A,I){for(var N,D=A+"",M=0;M<D.length;)I[y&M]=y&(N^=19*I[y&M])+D.charCodeAt(M++);return k(I)}function k(A){return String.fromCharCode.apply(0,A)}if(n["seed"+d]=x,_(n.random(),t),e.exports){e.exports=x;try{r=require("crypto")}catch{}}})([],Math)});Es.alea=D8,Es.xor128=A8,Es.xorwow=I8,Es.xorshift7=N8,Es.xor4096=P8,Es.tychei=M8;var O8=Es,hk=O8.alea,mk=function(){function e(t,n,r,o,i){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var l=i||Math.random();this.random=hk(l.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var i=void 0,l=void 0,d=void 0;do d=(i=2*this.random()-1)*i+(l=2*this.random()-1)*l;while(d>=1||d===0);var p=Math.sqrt(-2*Math.log(d)/d);n=this.mean+this.stdDev*i*p,r=this.mean+this.stdDev*l*p,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}();function F8(e){var t=H(e,"x","clone",null);return rt.engine.runKernel(function(n){return zt.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}function $8(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=Oe([e,t],r),i=e<=t?e:t,l=0;l<i;++l)o.set(1,l,l);var d=o.toTensor().as2D(e,t);if(n==null)return d;if(n.length===1)return Ju(To(d,0),[n[0],1,1]);if(n.length===2)return Ju(To(To(d,0),0),[n[0],n[1],1,1]);if(n.length===3)return Ju(To(To(To(d,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}function B8(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new mk(t,n,r,!1,o),l=Oe(e,r),d=0;d<l.values.length;d++)l.values[d]=i.nextValue();return l.toTensor()}function L8(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new mk(t,n,r,!0,o),l=Oe(e,r),d=0;d<l.values.length;d++)l.values[d]=i.nextValue();return l.toTensor()}function W8(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var o=Oe(e,r),i=0;i<o.values.length;i++)o.values[i]=mU(t,n);return o.toTensor()}function U8(e,t,n){var r=ue(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return zt.make(e,{values:o},n)}function z8(e,t,n,r){r===void 0&&(r=!1);var o=H(e,"logits","multinomial"),i=o.size,l=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(l>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+l);n=n||Math.random();var d=l===1?o.as2D(1,-1):o,p=rt.engine.runKernel(function(h){return h.multinomial(d,r,t,n)},{logits2D:d});return l===1?p.as1D():p}function V8(e,t,n,r){n===void 0&&(n=1),r===void 0&&(r=0);var o=H(e,"indices","oneHot","int32");if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);return rt.engine.runKernel(function(i){return i.oneHot(o,t,n,r)},{$indices:o},function(i){return{$indices:function(){return Fn(o.shape,"float32")}}})}function H8(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return rt.engine.fromPixels(e,t)}function G8(e,t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D,M,F;return Ze(this,function(W){switch(W.label){case 0:if(n=H(e,"img","toPixels"),e instanceof zt||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(l=n.rank===2?1:n.shape[2])>4||l===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+l);return d=n.min(),p=n.max(),[4,d.data()];case 1:return h=W.sent()[0],[4,p.data()];case 2:if(g=W.sent()[0],d.dispose(),p.dispose(),n.dtype==="float32"){if(h<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+g+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+g+"].")}return[4,n.data()];case 3:for(y=W.sent(),x=n.dtype==="float32"?255:1,C=new Uint8ClampedArray(i*o*4),_=0;_<o*i;++_)k=void 0,A=void 0,I=void 0,N=void 0,l===1?(k=y[_]*x,A=y[_]*x,I=y[_]*x,N=255):l===3?(k=y[3*_]*x,A=y[3*_+1]*x,I=y[3*_+2]*x,N=255):l===4&&(k=y[4*_]*x,A=y[4*_+1]*x,I=y[4*_+2]*x,N=y[4*_+3]*x),C[(D=4*_)+0]=Math.round(k),C[D+1]=Math.round(A),C[D+2]=Math.round(I),C[D+3]=Math.round(N);return t!=null&&(t.width=i,t.height=o,M=t.getContext("2d"),F=new ImageData(C,i,o),M.putImageData(F,0,0)),n!==e&&n.dispose(),[2,C]}})})}function q8(e,t){var n=H(e,"x","reshape",null);return t=yU(t,n.size),et(n.size===ue(t),"new shape and old shape must have the same number of elements."),rt.engine.runKernel(function(r){return r.reshape(n,t)},{$x:n},function(r){return{$x:function(){return r.reshape(n.shape)}}})}function j8(e,t){var n=H(e,"x","squeeze");return Ho(n,Ks(n.shape,t).newShape)}function K8(e,t){var n=H(e,"x","cast");return rt.engine.runKernel(function(r){return r.cast(n,t)},{$x:n},function(r){return{$x:function(){return r.clone()}}})}function X8(e,t){var n=H(e,"x","tile");return et(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."),rt.engine.runKernel(function(r){return r.tile(n,t)},{$x:n},function(r){return{$x:function(){var o=Sn(n);if(n.rank===1)for(var i=0;i<t[0];++i)o=o.add(r.slice([i*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(i=0;i<t[0];++i)for(var l=0;l<t[1];++l)o=o.add(r.slice([i*n.shape[0],l*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(i=0;i<t[0];++i)for(l=0;l<t[1];++l)for(var d=0;d<t[2];++d)o=o.add(r.slice([i*n.shape[0],l*n.shape[1],d*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(n.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(i=0;i<t[0];++i)for(l=0;l<t[1];++l)for(d=0;d<t[2];++d)for(var p=0;p<t[3];++p)o=o.add(r.slice([i*n.shape[0],l*n.shape[1],d*n.shape[2],p*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return o}}})}function Y8(e,t,n){return n===void 0&&(n=0),et(t.length===2,"Invalid number of paddings. Must be length of 2."),cd(e,[t],n)}function Q8(e,t,n){return n===void 0&&(n=0),et(t.length===2&&t[0].length===2&&t[1].length===2,"Invalid number of paddings. Must be length of 2 each."),cd(e,t,n)}function J8(e,t,n){return n===void 0&&(n=0),et(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,"Invalid number of paddings. Must be length of 2 each."),cd(e,t,n)}function Z8(e,t,n){return n===void 0&&(n=0),et(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,"Invalid number of paddings. Must be length of 2 each."),cd(e,t,n)}function t7(e,t,n){n===void 0&&(n=0);var r=H(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(i){return i[0]});return rt.engine.runKernel(function(i){return i.pad(r,t,n)},{$x:r},function(i){return{$x:function(){return i.slice(o,r.shape)}}})}function e7(e,t){t===void 0&&(t=0);var n=sp(e,"tensors","stack");if(et(n.length>=1,"Pass at least one tensor to tf.stack"),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;et(t<=r,"Axis must be <= rank of the tensor"),n.forEach(function(d){on(o,d.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(d){et(i===d.dtype,"All tensors passed to stack must have matching dtypes")});var l=n.map(function(d){return d.expandDims(t)});return oo(l,t)}function n7(e,t,n){var r=H(e,"x","batchToSpaceND"),o=t.reduce(function(i,l){return i*l});return et(r.rank>=1+t.length,"input rank is "+r.rank+" but should be > than blockShape.length "+t.length),et(n.length===t.length,"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length),et(r.shape[0]%o==0,"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o),rt.engine.runKernel(function(i){return i.batchToSpaceND(r,t,n)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,n)}}})}function r7(e,t,n){var r=H(e,"x","spaceToBatchND");return et(r.rank>=1+t.length,"input rank "+r.rank+" should be > than [blockShape] "+t.length),et(n.length===t.length,"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length),et(r.shape.reduce(function(o,i,l){return l>0&&l<=t.length?o&&(i+n[l-1][0]+n[l-1][1])%t[l-1]==0:o},!0),"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()),rt.engine.runKernel(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}function o7(e,t){t===void 0&&(t=0);for(var n,r=H(e,"x","unstack"),o=r.shape[t],i=Array(r.rank-1).fill(0),l=0,d=0;d<r.rank;d++)d!==t&&(i[l]=r.shape[d],l++);n=Array(o).fill(1);var p=Array(r.rank).fill(0),h=r.shape.slice();return n.map(function(g){h[t]=g;var y=r.slice(p,h);return p[t]+=g,y.reshape(i)})}function a7(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=H(e,"x","cumsum"),i=_a([t|=0],o.rank),l=o;i!=null&&(l=o.transpose(i));var d=Ea(1,o.rank)[0],p=rt.engine.runKernel(function(h){return h.cumsum(l,d,n,r)},{permutedX:l},function(h){return{permutedX:function(){return h.cumsum(t,n,!r)}}});return i!=null&&(p=p.transpose(i)),p}function i7(e,t){t===void 0&&(t=0);var n=H(e,"x","expandDims");et(t<=n.rank,"Axis must be <= rank of the tensor");var r=n.shape.slice();return t<0&&(et(-(n.rank+1)<=t,"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"),t=n.rank+t+1),r.splice(t,0,1),Ho(n,r)}function s7(e,t,n){n===void 0&&(n="NHWC");var r=H(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],l=n==="NHWC"?r.shape[3]:r.shape[1];return et(o*t>=0,`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape),et(i*t>=0,`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape),et(l%(t*t)==0,"Dimension size must be evenly divisible by "+t*t+" but is "+l+" for depthToSpace with input shape "+r.shape),rt.engine.runKernel(function(d){return d.depthToSpace(r,t,n)},{$x:r})}function u7(e,t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y;return Ze(this,function(x){switch(x.label){case 0:return n=H(e,"x","setdiff1d"),r=H(t,"y","setdiff1d"),et(n.dtype===r.dtype,"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."),et(n.rank===1,"x should be 1D tensor, but got x ("+n.shape+")."),et(r.rank===1,"y should be 1D tensor, but got y ("+r.shape+")."),[4,n.data()];case 1:return o=x.sent(),[4,r.data()];case 2:for(i=x.sent(),l=new Set(i),d=0,g=0;g<o.length;g++)l.has(o[g])||d++;for(p=new ql([d],n.dtype),h=new ql([d],"int32"),g=0,y=0;g<o.length;g++)l.has(o[g])||(p.values[y]=o[g],h.values[y]=g,y++);return[2,[p.toTensor(),h.toTensor()]]}})})}function Oe(e,t,n){return t===void 0&&(t="float32"),new ql(e,t=t||"float32",n)}function c7(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var gk=ut({batchToSpaceND_:n7}),l7=ut({cast_:K8}),d7=ut({clone_:F8}),f7=ut({cumsum_:a7}),p7=ut({depthToSpace_:s7}),To=ut({expandDims_:i7}),vk=ut({eye_:$8}),yk=ut({fromPixels_:H8}),h7=ut({multinomial_:z8}),iv=ut({oneHot_:V8}),cd=ut({pad_:t7}),m7=ut({pad1d_:Y8}),g7=ut({pad2d_:Q8}),v7=ut({pad3d_:J8}),y7=ut({pad4d_:Z8}),b7=ut({rand_:U8}),x7=ut({randomNormal_:B8}),w7=ut({randomUniform_:W8}),Ho=ut({reshape_:q8}),bk=ut({spaceToBatchND_:r7}),xk=ut({squeeze_:j8}),ya=ut({stack_:e7}),Ju=ut({tile_:X8}),C7=ut({truncatedNormal_:L8}),Wr=ut({unstack_:o7}),S7=u7;function m0(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Oe(e,"int32"),i=Oe([n.length,e.length],"int32");for(r=0;r<n.length;r++){var l=o.indexToLoc(n[r]),d=r*e.length;i.values.set(l,d)}return i.toTensor()}var _7=10,E7=300,k7=1e3,R7=function(){function e(t,n){if(n===void 0&&(n=!0),this.gpgpu=t,this.delayedStorage=n,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,rt.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(t==null){var r=ti(rt.get("WEBGL_VERSION"));this.gpgpu=new ZH(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;rt.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*E7),this.textureManager=new PG(this.gpgpu)}return e.prototype.register=function(t,n,r){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:n,dtype:r})},e.prototype.setDataMover=function(t){this.texData=new XE(t)},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var r=[t.height,t.width],o=[t.height,t.width,n];if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(!rt.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var i=this.makeTensorHandle(r,"int32");this.texData.get(i.dataId).usage=ha.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var l=new iH(o),d=this.compileAndRun(l,[i]);return this.disposeData(i.dataId),d},e.prototype.makeTensorHandle=function(t,n){var r={};return this.register(r,t,n),{dataId:r,shape:t,dtype:n}},e.prototype.write=function(t,n){if(n==null)throw new Error("MathBackendWebGL.write(): values can not be null");var r=this.texData.get(t),o=r.texture,i=r.texShape,l=r.usage,d=r.dtype,p=r.isPacked;if(d==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");o!=null&&(this.releaseTexture(t,o,i,l,p),r.texture=null,r.texShape=null),r.usage=ha.UPLOAD,r.values=n,this.delayedStorage||this.uploadToGPU(t)},e.prototype.readSync=function(t){var n=this.texData.get(t),r=n.values,o=n.dtype,i=n.complexTensors;if(r!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return r;var l,d,p=this.activeTimers!=null;return p&&(l=performance.now()),o==="complex64"?d=QE(i.real.dataSync(),i.imag.dataSync()):d=this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=performance.now()-l),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D;return Ze(this,function(M){switch(M.label){case 0:if(this.pendingRead.has(t))return o=this.pendingRead.get(t),[2,new Promise(function(F){return o.push(F)})];if(i=this.texData.get(t),l=i.texture,d=i.values,p=i.texShape,h=i.isPacked,g=i.shape,d!=null)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!rt.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&rt.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return y=p[1],x=p[0],h&&(n=Qs(p[0],p[1]),y=n[0],x=n[1]),C=this.gpgpu.maybeCreateBufferFromTexture(l,x,y),[4,this.gpgpu.createAndWaitForFence()];case 1:return M.sent(),C instanceof WebGLTexture?_=this.getValuesFromTexture(t):h?(k=this.getBatchDim(g),A=1,I=1,g.length&&(r=this.getRowsCols(g),A=r[0],I=r[1]),_=this.gpgpu.downloadPackedMatrixFromBuffer(C,k,A,I,p[0],p[1])):_=this.gpgpu.downloadFloat32MatrixFromBuffer(C,p[0],p[1]),N=this.convertAndCacheOnCPU(t,_),D=this.pendingRead.get(t),this.pendingRead.delete(t),D.forEach(function(F){return F(N)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,N]}})})},e.prototype.getValuesFromTexture=function(t){var n,r=this.texData.get(t),o=r.shape,i=r.dtype,l=r.texture,d=r.texShape;if(rt.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var p=this.getBatchDim(o),h=1,g=1;return o.length&&(h=(n=this.getRowsCols(o))[0],g=n[1]),this.gpgpu.downloadMatrixFromPackedTexture(l,p,h,g,d[0],d[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(l,d[0],d[1])}var y=this.makeTensorHandle(o,"float32");y.size=ue(o),this.texData.get(y.dataId).usage=ha.DOWNLOAD;var x=new aH(o);this.compileAndRun(x,[{shape:o,dtype:i,dataId:t}],y,null,!1);var C=this.texData.get(y.dataId),_=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(C.texture,C.texShape[0],C.texShape[1]);return this.disposeData(y.dataId),_},e.prototype.time=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d,p;return Ze(this,function(h){switch(h.label){case 0:return n=this.activeTimers,r=[],o=!1,this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=ic(this.activeTimers.map(function(g){return g.query})).filter(function(g){return g!=null}),l=ic(this.activeTimers.map(function(g){return g.name})).filter(function(g){return g!=null}),this.activeTimers=n,o&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return d=h.sent(),p={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:hU(d),getExtraProfileInfo:function(){return d.map(function(g,y){return{name:l[y],ms:g}}).map(function(g){return g.name+": "+g.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,p]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(t){return rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},e.prototype.getQueryTime=function(t){return Je(this,void 0,void 0,function(){var n;return Ze(this,function(r){return rt.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var n=this.texData.get(t),r=n.texture,o=n.texShape,i=n.usage,l=n.complexTensors,d=n.isPacked;r!=null&&this.releaseTexture(t,r,o,i,d),l!=null&&(l.real.dispose(),l.imag.dispose()),this.texData.delete(t)}}},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getCPUBackend=function(){return rt.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=rt.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var r=this;return n===void 0&&(n=_7),this.getCPUBackend()!=null&&t.every(function(o){return r.texData.get(o.dataId).texture==null&&o.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.complex=function(t,n){var r=this.makeOutputArray(t.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:rt.engine.keep(t.clone()),imag:rt.engine.keep(n.clone())},r},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,r);var o=new AG(r),i=o.getCustomSetupFunc(n);return this.compileAndRun(o,[t],null,i)},e.prototype.stridedSlice=function(t,n,r,o,i,l,d,p,h){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,r,o,i,l,d,p,h);var g=qE(t.shape,n,r,o,i,l,d,p,h),y=g[0],x=g[1],C=g[2],_=x.filter(function(A,I){return C.indexOf(I)===-1});if(_.some(function(A){return A===0}))return Kn([],_);var k=new NG(y,o,x,C);return this.compileAndRun(k,[t])},e.prototype.reverse=function(t,n){var r=new RG(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.concat2Tensors=function(t,n,r){var o=jl([t.shape,n.shape],r),i=t.as2D(-1,ue(t.shape.slice(r))),l=n.as2D(-1,ue(n.shape.slice(r))),d=new nV(i.shape,l.shape);return this.compileAndRun(d,[i,l]).reshape(o)},e.prototype.concat=function(t,n){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];for(var r=t[0],o=1;o<t.length;++o)r=this.concat2Tensors(r,t[o],n);return r},e.prototype.neg=function(t){var n=new Le(t.shape,VG);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,r,o){var i=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],d=r?t.shape[1]:t.shape[2],p=t.shape[0];if((i===1||l===1)&&d>k7){r&&(t=t.transpose([0,2,1])),o&&(n=n.transpose([0,2,1]));var h=l===1?t:t.as3D(p,d,1),g=l===1?2:1,y=l===1?n.as3D(p,1,d):n;return this.multiply(h,y).sum(g,!0)}var x=lr(t.dtype,n.dtype);if(p===1){var C=t.as2D(t.shape[1],t.shape[2]),_=n.as2D(n.shape[1],n.shape[2]),k=new zC(C.shape,_.shape,[i,l],r,o),A=this.makePackedTensor(k.outputShape,x),I=this.compileAndRun(k,[C,_],A);return I.reshape([1,I.shape[0],I.shape[1]])}return k=new uG(t.shape,n.shape,r,o),A=this.makeOutputArray(k.outputShape,x),this.compileAndRun(k,[t,n],A)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var r=this.texData.get(t.dataId),o=this.texData.get(n.dataId),i=new NC(IC.REAL,t.shape,n.shape),l=new NC(IC.IMAG,t.shape,n.shape),d=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag),this.makeComplexComponentTensorHandle(n,o.complexTensors.real),this.makeComplexComponentTensorHandle(n,o.complexTensors.imag)],p=this.compileAndRun(i,d),h=this.compileAndRun(l,d),g=this.complex(p,h);return p.dispose(),h.dispose(),g}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);var y=new Bn(Oz,t.shape,n.shape),x=this.makeOutputArray(y.outputShape,t.dtype);return this.compileAndRun(y,[t,n],x)},e.prototype.batchNormalization=function(t,n,r,o,i,l){var d=[t,n,r],p=null;l!=null&&(p=l.shape,d.push(l));var h=null;if(i!=null&&(h=i.shape,d.push(i)),rt.get("WEBGL_PACK_BATCHNORMALIZATION")){var g=new Mz(t.shape,n.shape,r.shape,p,h,o);return this.compileAndRun(g,d)}var y=new Pz(t.shape,n.shape,r.shape,p,h,o);return this.compileAndRun(y,d)},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){var l=new aG(t.shape,n,r,o,i);return this.compileAndRun(l,[t])},e.prototype.LRNGrad=function(t,n,r,o,i,l,d){var p=new iG(n.shape,o,i,l,d);return this.compileAndRun(p,[n,r,t])},e.prototype.tile=function(t,n){var r=new MG(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,n,r){var o=new yG(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,n){var r=new FG(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.gather=function(t,n,r){var o=new sH(t.shape,n.size,r);return this.compileAndRun(o,[t,n])},e.prototype.batchToSpaceND=function(t,n,r){et(t.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var o=n.reduce(function(g,y){return g*y}),i=rp(t.shape,n,o),l=op(i.length,n.length),d=ap(t.shape,n,o),p=UE(r,n.length),h=zE(d,r,n.length);return t.reshape(i).transpose(l).reshape(d).slice(p,h)},e.prototype.spaceToBatchND=function(t,n,r){et(t.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var o=n.reduce(function(y,x){return y*x}),i=[[0,0]];i.push.apply(i,r);for(var l=1+n.length;l<t.shape.length;++l)i.push([0,0]);var d=t.pad(i),p=rp(d.shape,n,o,!1),h=op(p.length,n.length,!1),g=ap(d.shape,n,o,!1);return d.reshape(p).transpose(h).reshape(g)},e.prototype.reduce=function(t,n,r){var o=t.shape[0],i=t.shape[1],l=TC(i),d=new bG({windowSize:l,inSize:i,batchSize:o},n),p=d.outputShape,h=p[0],g=p[1],y=this.makeOutputArray([h,g],r);return this.compileAndRun(d,[t],y),y.shape[1]===1?y:this.reduce(y,n,r)},e.prototype.argReduce=function(t,n,r){r===void 0&&(r=null);var o=t.shape[0],i=t.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);var l=TC(i),d=new Az({windowSize:l,inSize:i,batchSize:o},n,r==null),p=d.outputShape,h=p[0],g=p[1],y=this.makeOutputArray([h,g],"int32"),x=[t];return r!=null&&x.push(r),this.compileAndRun(d,x,y),y.shape[1]===1?y:this.argReduce(t,n,y)},e.prototype.sum=function(t,n){Qr("sum",n,t.rank);var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i),d=pg(t.dtype);return this.reduce(l,"sum",d).reshape(o)},e.prototype.prod=function(t,n){var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i),d=pg(t.dtype);return this.reduce(l,"prod",d).reshape(o)},e.prototype.unsortedSegmentSum=function(t,n,r){var o=0,i=_a([o],t.rank),l=t;i!=null&&(l=t.transpose(i),o=Ea(1,t.rank)[0]);var d=sz(l.shape,o,r),p=ue([l.shape[o]]),h=l.as2D(-1,p),g=pg(t.dtype),y=this.segOpCompute(h,"unsortedSegmentSum",n,g,r).reshape(d);return i!=null&&(y=y.transpose(u0(i))),y},e.prototype.segOpCompute=function(t,n,r,o,i){var l=t.shape[0],d=t.shape[1],p=iz(d,i),h=new TG({windowSize:p,inSize:d,batchSize:l,numSegments:i},n),g=h.outputShape,y=g[0],x=g[1],C=this.makeOutputArray([y,x],o);return this.compileAndRun(h,[t,r],C),C.shape[1]===i?C:(r=KE(0,i).tile([d/p]),this.segOpCompute(C,n,r,o,i))},e.prototype.argMin=function(t,n){var r=[n];Qr("argMin",r,t.rank);var o=sr(t.shape,r),i=o[0],l=ue(o[1]),d=t.as2D(-1,l);return this.argReduce(d,"min").reshape(i)},e.prototype.argMax=function(t,n){var r=[n];Qr("argMax",r,t.rank);var o=sr(t.shape,r),i=o[0],l=ue(o[1]),d=t.as2D(-1,l);return this.argReduce(d,"max").reshape(i)},e.prototype.cumsum=function(t,n,r,o){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var i=new nH(t.shape,r,o);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,n){var r=new Bn(Wz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.notEqual=function(t,n){var r=new Bn(Uz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);var r=new Bn(zz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.lessEqual=function(t,n){var r=new Bn(Vz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);var r=new Bn(Hz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.greaterEqual=function(t,n){var r=new Bn(Gz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.logicalNot=function(t){var n=new Le(t.shape,v8);return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){var r=new Bn(qz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.logicalOr=function(t,n){var r=new Bn(jz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.select=function(t,n,r){var o=new DG(t.rank,n.shape,n.rank),i=this.makeOutputArray(o.outputShape,lr(n.dtype,r.dtype));return this.compileAndRun(o,[t,n,r],i)},e.prototype.where=function(t){ov("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return m0(t.shape,n)},e.prototype.topk=function(t,n,r){return ZE(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Qr("min",n,t.rank);var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i);return this.reduce(l,"min",l.dtype).reshape(o)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var r=new Bn(Xz,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.mod=function(t,n){var r=new Bn(Yz,t.shape,n.shape),o=r.getCustomSetupFunc();return this.compileAndRun(r,[t,n],null,o)},e.prototype.max=function(t,n){Qr("max",n,t.rank);var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i);return this.reduce(l,"max",l.dtype).reshape(o)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var r=new Bn(Kz,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.all=function(t,n){Qr("all",n,t.rank);var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i);return this.reduce(l,"all",l.dtype).reshape(o)},e.prototype.any=function(t,n){Qr("any",n,t.rank);var r=sr(t.shape,n),o=r[0],i=ue(r[1]),l=t.as2D(-1,i);return this.reduce(l,"any",l.dtype).reshape(o)},e.prototype.squaredDifference=function(t,n){var r=new Bn(Lz,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.realDivide=function(t,n){var r=new Bn(Fz,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t,n],o)},e.prototype.floorDiv=function(t,n){var r=new Bn($z,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[t,n],o)},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,PC);var r=new Bn(PC,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,lr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],o)},e.prototype.complexSeparableBinaryOp=function(t,n,r){var o=this,i=this.texData.get(t.dataId),l=this.texData.get(n.dataId),d=[[i.complexTensors.real,l.complexTensors.real],[i.complexTensors.imag,l.complexTensors.imag]].map(function(y){var x=y[0],C=y[1],_=new Bn(r,t.shape,n.shape),k=o.makeOutputArray(_.outputShape,lr(x.dtype,C.dtype)),A=o.makeComplexComponentTensorHandle(t,x),I=o.makeComplexComponentTensorHandle(n,C);return o.compileAndRun(_,[A,I],k)}),p=d[0],h=d[1],g=this.complex(p,h);return p.dispose(),h.dispose(),g},e.prototype.makeComplexComponentTensorHandle=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){for(var n=t[0],r=1;r<t.length;r++)n=this.add(n,t[r]);return n},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,MC);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var r=new Bn(MC,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,lr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],o)},e.prototype.pow=function(t,n){var r=new Bn(Bz,t.shape,n.shape),o=r.getCustomSetupFunc(),i=this.makeOutputArray(r.outputShape,lr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],i,o)},e.prototype.ceil=function(t){var n=new Le(t.shape,HG);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){var n=new Le(t.shape,GG);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new Le(t.shape,qG);return this.compileAndRun(n,[t])},e.prototype.round=function(t){var n=new Le(t.shape,jG);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){var n=new Le(t.shape,KG);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){var n=new Le(t.shape,XG);return this.compileAndRun(n,[t])},e.prototype.log=function(t){var n=new Le(t.shape,YG),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.log1p=function(t){var n=new Le(t.shape,QG);return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new Le(t.shape,JG);return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){var n=new Le(t.shape,ZG);return this.compileAndRun(n,[t])},e.prototype.square=function(t){var n=new Le(t.shape,m8);return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new Le(t.shape,g8);return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n=new Le(t.shape,LG);return this.compileAndRun(n,[t])},e.prototype.elu=function(t){var n=new Le(t.shape,WG);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var r=new Bn(Jz,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.selu=function(t){var n=new Le(t.shape,UG);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new Le(t.shape,y8),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t],r)},e.prototype.clip=function(t,n,r){var o;return o=rt.get("WEBGL_PACK_CLIP")?new tV(t.shape,n,r):new Zz(t.shape,n,r),this.compileAndRun(o,[t])},e.prototype.abs=function(t){var n=new Le(t.shape,BG);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),r=new eV(t.shape),o=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)];return this.compileAndRun(r,o)},e.prototype.sigmoid=function(t){var n=new Le(t.shape,t8);return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new Le(t.shape,e8);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new Le(t.shape,n8);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new Le(t.shape,r8);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new Le(t.shape,o8);return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new Le(t.shape,a8);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new Le(t.shape,i8);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new Le(t.shape,s8);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var r=new Bn(Qz,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.sinh=function(t){var n=new Le(t.shape,u8);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new Le(t.shape,c8);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new Le(t.shape,l8);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new Le(t.shape,d8);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new Le(t.shape,f8),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.atanh=function(t){var n=new Le(t.shape,p8),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.erf=function(t){var n=new Le(t.shape,h8);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var r=new Le(t.shape,zG(n));return this.compileAndRun(r,[t])},e.prototype.conv2dWithIm2Row=function(t,n,r){var o=r.filterWidth,i=r.filterHeight,l=r.inChannels,d=r.outWidth,p=r.outHeight,h=o*i*l,g=p*d,y=[h,g],x=t.squeeze([0]),C=n.reshape([h,-1]),_=new oG(y,x.shape,r),k=this.compileAndRun(_,[x]),A=new zC(k.shape,C.shape,[g,r.outChannels],!0,!1);return this.compileAndRun(A,[k,C]).reshape([1,p,d,r.outChannels])},e.prototype.conv2d=function(t,n,r){if(rt.get("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,r);var o=new cV(r);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerInput=function(t,n,r){var o=new oV(r);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerFilter=function(t,n,r){var o=new rV(r);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2D=function(t,n,r){var o;return rt.get("WEBGL_PACK_DEPTHWISECONV")&&r.dilationWidth===1&&r.dilationHeight===1&&r.padInfo.left<=1&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(o=new fV(r),this.compileAndRun(o,[t,n],this.makePackedTensor(r.outShape,t.dtype))):(o=new dV(r),this.compileAndRun(o,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,r){var o=new uV(r);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){var o=new sV(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3d=function(t,n,r){var o=new lV(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerInput=function(t,n,r){var o=new iV(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerFilter=function(t,n,r){var o=new aV(r);return this.compileAndRun(o,[t,n])},e.prototype.maxPool=function(t,n){var r=new yg(n,"max",!1),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[t],o)},e.prototype.avgPool=function(t,n){var r=new yg(n,"avg",!1),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t],o)},e.prototype.maxPoolBackprop=function(t,n,r,o){var i=new yg(o,"max",!0),l=this.compileAndRun(i,[n]),d=new sG(o),p=this.makeOutputArray(d.outputShape,n.dtype),h=this.compileAndRun(d,[t,l],p);return l.dispose(),h},e.prototype.avgPoolBackprop=function(t,n,r){var o=new Iz(r),i=this.makeOutputArray(o.outputShape,n.dtype);return this.compileAndRun(o,[t],i)},e.prototype.cast=function(t,n){return YE(t,n,this)},e.prototype.reshape=function(t,n){return this.texData.get(t.dataId).isPacked&&!WC(t.shape,n)?this.packedReshape(t,n):av(t,n)},e.prototype.resizeBilinear=function(t,n,r,o){var i=new _G(t.shape,n,r,o);return this.compileAndRun(i,[t])},e.prototype.resizeBilinearBackprop=function(t,n,r){var o=new SG(t,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,n,r,o){var i=new kG(t.shape,n,r,o);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){var o=new EG(t,n,r);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,n,r,o){var i=n?t:Ys(t),l=i.shape[0],d=i.shape[1],p=new cG(l,d,r),h=this.makeOutputArray(p.outputShape,"int32"),g=p.getCustomSetupFunc(o);return this.compileAndRun(p,[i],h,g)},e.prototype.oneHot=function(t,n,r,o){var i=new lG(t.size,n,r,o);return this.compileAndRun(i,[t])},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return ov("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),l0(t.dataSync(),n.dataSync(),r,o,i)},e.prototype.cropAndResize=function(t,n,r,o,i,l){var d=new pV(t.shape,n.shape,o,i,l);return this.compileAndRun(d,[t,n,r])},e.prototype.depthToSpace=function(t,n,r){et(n>1,"blockSize should be > 1 for depthToSpace, but was: "+n);var o=t.shape[0],i=(r==="NHWC"?t.shape[1]:t.shape[2])*n,l=(r==="NHWC"?t.shape[2]:t.shape[3])*n,d=(r==="NHWC"?t.shape[3]:t.shape[1])/(n*n),p=new oH(r==="NHWC"?[o,i,l,d]:[o,d,i,l],n,r);return this.compileAndRun(p,[t])},e.prototype.split=function(t,n,r){return JE(t,n,r)},e.prototype.scatterND=function(t,n,r){var o=ip(n,t,r),i=o.sliceRank,l=o.numUpdates,d=o.sliceSize,p=o.strides,h=o.outputSize,g=[h/d,d],y=t.reshape([l,i]),x=n.reshape([l,d]);if(h===0)return av(Kn([]),r);var C=Ot(0),_=new VC(l,i,y.rank,x.rank,p,g);return this.compileAndRun(_,[x,y,C]).reshape(r)},e.prototype.sparseToDense=function(t,n,r,o){var i=ip(n,t,r),l=i.sliceRank,d=i.numUpdates,p=i.strides,h=i.outputSize,g=new VC(d,l,t.rank,n.rank,p,[h,1],!1);return this.compileAndRun(g,[n,t,o]).reshape(r)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var r=this.texData.get(t.dataId),o=new $C(FC.REAL,t.shape,n),i=new $C(FC.IMAG,t.shape,n),l=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],d=this.compileAndRun(o,l),p=this.compileAndRun(i,l),h=this.complex(d,p).as2D(t.shape[0],t.shape[1]);return d.dispose(),p.dispose(),h},e.prototype.gatherND=function(t,n){var r=n.shape,o=r[r.length-1],i=HE(t,n),l=i[0],d=i[1],p=i[2],h=i[3],g=n.reshape([d,o]),y=t.reshape([t.size/p,p]),x=new cH(o,h,[d,p]);return this.compileAndRun(x,[y,g]).reshape(l)},e.prototype.makeOutputArray=function(t,n){return zt.make(t,{},n)},e.prototype.makePackedTensor=function(t,n){var r=zt.make(t,{},n);return this.texData.get(r.dataId).isPacked=!0,r},e.prototype.unpackTensor=function(t){var n=new qC(t.shape);return this.compileAndRun(n,[t],zt.make(n.outputShape,{},t.dtype))},e.prototype.getBatchDim=function(t,n){return n===void 0&&(n=2),ue(t.slice(0,t.length-n))},e.prototype.getRowsCols=function(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]},e.prototype.packedReshape=function(t,n){var r=t.reshape([this.getBatchDim(t.shape)].concat(this.getRowsCols(t.shape))),o=[this.getBatchDim(n)].concat(this.getRowsCols(n)),i=new xG(o,r.shape);return this.compileAndRun(i,[r]).reshape(n)},e.prototype.compileAndRun=function(t,n,r,o,i){var l=this;if(i===void 0&&(i=!0),r==null&&(r=t.usesPackedTextures?this.makePackedTensor(t.outputShape,n[0].dtype):this.makeOutputArray(t.outputShape,n[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=Qg(r.dtype,0),r;var d=n.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var D=l.texData.get(N.dataId);if(D.texture==null){if(!t.usesPackedTextures&&ue(N.shape)<=rt.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:l.readSync(N.dataId)};t.usesPackedTextures&&(D.isPacked=!0,D.shape=N.shape)}else if(!!D.isPacked!=!!t.usesPackedTextures){var M=void 0,F=void 0;D.isPacked?(M=new qC(N.shape),F=l.compileAndRun(M,[N],zt.make(M.outputShape,{},N.dtype))):(M=new pG(N.shape),F=l.compileAndRun(M,[N],l.makePackedTensor(N.shape,N.dtype))),D=l.texData.get(F.dataId),N=F}else if(D.isPacked&&!WC(D.shape,N.shape)){l.delayedStorage=!1;var W=N.dataSync();l.delayedStorage=!0,N=zt.make(N.shape,{values:W},N.dtype),(D=l.texData.get(N.dataId)).isPacked=!0}return l.uploadToGPU(N.dataId),{shape:N.shape,texData:D,isUniform:!1}});this.uploadToGPU(r.dataId);var p,h={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},g=rG(t,d,h),y=this.getAndSaveBinary(g,function(){return eG(l.gpgpu,t,d,h)}),x=this.activeTimers!=null;if(x&&(p=this.startTimer()),nG(y,d,h,o),rt.get("WEBGL_PAGING_ENABLED")&&i&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var C=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;C>0&&this.lruDataGPU.length>0;){var _=this.lruDataGPU.shift(),k=this.texData.get(_),A=k.shape,I=k.dtype;C-=this.computeBytes(A,I),this.read(_)}return x&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),rt.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(r.dataId).isPacked||t.isPackShader?r:this.unpackTensor(r)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return ve(function(){return t.abs(Ot(1e-8)).get()>0?32:16})},e.prototype.uploadToGPU=function(t){var n,r=this.texData.get(t),o=r.shape,i=r.values,l=r.texture,d=r.usage,p=r.isPacked;if(l==null){var h,g=this.activeTimers!=null;g&&(h=performance.now());var y=PH(o,p);r.texShape=y;var x=this.acquireTexture(t,y,d,p);if(r.texture=x,i!=null){if(p){var C=this.getBatchDim(o),_=1,k=1;o.length&&(_=(n=this.getRowsCols(o))[0],k=n[1]),this.gpgpu.uploadMatrixToPackedTexture(x,C,_,k,y[0],y[1],jC(i))}else this.gpgpu.uploadMatrixToTexture(x,y[0],y[1],jC(i));r.values=null,g&&(this.uploadWaitMs+=performance.now()-h)}}else rt.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},e.prototype.convertAndCacheOnCPU=function(t,n){var r=this.delayedStorage,o=this.texData.get(t),i=o.texture,l=o.texShape,d=o.dtype,p=o.usage,h=o.isPacked;return r&&i!=null&&(this.releaseTexture(t,i,l,p,h),o.texture=null,o.texShape=null),o.usage=ha.UPLOAD,n!=null&&(o.values=T7(n,d)),o.values},e.prototype.releaseTexture=function(t,n,r,o,i){var l=this.texData.get(t),d=l.shape,p=l.dtype;if(rt.get("WEBGL_PAGING_ENABLED")){var h=this.lruDataGPU.indexOf(t);h>=0&&this.lruDataGPU.splice(h,1)}this.numBytesInGPU-=this.computeBytes(d,p),this.textureManager.releaseTexture(n,r,o,i)},e.prototype.acquireTexture=function(t,n,r,o){var i=this.texData.get(t),l=i.shape,d=i.dtype;return rt.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(l,d),this.textureManager.acquireTexture(n,r,o)},e.prototype.computeBytes=function(t,n){return ue(t)*PE(n)},e}();function T7(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){for(var n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}function jC(e){return e instanceof Float32Array?e:new Float32Array(e)}function D7(e){var t=H(e,"x","neg");return rt.engine.runKernel(function(n){return n.neg(t)},{$x:t},function(n){return{$x:function(){return n.neg()}}})}function A7(e){var t=H(e,"x","ceil");return rt.engine.runKernel(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Sn(n)}}})}function I7(e){var t=H(e,"x","floor");return rt.engine.runKernel(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Sn(n)}}})}function N7(e){var t=H(e,"x","sign");return rt.engine.runKernel(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Sn(n)}}})}function P7(e){var t=H(e,"x","round");return rt.engine.runKernel(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Sn(n)}}})}function M7(e){var t=H(e,"x","exp");return rt.engine.runKernel(function(n,r){return r(n.exp(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mulStrict(o)}}})}function O7(e){var t=H(e,"x","expm1");return rt.engine.runKernel(function(n){return n.expm1(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.exp())}}})}function F7(e){var t=H(e,"x","log");return rt.engine.runKernel(function(n){return n.log(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.toFloat())}}})}function $7(e){var t=H(e,"x","log1p");return rt.engine.runKernel(function(n){return n.log1p(t)},{$x:t},function(n){return{$x:function(){return n.div(t.add(1))}}})}function B7(e){var t=H(e,"x","sqrt");return rt.engine.runKernel(function(n){return n.sqrt(t)},{$x:t},function(n){return{$x:function(){return n.div(t.toFloat().sqrt().mul(2))}}})}function L7(e){var t=H(e,"x","rsqrt");return rt.engine.runKernel(function(n){return n.rsqrt(t)},{$x:t},function(n){return{$x:function(){return n.div(t.pow(1.5).mul(2)).neg()}}})}function W7(e){var t=H(e,"x","square");return rt.engine.runKernel(function(n){return n.square(t)},{$x:t},function(n){return{$x:function(){return n.mul(t.toFloat().mul(2))}}})}function U7(e){var t=H(e,"x","reciprocal");return rt.engine.runKernel(function(n){return n.reciprocal(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.square().neg())}}})}function z7(e){var t=H(e,"x","abs");return t.dtype==="complex64"?rt.engine.runKernel(function(n){return n.complexAbs(t)},{$x:t}):rt.engine.runKernel(function(n){return n.abs(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.toFloat().step(-1))}}})}function V7(e,t,n){var r=H(e,"x","clipByValue");return et(t<=n,"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."),rt.engine.runKernel(function(o){return o.clip(r,t,n)},{$x:r},function(o){return{$x:function(){return o.where(r.greaterEqual(t).logicalAnd(r.lessEqual(n)),Sn(o))}}})}function H7(e){var t=H(e,"x","sigmoid");return rt.engine.runKernel(function(n,r){return r(n.sigmoid(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.mul(Ot(1).sub(o)))}}})}function G7(e){var t=H(e,"x","logSigmoid");return rt.engine.runKernel(function(n){return n.softplus(t.neg()).neg()},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.neg().sigmoid())}}})}function q7(e){var t=H(e,"x","softplus");return rt.engine.runKernel(function(n){return n.softplus(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.sigmoid())}}})}function j7(e){var t=H(e,"x","sin");return rt.engine.runKernel(function(n){return n.sin(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().cos().mulStrict(n)}}})}function K7(e){var t=H(e,"x","cos");return rt.engine.runKernel(function(n){return n.cos(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().sin().neg().mulStrict(n)}}})}function X7(e){var t=H(e,"x","tan");return rt.engine.runKernel(function(n){return n.tan(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.cos().square())}}})}function Y7(e){var t=H(e,"x","asin");return rt.engine.runKernel(function(n){return n.asin(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Ot(1).sub(t.toFloat().square()).sqrt())}}})}function Q7(e){var t=H(e,"x","acos");return rt.engine.runKernel(function(n){return n.acos(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Ot(1).sub(t.toFloat().square()).sqrt()).neg()}}})}function J7(e){var t=H(e,"x","atan");return rt.engine.runKernel(function(n){return n.atan(t)},{$x:t},function(n){return{$x:function(){return n.div(t.toFloat().square().add(1))}}})}function Z7(e){var t=H(e,"x","sinh");return rt.engine.runKernel(function(n){return n.sinh(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().cosh().mulStrict(n)}}})}function tq(e){var t=H(e,"x","cosh");return rt.engine.runKernel(function(n){return n.cosh(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().sinh().mulStrict(n)}}})}function eq(e){var t=H(e,"x","tanh");return rt.engine.runKernel(function(n,r){return r(n.tanh(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return Ot(1).sub(o.square()).mulStrict(n)}}})}function nq(e){var t=H(e,"x","asinh");return rt.engine.runKernel(function(n){return n.asinh(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Ot(1).add(t.toFloat().square()).sqrt())}}})}function rq(e){var t=H(e,"x","acosh");return rt.engine.runKernel(function(n){return n.acosh(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.toFloat().square().sub(1).sqrt())}}})}function oq(e){var t=H(e,"x","atanh");return rt.engine.runKernel(function(n){return n.atanh(t)},{$x:t},function(n){return{$x:function(){return n.div(Ot(1).sub(t.toFloat().square()))}}})}function aq(e){var t=H(e,"x","erf");return et(t.dtype==="int32"||t.dtype==="float32","Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=t.toFloat()),rt.engine.runKernel(function(n){return n.erf(t)},{$x:t},function(n){return{$x:function(){return n.mul(t.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function iq(e,t){t===void 0&&(t=0);var n=H(e,"x","step");return rt.engine.runKernel(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Sn(r)}}})}rt.get("IS_BROWSER")&&rt.registerBackend("webgl",function(){return new R7},2,s0);var sq=ut({abs_:z7}),uq=ut({acos_:Q7}),cq=ut({acosh_:rq}),lq=ut({asin_:Y7}),dq=ut({asinh_:nq}),fq=ut({atan_:J7}),pq=ut({atanh_:oq}),hq=ut({ceil_:A7}),g0=ut({clipByValue_:V7}),mq=ut({cos_:K7}),gq=ut({cosh_:tq}),vq=ut({erf_:aq}),sv=ut({exp_:M7}),yq=ut({expm1_:O7}),bq=ut({floor_:I7}),xq=ut({log_:F7}),wq=ut({log1p_:$7}),Cq=ut({logSigmoid_:G7}),up=ut({neg_:D7}),Sq=ut({reciprocal_:U7}),_q=ut({round_:P7}),wk=ut({rsqrt_:L7}),Ck=ut({sigmoid_:H7}),Eq=ut({sign_:N7}),kq=ut({sin_:j7}),Rq=ut({sinh_:Z7}),Tq=ut({softplus_:q7}),Dq=ut({sqrt_:B7}),Aq=ut({square_:W7}),Iq=ut({step_:iq}),Nq=ut({tan_:X7}),Pq=ut({tanh_:eq});function Mq(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=H(e,"x","batchNormalization"),h=H(t,"mean","batchNormalization"),g=H(n,"variance","batchNormalization");return o!=null&&(l=H(o,"scale","batchNormalization")),i!=null&&(d=H(i,"offset","batchNormalization")),et(p.rank===2,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),et(h.rank===2||h.rank===1,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."),et(g.rank===2||g.rank===1,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+g.rank+"."),l!=null&&et(l.rank===2||l.rank===1,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."),d!=null&&et(d.rank===2||d.rank===1,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+d.rank+"."),ld(p,h,g,r,l,d)}function Oq(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=H(e,"x","batchNormalization"),h=H(t,"mean","batchNormalization"),g=H(n,"variance","batchNormalization");return o!=null&&(l=H(o,"scale","batchNormalization")),i!=null&&(d=H(i,"offset","batchNormalization")),et(p.rank===3,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),et(h.rank===3||h.rank===1,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."),et(g.rank===3||g.rank===1,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+g.rank+"."),l!=null&&et(l.rank===3||l.rank===1,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."),d!=null&&et(d.rank===3||d.rank===1,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+d.rank+"."),ld(p,h,g,r,l,d)}function Fq(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=H(e,"x","batchNormalization"),h=H(t,"mean","batchNormalization"),g=H(n,"variance","batchNormalization");return o!=null&&(l=H(o,"scale","batchNormalization")),i!=null&&(d=H(i,"offset","batchNormalization")),et(p.rank===4,"Error in batchNormalization4D: x must be rank 4 but got rank "+p.rank+"."),et(h.rank===4||h.rank===1,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."),et(g.rank===4||g.rank===1,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+g.rank+"."),l!=null&&et(l.rank===4||l.rank===1,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."),d!=null&&et(d.rank===4||d.rank===1,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+d.rank+"."),ld(p,h,g,r,l,d)}function $q(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p,h=H(e,"x","batchNormalization"),g=H(t,"mean","batchNormalization"),y=H(n,"variance","batchNormalization");return o!=null&&(l=H(o,"scale","batchNormalization")),i!=null&&(d=H(i,"offset","batchNormalization")),et(g.rank===y.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),et(d==null||g.rank===d.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),et(l==null||g.rank===l.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),p=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h,rt.engine.runKernel(function(x){return x.batchNormalization(p,Df(g),Df(y),r,Df(l),Df(d))},{$x:h,$mean:g,$variance:y,$scale:l,$offset:d},function(x){var C=l??Ot(1),_=hr(g.shape,p.shape),k=[];if(g.rank===1){for(var A=0;A<p.shape.length-1;++A)k.push(p.shape[A]);k.push(1)}var I=h.sub(g),N=x.mul(C),D=wk(y.add(Ot(r))),M=D.mul(D).mul(D).mul(Ot(-.5));return{$x:function(){return g.rank===1?x.mul(Ju(D.as4D(1,1,1,g.shape[0]),k)).mul(C).reshape(h.shape):x.mul(D).mul(C).reshape(h.shape)},$mean:function(){var F=D.mul(Ot(-1)).mul(N);return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)},$variance:function(){var F=M.mul(I).mul(N);return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)},$scale:function(){var F=I.mul(D),W=x.mul(F);return g.rank===1&&(W=W.sum(_)),W.reshape(g.shape)},$offset:function(){var F=x;return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)}}}).reshape(h.shape)}function Df(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Bq=ut({batchNormalization2d_:Mq}),Lq=ut({batchNormalization3d_:Oq}),Wq=ut({batchNormalization4d_:Fq}),ld=ut({batchNormalization_:$q});function dd(e,t,n,r,o,i,l){l===void 0&&(l="channelsLast");var d,p=cp(t),h=p[0],g=p[1];if(l==="channelsLast")d=[h,g,e[3],e[3]];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);d=[h,g,e[1],e[1]]}return fd(e,d,n,r,o,i,!1,l)}function fd(e,t,n,r,o,i,l,d){l===void 0&&(l=!1),d===void 0&&(d="channelsLast");var p=[-1,-1,-1,-1],h=p[0],g=p[1],y=p[2],x=p[3];if(d==="channelsLast")h=e[0],g=e[1],y=e[2],x=e[3];else{if(d!=="channelsFirst")throw new Error("Unknown dataFormat "+d);h=e[0],x=e[1],g=e[2],y=e[3]}var C,_=t[0],k=t[1],A=t[3],I=cp(n),N=I[0],D=I[1],M=cp(r),F=M[0],W=M[1],L=Zu(_,F),X=Zu(k,W),q=Vq(o,g,y,N,D,L,X,i),Q=q.padInfo,it=q.outHeight,at=q.outWidth,ht=l?A*x:A;return d==="channelsFirst"?C=[h,ht,it,at]:d==="channelsLast"&&(C=[h,it,at,ht]),{batchSize:h,dataFormat:d,inHeight:g,inWidth:y,inChannels:x,outHeight:it,outWidth:at,outChannels:ht,padInfo:Q,strideHeight:N,strideWidth:D,filterHeight:_,filterWidth:k,effectiveFilterHeight:L,effectiveFilterWidth:X,dilationHeight:F,dilationWidth:W,inShape:e,outShape:C,filterShape:t}}function v0(e,t,n,r,o,i,l){i===void 0&&(i=!1),l===void 0&&(l="channelsLast");var d=[-1,-1,-1,-1,-1],p=d[0],h=d[1],g=d[2],y=d[3],x=d[4];if(l==="channelsLast")p=e[0],h=e[1],g=e[2],y=e[3],x=e[4];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);p=e[0],x=e[1],h=e[2],g=e[3],y=e[4]}var C,_=t[0],k=t[1],A=t[2],I=t[4],N=KC(n),D=N[0],M=N[1],F=N[2],W=KC(r),L=W[0],X=W[1],q=W[2],Q=Hq(o,h,g,y,D,M,F,Zu(_,L),Zu(k,X),Zu(A,q)),it=Q.padInfo,at=Q.outDepth,ht=Q.outHeight,gt=Q.outWidth,Ct=i?I*x:I;return l==="channelsFirst"?C=[p,Ct,at,ht,gt]:l==="channelsLast"&&(C=[p,at,ht,gt,Ct]),{batchSize:p,dataFormat:l,inDepth:h,inHeight:g,inWidth:y,inChannels:x,outDepth:at,outHeight:ht,outWidth:gt,outChannels:Ct,padInfo:it,strideDepth:D,strideHeight:M,strideWidth:F,filterDepth:_,filterHeight:k,filterWidth:A,dilationDepth:L,dilationHeight:X,dilationWidth:q,inShape:e,outShape:C,filterShape:t}}function Uq(e,t,n,r,o,i){o==null&&(o=zq(e,t,r));var l=e[0],d=e[1],p=XC((l-t+2*o)/r+1,i);et(Mo(p),"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters");var h=XC((d-t+2*o)/r+1,i);return et(Mo(h),"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"),[p,h,n]}function zq(e,t,n,r){r===void 0&&(r=1);var o=Zu(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function cp(e){return typeof e=="number"?[e,e]:e}function KC(e){return typeof e=="number"?[e,e,e]:e}function Zu(e,t){return t<=1?e:e+(e-1)*(t-1)}function Vq(e,t,n,r,o,i,l,d){var p,h,g;if(typeof e=="number"){p={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};var y=Uq([t,n,1],i,1,r,e,d);h=y[0],g=y[1]}else if(e==="same"){var x=((h=Math.ceil(t/r))-1)*r+i-t,C=((g=Math.ceil(n/o))-1)*o+l-n,_=Math.floor(x/2),k=x-_,A=Math.floor(C/2);p={top:_,bottom:k,left:A,right:C-A,type:"SAME"}}else{if(e!=="valid")throw Error("Unknown padding parameter: "+e);p={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-i+1)/r),g=Math.ceil((n-l+1)/o)}return{padInfo:p,outHeight:h,outWidth:g}}function Hq(e,t,n,r,o,i,l,d,p,h){var g,y,x,C;if(e==="same"){var _=((y=Math.ceil(t/o))-1)*o+d-t,k=((x=Math.ceil(n/i))-1)*i+p-n,A=((C=Math.ceil(r/l))-1)*l+h-r,I=Math.floor(_/2),N=_-I,D=Math.floor(k/2),M=k-D,F=Math.floor(A/2);g={top:D,bottom:M,left:F,right:A-F,front:I,back:N,type:"SAME"}}else{if(e!=="valid")throw Error("Unknown padding parameter: "+e);g={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},y=Math.ceil((t-d+1)/o),x=Math.ceil((n-p+1)/i),C=Math.ceil((r-h+1)/l)}return{padInfo:g,outDepth:y,outHeight:x,outWidth:C}}function XC(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function lp(e){var t=cp(e),n=t[0],r=t[1];return n===1&&r===1}function Zi(e,t){return lp(e)||lp(t)}function Gq(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var i=H(e,"a","matMul"),l=H(t,"b","matMul");i=(o=gr(i,l))[0],l=o[1];var d=n?i.shape[i.rank-2]:i.shape[i.rank-1],p=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?i.shape[i.rank-1]:i.shape[i.rank-2],g=r?l.shape[l.rank-2]:l.shape[l.rank-1],y=i.shape.slice(0,-2),x=l.shape.slice(0,-2),C=ue(y),_=ue(x);et(i.rank>=2&&l.rank>=2&&i.rank===l.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+l.rank+"."),et(Ar(y,x),"Error in matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+i.shape+" and "+l.shape+" must match."),et(d===p,"Error in matMul: inner shapes ("+d+") and ("+p+") of Tensors with shapes "+i.shape+" and "+l.shape+" and transposeA="+n+" and transposeB="+r+" must match.");var k=i.shape.slice(0,-2).concat([h,g]),A=n?i.as3D(C,d,h):i.as3D(C,h,d),I=r?l.as3D(_,g,p):l.as3D(_,p,g);return rt.engine.runKernel(function(N){return N.batchMatMul(A,I,n,r)},{$a:A,$b:I},function(N){return n||r?!n&&r?{$a:function(){return N.matMul(I,!1,!1)},$b:function(){return N.matMul(A,!0,!1)}}:n&&!r?{$a:function(){return I.matMul(N,!1,!0)},$b:function(){return A.matMul(N,!1,!1)}}:{$a:function(){return I.matMul(N,!0,!0)},$b:function(){return N.matMul(A,!0,!0)}}:{$a:function(){return N.matMul(I,!1,!0)},$b:function(){return A.matMul(N,!0,!1)}}}).reshape(k)}function qq(e,t){var n=H(e,"v1","outerProduct"),r=H(t,"v2","outerProduct");return et(n.rank===1&&r.rank===1,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))}function jq(e,t){var n=H(e,"t1","dot"),r=H(t,"t2","dot");et(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var o=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];return et(o===i,"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}var Vp=ut({matMul_:Gq}),Kq=ut({dot_:jq}),Xq=ut({outerProduct_:qq});function Yq(e,t,n,r,o,i,l){o===void 0&&(o="NWC"),i===void 0&&(i=1);var d=H(e,"x","conv1d"),p=H(t,"filter","conv1d"),h=d,g=!1;d.rank===2&&(g=!0,h=d.as3D(1,d.shape[0],d.shape[1])),et(h.rank===3,"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."),et(p.rank===3,"Error in conv1d: filter must be rank 3, but got rank "+p.rank+"."),l!=null&&et(Mo(r),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+"."),et(h.shape[2]===p.shape[1],"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+p.shape[1]+"."),et(Zi(n,i),"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"),et(o==="NWC","Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported.");var y=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]),x=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),C=ts(x,y,[1,n],r,"NHWC",[1,i],l);return g?C.as2D(C.shape[2],C.shape[3]):C.as3D(C.shape[0],C.shape[2],C.shape[3])}function Qq(e,t,n,r,o,i,l){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var d=H(e,"x","conv2d"),p=H(t,"filter","conv2d"),h=d,g=!1;d.rank===3&&(g=!0,h=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),et(h.rank===4,"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."),et(p.rank===4,"Error in conv2d: filter must be rank 4, but got rank "+p.rank+"."),l!=null&&et(Mo(r),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+"."),et(h.shape[3]===p.shape[2],"Error in conv2d: depth of input ("+h.shape[3]+") must match input depth for filter "+p.shape[2]+"."),et(Zi(n,i),"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),et(o==="NHWC","Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported.");var y,x=fd(h.shape,p.shape,n,i,r,l);if(x.filterHeight!==1||x.filterWidth!==1||x.dilationHeight!==1||x.dilationWidth!==1||x.strideHeight!==1||x.strideWidth!==1||x.padInfo.type!=="SAME"&&x.padInfo.type!=="VALID")y=rt.engine.runKernel(function(k){return k.conv2d(h,p,x)},{x:h,$filter:p},function(k){return et(lp(i),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return Sk(h.shape,k,p,n,r)},$filter:function(){return _k(h,k,p.shape,n,r)}}});else{var C=h.reshape([-1,x.inChannels]),_=p.reshape([x.inChannels,x.outChannels]);y=Vp(C,_).reshape(x.outShape)}return g?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}function Sk(e,t,n,r,o,i){et(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var l=e,d=t,p=!1;t.rank===3&&(p=!0,d=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),l=[1,e[0],e[1],e[2]]);var h=l[3],g=d.shape[3];et(l.length===4,"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."),et(d.rank===4,"Error in conv2dDerInput: dy must be rank 4, but got rank "+d.rank),et(n.rank===4,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),et(h===n.shape[2],"Error in conv2dDerInput: depth of input ("+h+") must match input depth for filter "+n.shape[2]+"."),et(g===n.shape[3],"Error in conv2dDerInput: depth of output ("+g+") must match output depth for filter "+n.shape[3]+"."),i!=null&&et(Mo(o),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var y=fd(l,n.shape,r,1,o,i),x=rt.engine.runKernel(function(C){return C.conv2dDerInput(d,n,y)},{dy4D:d,filter:n},function(C){return{dy4D:function(){return ts(C,n,r,o,"NHWC",1,i)},filter:function(){return Ek(C,d,n.shape,r,o,i)}}});return p?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function _k(e,t,n,r,o,i){var l=e;e.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var d=t;d.rank===3&&(d=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),et(l.rank===4,"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."),et(d.rank===4,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+d.shape+"."),et(n.length===4,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),et(l.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+l.shape[3]+") must match input depth in filter ("+n[2]+"."),et(d.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+d.shape[3]+") must match output depth for filter ("+n[3]+")."),i!=null&&et(Mo(o),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var p=fd(l.shape,n,r,1,o,i);return rt.engine.runKernel(function(h){return h.conv2dDerFilter(l,d,p)},{x4D:l,dy4D:d})}function Jq(e,t,n,r,o,i){return Sk(n,H(e,"x","conv2dTranspose"),H(t,"filter","conv2dTranspose"),r,o,i)}function Zq(e,t,n,r,o,i,l){i===void 0&&(i=[1,1]);var d=H(e,"x","depthwiseConv2d"),p=H(t,"filter","depthwiseConv2d"),h=d,g=!1;d.rank===3&&(g=!0,h=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),et(h.rank===4,"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."),et(p.rank===4,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+p.rank+"."),et(h.shape[3]===p.shape[2],"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+p.shape[2]+"."),i==null&&(i=[1,1]),et(Zi(n,i),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),l!=null&&et(Mo(r),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+".");var y=fd(h.shape,p.shape,n,i,r,l,!0),x=rt.engine.runKernel(function(C){return C.depthwiseConv2D(h,p,y)},{x:h,$filter:p},function(C){return et(lp(i),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"),{x:function(){return rj(h.shape,C,p,y)},$filter:function(){return oj(h,C,p.shape,y)}}});return g?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function tj(e,t,n,r,o,i,l){i===void 0&&(i=[1,1]),l===void 0&&(l="NHWC");var d=H(e,"x","separableConv2d"),p=H(t,"depthwiseFilter","separableConv2d"),h=H(n,"pointwiseFilter","separableConv2d"),g=d,y=!1;if(d.rank===3&&(y=!0,g=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");et(g.rank===4,"Error in separableConv2d: input must be rank 4, but got rank "+g.rank+"."),et(p.rank===4,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+p.rank+"."),et(h.rank===4,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+p.rank+"."),et(h.shape[0]===1,"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."),et(h.shape[1]===1,"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+h.shape[1]+".");var x=p.shape[2],C=p.shape[3];et(h.shape[2]===x*C,"Error in separableConv2d: the third dimension of pointwise filter must be "+x*C+", but got "+h.shape[2]+".");var _=y0(g,p,r,o,l,i),k=ts(_,h,1,"valid",l);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}function ej(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function uv(e){var t=ej(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function nj(e,t){return uv(e)||uv(t)}function rj(e,t,n,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var l=rt.engine.runKernel(function(d){return d.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function oj(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),rt.engine.runKernel(function(l){return l.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}function aj(e,t,n,r,o,i){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1,1]);var l=H(e,"x","conv3d"),d=H(t,"filter","conv3d"),p=l,h=!1;l.rank===4&&(h=!0,p=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),et(p.rank===5,"Error in conv3d: input must be rank 5, but got rank "+p.rank+"."),et(d.rank===5,"Error in conv3d: filter must be rank 5, but got rank "+d.rank+"."),et(p.shape[4]===d.shape[3],"Error in conv3d: depth of input ("+p.shape[4]+") must match input depth for filter "+d.shape[3]+"."),et(nj(n,i),"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),et(o==="NHWC","Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported.");var g=v0(p.shape,d.shape,n,i,r),y=rt.engine.runKernel(function(x){return x.conv3d(p,d,g)},{x:p,$filter:d},function(x){return et(uv(i),"Error in gradient of conv3D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return ij(p.shape,x,d,n,r)},$filter:function(){return sj(p,x,d.shape,n,r)}}});return h?y.as4D(y.shape[1],y.shape[2],y.shape[3],y.shape[4]):y}function ij(e,t,n,r,o){et(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var i=e,l=t,d=!1;t.rank===4&&(d=!0,l=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var p=i[4],h=l.shape[4];et(i.length===5,"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."),et(l.rank===5,"Error in conv3dDerInput: dy must be rank 5, but got rank "+l.rank),et(n.rank===5,"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),et(p===n.shape[3],"Error in conv3dDerInput: depth of input ("+p+") must match input depth for filter "+n.shape[3]+"."),et(h===n.shape[4],"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[4]+".");var g=v0(i,n.shape,r,1,o),y=rt.engine.runKernel(function(x){return x.conv3dDerInput(l,n,g)},{dy5D:l});return d?y.as4D(y.shape[1],y.shape[2],y.shape[3],y.shape[4]):y}function sj(e,t,n,r,o){var i=e;e.rank===4&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var l=t;l.rank===4&&(l=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),et(i.rank===5,"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."),et(l.rank===5,"Error in conv3dDerFilter: dy must be rank 5, but got shape "+l.shape+"."),et(n.length===5,"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),et(i.shape[4]===n[3],"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."),et(l.shape[4]===n[4],"Error in conv3dDerFilter: depth of dy ("+l.shape[4]+") must match output depth for filter ("+n[4]+").");var d=v0(i.shape,n,r,1,o);return rt.engine.runKernel(function(p){return p.conv3dDerFilter(i,l,d)},{x5D:i,dy5D:l})}var uj=ut({conv1d_:Yq}),ts=ut({conv2d_:Qq}),cj=ut({conv3d_:aj}),Ek=ut({conv2dDerFilter_:_k}),y0=ut({depthwiseConv2d_:Zq}),kk=ut({separableConv2d_:tj}),lj=ut({conv2dTranspose_:Jq});function dj(e){var t=H(e,"x","reverse");return et(t.rank===1,`Error in reverse1D: x must be rank 1 but got
             rank `+t.rank+"."),pd(t,0)}function fj(e,t){var n=H(e,"x","reverse");return et(n.rank===2,`Error in reverse2D: x must be rank 2 but got
             rank `+n.rank+"."),pd(n,t)}function pj(e,t){var n=H(e,"x","reverse");return et(n.rank===3,`Error in reverse3D: x must be rank 3 but got
             rank `+n.rank+"."),pd(n,t)}function hj(e,t){var n=H(e,"x","reverse");return et(n.rank===4,`Error in reverse4D: x must be rank 4 but got
             rank `+n.rank+"."),pd(n,t)}function mj(e,t){var n=H(e,"x","reverse");if(n.rank===0)return n.clone();var r=Mr(t,n.shape);return rt.engine.runKernel(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}var pd=ut({reverse_:mj}),gj=ut({reverse1d_:dj}),vj=ut({reverse2d_:fj}),yj=ut({reverse3d_:pj}),bj=ut({reverse4d_:hj});function Rk(e,t,n,r,o,i){var l=H(e,"x","maxPool"),d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),et(d.rank===4,"Error in maxPool: input must be rank 4 but got rank "+d.rank+"."),et(Zi(n,r),"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"),i!=null&&et(Mo(o),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var h=dd(d.shape,t,n,r,o,i),g=rt.engine.runKernel(function(y,x){return x(y.maxPool(d,h))},{x:d},function(y,x){var C=x[0];return{x:function(){return Sj(y,d,C,t,n,r,o)}}});return p?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function xj(e,t,n,r,o){return Rk(e,t,n,1,r,o)}function Tk(e,t,n,r,o,i){var l=H(e,"x","avgPool","float32");et(Zi(n,r),"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'");var d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),et(d.rank===4,"Error in avgPool: x must be rank 4 but got rank "+d.rank+"."),i!=null&&et(Mo(o),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var h=dd(d.shape,t,n,r,o),g=rt.engine.runKernel(function(y){return y.avgPool(d,h)},{x:d},function(y){return{x:function(){return _j(y,d,t,n,r,o)}}});return g=g.cast(l.dtype),p?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function wj(e,t,n,r,o){return Tk(e,t,n,1,r,o)}function Cj(e,t,n,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var l=H(e,"x","maxPool"),d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),et(Zi(i,o),"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'");var h,g=dd(d.shape,t,i,o,r),y=[g.dilationHeight,g.dilationWidth];h=r==="same"?kj([g.filterHeight,g.filterWidth],y):[[0,0],[0,0]];var x=y[0]===1&&y[1]===1,C=Ej([g.inHeight,g.inWidth],y,h),_=C[0],k=C[1],A=x?r:"valid",I=x?d:bk(d,y,_),N=(n==="avg"?function(){return Tk(I,t,i,1,A)}:function(){return Rk(I,t,i,1,A)})(),D=x?N:gk(N,y,k);return p?D.as3D(D.shape[1],D.shape[2],D.shape[3]):D}function Sj(e,t,n,r,o,i,l,d){var p=H(e,"dy","maxPoolBackprop"),h=H(t,"input","maxPoolBackprop"),g=H(n,"output","maxPoolBackprop");et(h.rank===p.rank,"Rank of input ("+h.rank+") does not match rank of dy ("+p.rank+")"),et(Zi(o,i),"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"),et(p.rank===4,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+p.rank+"."),et(h.rank===4,"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+".");var y=dd(h.shape,r,o,i,l,d);return rt.engine.runKernel(function(x){return x.maxPoolBackprop(p,h,g,y)},{$dy:p,$input:h})}function _j(e,t,n,r,o,i){var l=H(e,"dy","avgPoolBackprop"),d=H(t,"input","avgPoolBackprop");et(d.rank===l.rank,"Rank of input ("+d.rank+") does not match rank of dy ("+l.rank+")"),et(Zi(r,o),"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'");var p=d,h=l,g=!1;d.rank===3&&(g=!0,p=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]),h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),et(h.rank===4,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+h.rank+"."),et(p.rank===4,"Error in avgPoolBackprop: input must be rank 4 but got rank "+p.rank+".");var y=dd(p.shape,n,r,o,i),x=rt.engine.runKernel(function(C){return C.avgPoolBackprop(h,p,y)},{dy4D:h,input4D:p});return g?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Ej(e,t,n){var r=n.map(function(p){return p[0]}),o=n.map(function(p){return p[1]}),i=e.concat(r,o),l=t.map(function(p,h){return(p-i[h]%p)%p}),d=o.map(function(p,h){return p+l[h]});return[t.map(function(p,h){return[r[h],d[h]]}),t.map(function(p,h){return[0,l[h]]})]}function kj(e,t){var n=e.map(function(i,l){return i+(i-1)*(t[l]-1)}).map(function(i){return i-1}),r=n.map(function(i){return Math.floor(i/2)}),o=n.map(function(i,l){return i-r[l]});return n.map(function(i,l){return[r[l],o[l]]})}var Kl=ut({maxPool_:xj}),Hp=ut({avgPool_:wj}),Rj=ut({pool_:Cj});function Tj(e,t,n){var r=H(e,"x","slice1d");return et(r.rank===1,"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"),zs(r,[t],[n])}function Dj(e,t,n){var r=H(e,"x","slice2d");return et(r.rank===2,"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"),zs(r,t,n)}function Aj(e,t,n){var r=H(e,"x","slice3d");return et(r.rank===3,"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"),zs(r,t,n)}function Ij(e,t,n){var r=H(e,"x","slice4d");return et(r.rank===4,"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"),zs(r,t,n)}function Nj(e,t,n){var r,o,i=H(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice(),o=(o=n==null?new Array(i.rank).fill(-1):typeof n=="number"?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(d,p){return d>=0?d:(et(d===-1,"Bad value in size"),i.shape[p]-r[p])}),uz(i,r,o);var l=i.shape;return rt.engine.runKernel(function(d){return d.slice(i,r,o)},{$x:i},function(d){for(var p=[],h=0;h<d.rank;h++)p.push([r[h],l[h]-r[h]-o[h]]);return{$x:function(){return d.pad(p)}}})}var zs=ut({slice_:Nj}),Pj=ut({slice1d_:Tj}),Mj=ut({slice2d_:Dj}),Dk=ut({slice3d_:Aj}),Oj=ut({slice4d_:Ij});function Fj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","logSumExp"),o=Mr(t,r.shape),i=r.max(o,!0),l=r.sub(i).exp().sum(o).log(),d=i.reshape(l.shape).add(l);if(n){var p=Oo(d.shape,o);return d.reshape(p)}return d}function $j(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=Mr(t,r.shape);return id(function(i){var l=_a(o,i.rank),d=o,p=i;l!=null&&(p=i.transpose(l),d=Ea(d.length,i.rank));var h=rt.engine.runKernel(function(y){return y.sum(p,d)},{permutedX:p});if(n){var g=Oo(h.shape,o);h=h.reshape(g)}return{value:h,gradFunc:function(y){var x=i.shape.slice();return o.forEach(function(C){x[C]=1}),y.reshape(x).mul(Hi(i.shape,"float32"))}}})(r)}function Bj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=Mr(t,r.shape),i=_a(o,r.rank),l=o,d=r;i!=null&&(d=r.transpose(i),l=Ea(l.length,r.rank));var p=rt.engine.runKernel(function(g){return g.prod(d,l)},{permutedX:d});if(n){var h=Oo(p.shape,o);p=p.reshape(h)}return p}function Lj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","mean"),o=Mr(t,r.shape),i=ue(sr(r.shape,o)[1]);return id(function(l){var d=Ot(i);return{value:(d.dtype===l.dtype?l:l.cast(d.dtype)).div(d).sum(t,n),gradFunc:function(p){var h=l.shape.slice();return o.forEach(function(g){h[g]=1}),p.reshape(h).mul(Hi(l.shape,"float32")).div(d)}}})(r)}function Ak(e,t,n,r,o){var i=t[0];return i.rank<n.rank&&(i=i.reshape(Oo(i.shape,r))),e.rank<n.rank&&(e=e.reshape(Oo(e.shape,r))),{$x:function(){var l=e.mul(n.equal(i).cast(e.dtype));return o==null?l:l.transpose(o)}}}function Wj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","min"),o=r,i=Mr(t,r.shape),l=i,d=_a(l,r.rank);d!=null&&(r=r.transpose(d),l=Ea(l.length,r.rank));var p=rt.engine.runKernel(function(g,y){return y(g.min(r,l))},{$x:r},function(g,y){return Ak(g,y,o,i,d)});if(n){var h=Oo(p.shape,i);p=p.reshape(h)}return p}function Uj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","max"),o=r,i=Mr(t,r.shape),l=i,d=_a(l,r.rank);d!=null&&(r=r.transpose(d),l=Ea(l.length,r.rank));var p=rt.engine.runKernel(function(g,y){return y(g.max(r,l))},{$x:r},function(g,y){return Ak(g,y,o,i,d)});if(n){var h=Oo(p.shape,i);p=p.reshape(h)}return p}function zj(e,t){t===void 0&&(t=0);var n=H(e,"x","argMin");t==null&&(t=0);var r=Mr(t,n.shape),o=_a(r,n.rank);return o!=null&&(n=n.transpose(o),r=Ea(r.length,n.rank)),rt.engine.runKernel(function(i){return i.argMin(n,r[0])},{$x:n},function(i){return{$x:function(){return Sn(n)}}})}function Vj(e,t){t===void 0&&(t=0);var n=H(e,"x","argMax");t==null&&(t=0);var r=Mr(t,n.shape),o=_a(r,n.rank);return o!=null&&(n=n.transpose(o),r=Ea(r.length,n.rank)),rt.engine.runKernel(function(i){return i.argMax(n,r[0])},{$x:n},function(i){return{$x:function(){return Sn(n)}}})}function Hj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","all","bool"),o=Mr(t,r.shape),i=o,l=_a(i,r.rank);l!=null&&(r=r.transpose(l),i=Ea(i.length,r.rank));var d=rt.engine.runKernel(function(h){return h.all(r,i)},{$x:r});if(n){var p=Oo(d.shape,o);return d.reshape(p)}return d}function Gj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=H(e,"x","any","bool"),o=Mr(t,r.shape),i=o,l=_a(i,r.rank);l!=null&&(r=r.transpose(l),i=Ea(i.length,r.rank));var d=rt.engine.runKernel(function(h){return h.any(r,i)},{$x:r});if(n){var p=Oo(d.shape,o);return d.reshape(p)}return d}function qj(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=Mr(t,(e=H(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;return n||(i=Oo(o.shape,r)),{mean:o,variance:e.toFloat().sub(o.reshape(i)).square().mean(r,n)}}var jj=ut({all_:Hj}),Kj=ut({any_:Gj}),Xj=ut({argMax_:Vj}),Yj=ut({argMin_:zj}),Qj=ut({logSumExp_:Fj}),Gp=ut({max_:Uj}),Jj=ut({mean_:Lj}),Zj=ut({min_:Wj}),t9=ut({moments_:qj}),Ik=ut({sum_:$j}),e9=ut({prod_:Bj});function n9(e,t){var n,r=H(e,"a","notEqual"),o=H(t,"b","notEqual");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.notEqual(r,o)},{$a:r,$b:o})}function r9(e,t){var n=H(e,"a","notEqualStrict"),r=H(t,"b","notEqualStrict");return on(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}function o9(e,t){var n,r=H(e,"a","less"),o=H(t,"b","less");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.less(r,o)},{$a:r,$b:o})}function a9(e,t){var n=H(e,"a","lessStrict"),r=H(t,"b","lessStrict");return on(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}function i9(e,t){var n,r=H(e,"a","equal"),o=H(t,"b","equal");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.equal(r,o)},{$a:r,$b:o})}function s9(e,t){var n=H(e,"a","equalStrict"),r=H(t,"b","equalStrict");return on(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}function u9(e,t){var n,r=H(e,"a","lessEqual"),o=H(t,"b","lessEqual");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.lessEqual(r,o)},{$a:r,$b:o})}function c9(e,t){var n=H(e,"a","lessEqualStrict"),r=H(t,"b","lessEqualStrict");return on(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}function l9(e,t){var n,r=H(e,"a","greater"),o=H(t,"b","greater");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.greater(r,o)},{$a:r,$b:o})}function d9(e,t){var n=H(e,"a","greaterStrict"),r=H(t,"b","greaterStrict");return on(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}function f9(e,t){var n,r=H(e,"a","greaterEqual"),o=H(t,"b","greaterEqual");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.greaterEqual(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return Sn(r)},$b:function(){return Sn(o)}}})}function p9(e,t){var n=H(e,"a","greaterEqualStrict"),r=H(t,"b","greaterEqualStrict");return on(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}var Nk=ut({equal_:i9}),h9=ut({equalStrict_:s9}),m9=ut({greater_:l9}),Pk=ut({greaterEqual_:f9}),g9=ut({greaterEqualStrict_:p9}),v9=ut({greaterStrict_:d9}),y9=ut({less_:o9}),b9=ut({lessEqual_:u9}),x9=ut({lessEqualStrict_:c9}),w9=ut({lessStrict_:a9}),C9=ut({notEqual_:n9}),S9=ut({notEqualStrict_:r9});function _9(e,t){var n,r=H(e,"a","add"),o=H(t,"b","add");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.add(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l,p=hr(r.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(r.shape)},$b:function(){var d=l,p=hr(o.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(o.shape)}}})}function E9(e){et(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),et(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,i){return H(o,"tensors"+i,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Ar(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return rt.engine.runKernel(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(l,d){i[d]=function(){return o.clone()}}),i})}function k9(e,t){var n=H(e,"a","addStrict"),r=H(t,"b","addStrict");return on(n.shape,r.shape,"Error in addStrict: "),n.add(r)}function R9(e,t){var n,r=H(e,"a","sub"),o=H(t,"b","sub");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.subtract(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l,p=hr(r.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(r.shape)},$b:function(){var d=l,p=hr(o.shape,i);return p.length>0&&(d=d.sum(p)),d.neg().reshape(o.shape)}}})}function T9(e,t){var n=H(e,"a","subStrict"),r=H(t,"b","subStrict");return on(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}function D9(e,t){var n=H(e,"base","pow"),r=H(t,"exp","pow"),o=qe(n.shape,r.shape);return e=n.cast(lr(n.dtype,r.dtype)),t=r.cast(lr(n.dtype,r.dtype)),rt.engine.runKernel(function(i,l){return l(i.pow(n,r))},{$base:n,$exp:r},function(i,l){var d=l[0];return{$base:function(){var p=r.toFloat(),h=i.mul(p.mul(n.pow(p.sub(Ot(1))))),g=hr(n.shape,o);return g.length>0&&(h=h.sum(g)),h.reshape(n.shape)},$exp:function(){var p=i.mul(d.mul(n.log()).toFloat()),h=hr(r.shape,o);return h.length>0&&(p=p.sum(h)),p.reshape(r.shape)}}})}function A9(e,t){return on(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}function I9(e,t){var n,r=H(e,"a","mul"),o=H(t,"b","mul");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.multiply(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l.mul(o.toFloat()),p=hr(r.shape,i);return p.length>0?d.sum(p).reshape(r.shape):d},$b:function(){var d=l.mul(r.toFloat()),p=hr(o.shape,i);return p.length>0?d.sum(p).reshape(o.shape):d}}})}function N9(e,t){var n=H(e,"a","mul"),r=H(t,"b","mul");return on(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}function P9(e,t){var n,r,o=H(e,"a","div"),i=H(t,"b","div");if(n=gr(o,i),o=n[0],i=n[1],o.dtype==="int32"&&i.dtype==="int32")return Mk(o,i);r=function(d){return d.realDivide(o,i)};var l=qe(o.shape,i.shape);return rt.engine.runKernel(r,{$a:o,$b:i},function(d){return{$a:function(){var p=d.div(i.toFloat()),h=hr(o.shape,l);return h.length>0?p.sum(h).reshape(o.shape):p},$b:function(){var p=d.mul(o.toFloat()),h=hr(i.shape,l);h.length>0&&(p=p.sum(h).reshape(i.shape));var g=i.square();return p.div(g.toFloat()).neg()}}})}function M9(e,t){var n,r=H(e,"a","floorDiv"),o=H(t,"b","floorDiv");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.floorDiv(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l.div(o.toFloat()),p=hr(r.shape,i);return p.length>0?d.sum(p).reshape(r.shape):d},$b:function(){var d=l.mul(r.toFloat()),p=hr(o.shape,i);p.length>0&&(d=d.sum(p).reshape(o.shape));var h=o.square();return d.div(h.toFloat()).neg()}}})}function O9(e,t){var n=H(e,"a","div"),r=H(t,"b","div");return on(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}function F9(e,t){var n,r=H(e,"a","mod"),o=H(t,"b","mod");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.mod(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=hr(r.shape,i);return d.length>0?l.sum(d).reshape(r.shape):l},$b:function(){var d=l.mul(r.div(o).floor().neg()),p=hr(o.shape,i);return p.length>0?d.sum(p).reshape(o.shape):d}}})}function $9(e,t){var n=H(e,"a","modStrict"),r=H(t,"b","modStrict");return on(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}function B9(e,t){var n,r=H(e,"a","minimum"),o=H(t,"b","minimum");return n=gr(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.minimum(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return i.mul(r.lessEqual(o).toFloat())},$b:function(){return i.mul(r.greater(o).toFloat())}}})}function L9(e,t){var n=H(e,"a","minimumStrict"),r=H(t,"b","minimumStrict");return on(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}function W9(e,t){var n,r=H(e,"a","maximum"),o=H(t,"b","maximum");return n=gr(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.maximum(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return i.mul(r.greaterEqual(o).toFloat())},$b:function(){return i.mul(r.less(o).toFloat())}}})}function U9(e,t){var n=H(e,"a","maximumStrict"),r=H(t,"b","maximumStrict");return on(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}function z9(e,t){var n,r=H(e,"a","squaredDifference"),o=H(t,"b","squaredDifference");return n=gr(r,o),r=n[0],o=n[1],qe(r.shape,o.shape),rt.engine.runKernel(function(i){return i.squaredDifference(r,o)},{$a:r,$b:o},function(i){var l=Ot(2);return{$a:function(){return i.mul(r.sub(o).mul(l))},$b:function(){return i.mul(o.sub(r).mul(l))}}})}function V9(e,t){var n=H(e,"a","squaredDifferenceStrict"),r=H(t,"b","squaredDifferenceStrict");return on(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}function H9(e,t){var n,r=H(e,"a","atan2"),o=H(t,"b","atan2");n=gr(r,o),r=n[0],o=n[1];var i=qe(r.shape,o.shape);return rt.engine.runKernel(function(l){return l.atan2(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=nn(r.square(),o.square()),p=l.mul(o.div(d)),h=hr(r.shape,i);return h.length>0&&(p=p.sum(h)),p.reshape(r.shape)},$b:function(){var d=nn(r.square(),o.square()),p=up(l.mul(r.div(d))),h=hr(o.shape,i);return h.length>0&&(p=p.sum(h)),p.reshape(o.shape)}}})}var nn=ut({add_:_9}),G9=ut({addN_:E9}),q9=ut({addStrict_:k9}),j9=ut({atan2_:H9}),Ua=ut({div_:P9}),K9=ut({divStrict_:O9}),Mk=ut({floorDiv_:M9}),qp=ut({maximum_:W9}),X9=ut({maximumStrict_:U9}),b0=ut({minimum_:B9}),Y9=ut({minimumStrict_:L9}),Q9=ut({mod_:F9}),J9=ut({modStrict_:$9}),qa=ut({mul_:I9}),Z9=ut({mulStrict_:N9}),Ok=ut({pow_:D9}),tK=ut({powStrict_:A9}),eK=ut({squaredDifference_:z9}),nK=ut({squaredDifferenceStrict_:V9}),wa=ut({sub_:R9}),rK=ut({subStrict_:T9});function oK(e){var t=H(e,"x","logicalNot","bool");return rt.engine.runKernel(function(n){return n.logicalNot(t)},{$x:t})}function aK(e,t){var n=H(e,"a","logicalAnd","bool"),r=H(t,"b","logicalAnd","bool");return qe(n.shape,r.shape),rt.engine.runKernel(function(o){return o.logicalAnd(n,r)},{$a:n,$b:r})}function iK(e,t){var n=H(e,"a","logicalOr","bool"),r=H(t,"b","logicalOr","bool");return qe(n.shape,r.shape),rt.engine.runKernel(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}function sK(e,t){var n=H(e,"a","logicalXor","bool"),r=H(t,"b","logicalXor","bool");return qe(n.shape,r.shape),Fk(e,t).logicalAnd(x0(e,t).logicalNot())}function uK(e,t,n){var r=H(t,"a","where"),o=H(n,"b","where"),i=H(e,"condition","where","bool");return on(r.shape,o.shape,"Error in where: "),i.rank===1?et(i.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):on(i.shape,o.shape,"Error in where: "),rt.engine.runKernel(function(l){return l.select(i,r,o)},{$condition:i,$a:r,$b:o},function(l){return{$condition:function(){return Sn(i).toFloat()},$a:function(){return l.mul(i.cast(l.dtype))},$b:function(){return l.mul(i.logicalNot().cast(l.dtype))}}})}function cK(e){return Je(this,void 0,void 0,function(){var t,n,r;return Ze(this,function(o){switch(o.label){case 0:return[4,(t=H(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=m0(t.shape,n),e!==t&&t.dispose(),[2,r]}})})}var x0=ut({logicalAnd_:aK}),lK=ut({logicalNot_:oK}),Fk=ut({logicalOr_:iK}),dK=ut({logicalXor_:sK}),w0=ut({where_:uK}),fK=cK;function pK(e){var t=H(e,"x","relu");return t.dtype==="bool"?t.toInt():rt.engine.runKernel(function(n){return n.relu(t)},{$x:t},function(n){var r=t.step();return{$x:function(){return n.mulStrict(r.toFloat())}}})}function hK(e){var t=H(e,"x","elu");return rt.engine.runKernel(function(n,r){return r(n.elu(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return rt.engine.runKernel(function(i){return i.eluDer(n,o)},{dy:n,y:o})}}})}function mK(e){var t=H(e,"x","selu");return rt.engine.runKernel(function(n){return n.selu(t)},{$x:t},function(n){return{$x:function(){var r=t.greater(Ot(0)),o=Ot(f0),i=Ot(p0),l=n.mul(i),d=n.mul(o).mul(t.toFloat().exp());return w0(r,l,d)}}})}function gK(e,t){t===void 0&&(t=.2);var n=H(e,"x","leakyRelu");return qp(Ot(t).mul(n),n)}function vK(e,t){var n=H(e,"x","prelu"),r=H(t,"alpha","prelu"),o=Ot(0);return qp(o,n).add(r.mul(b0(o,n)))}var yK=ut({elu_:hK}),bK=ut({leakyRelu_:gK}),xK=ut({prelu_:vK}),po=ut({relu_:pK}),wK=ut({selu_:mK});function CK(e,t){var n=H(e,"x","transpose");return t==null&&(t=n.shape.map(function(r,o){return o}).reverse()),et(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."),t.forEach(function(r){et(r>=0&&r<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)}),n.rank<=1?n.clone():rt.engine.runKernel(function(r){return r.transpose(n,t)},{$x:n},function(r){var o=u0(t);return{$x:function(){return r.transpose(o)}}})}var Gi=ut({transpose_:CK});function SK(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=H(e,"x","localResponseNormalization");et(i.rank===4||i.rank===3,`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."),et(Mo(t),`Error in localResponseNormalization: depthRadius must be an integer
                     but got depthRadius `+t+".");var l=i,d=!1;i.rank===3&&(d=!0,l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var p=rt.engine.runKernel(function(h,g){return g(h.localResponseNormalization4D(l,t,n,r,o))},{x4D:l},function(h,g){var y=g[0];return{x4D:function(){return rt.engine.runKernel(function(x){return x.LRNGrad(h,l,y,t,n,r,o)},{})}}});return d?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}var _K=ut({localResponseNormalization_:SK});function EK(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=$k(e=H(e,"x","norm"),t,n),i=o.shape;if(r){var l=Mr(n,e.shape);i=Oo(o.shape,l)}return o.reshape(i)}function $k(e,t,n){if(n===void 0&&(n=null),e.rank===0)return e.abs();if(e.rank!==1&&n===null)return $k(e.reshape([-1]),t,n);if(e.rank===1||typeof n=="number"||n instanceof Array&&n.length===1){if(t===1)return e.abs().sum(n);if(t===1/0)return e.abs().max(n);if(t===-1/0)return e.abs().min(n);if(t==="euclidean"||t===2)return e.abs().pow(Ot(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(n instanceof Array&&n.length===2){if(t===1)return e.abs().sum(n[0]).max(n[1]-1);if(t===1/0)return e.abs().sum(n[1]).max(n[0]);if(t===-1/0)return e.abs().sum(n[1]).min(n[0]);if(t==="fro"||t==="euclidean")return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+n)}var Bk=ut({norm_:EK});function kK(e,t,n){var r=H(e,"x","unsortedSegmentSum"),o=H(t,"segmentIds","unsortedSegmentSum","int32");return et(Mo(n),"numSegments must be of dtype int"),rt.engine.runKernel(function(i){return i.unsortedSegmentSum(r,o,n)},{$x:r},function(i){return{$x:function(){return TK(i,o)}}})}function RK(e,t,n){n===void 0&&(n=0);var r=H(e,"x","gather"),o=H(t,"indices","gather","int32");return n=Mr(n,r.shape)[0],rt.engine.runKernel(function(i){return i.gather(r,o,n)},{$x:r},function(i){return{$x:function(){if(n===0)return cv(i,o,r.shape[n]);var l=r.shape,d=o.size,p=l.slice(0,n),h=p.length,g=l.slice(n,l.length).slice(1),y=g.length,x=YC(0,h),C=YC(h+1,h+1+y),_=QC([p,[d],g]),k=i.reshape(_),A=o.reshape([d]),I=QC([[h],x,C]),N=k.transpose(I),D=cv(N,A,r.shape[n]),M=u0(I);return D=D.transpose(M)}}})}function YC(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function QC(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}function TK(e,t){for(var n=qp(t,Sn(t)),r=Lk(e,n),o=Pk(t,Ot(0,"int32")),i=r.rank-o.rank,l=0;l<i;++l)o=To(o,l+1);o=x0(o,Hi(r.shape,"bool"));var d=Sn(r);return w0(o,r,d)}var Lk=ut({gather_:RK}),cv=ut({unsortedSegmentSum_:kK});function DK(e,t,n,r){for(var o=H(t,"data","multiRNNCell"),i=sp(n,"c","multiRNNCell"),l=sp(r,"h","multiRNNCell"),d=o,p=[],h=0;h<e.length;h++){var g=e[h](d,i[h],l[h]);p.push(g[0]),p.push(g[1]),d=g[1]}var y=[],x=[];for(h=0;h<p.length;h+=2)y.push(p[h]),x.push(p[h+1]);return[y,x]}function AK(e,t,n,r,o,i){var l=H(e,"forgetBias","basicLSTMCell"),d=H(t,"lstmKernel","basicLSTMCell"),p=H(n,"lstmBias","basicLSTMCell"),h=H(r,"data","basicLSTMCell"),g=H(o,"c","basicLSTMCell"),y=H(i,"h","basicLSTMCell"),x=h.concat(y,1).matMul(d).add(p),C=x.shape[0],_=x.shape[1]/4,k=[C,_],A=x.slice([0,0],k),I=x.slice([0,_],k),N=x.slice([0,2*_],k),D=x.slice([0,3*_],k),M=A.sigmoid().mulStrict(I.tanh()).addStrict(g.mulStrict(l.add(N).sigmoid()));return[M,M.tanh().mulStrict(D.sigmoid())]}var IK=ut({basicLSTMCell_:AK}),NK=ut({multiRNNCell_:DK});function PK(e,t,n,r,o){o===void 0&&(o=!0);var i=H(e,"v","movingAverage"),l=H(t,"x","movingAverage"),d=H(n,"decay","movingAverage");MU(i,l),et(Ar(i.shape,l.shape),"Shape mismatch in v and x");var p=Ot(1),h=p.sub(d),g=l.sub(i).mul(h);if(o){et(r!=null,"When using zeroDebias: true, step is required.");var y=H(r,"step","movingAverage");g=g.div(p.sub(Ok(d,y)))}return i.add(g)}var MK=ut({movingAverage_:PK});function OK(e,t,n,r,o,i,l,d,p){if(o===void 0&&(o=0),i===void 0&&(i=0),l===void 0&&(l=0),d===void 0&&(d=0),p===void 0&&(p=0),l!==0)throw new Error("ellipsis mask is not yet supported");if(d!==0)throw new Error("new axis mask is not yet supported");var h=H(e,"x","stridedSlice");return rt.engine.runKernel(function(g){return g.stridedSlice(h,t,n,r,o,i,l,d,p)},{$x:h})}var FK=ut({stridedSlice_:OK});function $K(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=H(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=rt.engine.runKernel(function(l){return l.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}var BK=ut({topk_:$K});function LK(e,t,n){var r=H(e,"indices","scatterND","int32"),o=H(t,"updates","scatterND");return az(o,r,n),rt.engine.runKernel(function(i){return i.scatterND(r,o,n)},{$indices:r,$updates:o})}var WK=ut({scatterND_:LK});function UK(e){et(e.dtype==="complex64","The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+".");var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return rt.engine.runKernel(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}function zK(e){et(e.dtype==="complex64","The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+".");var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return rt.engine.runKernel(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}function VK(e){et(e.dtype==="float32",`The dtype for rfft() must be real value but
    got `+e.dtype);var t=e.shape[e.shape.length-1],n=e.size/t,r=e.zerosLike(),o=Xr(e,r).as2D(n,t),i=C0(o),l=Math.floor(t/2)+1,d=Ga(i),p=Ds(i),h=d.split([l,t-l],d.shape.length-1),g=p.split([l,t-l],p.shape.length-1),y=e.shape.slice();return y[e.shape.length-1]=l,Xr(h[0],g[0]).reshape(y)}function HK(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=dp(r);return Ga(o)}var i=[n,2*(t-1)],l=Ga(e).as2D(n,t),d=Ds(e).as2D(n,t),p=l.slice([0,1],[n,t-2]).reverse(1),h=d.slice([0,1],[n,t-2]).reverse(1).mul(Ot(-1)),g=l.concat(p,1),y=d.concat(h,1);return r=Xr(g,y).as2D(i[0],i[1]),o=dp(r),Ga(o)}var C0=ut({fft_:UK}),dp=ut({ifft_:zK}),Wk=ut({rfft_:VK}),Uk=ut({irfft_:HK}),GK=Object.freeze({fft:C0,ifft:dp,rfft:Wk,irfft:Uk});function qK(e,t,n,r){if(e.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var l=t.size;if(t.rank!==0&&(t.rank!==1||l!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function jK(e,t,n,r){var o=H(e,"sparseIndices","sparseToDense","int32"),i=H(t,"sparseValues","sparseToDense"),l=H(r,"defaultValue","sparseToDense",i.dtype);return qK(o,i,n,l),rt.engine.runKernel(function(d){return d.sparseToDense(o,i,n,l)},{$sparseIndices:o,$sparseValues:i,$defaultValue:l})}var KK=ut({sparseToDense_:jK});function XK(e,t){var n=H(t,"indices","gatherND","int32"),r=H(e,"x","gatherND");return rt.engine.runKernel(function(o){return o.gatherND(r,n)},{$x:r,$indices:n})}var Rr,YK=ut({gatherND_:XK});function QK(e,t,n){n===void 0&&(n=Rr.SUM_BY_NONZERO_WEIGHTS);var r=H(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=H(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(n===Rr.NONE)return i;if(n===Rr.SUM)return i.sum();if(n===Rr.MEAN){if(o==null)return i.mean();var l=ue(r.shape)/ue(o.shape),d=i.sum().div(o.sum());return l>1?d.div(Ot(l)):d}if(n===Rr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(Ot(r.size));var p=o.mul(Hi(r.shape)).notEqual(Ot(0)).sum().toFloat();return i.sum().div(p)}throw Error("Unknown reduction: "+n)}function JK(e,t,n,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var o=H(e,"labels","absoluteDifference"),i=H(t,"predictions","absoluteDifference"),l=null;n!=null&&(l=H(n,"weights","absoluteDifference")),on(o.shape,i.shape,"Error in absoluteDifference: ");var d=o.sub(i).abs();return ni(d,l,r)}function ZK(e,t,n,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var o=H(e,"labels","meanSquaredError"),i=H(t,"predictions","meanSquaredError"),l=null;n!=null&&(l=H(n,"weights","meanSquaredError")),on(o.shape,i.shape,"Error in meanSquaredError: ");var d=o.squaredDifference(i);return ni(d,l,r)}function tX(e,t,n,r,o){o===void 0&&(o=Rr.SUM_BY_NONZERO_WEIGHTS);var i=H(e,"labels","cosineDistance"),l=H(t,"predictions","cosineDistance"),d=null;r!=null&&(d=H(r,"weights","cosineDistance")),on(i.shape,l.shape,"Error in cosineDistance: ");var p=Ot(1).sub(i.mul(l).sum(n,!0));return ni(p,d,o)}function eX(e,t,n,r){r===void 0&&(r=Rr.SUM_BY_NONZERO_WEIGHTS);var o=H(e,"labels","hingeLoss"),i=H(t,"predictions","hingeLoss"),l=null;n!=null&&(l=H(n,"weights","hingeLoss")),on(o.shape,i.shape,"Error in hingeLoss: ");var d=Ot(1);o=Ot(2).mul(o).sub(d);var p=d.sub(o.mul(i)).relu();return ni(p,l,r)}function nX(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Rr.SUM_BY_NONZERO_WEIGHTS);var i=H(e,"labels","logLoss"),l=H(t,"predictions","logLoss"),d=null;n!=null&&(d=H(n,"weights","logLoss")),on(i.shape,l.shape,"Error in logLoss: ");var p=Ot(1),h=Ot(r),g=i.mul(l.add(h).log()).neg().sub(p.sub(i).mul(p.sub(l).add(h).log()));return ni(g,d,o)}function rX(e,t){var n=H(e,"labels","sigmoidCrossEntropyWithLogits"),r=H(t,"logits","sigmoidCrossEntropyWithLogits");on(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),l=r.abs().neg().exp().log1p();return o.sub(i).add(l)}function oX(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Rr.SUM_BY_NONZERO_WEIGHTS);var i=H(e,"multiClassLabels","sigmoidCrossEntropy"),l=H(t,"logits","sigmoidCrossEntropy"),d=null;if(n!=null&&(d=H(n,"weights","sigmoidCrossEntropy")),on(i.shape,l.shape,"Error in sigmoidCrossEntropy: "),r>0){var p=Ot(r),h=Ot(1),g=Ot(.5);i=i.mul(h.sub(p)).add(g.mul(p))}var y=rX(i,l);return ni(y,d,o)}function aX(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Rr.SUM_BY_NONZERO_WEIGHTS);var i=H(e,"labels","huberLoss"),l=H(t,"predictions","huberLoss"),d=null;n!=null&&(d=H(n,"weights","huberLoss")),on(i.shape,l.shape,"Error in huberLoss: ");var p=Ot(r),h=l.sub(i).abs(),g=b0(h,p),y=h.sub(g),x=Ot(.5).mul(g.square()).add(p.mul(y));return ni(x,d,o)}function iX(e,t,n){if(n===void 0&&(n=-1),n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return id(function(r,o){var i=o.logSumExp([n],!0),l=o.toFloat().sub(i);return{value:l.mul(r).neg().sum([n]),gradFunc:function(d){var p=Oo(d.shape,[n]);return[d.reshape(p).mul(r.toFloat().sub(l.exp())),d.reshape(p).mul(l.exp().sub(r.toFloat()))]}}})(e,t)}function sX(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Rr.SUM_BY_NONZERO_WEIGHTS);var i=H(e,"onehotLabels","softmaxCrossEntropy"),l=H(t,"logits","softmaxCrossEntropy"),d=null;if(n!=null&&(d=H(n,"weights","softmaxCrossEntropy")),on(i.shape,l.shape,"Error in softmaxCrossEntropy: "),r>0){var p=Ot(r),h=Ot(1),g=Ot(i.shape[1]);i=i.mul(h.sub(p)).add(p.div(g))}var y=iX(i,l);return ni(y,d,o)}(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Rr||(Rr={}));var uX=ut({absoluteDifference_:JK}),ni=ut({computeWeightedLoss_:QK}),cX=ut({cosineDistance_:tX}),lX=ut({hingeLoss_:eX}),dX=ut({huberLoss_:aX}),fX=ut({logLoss_:nX}),pX=ut({meanSquaredError_:ZK}),hX=ut({sigmoidCrossEntropy_:oX}),mX=ut({softmaxCrossEntropy_:sX}),gX=Object.freeze({get Reduction(){return Rr},absoluteDifference:uX,computeWeightedLoss:ni,cosineDistance:cX,hingeLoss:lX,huberLoss:dX,logLoss:fX,meanSquaredError:pX,sigmoidCrossEntropy:hX,softmaxCrossEntropy:mX});function vX(e){var t;if(Array.isArray(e)){t=!1,et(e!=null&&e.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=e[0].shape[0],r=1;r<e.length;++r)et(e[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[r].shape[0]+" vs. "+n+")")}else t=!0,e=h0(e,e.shape[0],0).map(function(d){return xk(d,[0])});et(e.length<=e[0].shape[0],"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+").");var o=[],i=e,l=function(d){o.push(rt.engine.tidy(function(){var p=i[d];if(d>0)for(var h=0;h<d;++h){var g=Ik(o[h].mulStrict(p)).mul(o[h]);p=p.sub(g)}return p.div(Bk(p,"euclidean"))}))};for(r=0;r<e.length;++r)l(r);return t?ya(o,0):o}function yX(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return JC(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(i,l){return i*l}),r=[],o=[];return Wr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach(function(i){var l=JC(i,t),d=l[0],p=l[1];r.push(d),o.push(p)}),[ya(r,0).reshape(e.shape),ya(o,0).reshape(e.shape)]}function JC(e,t){return t===void 0&&(t=!1),rt.engine.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=vk(n),i=e.clone(),l=Up([[1]],[1,1]),d=l.clone(),p=n>=r?r:n,h=function(y){var x,C=i,_=d,k=o;x=rt.engine.tidy(function(){var A=i.slice([y,y],[n-y,1]),I=A.norm(),N=i.slice([y,y],[1,1]),D=N.sign().neg(),M=N.sub(D.mul(I)),F=A.div(M);d=F.shape[0]===1?l.clone():l.concat(F.slice([1,0],[F.shape[0]-1,F.shape[1]]),0);var W=D.matMul(M).div(I).neg(),L=i.slice([y,0],[n-y,r]),X=W.mul(d);i=y===0?L.sub(X.matMul(d.transpose().matMul(L))):i.slice([0,0],[y,r]).concat(L.sub(X.matMul(d.transpose().matMul(L))),0);var q=o.slice([0,y],[n,o.shape[1]-y]);return o=y===0?q.sub(q.matMul(d).matMul(X.transpose())):o.slice([0,0],[n,y]).concat(q.sub(q.matMul(d).matMul(X.transpose())),1),[d,i,o]}),d=x[0],i=x[1],o=x[2],ez([C,_,k])},g=0;g<p;++g)h(g);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var bX=ut({gramSchmidt_:vX}),xX=ut({qr_:yX}),wX=Object.freeze({gramSchmidt:bX,qr:xX});function CX(e,t,n){n===void 0&&(n=!1);var r=H(e,"images","resizeBilinear");et(r.rank===3||r.rank===4,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),et(t.length===2,"Error in resizeBilinear: new shape must 2D, but got shape "+t+".");var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],d=t[1],p=rt.engine.runKernel(function(h,g){return h.resizeBilinear(o,l,d,n)},{batchImages:o},function(h,g){return{batchImages:function(){return rt.engine.runKernel(function(y){return y.resizeBilinearBackprop(h,o,n)},{})}}});return i?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function SX(e,t,n){n===void 0&&(n=!1);var r=H(e,"images","resizeNearestNeighbor");et(r.rank===3||r.rank===4,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),et(t.length===2,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),et(r.dtype==="float32"||r.dtype==="int32","`images` must have `int32` or `float32` as dtype");var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],d=t[1],p=rt.engine.runKernel(function(h,g){return h.resizeNearestNeighbor(o,l,d,n)},{batchImages:o},function(h,g){return{batchImages:function(){return rt.engine.runKernel(function(y){return y.resizeNearestNeighborBackprop(h,o,n)},{})}}});return i?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function _X(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=H(e,"boxes","nonMaxSuppression"),l=H(t,"scores","nonMaxSuppression"),d=zk(i,l,n,r,o);return n=d.maxOutputSize,r=d.iouThreshold,o=d.scoreThreshold,rt.engine.runKernel(function(p){return p.nonMaxSuppression(i,l,n,r,o)},{$boxes:i})}function EX(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Je(this,void 0,void 0,function(){var i,l,d,p,h,g;return Ze(this,function(y){switch(y.label){case 0:return i=H(e,"boxes","nonMaxSuppressionAsync"),l=H(t,"scores","nonMaxSuppressionAsync"),d=zk(i,l,n,r,o),n=d.maxOutputSize,r=d.iouThreshold,o=d.scoreThreshold,[4,i.data()];case 1:return p=y.sent(),[4,l.data()];case 2:return h=y.sent(),g=l0(p,h,n,r,o),i!==e&&i.dispose(),l!==t&&l.dispose(),[2,g]}})})}function zk(e,t,n,r,o){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY);var i=e.shape[0];return n=Math.min(n,i),et(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),et(e.rank===2,"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"),et(e.shape[1]===4,"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),et(t.rank===1,"scores must be a 1D tensor"),et(t.shape[0]===i,"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}function kX(e,t,n,r,o,i){var l=H(e,"image","cropAndResize","float32"),d=H(t,"boxes","cropAndResize","float32"),p=H(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var h=d.shape[0];return et(l.rank===4,"Error in cropAndResize: image must be rank 4,but got rank "+l.rank+"."),et(d.rank===2&&d.shape[1]===4,"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+d.shape+"."),et(p.rank===1&&p.shape[0]===h,"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+d.shape+"."),et(r.length===2,"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."),et(r[0]>=1&&r[1]>=1,"cropSize must be atleast [1,1], but was "+r),et(o==="bilinear"||o==="nearest","method must be bilinear or nearest, but was "+o),rt.engine.runKernel(function(g,y){return g.cropAndResize(l,d,p,r,o,i)},{$image:l,$boxes:d})}var RX=ut({resizeBilinear_:CX}),TX=ut({resizeNearestNeighbor_:SX}),DX=ut({nonMaxSuppression_:_X}),AX=EX,IX=kX,Vk=Object.freeze({resizeBilinear:RX,resizeNearestNeighbor:TX,nonMaxSuppression:DX,nonMaxSuppressionAsync:AX,cropAndResize:IX}),NX=Object.freeze({image:Vk,linalg:wX,losses:gX,spectral:GK,op:ut,batchNormalization2d:Bq,batchNormalization3d:Lq,batchNormalization4d:Wq,batchNormalization:ld,complex:Xr,real:Ga,imag:Ds,concat:oo,concat1d:E8,concat2d:k8,concat3d:R8,concat4d:T8,split:h0,conv1d:uj,conv2d:ts,conv3d:cj,conv2dDerFilter:Ek,depthwiseConv2d:y0,separableConv2d:kk,conv2dTranspose:lj,matMul:Vp,dot:Kq,outerProduct:Xq,reverse:pd,reverse1d:gj,reverse2d:vj,reverse3d:yj,reverse4d:bj,maxPool:Kl,avgPool:Hp,pool:Rj,slice:zs,slice1d:Pj,slice2d:Mj,slice3d:Dk,slice4d:Oj,abs:sq,acos:uq,acosh:cq,asin:lq,asinh:dq,atan:fq,atanh:pq,ceil:hq,clipByValue:g0,cos:mq,cosh:gq,erf:vq,exp:sv,expm1:yq,floor:bq,log:xq,log1p:wq,logSigmoid:Cq,neg:up,reciprocal:Sq,round:_q,rsqrt:wk,sigmoid:Ck,sign:Eq,sin:kq,sinh:Rq,softplus:Tq,sqrt:Dq,square:Aq,step:Iq,tan:Nq,tanh:Pq,all:jj,any:Kj,argMax:Xj,argMin:Yj,logSumExp:Qj,max:Gp,mean:Jj,min:Zj,moments:t9,sum:Ik,prod:e9,equal:Nk,equalStrict:h9,greater:m9,greaterEqual:Pk,greaterEqualStrict:g9,greaterStrict:v9,less:y9,lessEqual:b9,lessEqualStrict:x9,lessStrict:w9,notEqual:C9,notEqualStrict:S9,add:nn,addN:G9,addStrict:q9,atan2:j9,div:Ua,divStrict:K9,floorDiv:Mk,maximum:qp,maximumStrict:X9,minimum:b0,minimumStrict:Y9,mod:Q9,modStrict:J9,mul:qa,mulStrict:Z9,pow:Ok,powStrict:tK,squaredDifference:eK,squaredDifferenceStrict:nK,sub:wa,subStrict:rK,elu:yK,leakyRelu:bK,prelu:xK,relu:po,selu:wK,logicalAnd:x0,logicalNot:lK,logicalOr:Fk,logicalXor:dK,where:w0,whereAsync:fK,buffer:Oe,toPixels:G8,print:c7,batchToSpaceND:gk,cast:l7,clone:d7,cumsum:f7,depthToSpace:p7,expandDims:To,eye:vk,fromPixels:yk,multinomial:h7,oneHot:iv,pad:cd,pad1d:m7,pad2d:g7,pad3d:v7,pad4d:y7,rand:b7,randomNormal:x7,randomUniform:w7,reshape:Ho,spaceToBatchND:bk,squeeze:xk,stack:ya,tile:Ju,truncatedNormal:C7,unstack:Wr,setdiff1dAsync:S7,fill:Rl,linspace:wz,ones:Hi,range:KE,scalar:Ot,tensor:Kn,tensor1d:eo,tensor2d:Up,tensor3d:c0,tensor4d:lo,tensor5d:vz,tensor6d:yz,zeros:Fn,onesLike:Cz,zerosLike:Sn,transpose:Gi,softmax:Ys,logSoftmax:pz,localResponseNormalization:_K,norm:Bk,gather:Lk,unsortedSegmentSum:cv,basicLSTMCell:IK,multiRNNCell:NK,movingAverage:MK,stridedSlice:FK,topk:BK,scatterND:WK,fft:C0,ifft:dp,rfft:Wk,irfft:Uk,sparseToDense:KK,gatherND:YK}),PX=function(){function e(){this.blockSize=48,this.firstUse=!0,rt.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return e.prototype.setDataMover=function(t){this.data=new XE(t)},e.prototype.register=function(t,n,r){if(this.firstUse&&(this.firstUse=!1,rt.get("IS_NODE")&&ov(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:r})},e.prototype.write=function(t,n){if(n==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=n},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var r,o;if(rt.get("IS_NODE")&&t.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(t.getContext!=null)r=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)r=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),r=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(n===4)o=new Int32Array(r);else{var i=t.width*t.height;o=new Int32Array(i*n);for(var l=0;l<i;l++)for(var d=0;d<n;++d)o[l*n+d]=r[4*l+d]}return c0(o,[t.height,t.width,n],"int32")},e.prototype.read=function(t){return Je(this,void 0,void 0,function(){return Ze(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),r=n.dtype,o=n.complexTensors;return r==="complex64"?QE(o.real.dataSync(),o.imag.dataSync()):this.data.get(t).values},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Je(this,void 0,void 0,function(){var n;return Ze(this,function(r){return n=np(),t(),[2,{kernelMs:np()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var r=zt.make(t.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:rt.engine.keep(t.clone()),imag:rt.engine.keep(n.clone())},r},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(r){r!=null&&et(r.dtype!=="complex64",n+" does not support complex64 tensors.")})},e.prototype.slice=function(t,n,r){this.assertNotComplex(t,"slice");for(var o=Oe(r,t.dtype),i=0;i<o.size;++i){var l=o.indexToLoc(i),d=l.map(function(p,h){return p+n[h]});o.set.apply(o,[t.get.apply(t,d)].concat(l))}return o.toTensor()},e.prototype.stridedSlice=function(t,n,r,o,i,l,d,p,h){this.assertNotComplex(t,"stridedSlice");var g=qE(t.shape,n,r,o,i,l,d,p,h),y=g[0],x=g[1],C=g[2],_=x.filter(function(M,F){return C.indexOf(F)===-1});if(_.some(function(M){return M===0}))return Kn([],_);for(var k=Oe(x,t.dtype),A=0;A<k.size;A++){for(var I=k.indexToLoc(A),N=new Array(I.length),D=0;D<N.length;D++)N[D]=I[D]*o[D]+y[D];k.set.apply(k,[t.get.apply(t,N)].concat(I))}return k.toTensor().reshape(_)},e.prototype.reverse=function(t,n){this.assertNotComplex(t,"reverse");for(var r=Oe(t.shape,t.dtype),o=t.buffer(),i=function(d){var p=r.indexToLoc(d),h=p.slice();n.forEach(function(g){return h[g]=t.shape[g]-1-h[g]}),r.set.apply(r,[o.get.apply(o,h)].concat(p))},l=0;l<r.size;l++)i(l);return r.toTensor()},e.prototype.concat=function(t,n){this.assertNotComplex(t,"concat");var r=t.map(function(h){var g=ue(h.shape.slice(n));return h.as2D(-1,g)}),o=jl(r.map(function(h){return h.shape}),1),i=Oe(o,t[0].dtype).values;if(r[0].shape[0]===1){var l=0;r.forEach(function(h){i.set(h.dataSync(),l),l+=h.size})}else{var d=0;r.forEach(function(h){for(var g=h.dataSync(),y=0,x=0;x<h.shape[0];++x)for(var C=x*o[1]+d,_=0;_<h.shape[1];++_)i[C+_]=g[y++];d+=h.shape[1]})}var p=jl(t.map(function(h){return h.shape}),n);return Kn(i,p,t[0].dtype)},e.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(Ot(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r+i,imag:o+l}}):this.broadcastedBinaryOp(t,n,lr(t.dtype,n.dtype),function(r,o){return r+o})},e.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var n=t.map(function(p){return p.dataSync()}),r=Oe(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var l=n[i],d=0;d<o.length;d++)o[d]+=l[d];return r.toTensor()},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r-i,imag:o-l}}):this.broadcastedBinaryOp(t,n,lr(t.dtype,n.dtype),function(r,o){return r-o})},e.prototype.pow=function(t,n){return this.assertNotComplex([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.pow(r,o)})},e.prototype.batchMatMul=function(t,n,r,o){this.assertNotComplex([t,n],"matMul");for(var i=r?t.shape[1]:t.shape[2],l=r?t.shape[2]:t.shape[1],d=o?n.shape[1]:n.shape[2],p=t.shape[0],h=t.dataSync(),g=n.dataSync(),y=r?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],x=y[0],C=y[1],_=y[2],k=o?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],A=k[0],I=k[1],N=k[2],D=l*d,M=Oe([p,l,d],t.dtype),F=M.values,W=this.blockSize,L=0;L<p;L++)for(var X=0;X<l;X+=W)for(var q=0;q<d;q+=W)for(var Q=0;Q<i;Q+=W)for(var it=Math.min(X+W,l),at=Math.min(q+W,d),ht=Math.min(Q+W,i),gt=X;gt<it;gt++)for(var Ct=q;Ct<at;Ct++){for(var pt=0,lt=Q;lt<ht;lt++)pt+=h[L*x+gt*C+lt*_]*g[lt*A+Ct*I+L*N];F[L*D+(gt*d+Ct)]+=pt}return M.toTensor()},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r*i-o*l,imag:r*l+o*i}}):this.broadcastedBinaryOp(t,n,lr(t.dtype,n.dtype),function(r,o){return r*o})},e.prototype.realDivide=function(t,n){return this.assertNotComplex([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(r,o){return r/o})},e.prototype.floorDiv=function(t,n){return this.assertNotComplex([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(r,o){return Math.floor(r/o)})},e.prototype.sum=function(t,n){this.assertNotComplex(t,"sum"),Qr("sum",n,t.rank);for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,lr(t.dtype,"int32")),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=0,C=0;C<d;++C)x+=h[y+C];p[g]=x}return l},e.prototype.prod=function(t,n){this.assertNotComplex(t,"sum");for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,lr(t.dtype,"int32")),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=1,C=0;C<d;++C)x*=h[y+C];p[g]=x}return l},e.prototype.unsortedSegmentSum=function(t,n,r){this.assertNotComplex(t,"unsortedSegmentSum");for(var o=[],i=t.rank-n.rank,l=0;l<i;++l)n=n.expandDims(l+1);for(l=0;l<r;++l){var d=Ot(l,"int32"),p=Nk(d,n).asType("float32").mul(t).sum(0);o.push(p)}return ya(o)},e.prototype.argMin=function(t,n){this.assertNotComplex(t,"argMin");var r=[n];Qr("argMin",r,t.rank);for(var o=sr(t.shape,r),i=o[0],l=o[1],d=Fn(i,"int32"),p=ue(l),h=d.dataSync(),g=t.dataSync(),y=0;y<h.length;++y){for(var x=y*p,C=g[x],_=0,k=0;k<p;++k){var A=g[x+k];A<C&&(C=A,_=k)}h[y]=_}return d},e.prototype.argMax=function(t,n){this.assertNotComplex(t,"argMax");var r=[n];Qr("argMax",r,t.rank);for(var o=sr(t.shape,r),i=o[0],l=o[1],d=Fn(i,"int32"),p=ue(l),h=d.dataSync(),g=t.dataSync(),y=0;y<h.length;++y){for(var x=y*p,C=g[x],_=0,k=0;k<p;++k){var A=g[x+k];A>C&&(C=A,_=k)}h[y]=_}return d},e.prototype.cumsum=function(t,n,r,o){if(this.assertNotComplex(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var i=lr(t.dtype,"int32"),l=Fn(t.shape,i),d=l.dataSync(),p=t.dataSync(),h=t.shape[t.rank-1],g=o?function(k,A){return k+h-A-1}:function(k,A){return k+A},y=0;y<p.length;y+=h)for(var x=0;x<h;x++){var C=g(y,x);if(x===0)d[C]=r?0:p[C];else{var _=g(y,x-1);d[C]=r?p[_]+d[_]:p[C]+d[_]}}return l},e.prototype.equal=function(t,n){return this.assertNotComplex([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r===o?1:0})},e.prototype.notEqual=function(t,n){return this.assertNotComplex([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r!==o?1:0})},e.prototype.less=function(t,n){return this.assertNotComplex([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r<o?1:0})},e.prototype.lessEqual=function(t,n){return this.assertNotComplex([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r<=o?1:0})},e.prototype.greater=function(t,n){return this.assertNotComplex([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r>o?1:0})},e.prototype.greaterEqual=function(t,n){return this.assertNotComplex([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r>=o?1:0})},e.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var n=t.dataSync(),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n[o]?0:1;return zt.make(t.shape,{values:r},"bool")},e.prototype.logicalAnd=function(t,n){return this.assertNotComplex([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r&&o})},e.prototype.logicalOr=function(t,n){return this.assertNotComplex([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r||o})},e.prototype.select=function(t,n,r){this.assertNotComplex([t,n,r],"select");for(var o=t.dataSync(),i=n.dataSync(),l=r.dataSync(),d=Fn(n.shape,lr(n.dtype,r.dtype)),p=d.dataSync(),h=0,g=t.rank===0||t.rank>1||n.rank===1?1:n.shape[1],y=0;y<o.length;y++)for(var x=0;x<g;x++)o[y]===1?p[h++]=i[y]:p[h++]=l[y];return d},e.prototype.where=function(t){this.assertNotComplex([t],"where");var n=t.dataSync();return m0(t.shape,n)},e.prototype.topk=function(t,n,r){return this.assertNotComplex(t,"topk"),ZE(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){this.assertNotComplex(t,"min"),Qr("min",n,t.rank);for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,t.dtype),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];_<x&&(x=_)}p[g]=x}return l},e.prototype.minimum=function(t,n){return this.assertNotComplex([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.min(r,o)})},e.prototype.mod=function(t,n){return this.assertNotComplex([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){var i=r%o;return r<0&&o<0||r>=0&&o>=0?i:(i+o)%o})},e.prototype.max=function(t,n){this.assertNotComplex(t,"max"),Qr("max",n,t.rank);for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,t.dtype),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];_>x&&(x=_)}p[g]=x}return l},e.prototype.maximum=function(t,n){return this.assertNotComplex([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.max(r,o)})},e.prototype.all=function(t,n){this.assertNotComplex(t,"all"),Qr("all",n,t.rank);for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,t.dtype),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];x=x&&_}p[g]=x}return l},e.prototype.any=function(t,n){this.assertNotComplex(t,"any"),Qr("any",n,t.rank);for(var r=sr(t.shape,n),o=r[0],i=r[1],l=Fn(o,t.dtype),d=ue(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];x=x||_}p[g]=x}return l},e.prototype.squaredDifference=function(t,n){return this.assertNotComplex([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){var i=r-o;return i*i})},e.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.ceil(n[o]);return zt.make(t.shape,{values:r})},e.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.floor(n[o]);return zt.make(t.shape,{values:r})},e.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)n[o]<0?r[o]=-1:n[o]>0?r[o]=1:r[o]=0;return zt.make(t.shape,{values:r})},e.prototype.round=function(t){this.assertNotComplex(t,"round");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=Math.floor(n[o]);n[o]-i<.5?r[o]=Math.floor(n[o]):n[o]-i>.5?r[o]=Math.ceil(n[o]):r[o]=i%2==0?i:i+1}return zt.make(t.shape,{values:r})},e.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.exp(n[o]);return zt.make(t.shape,{values:r})},e.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.expm1(n[o]);return zt.make(t.shape,{values:r})},e.prototype.log=function(t){this.assertNotComplex(t,"log");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.log(i)}return zt.make(t.shape,{values:r})},e.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.log1p(i)}return zt.make(t.shape,{values:r})},e.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.sqrt(i)}return zt.make(t.shape,{values:r})},e.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=1/Math.sqrt(i)}return zt.make(t.shape,{values:r})},e.prototype.square=function(t){this.assertNotComplex(t,"square");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=i*i}return zt.make(t.shape,{values:r})},e.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=1/n[o];return zt.make(t.shape,{values:r})},e.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var n=Fn(t.shape,t.dtype),r=n.dataSync(),o=t.dataSync(),i=0;i<o.length;++i)r[i]=Math.max(0,o[i]);return n},e.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i=r[o];n[o]=i>=0?i:Math.exp(i)-1}return zt.make(t.shape,{values:n})},e.prototype.eluDer=function(t,n){this.assertNotComplex([t,n],"eluDer");for(var r=new Float32Array(n.size),o=n.dataSync(),i=t.dataSync(),l=0;l<o.length;++l){var d=o[l];r[l]=d>=1?i[l]:i[l]*(d+1)}return zt.make(n.shape,{values:r})},e.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var n=f0,r=p0,o=new Float32Array(t.size),i=t.dataSync(),l=0;l<i.length;++l){var d=i[l];o[l]=d>=0?r*d:n*(Math.exp(d)-1)}return zt.make(t.shape,{values:o})},e.prototype.clip=function(t,n,r){this.assertNotComplex(t,"clip");for(var o=new Float32Array(t.size),i=t.dataSync(),l=0;l<i.length;++l){var d=i[l];o[l]=d>r?r:d<n?n:d}return zt.make(t.shape,{values:o})},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.abs(r[o]);return zt.make(t.shape,{values:n})},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<t.size;++o){var i=r[2*o],l=r[2*o+1];n[o]=Math.hypot(i,l)}return zt.make(t.shape,{values:n})},e.prototype.int=function(t){this.assertNotComplex(t,"int");for(var n=new Int32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=r[o];return zt.make(t.shape,{values:n},"int32")},e.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=1/(1+Math.exp(-r[o]));return zt.make(t.shape,{values:n})},e.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var l=o[i]>-n,d=o[i]<n,p=Math.exp(o[i]),h=void 0;h=d?p:l?o[i]:Math.log(1+p),r[i]=h}return zt.make(t.shape,{values:r})},e.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.sin(r[o]);return zt.make(t.shape,{values:n})},e.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.cos(r[o]);return zt.make(t.shape,{values:n})},e.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.tan(r[o]);return zt.make(t.shape,{values:n})},e.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.asin(r[o]);return zt.make(t.shape,{values:n})},e.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.acos(r[o]);return zt.make(t.shape,{values:n})},e.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.atan(r[o]);return zt.make(t.shape,{values:n})},e.prototype.atan2=function(t,n){return this.assertNotComplex([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.atan2(r,o)})},e.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.sinh(r[o]);return zt.make(t.shape,{values:n})},e.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.cosh(r[o]);return zt.make(t.shape,{values:n})},e.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=gU(r[o]);return zt.make(t.shape,{values:n})},e.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.asinh(r[o]);return zt.make(t.shape,{values:n})},e.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.acosh(r[o]);return zt.make(t.shape,{values:n})},e.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.atanh(r[o]);return zt.make(t.shape,{values:n})},e.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var n=new Float32Array(t.size),r=t.dataSync(),o=uk,i=ck,l=lk,d=dk,p=fk,h=pk,g=0;g<r.length;++g){var y=r[g],x=1/(1+o*y);n[g]=1-((((h*x+p)*x+d)*x+l)*x+i)*x*Math.exp(-y*y)}return zt.make(t.shape,{values:n})},e.prototype.step=function(t,n){n===void 0&&(n=0),this.assertNotComplex(t,"step");for(var r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var l=o[i];isNaN(l)?r[i]=NaN:r[i]=l>0?1:n}return zt.make(t.shape,{values:r})},e.prototype.conv2d=function(t,n,r){this.assertNotComplex([t,n],"conv2d");for(var o=r.filterHeight,i=r.filterWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.padInfo.left,h=r.padInfo.top,g=Oe(r.outShape,t.dtype),y=t.dataSync(),x=n.dataSync(),C=g.values,_=0;_<r.batchSize;++_)for(var k=_*t.strides[0],A=_*g.strides[0],I=0;I<r.outHeight;++I)for(var N=A+I*g.strides[1],D=I*r.strideHeight-p,M=0;M<o;M++){var F=D+M*l;if(!(F<0||F>=r.inHeight))for(var W=M*n.strides[0],L=k+F*t.strides[1],X=0;X<r.outWidth;++X)for(var q=N+X*r.outChannels,Q=X*r.strideWidth-h,it=0;it<i;it++){var at=Q+it*d;if(!(at<0||at>=r.inWidth))for(var ht=W+it*n.strides[1],gt=L+at*r.inChannels,Ct=ht,pt=0;pt<r.inChannels;++pt){for(var lt=y[gt+pt],ft=0;ft<r.outChannels;++ft)C[q+ft]+=lt*x[Ct+ft];Ct+=r.outChannels}}}return g.toTensor()},e.prototype.conv3d=function(t,n,r){for(var o=r.filterDepth,i=r.filterHeight,l=r.filterWidth,d=r.dilationDepth,p=r.dilationHeight,h=r.dilationWidth,g=r.padInfo.front,y=r.padInfo.left,x=r.padInfo.top,C=Oe(r.outShape,t.dtype),_=t.dataSync(),k=n.dataSync(),A=C.values,I=0;I<r.batchSize;++I)for(var N=I*t.strides[0],D=I*C.strides[0],M=0;M<r.outDepth;++M)for(var F=D+M*C.strides[1],W=M*r.strideDepth-g,L=0;L<o;L++){var X=W+L*d;if(!(X<0||X>=r.inDepth))for(var q=L*n.strides[0],Q=N+X*t.strides[1],it=0;it<r.outHeight;++it)for(var at=F+it*C.strides[2],ht=it*r.strideHeight-x,gt=0;gt<i;gt++){var Ct=ht+gt*p;if(!(Ct<0||Ct>=r.inHeight))for(var pt=q+gt*n.strides[1],lt=Q+Ct*t.strides[2],ft=0;ft<r.outWidth;++ft)for(var Tt=at+ft*r.outChannels,Pt=ft*r.strideWidth-y,Bt=0;Bt<l;Bt++){var Ut=Pt+Bt*h;if(!(Ut<0||Ut>=r.inWidth))for(var Zt=pt+Bt*n.strides[2],Xt=lt+Ut*r.inChannels,ce=Zt,fe=0;fe<r.inChannels;++fe){for(var se=_[Xt+fe],jt=0;jt<r.outChannels;++jt)A[Tt+jt]+=se*k[ce+jt];ce+=r.outChannels}}}}return C.toTensor()},e.prototype.conv2dDerInput=function(t,n,r){this.assertNotComplex([t,n],"conv2dDerInput");for(var o=Oe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=t.dataSync(),y=t.strides,x=y[0],C=y[1],_=y[2],k=n.dataSync(),A=n.strides,I=A[0],N=A[1],D=A[2],M=r.batchSize,F=r.filterHeight,W=r.filterWidth,L=r.inChannels,X=r.inHeight,q=r.inWidth,Q=r.outChannels,it=r.outHeight,at=r.outWidth,ht=r.strideHeight,gt=r.strideWidth,Ct=F-1-r.padInfo.top,pt=W-1-r.padInfo.left,lt=0;lt<M;++lt)for(var ft=0;ft<L;++ft)for(var Tt=0;Tt<X;++Tt)for(var Pt=Tt-Ct,Bt=Math.max(0,Math.ceil(Pt/ht)),Ut=Math.min(it,(F+Pt)/ht),Zt=0;Zt<q;++Zt){for(var Xt=Zt-pt,ce=Math.max(0,Math.ceil(Xt/gt)),fe=Math.min(at,(W+Xt)/gt),se=0,jt=Bt;jt<Ut;++jt)for(var Pe=jt*ht-Pt,re=ce;re<fe;++re)for(var _e=x*lt+C*jt+_*re,Y=I*(F-1-Pe)+N*(W-1-(re*gt-Xt))+D*ft,nt=0;nt<Q;++nt)se+=g[_e+nt]*k[Y+nt];i[d*lt+p*Tt+h*Zt+ft]=se}return o.toTensor()},e.prototype.conv3dDerInput=function(t,n,r){for(var o=Oe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=l[3],y=t.dataSync(),x=t.strides,C=x[0],_=x[1],k=x[2],A=x[3],I=n.dataSync(),N=n.strides,D=N[0],M=N[1],F=N[2],W=N[3],L=r.batchSize,X=r.filterDepth,q=r.filterHeight,Q=r.filterWidth,it=r.inChannels,at=r.inDepth,ht=r.inHeight,gt=r.inWidth,Ct=r.outChannels,pt=r.outDepth,lt=r.outHeight,ft=r.outWidth,Tt=r.strideDepth,Pt=r.strideHeight,Bt=r.strideWidth,Ut=X-1-r.padInfo.front,Zt=q-1-r.padInfo.top,Xt=Q-1-r.padInfo.left,ce=0;ce<L;++ce)for(var fe=0;fe<it;++fe)for(var se=0;se<at;++se)for(var jt=se-Ut,Pe=Math.max(0,Math.ceil(jt/Tt)),re=Math.min(pt,(X+jt)/Tt),_e=0;_e<ht;++_e)for(var Y=_e-Zt,nt=Math.max(0,Math.ceil(Y/Pt)),mt=Math.min(lt,(q+Y)/Pt),Et=0;Et<gt;++Et){for(var St=Et-Xt,Dt=Math.max(0,Math.ceil(St/Bt)),$t=Math.min(ft,(Q+St)/Bt),Ft=0,It=Pe;It<re;++It)for(var Rt=It*Tt-jt,Ht=nt;Ht<mt;++Ht)for(var Wt=Ht*Pt-Y,Yt=Dt;Yt<$t;++Yt)for(var he=C*ce+_*It+k*Ht+A*Yt,Ce=D*(X-1-Rt)+M*(q-1-Wt)+F*(Q-1-(Yt*Bt-St))+W*fe,Ee=0;Ee<Ct;++Ee)Ft+=y[he+Ee]*I[Ce+Ee];i[d*ce+p*se+h*_e+g*Et+fe]=Ft}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,n,r){this.assertNotComplex([t,n],"conv2dDerFilter");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=Oe(r.filterShape,"float32"),h=r.padInfo.left,g=r.padInfo.top,y=0;y<l;++y)for(var x=Math.max(0,Math.ceil((g-y)/o)),C=Math.min(r.outHeight,(r.inHeight+g-y)/o),_=0;_<d;++_)for(var k=Math.max(0,Math.ceil((h-_)/i)),A=Math.min(r.outWidth,(r.inWidth+h-_)/i),I=0;I<r.inChannels;++I)for(var N=0;N<r.outChannels;++N){for(var D=0,M=0;M<r.batchSize;++M)for(var F=x;F<C;++F)for(var W=y+F*o-g,L=k;L<A;++L){var X=_+L*i-h;D+=t.get(M,W,X,I)*n.get(M,F,L,N)}p.set(D,y,_,I,N)}return p.toTensor()},e.prototype.conv3dDerFilter=function(t,n,r){for(var o=r.strideDepth,i=r.strideHeight,l=r.strideWidth,d=r.filterDepth,p=r.filterHeight,h=r.filterWidth,g=Oe(r.filterShape,"float32"),y=g.values,x=g.strides,C=x[0],_=x[1],k=x[2],A=x[3],I=n.dataSync(),N=n.strides,D=N[0],M=N[1],F=N[2],W=N[3],L=t.dataSync(),X=t.strides,q=X[0],Q=X[1],it=X[2],at=X[3],ht=r.padInfo.front,gt=r.padInfo.left,Ct=r.padInfo.top,pt=0;pt<d;++pt)for(var lt=Math.max(0,Math.ceil((ht-pt)/o)),ft=Math.min(r.outDepth,(r.inDepth+ht-pt)/o),Tt=pt*C,Pt=0;Pt<p;++Pt)for(var Bt=Math.max(0,Math.ceil((Ct-Pt)/i)),Ut=Math.min(r.outHeight,(r.inHeight+Ct-Pt)/i),Zt=Pt*_+Tt,Xt=0;Xt<h;++Xt)for(var ce=Math.max(0,Math.ceil((gt-Xt)/l)),fe=Math.min(r.outWidth,(r.inWidth+gt-Xt)/l),se=Xt*k+Zt,jt=0;jt<r.inChannels;++jt)for(var Pe=jt*A+se,re=0;re<r.outChannels;++re){for(var _e=0,Y=0;Y<r.batchSize;++Y)for(var nt=Y*q,mt=Y*D,Et=lt;Et<ft;++Et)for(var St=(pt+Et*o-ht)*Q+nt,Dt=Et*M+mt,$t=Bt;$t<Ut;++$t)for(var Ft=(Pt+$t*i-Ct)*it+St,It=$t*F+Dt,Rt=ce;Rt<fe;++Rt){var Ht=Rt*W+It;_e+=L[(Xt+Rt*l-gt)*at+Ft+jt]*I[Ht+re]}y[Pe+re]=_e}return g.toTensor()},e.prototype.depthwiseConv2D=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2D");for(var o=r.filterHeight,i=r.filterWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.padInfo.left,h=r.padInfo.top,g=r.outChannels/r.inChannels,y=Oe(r.outShape,t.dtype),x=t.dataSync(),C=n.dataSync(),_=y.values,k=0;k<r.batchSize;++k)for(var A=k*t.strides[0],I=k*y.strides[0],N=0;N<r.outHeight;++N)for(var D=I+N*y.strides[1],M=N*r.strideHeight-p,F=0;F<o;++F){var W=M+F*l;if(!(W<0||W>=r.inHeight))for(var L=F*n.strides[0],X=A+W*t.strides[1],q=0;q<r.outWidth;++q)for(var Q=D+q*y.strides[2],it=q*r.strideWidth-h,at=0;at<i;++at){var ht=it+at*d;if(!(ht<0||ht>=r.inWidth))for(var gt=L+at*n.strides[1],Ct=X+ht*r.inChannels,pt=Q,lt=gt,ft=0;ft<r.inChannels;++ft){for(var Tt=x[Ct+ft],Pt=0;Pt<g;++Pt)_[pt+Pt]+=Tt*C[lt+Pt];pt+=g,lt+=g}}}return y.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2DDerInput");for(var o=Oe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=t.dataSync(),y=t.strides,x=y[0],C=y[1],_=y[2],k=n.dataSync(),A=n.strides,I=A[0],N=A[1],D=A[2],M=r.batchSize,F=r.filterHeight,W=r.filterWidth,L=r.inChannels,X=r.inHeight,q=r.inWidth,Q=r.outChannels,it=r.outHeight,at=r.outWidth,ht=r.strideHeight,gt=r.strideWidth,Ct=F-1-r.padInfo.top,pt=W-1-r.padInfo.left,lt=Q/L,ft=0;ft<M;++ft)for(var Tt=0;Tt<L;++Tt)for(var Pt=0;Pt<X;++Pt)for(var Bt=Pt-Ct,Ut=Math.max(0,Math.ceil(Bt/ht)),Zt=Math.min(it,(F+Bt)/ht),Xt=0;Xt<q;++Xt){for(var ce=Xt-pt,fe=Math.max(0,Math.ceil(ce/gt)),se=Math.min(at,(W+ce)/gt),jt=0,Pe=Ut;Pe<Zt;++Pe)for(var re=Pe*ht-Bt,_e=fe;_e<se;++_e)for(var Y=x*ft+C*Pe+_*_e,nt=I*(F-1-re)+N*(W-1-(_e*gt-ce))+D*Tt,mt=0;mt<lt;++mt)jt+=g[Y+(Tt*lt+mt)]*k[nt+mt];i[d*ft+p*Pt+h*Xt+Tt]=jt}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2DDerFilter");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=Oe(r.filterShape,"float32"),h=r.padInfo.left,g=r.padInfo.top,y=r.outChannels/r.inChannels,x=0;x<l;++x)for(var C=Math.max(0,Math.ceil((g-x)/o)),_=Math.min(r.outHeight,(r.inHeight+g-x)/o),k=0;k<d;++k)for(var A=Math.max(0,Math.ceil((h-k)/i)),I=Math.min(r.outWidth,(r.inWidth+h-k)/i),N=0;N<r.outChannels;++N){for(var D=Math.trunc(N/y),M=N%y,F=0,W=0;W<r.batchSize;++W)for(var L=C;L<_;++L)for(var X=x+L*o-g,q=A;q<I;++q){var Q=k+q*i-h;F+=t.get(W,X,Q,D)*n.get(W,L,q,N)}p.set(F,x,k,D,M)}return p.toTensor()},e.prototype.tile=function(t,n){this.assertNotComplex(t,"tile");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[o]*n[o];var i=Oe(r,t.dtype),l=t.buffer();for(o=0;o<i.values.length;++o){for(var d=i.indexToLoc(o),p=new Array(t.rank),h=0;h<p.length;h++)p[h]=d[h]%t.shape[h];var g=l.locToIndex(p);i.values[o]=l.values[g]}return i.toTensor()},e.prototype.pad=function(t,n,r){this.assertNotComplex(t,"pad");var o=n.map(function(y,x){return y[0]+t.shape[x]+y[1]}),i=n.map(function(y){return y[0]}),l=t.buffer(),d=Oe(o,t.dtype);r!==0&&d.values.fill(r);for(var p=0;p<t.size;p++){var h=l.indexToLoc(p),g=h.map(function(y,x){return y+i[x]});d.set.apply(d,[t.get.apply(t,h)].concat(g))}return d.toTensor()},e.prototype.transpose=function(t,n){this.assertNotComplex(t,"transpose");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[n[o]];var i=t.dataSync(),l=Oe(r,t.dtype),d=t.buffer();for(o=0;o<t.size;++o){for(var p=d.indexToLoc(o),h=new Array(p.length),g=0;g<h.length;g++)h[g]=p[n[g]];var y=l.locToIndex(h);l.values[y]=i[o]}return l.toTensor()},e.prototype.gather=function(t,n,r){this.assertNotComplex([t,n],"gather");var o=t.shape.slice(),i=n.dataSync();o[r]=i.length;for(var l=Oe(o,t.dtype),d=t.buffer(),p=0;p<l.size;++p){var h=l.indexToLoc(p),g=h.slice();g[r]=i[h[r]];var y=d.locToIndex(g);l.values[p]=d.values[y]}return l.toTensor()},e.prototype.batchToSpaceND=function(t,n,r){this.assertNotComplex([t],"batchToSpaceND");var o=n.reduce(function(g,y){return g*y}),i=rp(t.shape,n,o),l=op(i.length,n.length),d=ap(t.shape,n,o),p=UE(r,n.length),h=zE(d,r,n.length);return t.reshape(i).transpose(l).reshape(d).slice(p,h)},e.prototype.spaceToBatchND=function(t,n,r){this.assertNotComplex([t],"spaceToBatchND");var o=n.reduce(function(y,x){return y*x}),i=[[0,0]];i.push.apply(i,r);for(var l=1+n.length;l<t.shape.length;++l)i.push([0,0]);var d=t.pad(i),p=rp(d.shape,n,o,!1),h=op(p.length,n.length,!1),g=ap(d.shape,n,o,!1);return d.reshape(p).transpose(h).reshape(g)},e.prototype.pool=function(t,n,r){this.assertNotComplex(t,"pool");for(var o=n.strideHeight,i=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.top,y=n.padInfo.left,x=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=t.dataSync(),_=Oe(n.outShape,t.dtype),k=_.values,A=n.outShape[1]*n.outShape[2]*n.outShape[3],I=n.outShape[2]*n.outShape[3],N=n.outShape[3],D=0;D<n.batchSize;++D)for(var M=D*A,F=D*t.strides[0],W=0;W<n.inChannels;++W)for(var L=0;L<n.outHeight;++L)for(var X=L*o-g,q=Math.max(0,X),Q=Math.min(n.inHeight,p+X),it=M+L*I,at=0;at<n.outWidth;++at){for(var ht=at*i-y,gt=Math.max(0,ht),Ct=Math.min(n.inWidth,h+ht),pt=x,lt=0,ft=0,Tt=q;Tt<Q;Tt+=l){for(var Pt=F+Tt*t.strides[1],Bt=gt;Bt<Ct;Bt+=d){var Ut=C[Pt+Bt*t.strides[2]+W];r==="max"&&Ut>pt?pt=Ut:r==="avg"&&(lt+=Ut,ft++)}if(isNaN(pt))break}k[it+at*N+W]=r==="avg"?lt/ft:pt}return _.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var r=Oe(n.outShape,"int32"),o=n.strideHeight,i=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.top,y=n.padInfo.left,x=0;x<n.batchSize;++x)for(var C=0;C<n.inChannels;++C)for(var _=0;_<n.outHeight;++_){for(var k=_*o-g,A=k;A<0;)A+=l;for(var I=Math.min(n.inHeight,p+k),N=0;N<n.outWidth;++N){for(var D=N*i-y,M=D;M<0;)M+=d;for(var F=Math.min(n.inWidth,h+D),W=Number.NEGATIVE_INFINITY,L=-1,X=A;X<I;X+=l)for(var q=X-k,Q=M;Q<F;Q+=d){var it=Q-D,at=t.get(x,X,Q,C);at>W&&(W=at,L=q*h+it)}r.set(L,x,_,N,C)}}return r.toTensor()},e.prototype.maxPoolBackprop=function(t,n,r,o){this.assertNotComplex([n,r],"maxPoolBackprop");for(var i=this.maxPoolPositions(n,o),l=o.strideHeight,d=o.strideWidth,p=o.dilationHeight,h=o.dilationWidth,g=o.effectiveFilterHeight,y=o.effectiveFilterWidth,x=y-1-o.padInfo.left,C=g-1-o.padInfo.top,_=Oe(n.shape,"float32"),k=0;k<o.batchSize;++k)for(var A=0;A<o.inChannels;++A)for(var I=0;I<o.inHeight;++I)for(var N=0;N<o.inWidth;++N){for(var D=I-C,M=N-x,F=0,W=0;W<g;W+=p){var L=(D+W)/l;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var X=0;X<y;X+=h){var q=(M+X)/d;if(!(q<0||q>=o.outWidth||Math.floor(q)!==q)){var Q=g*y-1-i.get(k,L,q,A)===W*y+X?1:0;Q!==0&&(F+=t.get(k,L,q,A)*Q)}}}_.set(F,k,I,N,A)}return _.toTensor()},e.prototype.avgPoolBackprop=function(t,n,r){this.assertNotComplex([t,n],"avgPoolBackprop");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=r.dilationHeight,h=r.dilationWidth,g=r.effectiveFilterHeight,y=r.effectiveFilterWidth,x=y-1-r.padInfo.left,C=g-1-r.padInfo.top,_=Oe(n.shape,"float32"),k=1/(l*d),A=0;A<r.batchSize;++A)for(var I=0;I<r.inChannels;++I)for(var N=0;N<r.inHeight;++N)for(var D=0;D<r.inWidth;++D){for(var M=N-C,F=D-x,W=0,L=0;L<g;L+=p){var X=(M+L)/o;if(!(X<0||X>=r.outHeight||Math.floor(X)!==X))for(var q=0;q<y;q+=h){var Q=(F+q)/i;Q<0||Q>=r.outWidth||Math.floor(Q)!==Q||(W+=t.get(A,X,Q,I))}}_.set(W*k,A,N,D,I)}return _.toTensor()},e.prototype.cast=function(t,n){return YE(t,n,this)},e.prototype.reshape=function(t,n){return av(t,n)},e.prototype.avgPool=function(t,n){return this.assertNotComplex(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,r,o){this.assertNotComplex(t,"resizeBilinear");for(var i=t.shape,l=i[0],d=i[1],p=i[2],h=i[3],g=t.dataSync(),y=new Float32Array(ue([l,n,r,h])),x=[o&&n>1?d-1:d,o&&r>1?p-1:p],C=[o&&n>1?n-1:n,o&&r>1?r-1:r],_=0,k=x[0]/C[0],A=x[1]/C[1],I=0;I<l;I++)for(var N=0;N<n;N++)for(var D=k*N,M=Math.floor(D),F=D-M,W=Math.min(d-1,Math.ceil(D)),L=I*t.strides[0]+M*t.strides[1],X=I*t.strides[0]+W*t.strides[1],q=0;q<r;q++)for(var Q=A*q,it=Math.floor(Q),at=Q-it,ht=Math.min(p-1,Math.ceil(Q)),gt=L+it*t.strides[2],Ct=X+it*t.strides[2],pt=L+ +ht*t.strides[2],lt=X+ht*t.strides[2],ft=0;ft<h;ft++){var Tt=g[gt+ft],Pt=g[Ct+ft],Bt=Tt+(g[pt+ft]-Tt)*at,Ut=Bt+(Pt+(g[lt+ft]-Pt)*at-Bt)*F;y[_++]=Ut}return Kn(y,[l,n,r,h])},e.prototype.resizeBilinearBackprop=function(t,n,r){this.assertNotComplex([t,n],"resizeBilinearBackprop");for(var o=n.shape,i=o[0],l=o[1],d=o[2],p=o[3],h=t.shape,g=h[1],y=h[2],x=new Float32Array(i*l*d*p),C=[r&&g>1?l-1:l,r&&y>1?d-1:d],_=[r&&g>1?g-1:g,r&&y>1?y-1:y],k=C[0]/_[0],A=C[1]/_[1],I=t.dataSync(),N=0,D=0;D<i;D++)for(var M=D*n.strides[0],F=0;F<g;F++)for(var W=F*k,L=Math.floor(W),X=Math.min(Math.ceil(W),l-1),q=M+L*n.strides[1],Q=M+X*n.strides[1],it=W-L,at=1-it,ht=0;ht<y;ht++)for(var gt=ht*A,Ct=Math.floor(gt),pt=Math.min(Math.ceil(gt),d-1),lt=gt-Ct,ft=1-lt,Tt=q+Ct*n.strides[2],Pt=q+pt*n.strides[2],Bt=Q+Ct*n.strides[2],Ut=Q+pt*n.strides[2],Zt=at*ft,Xt=at*lt,ce=it*ft,fe=it*lt,se=0;se<p;se++){var jt=I[N++];x[Tt+se]+=jt*Zt,x[Pt+se]+=jt*Xt,x[Bt+se]+=jt*ce,x[Ut+se]+=jt*fe}return lo(x,[i,d,l,p],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,r,o){this.assertNotComplex(t,"resizeNearestNeighbor");for(var i=t.shape,l=i[0],d=i[1],p=i[2],h=i[3],g=t.dataSync(),y=new Float32Array(l*n*r*h),x=[o&&n>1?d-1:d,o&&r>1?p-1:p],C=[o&&n>1?n-1:n,o&&r>1?r-1:r],_=x[0]/C[0],k=x[1]/C[1],A=0,I=0;I<l;I++)for(var N=I*t.strides[0],D=0;D<n;D++)for(var M=_*D,F=N+Math.min(d-1,o?Math.round(M):Math.floor(M))*t.strides[1],W=0;W<r;W++)for(var L=k*W,X=F+Math.min(p-1,o?Math.round(L):Math.floor(L))*t.strides[2],q=0;q<h;q++){var Q=g[X+q];y[A++]=Q}return Kn(y,[l,n,r,h],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){this.assertNotComplex([t,n],"resizeNearestNeighborBackprop");for(var o=n.shape,i=o[0],l=o[1],d=o[2],p=o[3],h=t.shape,g=h[1],y=h[2],x=new Float32Array(i*l*d*p),C=t.dataSync(),_=[r&&g>1?l-1:l,r&&y>1?d-1:d],k=[r&&g>1?g-1:g,r&&y>1?y-1:y],A=_[0]/k[0],I=_[1]/k[1],N=1/A,D=1/I,M=2*Math.ceil(N)+2,F=2*Math.ceil(D)+2,W=0;W<i;W++)for(var L=W*n.strides[0],X=0;X<l;X++)for(var q=L+X*n.strides[1],Q=Math.floor(X*N),it=Math.floor(Q-M/2),at=0;at<d;at++)for(var ht=q+at*n.strides[2],gt=Math.floor(at*D),Ct=Math.floor(gt-F/2),pt=0;pt<p;pt++){for(var lt=0,ft=0;ft<M;ft++){var Tt=ft+it;if(!(Tt<0||Tt>=g)){var Pt=L+Tt*t.strides[1],Bt=Tt*A;if(X===Math.min(l-1,r?Math.round(Bt):Math.floor(Bt)))for(var Ut=0;Ut<F;Ut++){var Zt=Ut+Ct;if(!(Zt<0||Zt>=y)){var Xt=Pt+Zt*t.strides[2],ce=Zt*I;at===Math.min(d-1,r?Math.round(ce):Math.floor(ce))&&(lt+=C[Xt+pt])}}}}x[ht+pt]=lt}return lo(x,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,r,o,i,l){this.assertNotComplex([t,n,r,i,l],"batchNormalization");for(var d=t.dataSync(),p=n.dataSync(),h=r.dataSync(),g=i?i.dataSync():new Float32Array([1]),y=l?l.dataSync():new Float32Array([0]),x=new Float32Array(d.length),C=y.length,_=g.length,k=h.length,A=p.length,I=0,N=0,D=0,M=0,F=0;F<d.length;++F)x[F]=y[I++]+(d[F]-p[N++])*g[D++]/Math.sqrt(h[M++]+o),I>=C&&(I=0),N>=A&&(N=0),D>=_&&(D=0),M>=k&&(M=0);return lo(x,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){this.assertNotComplex(t,"localResponseNormalization4D");var l=t.shape[3],d=l-1,p=t.dataSync(),h=ue(t.shape),g=new Float32Array(h);function y(k){for(var A=k%l,I=k-A+Math.max(0,A-n),N=k-A+Math.min(A+n,d),D=0;I<=N;I++){var M=p[I];D+=M*M}return D}for(var x=0;x<h;x++){var C=y(x),_=p[x]*Math.pow(r+o*C,-i);g[x]=_}return lo(g,t.shape)},e.prototype.LRNGrad=function(t,n,r,o,i,l,d){this.assertNotComplex(t,"LRNGrad");for(var p=t.shape[3],h=t.dataSync(),g=n.dataSync(),y=r.dataSync(),x=new Float32Array(ue(t.shape)),C=ue(t.shape),_=0;_<C;_++){for(var k=_%p,A=_-k+Math.max(0,k-o),I=_-k+Math.min(p,k+o+1),N=0,D=A;D<I;D++)N+=Math.pow(g[D],2);for(N=l*N+i,D=A;D<I;D++){var M=-2*l*d*g[D]*y[_]/N;_===D&&(M+=Math.pow(N,-d)),M*=h[_],x[D]+=M}}return lo(x,t.shape)},e.prototype.multinomial=function(t,n,r,o){this.assertNotComplex(t,"multinomial");for(var i=n?t:Ys(t),l=i.shape[0],d=i.shape[1],p=Fn([l,r],"int32"),h=p.dataSync(),g=i.dataSync(),y=0;y<l;++y){var x=y*d,C=new Float32Array(d-1);C[0]=g[x];for(var _=1;_<C.length;++_)C[_]=C[_-1]+g[x+_];for(var k=hk(o.toString()),A=y*r,I=0;I<r;++I){var N=k();h[A+I]=C.length;for(var D=0;D<C.length;D++)if(N<C[D]){h[A+I]=D;break}}}return p},e.prototype.oneHot=function(t,n,r,o){this.assertNotComplex(t,"oneHot");var i=new Float32Array(t.size*n);i.fill(o);for(var l=0;l<t.size;++l)t.get(l)>=0&&t.get(l)<n&&(i[l*n+t.get(l)]=r);return Up(i,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return this.assertNotComplex(t,"nonMaxSuppression"),l0(t.dataSync(),n.dataSync(),r,o,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var r=t.shape[0],o=t.shape[1],i=Oe(t.shape,"float32"),l=Oe(t.shape,"float32"),d=Ga(t).as2D(r,o),p=Ds(t).as2D(r,o),h=0;h<r;h++)for(var g=d.slice([h,0],[1,o]),y=p.slice([h,0],[1,o]),x=Xr(g,y),C=this.fftImpl(x,n).dataSync(),_=0;_<o;_++){var k=AC(C,_);i.values[h*o+_]=k.real,l.values[h*o+_]=k.imag}return Xr(i.toTensor(),l.toTensor()).as2D(r,o)},e.prototype.fftImpl=function(t,n){var r=t.as1D(),o=r.size;if(this.isExponentOf2(o)){var i=this.fftRadix2(r,o,n).as2D(t.shape[0],t.shape[1]);return n&&(i=Xr(Ga(i).div(Ot(o)),Ds(i).div(Ot(o)))),i}var l=t.dataSync(),d=Sz(this.fourierTransformByMatmul(l,o,n));return Xr(d.real,d.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,r){if(n===1)return t;var o=t.dataSync(),i=n/2,l=_z(o),d=Xr(l.real,l.imag).as1D(),p=Ez(o),h=Xr(p.real,p.imag).as1D();d=this.fftRadix2(d,i,r),h=this.fftRadix2(h,i,r);var g=Rz(n,r),y=Xr(g.real,g.imag).mul(h),x=d.add(y),C=d.sub(y),_=Ga(x).concat(Ga(C)),k=Ds(x).concat(Ds(C));return Xr(_,k).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,r){for(var o=new Float32Array(2*n),i=0;i<n;i++){for(var l=0,d=0,p=0;p<n;p++){var h=Tz(i*p,n,r),g=AC(t,p);l+=g.real*h.real-g.imag*h.imag,d+=g.real*h.imag+g.imag*h.real}r&&(l/=n,d/=n),kz(o,l,d,i)}return o},e.prototype.depthToSpace=function(t,n,r){et(r==="NHWC","Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r),et(n>1,"blockSize should be > 1 for depthToSpace, but was: "+n);for(var o=t.shape[0],i=t.shape[1],l=t.shape[2],d=t.shape[3],p=i*n,h=l*n,g=d/(n*n),y=t.dataSync(),x=new Float32Array(o*p*h*g),C=0,_=0;_<o;++_)for(var k=0;k<p;++k)for(var A=Math.floor(k/n),I=k%n,N=0;N<h;++N)for(var D=Math.floor(N/n),M=(I*n+N%n)*g,F=0;F<g;++F){var W=F+M+d*(D+l*(A+i*_));x[C++]=y[W]}return lo(x,[o,p,h,g])},e.prototype.broadcastedBinaryOp=function(t,n,r,o){var i=qe(t.shape,n.shape),l=Oe(i,r),d=t.dataSync(),p=n.dataSync(),h=As(t.shape,i),g=As(n.shape,i),y=l.values;if(h.length+g.length===0)for(var x=0;x<y.length;++x)y[x]=o(d[x%d.length],p[x%p.length]);else{var C=t.buffer(),_=n.buffer(),k=function(A){var I=l.indexToLoc(A),N=I.slice(-t.rank);h.forEach(function(W){return N[W]=0});var D=C.locToIndex(N),M=I.slice(-n.rank);g.forEach(function(W){return M[W]=0});var F=_.locToIndex(M);y[A]=o(d[D],p[F])};for(x=0;x<y.length;++x)k(x)}return l.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,r){var o=qe(t.shape,n.shape),i=Oe(o,"float32"),l=Oe(o,"float32"),d=t.dataSync(),p=n.dataSync(),h=As(t.shape,o),g=As(n.shape,o),y=i.values,x=l.values;if(h.length+g.length===0)for(var C=0;C<y.length;C++){var _=C%d.length,k=C%p.length,A=r(d[2*_],d[2*_+1],p[2*k],p[2*k+1]);y[C]=A.real,x[C]=A.imag}else{var I=this.data.get(t.dataId).complexTensors.real.buffer(),N=this.data.get(n.dataId).complexTensors.real.buffer(),D=function(M){var F=i.indexToLoc(M),W=F.slice(-t.rank);h.forEach(function(it){return W[it]=0});var L=I.locToIndex(W),X=F.slice(-n.rank);g.forEach(function(it){return X[it]=0});var q=N.locToIndex(X),Q=r(d[2*L],d[2*L+1],p[2*q],p[2*q+1]);y[M]=Q.real,x[M]=Q.imag};for(C=0;C<y.length;C++)D(C)}return this.complex(i.toTensor(),l.toTensor())},e.prototype.split=function(t,n,r){return JE(t,n,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.cropAndResize=function(t,n,r,o,i,l){for(var d=t.shape,p=d[0],h=d[1],g=d[2],y=d[3],x=n.shape[0],C=o[0],_=o[1],k=Oe([x,C,_,y],t.dtype),A=n.dataSync(),I=r.dataSync(),N=t.dataSync(),D=t.strides,M=k.strides,F=0;F<x;F++){var W=4*F,L=A[W],X=A[W+1],q=A[W+2],Q=A[W+3],it=I[F];if(!(it>=p))for(var at=C>1?(q-L)*(h-1)/(C-1):0,ht=_>1?(Q-X)*(g-1)/(_-1):0,gt=0;gt<C;gt++){var Ct=C>1?L*(h-1)+gt*at:.5*(L+q)*(h-1);if(Ct<0||Ct>h-1)for(var pt=0;pt<_;pt++)for(var lt=0;lt<y;lt++){var ft=lt+pt*M[2]+gt*M[1]+F*M[0];k.values[ft]=l}else if(i==="bilinear"){var Tt=Math.floor(Ct),Pt=Math.ceil(Ct),Bt=Ct-Tt;for(pt=0;pt<_;pt++)if((re=_>1?X*(g-1)+pt*ht:.5*(X+Q)*(g-1))<0||re>g-1)for(lt=0;lt<y;lt++)ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=l;else{var Ut=Math.floor(re),Zt=Math.ceil(re),Xt=re-Ut;for(lt=0;lt<y;lt++){var ce=N[ft=lt+Ut*D[2]+Tt*D[1]+it*D[0]],fe=N[ft=lt+Zt*D[2]+Tt*D[1]+it*D[0]],se=N[ft=lt+Ut*D[2]+Pt*D[1]+it*D[0]],jt=ce+(fe-ce)*Xt,Pe=se+(N[ft=lt+Zt*D[2]+Pt*D[1]+it*D[0]]-se)*Xt;ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=jt+(Pe-jt)*Bt}}}else for(pt=0;pt<_;++pt){var re;if((re=_>1?X*(g-1)+pt*ht:.5*(X+Q)*(g-1))<0||re>g-1)for(lt=0;lt<y;lt++)ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=l;else{var _e=Math.round(re),Y=Math.round(Ct);for(lt=0;lt<y;lt++){var nt=lt+_e*D[2]+Y*D[1]+it*D[0],mt=lt+pt*M[2]+gt*M[1]+F*M[0];k.values[mt]=N[nt]}}}}}return k.toTensor()},e.prototype.sparseToDense=function(t,n,r,o){var i=ip(n,t,r),l=i.sliceRank,d=i.numUpdates,p=i.sliceSize,h=i.strides,g=i.outputSize;return this.scatter(t,n,r,g,p,d,l,h,o,!1)},e.prototype.gatherND=function(t,n){var r=n.shape,o=r[r.length-1],i=HE(t,n),l=i[0],d=i[1],p=i[2],h=i[3];if(d===0)return Kn([],l,t.dtype);for(var g=new ql([d,p],t.dtype),y=n.dataSync(),x=t.dataSync(),C=0;C<d;C++){for(var _=[],k=0,A=0;A<o;A++){var I=y[C*o+A];k+=I*h[A],_.push(I)}if(k<0||k>=t.size/p)throw new Error("Invalid indices: "+_+" does not index into "+t.shape);for(var N=0;N<p;N++)g.values[C*p+N]=x[k*p+N]}return g.toTensor().reshape(l)},e.prototype.scatterND=function(t,n,r){var o=ip(n,t,r),i=o.sliceRank,l=o.numUpdates,d=o.sliceSize,p=o.strides,h=o.outputSize,g=Ot(0);return this.scatter(t,n,r,h,d,l,i,p,g,!0)},e.prototype.scatter=function(t,n,r,o,i,l,d,p,h,g){var y=[o/i,i],x=t.dataSync(),C=n.dataSync();if(o===0)return Kn([],r,n.dtype);var _=new ql(y,n.dtype);_.values.fill(h.dataSync()[0]);for(var k=0;k<l;k++){for(var A=[],I=0,N=0;N<d;N++){var D=x[k*d+N];A.push(D),I+=D*p[N]}if(I<0||I>=o/i)throw new Error("Invalid indices: "+A+" does not index into "+r);for(var M=0;M<i;M++)g?_.values[I*i+M]+=C[k*i+M]:_.values[I*i+M]=n.rank===0?C[0]:C[k*i+M]}return _.toTensor().reshape(r)},e}();rt.registerBackend("cpu",function(){return new PX},1,s0);typeof requestAnimationFrame<"u"||setImmediate;var S0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ZC(e){return S0?Buffer.byteLength(e):new Blob([e]).size}function MX(e){return S0?Buffer.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function OX(e){if(S0){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}function FX(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function jp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:ZC(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:ZC(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var Xo=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t){return e.getHandlers(t,"load")},e.getHandlers=function(t,n){var r=[];return(n==="load"?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(o){var i=o(t);i!==null&&r.push(i)}),r},e}(),tS="://",Hk=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){et(t!=null,"scheme must not be undefined or null."),t.endsWith(tS)&&(t=t.slice(0,t.indexOf(tS))),et(t.length>0,"scheme must not be an empty string.");var r=e.getInstance();et(r.managers[t]==null,"A model store manager is already registered for scheme '"+t+"'."),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}(),lv="tensorflowjs",dv=1,Is="models_store",Fi="model_info_store";function Gk(){if(!rt.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function fv(e){var t=e.result;t.createObjectStore(Is,{keyPath:"modelPath"}),t.createObjectStore(Fi,{keyPath:"modelPath"})}var sc=function(){function e(t){if(this.indexedDB=Gk(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return Je(this,void 0,void 0,function(){return Ze(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return Je(this,void 0,void 0,function(){return Ze(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,i){var l=r.indexedDB.open(lv,dv);l.onupgradeneeded=function(){return fv(l)},l.onsuccess=function(){var d=l.result;if(n==null){var p=d.transaction(Is,"readonly"),h=p.objectStore(Is).get(r.modelPath);h.onsuccess=function(){if(h.result==null)return d.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(h.result.modelArtifacts)},h.onerror=function(k){return d.close(),i(h.error)},p.oncomplete=function(){return d.close()}}else{var g,y=jp(n),x=d.transaction(Fi,"readwrite"),C=x.objectStore(Fi),_=C.put({modelPath:r.modelPath,modelArtifactsInfo:y});_.onsuccess=function(){var k=(g=d.transaction(Is,"readwrite")).objectStore(Is).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:y});k.onsuccess=function(){return o({modelArtifactsInfo:y})},k.onerror=function(A){var I=(C=x.objectStore(Fi)).delete(r.modelPath);I.onsuccess=function(){return d.close(),i(k.error)},I.onerror=function(N){return d.close(),i(k.error)}}},_.onerror=function(k){return d.close(),i(_.error)},x.oncomplete=function(){g==null?d.close():g.oncomplete=function(){return d.close()}}}},l.onerror=function(d){return i(l.error)}})},e.URL_SCHEME="indexeddb://",e}(),eS=function(e){return rt.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sc.URL_SCHEME)?$X(e.slice(sc.URL_SCHEME.length)):null};function $X(e){return new sc(e)}function BX(e){return e.startsWith(sc.URL_SCHEME)?e.slice(sc.URL_SCHEME.length):e}Xo.registerSaveRouter(eS),Xo.registerLoadRouter(eS);var LX=function(){function e(){this.indexedDB=Gk()}return e.prototype.listModels=function(){return Je(this,void 0,void 0,function(){var t=this;return Ze(this,function(n){return[2,new Promise(function(r,o){var i=t.indexedDB.open(lv,dv);i.onupgradeneeded=function(){return fv(i)},i.onsuccess=function(){var l=i.result,d=l.transaction(Fi,"readonly"),p=d.objectStore(Fi).getAll();p.onsuccess=function(){for(var h={},g=0,y=p.result;g<y.length;g++){var x=y[g];h[x.modelPath]=x.modelArtifactsInfo}r(h)},p.onerror=function(h){return l.close(),o(p.error)},d.oncomplete=function(){return l.close()}},i.onerror=function(l){return o(i.error)}})]})})},e.prototype.removeModel=function(t){return Je(this,void 0,void 0,function(){var n=this;return Ze(this,function(r){return t=BX(t),[2,new Promise(function(o,i){var l=n.indexedDB.open(lv,dv);l.onupgradeneeded=function(){return fv(l)},l.onsuccess=function(){var d,p=l.result,h=p.transaction(Fi,"readwrite"),g=h.objectStore(Fi),y=g.get(t);y.onsuccess=function(){if(y.result==null)return p.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var x=g.delete(t),C=function(){var _=(d=p.transaction(Is,"readwrite")).objectStore(Is).delete(t);_.onsuccess=function(){return o(y.result.modelArtifactsInfo)},_.onerror=function(k){return i(y.error)}};x.onsuccess=C,x.onerror=function(_){return C(),p.close(),i(y.error)}},y.onerror=function(x){return p.close(),i(y.error)},h.oncomplete=function(){d==null?p.close():d.oncomplete=function(){return p.close()}}},l.onerror=function(d){return i(l.error)}})]})})},e}();if(rt.get("IS_BROWSER"))try{Hk.registerManager(sc.URL_SCHEME,new LX)}catch{}var $i="/",hl="tensorflowjs_models",qk="info",WX="model_topology",UX="weight_specs",zX="weight_data";function jk(e){return{info:[hl,e,qk].join($i),topology:[hl,e,WX].join($i),weightSpecs:[hl,e,UX].join($i),weightData:[hl,e,zX].join($i)}}function VX(e){var t=e.split($i);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join($i)}function HX(e){return e.startsWith(uc.URL_SCHEME)?e.slice(uc.URL_SCHEME.length):e}var uc=function(){function e(t){if(!rt.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=jk(this.modelPath)}return e.prototype.save=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i;return Ze(this,function(l){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=jp(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,MX(t.weightData)),[2,{modelArtifactsInfo:o}]}catch{for(i in this.keys)this.LS.removeItem(this.keys[i]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return Je(this,void 0,void 0,function(){var t,n,r,o,i;return Ze(this,function(l){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(i=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=OX(i),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),nS=function(e){return rt.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(uc.URL_SCHEME)?GX(e.slice(uc.URL_SCHEME.length)):null};function GX(e){return new uc(e)}Xo.registerSaveRouter(nS),Xo.registerLoadRouter(nS);var qX=function(){function e(){et(rt.get("IS_BROWSER"),"Current environment is not a web browser"),et(window.localStorage!==void 0,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return e.prototype.listModels=function(){return Je(this,void 0,void 0,function(){var t,n,r,o,i,l;return Ze(this,function(d){for(t={},n=hl+$i,r=$i+qk,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(n)&&i.endsWith(r)&&(l=VX(i),t[l]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},e.prototype.removeModel=function(t){return Je(this,void 0,void 0,function(){var n,r;return Ze(this,function(o){if(t=HX(t),n=jk(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(rt.get("IS_BROWSER"))try{Hk.registerManager(uc.URL_SCHEME,new qX)}catch{}var jX="model",KX=".json",XX=".weights.bin",pv=function(){function e(t){if(!rt.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=jX),this.modelTopologyFileName=t+KX,this.weightDataFileName=t+XX}return e.prototype.save=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d;return Ze(this,function(p){if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(l=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,l.href=i,l.click(),t.weightData!=null&&((d=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,d.href=n,d.click()),[2,{modelArtifactsInfo:jp(t)}]})})},e.URL_SCHEME="downloads://",e}(),YX=function(e){return rt.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pv.URL_SCHEME)?QX(e.slice(pv.URL_SCHEME.length)):null};function QX(e){return e===void 0&&(e="model"),new pv(e)}function JX(e,t,n){return Je(this,void 0,void 0,function(){var r,o;return Ze(this,function(i){switch(i.label){case 0:return n==null&&(n=fetch),r=e.map(function(l){return n(l,t)}),[4,Promise.all(r)];case 1:return o=i.sent(),[4,Promise.all(o.map(function(l){return l.arrayBuffer()}))];case 2:return[2,i.sent()]}})})}Xo.registerSaveRouter(YX);var Kk=function(){function e(t,n,r,o){if(this.weightPathPrefix=r,this.DEFAULT_METHOD="POST",o==null){if(typeof fetch>"u")throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");this.fetchFunc=fetch.bind(typeof window>"u"?null:window)}else et(typeof o=="function","Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetchFunc=o;if(et(t!=null&&t.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(t)&&et(t.length===2,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."),this.path=t,n!=null&&n.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n||{}}return e.prototype.save=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i;return Ze(this,function(l){switch(l.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,n)];case 1:if((i=l.sent()).ok)return[2,{modelArtifactsInfo:jp(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return Je(this,void 0,void 0,function(){return Ze(this,function(t){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},e.prototype.loadBinaryTopology=function(){return Je(this,void 0,void 0,function(){var t,n;return Ze(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.getFetchFunc()(this.path[0],this.requestInit)];case 1:if(!(t=r.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.arrayBuffer()];case 2:return[2,r.sent()];case 3:throw n=r.sent(),new Error(this.path[0]+" not found. "+n);case 4:return[2]}})})},e.prototype.loadBinaryModel=function(){return Je(this,void 0,void 0,function(){var t,n,r,o,i,l,d,p;return Ze(this,function(h){switch(h.label){case 0:return t=this.loadBinaryTopology(),[4,this.getFetchFunc()(this.path[1],this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+n.statusText);return[4,Promise.all([t,n])];case 2:return r=h.sent(),o=r[0],[4,r[1].json()];case 3:return(i=h.sent())==null?[3,5]:[4,this.loadWeights(i)];case 4:p=h.sent(),l=p[0],d=p[1],h.label=5;case 5:return[2,{modelTopology:o,weightSpecs:l,weightData:d}]}})})},e.prototype.loadJSONModel=function(){return Je(this,void 0,void 0,function(){var t,n,r,o,i,l,d,p;return Ze(this,function(h){switch(h.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.json()];case 2:if(n=h.sent(),r=n.modelTopology,o=n.weightsManifest,r==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,4]:(d=n.weightsManifest,[4,this.loadWeights(d)]);case 3:p=h.sent(),i=p[0],l=p[1],h.label=4;case 4:return[2,{modelTopology:r,weightSpecs:i,weightData:l}]}})})},e.prototype.loadWeights=function(t){return Je(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C;return Ze(this,function(_){switch(_.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=ZX(n),o=r[0],i=r[1],l=this.weightPathPrefix||o,d=[],p=0,h=t;p<h.length;p++)g=h[p],d.push.apply(d,g.weights);return y=[],t.forEach(function(k){k.paths.forEach(function(A){y.push(l+A+i)})}),x=[d],C=FX,[4,JX(y,this.requestInit,this.getFetchFunc())];case 1:return[2,x.concat([C.apply(void 0,[_.sent()])])]}})})},e.prototype.getFetchFunc=function(){return this.fetchFunc},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function ZX(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function rS(e){return e.match(Kk.URL_SCHEME_REGEX)!=null}var oS=function(e){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(t){return rS(t)}):rS(e))?tY(e):null};function tY(e,t,n,r){return new Kk(e,t,n,r)}Xo.registerSaveRouter(oS),Xo.registerLoadRouter(oS);Xo.registerSaveRouter;Xo.registerLoadRouter;Xo.getSaveHandlers;Xo.getLoadHandlers;function eY(e,t,n){var r=H(e,"labels","confusionMatrix"),o=H(t,"predictions","confusionMatrix");et(n==null||n>0&&Number.isInteger(n),"If provided, numClasses must be a positive integer, but got "+n),et(r.rank===1,"Expected the rank of labels to be 1, but got "+r.rank),et(o.rank===1,"Expected the rank of predictions to be 1, but got "+o.rank),et(r.shape[0]===o.shape[0],"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."),et(n>0&&Number.isInteger(n),"numClasses is required to be a positive integer, but got "+n);var i=iv(r.asType("int32"),n),l=iv(o.asType("int32"),n);return i.transpose().matMul(l).asType("int32")}ut({confusionMatrix_:eY});var nY=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),rY=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function tu(e){et(e.className!=null,"Class being registered does not have the static className property defined."),et(typeof e.className=="string","className is required to be a string, but got type "+typeof e.className),et(e.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),rY.register(e)}var bc=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return Za(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var i=this.computeGradients(n,o),l=i.value,d=i.grads;return this.applyGradients(d),Object.keys(d).forEach(function(p){return d[p].dispose()}),r?l:(l.dispose(),null)},t.prototype.computeGradients=function(n,r){return tz(n,r)},t}(nY),oY=function(e){function t(n,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=n,i.rho=r,i.epsilon=o,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=xn(Ot(-n)),i.rhoScalar=xn(Ot(r)),i.oneMinusRho=xn(Ot(1-r)),o===null&&(o=rt.get("EPSILON")),i.epsilonScalar=xn(Ot(o)),i}return Za(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=rt.engine.registeredVariables[d];i.accumulatedGrads[d]==null&&ve(function(){r.accumulatedGrads[d]=Sn(p).variable(!1)}),i.accumulatedUpdates[d]==null&&ve(function(){r.accumulatedUpdates[d]=Sn(p).variable(!1)});var h=n[d],g=i.accumulatedGrads[d],y=i.accumulatedUpdates[d];ve(function(){var x=r.rhoScalar.mul(g).add(r.oneMinusRho.mul(h.square())),C=y.add(r.epsilonScalar).sqrt().div(g.add(r.epsilonScalar).sqrt()).mul(h),_=r.rhoScalar.mul(y).add(r.oneMinusRho.mul(C.square()));r.accumulatedGrads[d].assign(x),r.accumulatedUpdates[d].assign(_);var k=r.c.mul(C).add(p);p.assign(k)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(r){return n.accumulatedUpdates[r].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(r){return n.accumulatedGrads[r].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="AdadeltaOptimizer",t}(bc);tu(oY);var aY=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads={},o.c=xn(Ot(-n)),o.epsilon=xn(Ot(rt.get("EPSILON"))),o}return Za(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=rt.engine.registeredVariables[d];i.accumulatedGrads[d]==null&&ve(function(){r.accumulatedGrads[d]=Rl(p.shape,r.initialAccumulatorValue).variable(!1)});var h=n[d],g=i.accumulatedGrads[d];ve(function(){var y=g.add(h.square());r.accumulatedGrads[d].assign(y);var x=r.c.mul(h.div(y.add(r.epsilon).sqrt())).add(p);p.assign(x)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(r){return n.accumulatedGrads[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(bc);tu(aY);var iY=function(e){function t(n,r,o,i){i===void 0&&(i=null);var l=e.call(this)||this;return l.learningRate=n,l.beta1=r,l.beta2=o,l.epsilon=i,l.accumulatedFirstMoment={},l.accumulatedSecondMoment={},l.c=xn(Ot(-n)),l.beta1Scalar=xn(Ot(r)),l.beta2Scalar=xn(Ot(o)),ve(function(){l.accBeta1=Ot(r).variable(),l.accBeta2=Ot(o).variable()}),l.oneMinusBeta1=xn(Ot(1-r)),l.oneMinusBeta2=xn(Ot(1-o)),l.one=xn(Ot(1)),i===null&&(i=rt.get("EPSILON")),l.epsScalar=xn(Ot(i)),l}return Za(t,e),t.prototype.applyGradients=function(n){var r=this;ve(function(){var o=r.one.sub(r.accBeta1),i=r.one.sub(r.accBeta2);for(var l in n){var d=rt.engine.registeredVariables[l];if(r.accumulatedFirstMoment[l]==null){var p=!1;r.accumulatedFirstMoment[l]=Sn(d).variable(p)}r.accumulatedSecondMoment[l]==null&&(p=!1,r.accumulatedSecondMoment[l]=Sn(d).variable(p));var h=n[l],g=r.accumulatedFirstMoment[l],y=r.accumulatedSecondMoment[l],x=r.beta1Scalar.mul(g).add(r.oneMinusBeta1.mul(h)),C=r.beta2Scalar.mul(y).add(r.oneMinusBeta2.mul(h.square())),_=x.div(o),k=C.div(i);r.accumulatedFirstMoment[l].assign(x),r.accumulatedSecondMoment[l].assign(C);var A=r.c.mul(_.div(r.epsScalar.add(k.sqrt()))).add(d);d.assign(A)}r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar)),r.accBeta2.assign(r.accBeta2.mul(r.beta2Scalar))})},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return n.accumulatedFirstMoment[r].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(r){return n.accumulatedSecondMoment[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="AdamOptimizer",t}(bc);tu(iY);var sY=function(e){function t(n,r,o,i,l){i===void 0&&(i=null),l===void 0&&(l=0);var d=e.call(this)||this;return d.learningRate=n,d.beta1=r,d.beta2=o,d.epsilon=i,d.decay=l,d.accumulatedFirstMoment={},d.accumulatedWeightedInfNorm={},d.c=xn(Ot(-n)),d.beta1Scalar=xn(Ot(r)),d.beta2Scalar=xn(Ot(o)),d.decayScalar=xn(Ot(l)),ve(function(){d.iteration=Ot(0).variable(),d.accBeta1=Ot(r).variable()}),d.oneMinusBeta1=xn(Ot(1-r)),d.one=xn(Ot(1)),i===null&&(i=rt.get("EPSILON")),d.epsScalar=xn(Ot(i)),d}return Za(t,e),t.prototype.applyGradients=function(n){var r=this;ve(function(){var o=r.one.sub(r.accBeta1),i=r.c.div(r.one.add(r.decayScalar.mul(r.iteration)));for(var l in n){var d=rt.engine.registeredVariables[l];if(r.accumulatedFirstMoment[l]==null){var p=!1;r.accumulatedFirstMoment[l]=Sn(d).variable(p)}r.accumulatedWeightedInfNorm[l]==null&&(p=!1,r.accumulatedWeightedInfNorm[l]=Sn(d).variable(p));var h=n[l],g=r.accumulatedFirstMoment[l],y=r.accumulatedWeightedInfNorm[l],x=r.beta1Scalar.mul(g).add(r.oneMinusBeta1.mul(h)),C=r.beta2Scalar.mul(y),_=h.abs(),k=C.maximum(_);r.accumulatedFirstMoment[l].assign(x),r.accumulatedWeightedInfNorm[l].assign(k);var A=i.div(o).mul(x.div(r.epsScalar.add(k))).add(d);d.assign(A)}r.iteration.assign(r.iteration.add(r.one)),r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar))})},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return n.accumulatedFirstMoment[r].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(r){return n.accumulatedWeightedInfNorm[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="AdamaxOptimizer",t}(bc);tu(sY);var Xk=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return Za(t,e),t.prototype.applyGradients=function(n){var r=this;Object.keys(n).forEach(function(o){var i=n[o],l=rt.engine.registeredVariables[o];ve(function(){var d=r.c.mul(i).add(l);l.assign(d)})})},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=xn(Ot(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGDOptimizer",t}(bc);tu(Xk);var uY=function(e){function t(n,r,o){o===void 0&&(o=!1);var i=e.call(this,n)||this;return i.learningRate=n,i.momentum=r,i.useNesterov=o,i.m=Ot(i.momentum),i.accumulations={},i}return Za(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=rt.engine.registeredVariables[d];i.accumulations[d]==null&&ve(function(){r.accumulations[d]=Sn(p).variable(!1)});var h=i.accumulations[d],g=n[d];ve(function(){var y,x=r.m.mul(h).add(g);y=r.useNesterov?r.c.mul(g.add(x.mul(r.m))).add(p):r.c.mul(x).add(p),r.accumulations[d].assign(x),p.assign(y)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var n in this.accumulations)this.accumulations[n].dispose()},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="MomentumOptimizer",t}(Xk);tu(uY);var cY=function(e){function t(n,r,o,i,l){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),l===void 0&&(l=!1);var d=e.call(this)||this;return d.learningRate=n,d.decay=r,d.momentum=o,d.epsilon=i,d.accumulatedMeanSquares={},d.accumulatedMeanGrads={},d.accumulatedMoments={},d.c=xn(Ot(n)),d.decayScalar=xn(Ot(r)),d.momentumScalar=xn(Ot(o)),d.oneMinusDecay=xn(Ot(1-r)),d.centered=l,i===null&&(i=rt.get("EPSILON")),d.epsilonScalar=xn(Ot(i)),d}return Za(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=rt.engine.registeredVariables[d];i.accumulatedMeanSquares[d]==null&&ve(function(){r.accumulatedMeanSquares[d]=Sn(p).variable(!1)}),i.accumulatedMeanGrads[d]==null&&i.centered&&ve(function(){r.accumulatedMeanGrads[d]=Sn(p).variable(!1)}),i.accumulatedMoments[d]==null&&ve(function(){r.accumulatedMoments[d]=Sn(p).variable(!1)});var h=i.accumulatedMeanSquares[d],g=i.accumulatedMeanGrads[d],y=i.accumulatedMoments[d],x=n[d];ve(function(){var C=r.decayScalar.mul(h).add(r.oneMinusDecay.mul(x.square()));if(r.centered){var _=r.decayScalar.mul(g).add(r.oneMinusDecay.mul(x)),k=r.momentumScalar.mul(y).add(r.c.mul(x).div(C.sub(_.square().add(r.epsilonScalar)).sqrt()));r.accumulatedMeanSquares[d].assign(C),r.accumulatedMeanGrads[d].assign(_),r.accumulatedMoments[d].assign(k);var A=p.sub(k);p.assign(A)}else{var I=r.decayScalar.mul(h).add(r.oneMinusDecay.mul(x.square()));k=r.momentumScalar.mul(y).add(r.c.mul(x).div(I.add(r.epsilonScalar).sqrt())),r.accumulatedMeanSquares[d].assign(I),r.accumulatedMoments[d].assign(k),A=p.sub(k),p.assign(A)}})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(r){return n.accumulatedMeanSquares[r].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(r){return n.accumulatedMeanGrads[r].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(r){return n.accumulatedMoments[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSPropOptimizer",t}(bc);tu(cY);Sa.setBackend;Sa.getBackend;Sa.disposeVariables;Sa.memory;AU(NX);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lY=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function ri(e,t){function n(){this.constructor=e}lY(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var bg=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};function Re(e,t,n,r){return new(n||(n=Promise))(function(o,i){function l(h){try{p(r.next(h))}catch(g){i(g)}}function d(h){try{p(r.throw(h))}catch(g){i(g)}}function p(h){h.done?o(h.value):new n(function(g){g(h.value)}).then(l,d)}p((r=r.apply(e,[])).next())})}function Te(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function d(p){return function(h){return function(g){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&g[0]?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[2&g[0],o.value]),g[0]){case 0:case 1:o=g;break;case 4:return l.label++,{value:g[1],done:!1};case 5:l.label++,r=g[1],g=[0];continue;case 7:g=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){l=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){l.label=g[1];break}if(g[0]===6&&l.label<o[1]){l.label=o[1],o=g;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(g);break}o[2]&&l.ops.pop(),l.trys.pop();continue}g=t.call(e,l)}catch(y){g=[6,y],r=0}finally{n=o=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([p,h])}}}var Lu={},xg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function oi(e){e in Lu||(document.createElement("canvas").addEventListener("webglcontextlost",function(n){n.preventDefault(),delete Lu[e]},!1),Lu[e]=dY(e));var t=Lu[e];return t.isContextLost()?(delete Lu[e],oi(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Lu[e])}function dY(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return e===1?t.getContext("webgl",xg)||t.getContext("experimental-webgl",xg):t.getContext("webgl2",xg)}function fY(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}function hv(e,t,n){return Math.max(e,Math.min(t,n))}function Xl(e){return e%2==0?e:e+1}function pY(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function hY(e,t){var n=Math.random();return t*n+(1-n)*e}function tt(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function an(e,t,n){n===void 0&&(n=""),tt(Nr(e,t),n+" Shapes "+e+" and "+t+" must match")}function xc(e){tt(e!=null,"The input to the tensor constructor must be a non-null value.")}function cc(e,t){if(t===void 0&&(t=[]),Array.isArray(e)||Xa(e))for(var n=0;n<e.length;++n)cc(e[n],t);else t.push(e);return t}function ie(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Nr(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Fo(e){return e%1==0}function mY(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function gY(e){for(var t=Math.floor(Math.sqrt(e));t>1;--t)if(e%t==0)return[t,e/t];return[1,e]}function tc(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function aS(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,l=function(){if(e())r();else{var d=t(++i);n!=null&&i>=n?o():setTimeout(l,d)}};l()})}function vY(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function eu(e,t){for(var n=[],r=[],o=0,i=0;i<e.length;++i){if(t!=null){if(t[o]===i&&e[i]!==1)throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(t[o]==null||t[o]>i)&&e[i]===1&&(n.push(e[i]),r.push(i)),t[o]<=i&&o++}e[i]!==1&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function mv(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Yk(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function yY(e,t,n){if(t==="float32"){for(var r=0;r<e.length;r++)if(isNaN(e[r]))throw Error("The result of the '"+n+"' has NaNs.")}}function bY(e,t){if(t!=="float32"){for(var n=0;n<e.length;n++)if(isNaN(e[n]))throw Error("NaN is not a valid value for dtype: '"+t+"'.")}}function xY(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function Xa(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Qk(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function wY(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=2*n.length}),t}function Jk(e){return typeof e=="string"||e instanceof String}function CY(e){return typeof e=="boolean"}function SY(e){return typeof e=="number"}function Kp(e){return e instanceof Array?Kp(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":SY(e)?"float32":Jk(e)?"string":CY(e)?"bool":"float32"}function gv(e){return!!(e&&e.constructor&&e.call&&e.apply)}function vv(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function nu(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Zk(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(_Y(e,t))return e;if(Array.isArray(e)&&(e=cc(e)),t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return n&&bY(e,t),new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function _Y(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function tR(e,t){for(var n=hd(e,t),r=0;r<n.length;r++)n[r]=1;return n}function hd(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function fp(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}var EY=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new kY)}return e.prototype.profileKernel=function(t,n){var r,o=this,i=this.backendTimer.time(function(){r=n()});return(Array.isArray(r)?r:[r]).forEach(function(l){var d=l.dataSync();yY(d,l.dtype,t),i.then(function(p){var h="";p.getExtraProfileInfo!=null&&(h=p.getExtraProfileInfo()),o.logger.logKernelProfile(t,l,d,p.kernelMs,h)})}),r},e}(),kY=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,i){var l=tc(o+"ms",9),d=tc(t,25),p=n.rank,h=n.size,g=tc(n.shape.toString(),14);console.log("%c"+d+"	%c"+l+"	%c"+p+"D "+g+"	%c"+h+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}(),iS=20,cl=3,wg=7;function RY(e,t,n,r){var o=nu(t),i=TY(e,t,n,o),l=t.length,d=Gf(e,t,n,o,i),p=["Tensor"];return r&&(p.push("  dtype: "+n),p.push("  rank: "+l),p.push("  shape: ["+t+"]"),p.push("  values:")),p.push(d.map(function(h){return"    "+h}).join(`
`)),p.join(`
`)}function TY(e,t,n,r){var o=ie(t),i=r[r.length-1],l=new Array(i).fill(0),d=t.length,p=n==="complex64"?gl(e):e;if(d>1)for(var h=0;h<o/i;h++)for(var g=h*i,y=0;y<i;y++)l[y]=Math.max(l[y],ml(p[g+y],0).length);return l}function ml(e,t){return tc(Array.isArray(e)?parseFloat(e[0].toFixed(wg))+" + "+parseFloat(e[1].toFixed(wg))+"j":Jk(e)?"'"+e+"'":parseFloat(e.toFixed(wg)).toString(),t)}function Gf(e,t,n,r,o,i){i===void 0&&(i=!0);var l=n==="complex64"?2:1,d=t[0],p=t.length;if(p===0)return n==="complex64"?[ml(gl(e)[0],0)]:[e[0].toString()];if(p===1){if(d>iS){var h=cl*l,g=Array.from(e.slice(0,h)),y=Array.from(e.slice(d-cl*l,d));return n==="complex64"&&(g=gl(g),y=gl(y)),["["+g.map(function(F,W){return ml(F,o[W])}).join(", ")+", ..., "+y.map(function(F,W){return ml(F,o[d-cl+W])}).join(", ")+"]"]}return["["+(n==="complex64"?gl(e):Array.from(e)).map(function(F,W){return ml(F,o[W])}).join(", ")+"]"]}var x=t.slice(1),C=r.slice(1),_=r[0]*l,k=[];if(d>iS){for(var A=0;A<cl;A++){var I=(N=A*_)+_;k.push.apply(k,Gf(e.slice(N,I),x,n,C,o,!1))}for(k.push("..."),A=d-cl;A<d;A++)I=(N=A*_)+_,k.push.apply(k,Gf(e.slice(N,I),x,n,C,o,A===d-1))}else for(A=0;A<d;A++){var N;I=(N=A*_)+_,k.push.apply(k,Gf(e.slice(N,I),x,n,C,o,A===d-1))}var D=p===2?",":"";for(k[0]="["+k[0]+D,A=1;A<k.length-1;A++)k[A]=" "+k[A]+D;var M=`,
`;for(A=2;A<p;A++)M+=`
`;return k[k.length-1]=" "+k[k.length-1]+"]"+(i?"":M),k}function gl(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Yl=function(){function e(t,n,r){if(this.dtype=n,this.shape=t.slice(),this.size=ie(t),r!=null){var o=r.length;tt(o===this.size,"Length of values '"+o+"' does not match the size inferred by the shape '"+this.size+"'.")}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Yk(n,ie(this.shape)),this.strides=nu(t)}return e.prototype.set=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];n.length===0&&(n=[0]),tt(n.length===this.rank,"The number of provided coordinates ("+n.length+") must match the rank ("+this.rank+")");var o=this.locToIndex(n);this.values[o]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.values[r]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Kt.make(this.shape,{values:this.values},this.dtype)},e}(),Do=null,wt=null;function _0(e){Do=e}function DY(e){wt=e}var Kt=function(){function e(t,n,r,o){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ie(t),this.strides=nu(t),this.dataId=o??{},this.id=Do().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Do().registerTensor(this),r!=null&&Do().write(this.dataId,r)}return e.make=function(t,n,r){return new e(t,r,n.values,n.dataId)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),tt(this.size===1,"The array must have only 1 element."),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,i){return this.throwIfDisposed(),this.reshape([t,n,r,o,i])},e.prototype.asType=function(t){return this.throwIfDisposed(),wt.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];tt(t.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),tt(this.dtype!=="complex64","Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),t.length===0&&(t=[0]);for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.dataSync()[r]},e.prototype.buffer=function(){return wt.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.data=function(){return Re(this,void 0,void 0,function(){return Te(this,function(t){return this.throwIfDisposed(),[2,Do().read(this.dataId)]})})},e.prototype.dataSync=function(){return this.throwIfDisposed(),Do().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(Do().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),wt.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),wt.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),wt.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),wt.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),wt.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),wt.clone(this)},e.prototype.toString=function(t){return t===void 0&&(t=!1),RY(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),wt.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),wt.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),wt.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),wt.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),wt.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),wt.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),wt.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),wt.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),wt.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),wt.stack([this,t],n)},e.prototype.unstack=function(t,n){return n===void 0&&(n=0),wt.unstack(this,n)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),wt.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,i){return r===void 0&&(r=.001),this.throwIfDisposed(),wt.batchNormalization(this,t,n,r,o,i)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),wt.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),wt.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),wt.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),wt.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),wt.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),wt.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),wt.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),wt.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),wt.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),wt.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),wt.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),wt.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),wt.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),wt.div(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),wt.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),wt.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),wt.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),wt.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),wt.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),wt.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),wt.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),wt.modStrict(this,t)},e.prototype.squaredDifference=function(t){return this.throwIfDisposed(),wt.squaredDifference(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),wt.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),wt.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),wt.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),wt.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),wt.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),wt.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),wt.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),wt.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),wt.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),wt.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),wt.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),wt.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),wt.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),wt.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),wt.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),wt.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),wt.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),wt.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),wt.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),wt.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),wt.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),wt.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),wt.sign(this)},e.prototype.exp=function(){return this.throwIfDisposed(),wt.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),wt.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),wt.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),wt.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),wt.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),wt.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),wt.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),wt.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),wt.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),wt.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),wt.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),wt.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),wt.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),wt.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),wt.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),wt.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),wt.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),wt.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),wt.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),wt.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),wt.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),wt.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),wt.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),wt.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),wt.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),wt.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),wt.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),wt.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),wt.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),wt.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),wt.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),wt.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),wt.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),wt.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),wt.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),wt.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),wt.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),wt.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),wt.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,i,l){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),wt.conv1d(this,t,n,r,o,i,l)},e.prototype.conv2d=function(t,n,r,o,i,l){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),wt.conv2d(this,t,n,r,o,i,l)},e.prototype.conv2dTranspose=function(t,n,r,o,i){return this.throwIfDisposed(),wt.conv2dTranspose(this,t,n,r,o,i)},e.prototype.depthwiseConv2D=function(t,n,r,o,i,l){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),wt.depthwiseConv2d(this,t,n,r,o,i,l)},e.prototype.separableConv2d=function(t,n,r,o,i,l){return i===void 0&&(i=[1,1]),l===void 0&&(l="NHWC"),this.throwIfDisposed(),wt.separableConv2d(this,t,n,r,o,i,l)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),wt.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),wt.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),wt.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,i){return this.throwIfDisposed(),wt.pool(this,t,n,r,o,i)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),Vs.variable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),wt.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),wt.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),wt.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),wt.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,i){return o===void 0&&(o=0),i===void 0&&(i=0),this.throwIfDisposed(),wt.stridedSlice(this,t,n,r,o,i)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),wt.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),wt.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),wt.spectral.ifft(this)},e}();Object.defineProperty(Kt,Symbol.hasInstance,{value:function(e){return!!e&&e.shape!=null&&e.dtype!=null}});var Vs=function(e){function t(n,r,o){r===void 0&&(r=!0);var i=e.call(this,n.shape,n.dtype,null,n.dataId)||this;i.trainable=r,i.name=o,i.name==null&&(i.name=Do().nextVariableId().toString());try{Do().registerVariable(i)}catch(l){throw Do().disposeTensor(i),l}return i}return ri(t,e),t.variable=function(n,r,o,i){return r===void 0&&(r=!0),i!=null&&i!==n.dtype&&(n=n.asType(i)),new t(n,r,o)},t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!Nr(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Do().disposeTensor(this),this.dataId=n.dataId,Do().registerTensor(this)},t}(Kt);Object.defineProperty(Vs,Symbol.hasInstance,{value:function(e){return e instanceof Kt&&e.assign!=null&&e.assign instanceof Function}});var sS,yv,bv,xv,wv;Vs.variable;function AY(e,t,n){for(var r={},o={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var l=(_=e[i]).inputs;for(var d in l){for(var p=l[d],h=!1,g=0;g<t.length;g++)if(r[p.id]){_.outputs.forEach(function(N){return r[N.id]=!0}),h=!0,o[_.id]=!0;break}if(h)break}}var y={};y[n.id]=!0;var x={};for(i=e.length-1;i>=0;i--)for(l=(_=e[i]).inputs,g=0;g<_.outputs.length;g++)if(y[_.outputs[g].id]){for(var d in l)y[l[d].id]=!0,x[_.id]=!0;break}var C=[];for(i=0;i<e.length;i++){var _;if(o[(_=e[i]).id]&&x[_.id]){var k={};for(var d in _.inputs){var A=_.inputs[d];r[A.id]&&(k[d]=A)}var I=Object.assign({},_);I.inputs=k,I.outputs=_.outputs,C.push(I)}}return C}function IY(e,t){for(var n=function(o){var i=t[o],l=[];if(i.outputs.forEach(function(x){var C=e[x.id];if(C!=null)l.push(C);else{var _=Kt.make(x.shape,{values:hd(x.size,x.dtype)},x.dtype);l.push(_)}}),i.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var d=i.gradient(i.outputs.length===1?l[0]:l);for(var p in i.inputs){if(!(p in d))throw new Error("Cannot backprop through input "+p+". Available gradients found: "+Object.keys(d)+".");var h=d[p]();if(h.dtype!=="float32")throw new Error("Error in gradient for op "+i.name+". The gradient of input "+p+" must have 'float32' dtype, but has '"+h.dtype+"'");var g=i.inputs[p];if(!Nr(h.shape,g.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+p+"' has shape '"+h.shape+"', which does not match the shape of the input '"+g.shape+"'");if(e[g.id]==null)e[g.id]=h;else{var y=e[g.id];e[g.id]=y.add(h),y.dispose()}}},r=t.length-1;r>=0;r--)n(r)}(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(sS||(sS={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(yv||(yv={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(bv||(bv={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(xv||(xv={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(wv||(wv={}));var NY={float32:xv,int32:yv,bool:bv,complex64:wv};function dr(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return NY[e][t]}function Cg(e){return dr(e,"int32")}function vr(e,t){if(e.dtype===t.dtype)return[e,t];var n=dr(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function PY(e,t){tt(e.dtype===t.dtype,"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match")}function MY(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1}function eR(e){var t=[];return nR(e,t,new Set),t}function nR(e,t,n){if(e!=null){if(e instanceof Kt)t.push(e);else if(OY(e)){var r=e;for(var o in r){var i=r[o];n.has(i)||(n.add(i),nR(i,t,n))}}}}function OY(e){return Array.isArray(e)||typeof e=="object"}var pn,FY=function(){function e(t,n,r){this.backend=t,this.safeMode=n,this.debugMode=r,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.scopeStack=[],this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.profiler=new EY(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.moveData=function(t){this.write(t,this.readSync(t))},e.prototype.tidy=function(t,n,r){var o=this;r===void 0&&(r=!1);var i,l=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");l=t}return this.scopedRun(function(){return o.startScope(l,r)},function(){return o.endScope(i,r)},function(){return(i=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(i){throw n(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.runKernel=function(t,n,r){var o,i=this,l=[],d=function(x){return l.push(x),x},p=this.activeScope.name,h=this.numBytes,g=this.numTensors;if(this.scopedRun(function(){return i.customGradientDepth++},function(){return i.customGradientDepth--},function(){o=i.debugMode()?i.profiler.profileKernel(p,function(){return t(i.backend,d)}):t(i.backend,d)}),this.shouldRecord()){var y={id:this.nextTapeNodeId++,name:p,inputs:n,outputs:Array.isArray(o)?o:[o]};r!=null&&(y.gradient=function(x){return r(x,l)}),this.activeTape.push(y)}return this.profiling&&this.activeProfile.kernels.push({name:p,bytesAdded:this.numBytes-h,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-g,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(n).map(function(x){return n[x].shape}),outputShape:Array.isArray(o)?o.map(function(x){return x.shape}):o.shape}),o},e.prototype.registerTensor=function(t){var n=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;if(this.numTensors++,t.dtype==="string"&&this.numStringTensors++,n===0){this.numDataBuffers++;var r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=ie(t.shape)*Qk(t.dtype)),this.tensorInfo.set(t.dataId,{backend:this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.numBytes+=r,this.backend.register(t.dataId,t.shape,t.dtype)}this.tensorInfo.get(t.dataId).refCount++,t instanceof Vs||this.track(t)},e.prototype.registerVariable=function(t){if(this.registeredVariables[t.name]!=null)throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},e.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--,t.dtype==="string"&&this.numStringTensors--;var n=this.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.numBytes-=n.bytes),this.numDataBuffers--,n.backend.disposeData(t.dataId),this.tensorInfo.delete(t.dataId)):this.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var n=this.registeredVariables[t];this.disposeTensor(n),delete this.registeredVariables[t]}},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,this.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return Re(this,void 0,void 0,function(){var n,r;return Te(this,function(o){return this.profiling=!0,n=this.numBytes,r=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-n,this.activeProfile.newTensors=this.numTensors-r,[2,this.activeProfile]})})},e.prototype.shouldRecord=function(){return this.activeTape!=null&&this.customGradientDepth===0},e.prototype.addTapeNode=function(t,n,r){var o={};t.forEach(function(l,d){o[d]=l});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:o,outputs:[n],gradient:function(l){var d={};return r(l).forEach(function(p,h){d[h]=function(){return p}}),d}};this.activeTape.push(i)},e.prototype.keep=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},e.prototype.startScope=function(t,n){n===void 0&&(n=!1),n&&this.gradientScopeCount===0&&(this.activeTape=[]),n&&this.gradientScopeCount++;var r={track:[],name:"unnamed scope"};t&&(r.name=t),this.scopeStack.push(r),this.activeScope=r},e.prototype.endScope=function(t,n){var r=this;n===void 0&&(n=!1),n&&(this.gradientScopeCount--,this.gradientScopeCount===0&&(this.activeTape=null));var o=new Set(this.keepTensors),i=eR(t);i.forEach(function(h){return o.add(h.id)});for(var l=0;l<this.activeScope.track.length;l++){var d=this.activeScope.track[l];o.has(d.id)||(this.activeTape!=null?i.push(d):d.dispose())}var p=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],i.forEach(function(h){!r.keepTensors.has(h.id)&&MY(h,p.track)&&r.track(h)})},e.prototype.gradients=function(t,n,r,o){var i=this;if(o===void 0&&(o=!1),tt(n.length>0,"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");return this.tidy("gradients",function(){var l=t();tt(l instanceof Kt,"The result y returned by f() must be a tensor.");var d=AY(i.activeTape,n,l);if(!o&&d.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var p={};return p[l.id]=r??$Y(l.shape),IY(p,d),{value:l,grads:n.map(function(h){return p[h.id]})}},!0)},e.prototype.customGrad=function(t){var n=this;return tt(gv(t),"The f passed in customGrad(f) must be a function."),function(){for(var r,o,i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];return tt(i.every(function(d){return d instanceof Kt}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),n.scopedRun(function(){return n.customGradientDepth++},function(){return n.customGradientDepth--},function(){o=n.tidy(t.name,function(){var d=t.apply(void 0,i),p=d.value,h=d.gradFunc;return tt(p instanceof Kt,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),tt(gv(h),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r=h,p},!0)}),n.shouldRecord()&&n.addTapeNode(i,o,function(d){var p=r(d),h=Array.isArray(p)?p:[p];return tt(h.length===i.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),tt(h.every(function(g){return g instanceof Kt}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),h}),o}},e.prototype.write=function(t,n){var r=this.tensorInfo.get(t);if(r.dtype==="string"){var o=wY(n);this.numBytes+=o-r.bytes,r.bytes=o}this.backend!==r.backend&&(r.backend.disposeData(t),r.backend=this.backend,this.backend.register(t,r.shape,r.dtype)),this.backend.write(t,n)},e.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},e.prototype.fromPixels=function(t,n){return this.backend.fromPixels(t,n)},e.prototype.time=function(t){return Re(this,void 0,void 0,function(){var n,r;return Te(this,function(o){switch(o.label){case 0:return n=fp(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=fp()-n,[2,r]}})})},e.prototype.track=function(t){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&this.activeScope.track.push(t),t},e.nextTensorId=0,e.nextVariableId=0,e}();function $Y(e){var t=tR(ie(e),"float32");return Kt.make(e,{values:t})}(function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"})(pn||(pn={}));var Sg,BY=[{name:"DEBUG",type:pn.BOOLEAN},{name:"IS_BROWSER",type:pn.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:pn.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:pn.BOOLEAN},{name:"WEBGL_PACK",type:pn.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:pn.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:pn.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:pn.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:pn.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:pn.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:pn.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:pn.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:pn.BOOLEAN},{name:"WEBGL_VERSION",type:pn.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:pn.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:pn.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:pn.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:pn.NUMBER},{name:"BACKEND",type:pn.STRING},{name:"EPSILON",type:pn.NUMBER},{name:"PROD",type:pn.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:pn.BOOLEAN}];function uS(e){try{if(oi(e)!=null)return!0}catch{return!1}return!1}function LY(e){if(Sg==null){var t=oi(e);Sg=t.getParameter(t.MAX_TEXTURE_SIZE)}return Sg}function WY(e){if(e===0)return 0;var t=oi(e);return Bs(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:Bs(t,"EXT_disjoint_timer_query")?1:0}function UY(e){if(e===0)return!1;var t=oi(e);if(e===1){if(!Bs(t,"OES_texture_float"))return!1}else if(!Bs(t,"EXT_color_buffer_float"))return!1;return oR(t,e)}function zY(e){if(e===0)return!1;var t=oi(e);if(e===1){if(!Bs(t,"OES_texture_float")||!Bs(t,"WEBGL_color_buffer_float"))return!1}else if(!Bs(t,"EXT_color_buffer_float"))return!1;return oR(t,e)}function VY(e){return e===2&&oi(e).fenceSync!=null}function HY(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var cS="tfjsflags";function rR(){var e={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return e;var t=GY(window.location.search);if(cS in t){var n={};t[cS].split(",").forEach(function(r){var o=r.split(":"),i=o[0],l=o[1];n[i]=l}),BY.forEach(function(r){r.name in n&&(console.log("Setting feature override from URL "+r.name+": "+n[r.name]),r.type===pn.NUMBER?e[r.name]=+n[r.name]:r.type===pn.BOOLEAN?e[r.name]=n[r.name]==="true":r.type===pn.STRING?e[r.name]=n[r.name]:console.warn("Unknown URL param: "+r.name+"."))})}return e}function Bs(e,t){return e.getExtension(t)!=null}function oR(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var o=t===2?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,o,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),i}function GY(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(n){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return qY(t,r[0],r[1]),r.join("=")}),t}function qY(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}var jY=1e-4,KY=.1,XY=1e-7,YY=.001,ka=function(){function e(t){this.features={},this.registry={},t!=null&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(t,n){if(!(t in ot.registry))throw new Error("Backend name '"+t+"' not found in registry");ot.engine.backend=ot.findBackend(t),ot.backendName=t},e.getBackend=function(){return ot.initEngine(),ot.backendName},e.disposeVariables=function(){ot.engine.disposeVariables()},e.memory=function(){return ot.engine.memory()},e.profile=function(t){return ot.engine.profile(t)},e.tidy=function(t,n){return ot.engine.tidy(t,n)},e.dispose=function(t){eR(t).forEach(function(n){return n.dispose()})},e.keep=function(t){return ot.engine.keep(t)},e.time=function(t){return ot.engine.time(t)},e.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(t,n){this.features[t]=n},e.prototype.getBestBackendName=function(){var t=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(n){return{name:n,entry:t.registry[n]}}).sort(function(n,r){return r.entry.priority-n.entry.priority})[0].name},e.prototype.evaluateFeature=function(t){if(t==="DEBUG")return!1;if(t==="IS_BROWSER")return typeof window<"u";if(t==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(t==="IS_CHROME")return HY();if(t==="WEBGL_CPU_FORWARD")return!0;if(t==="WEBGL_PACK")return!1;if(t==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(t==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(t==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(t==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(t==="WEBGL_PAGING_ENABLED")return this.get("IS_BROWSER")&&!this.get("PROD");if(t==="WEBGL_MAX_TEXTURE_SIZE")return LY(this.get("WEBGL_VERSION"));if(t==="IS_TEST")return!1;if(t==="BACKEND")return this.getBestBackendName();if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var n=this.get("WEBGL_VERSION");return n===0?0:WY(n)}if(t==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!fY();if(t==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(t==="WEBGL_VERSION")return uS(2)?2:uS(1)?1:0;if(t==="WEBGL_RENDER_FLOAT32_ENABLED")return UY(this.get("WEBGL_VERSION"));if(t==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return zY(this.get("WEBGL_VERSION"));if(t==="WEBGL_FENCE_API_ENABLED")return VY(this.get("WEBGL_VERSION"));if(t==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(t==="TEST_EPSILON")return this.backend.floatPrecision()===32?YY:KY;if(t==="EPSILON")return this.backend.floatPrecision()===32?XY:jY;if(t==="PROD")return!1;if(t==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");throw new Error("Unknown feature "+t+".")},e.prototype.setFeatures=function(t){this.features=Object.assign({},t)},e.prototype.reset=function(){this.features=rR(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(e.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),e.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},e.prototype.registerBackend=function(t,n,r,o){var i=this;if(r===void 0&&(r=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),o!=null&&o(function(){return i.engine}),!1;try{var l=n();return l.setDataMover({moveData:function(d){return i.engine.moveData(d)}}),this.registry[t]={backend:l,priority:r},!0}catch(d){return console.warn("Registration of backend "+t+" failed"),console.warn(d.stack||d.message),!1}},e.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){var t=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var n=this.findBackend(this.backendName);this.globalEngine=new FY(n,!1,function(){return t.get("DEBUG")})}},e}();function QY(){var e;if(typeof window<"u")e=window;else{if(typeof process>"u")throw new Error("Could not find a global object");e=process}return e}function JY(){var e=QY();return e.ENV==null&&(e.ENV=new ka(rR()),_0(function(){return e.ENV.engine})),e.ENV}var ot=JY();function ZY(e,t){if(tt(gv(e),"The f passed in variableGrads(f) must be a function"),tt(t==null||Array.isArray(t)&&t.every(function(p){return p instanceof Vs}),"The varList passed in variableGrads(f, varList) must be an array of variables"),t==null)for(var n in t=[],ot.engine.registeredVariables)t.push(ot.engine.registeredVariables[n]);var r=t.length;tt((t=t.filter(function(p){return p.trainable})).length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var o=ot.engine.gradients(e,t,null,!0),i=o.value,l=o.grads;tt(l.some(function(p){return p!=null}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),tt(i.rank===0,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor");var d={};return t.forEach(function(p,h){l[h]!=null&&(d[p.name]=l[h])}),{value:i,grads:d}}function md(e){return ot.engine.customGrad(e)}var rn=ka.tidy,wn=ka.keep,tQ=ka.dispose;ka.time;ka.profile;function Cv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ot.get("IS_TEST")||console.warn.apply(console,e)}function pp(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,l=0;l<i;++l)o=o.concat([e[l+1]/t[l],t[l]]);o=o.concat(e.slice(i+1))}return o}function hp(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],l=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?l.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,l)}return r}function mp(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function aR(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function iR(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function sR(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function eQ(e,t,n){for(var r=e.length+t.length,o=[],i=0,l=0,d=0;d<r;d++)n.indexOf(d)===-1?o.push(e[i++]):o.push(t[l++]);return o}function ur(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(i){return e[i]})]}function $o(e,t){return eQ(e,t.map(function(n){return 1}),t)}function Or(e,t){var n=t.length;return tt((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e),tt(e.every(function(r){return Fo(r)}),"All values in axis param must be integers but got axis "+e),e.map(function(r){return r<0?n+r:r})}function Zr(e,t,n){tt(sR(t,n),e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input.")}function Ra(e,t){if(sR(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function E0(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function Ta(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function nQ(e,t){var n=e[0].length;e.forEach(function(o,i){tt(o.length===n,"Error in concat"+n+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+n+")")}),tt(t>=0&&t<n,"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+".");var r=e[0];e.forEach(function(o,i){for(var l=0;l<n;l++)tt(l===t||o[l]===r[l],"Error in concat"+n+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+".")})}function Ql(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function uR(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var l=e.shape,d=n.slice();d.pop();var p=1;for(i=r;i<e.rank;++i)p*=l[i],d.push(l[i]);var h=nu(e.shape).map(function(g){return g/p}).concat([1]).slice(0,r);return[d,o,p,h]}var cR=30;function lS(e){return e<=cR?e:vv(e,Math.floor(Math.sqrt(e)))}function rQ(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var l=0;l<o;++l)if(n.shape[l]!==t.shape[l])throw new Error(i+" updates.shape["+l+"] ("+n.shape[l]+") != indices.shape["+l+"] ("+t.shape[l]+").");for(l=0;l<n.rank-o;++l)if(n.shape[l+o]!==e[l+r])throw new Error(i+" updates.shape["+(l+o)+"] ("+n.shape[l+o]+") != shape["+(l+o)+"] ("+e[l+o]+")")}function oQ(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}rQ(n,t,e)}function gp(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,o=n.length,i=1,l=r;l<o;++l)i*=n[l];var d=r<1?1:r,p=t.size/d,h=nu(n).concat([1]);return{sliceRank:r,numUpdates:p,sliceSize:i,strides:h.slice(h.length-r,h.length),outputSize:ie(n)}}function aQ(e,t){var n,r=!1;for(e<=cR?(n=e,r=!0):n=vv(e,Math.floor(Math.sqrt(e)));!r;){if(n>t||n===e){r=!0;break}n=vv(e,n+1)}return n}function iQ(e,t,n){for(var r=[],o=e.length,i=0;i<o;i++)i!==t?r.push(e[i]):r.push(n);return r}function sQ(e,t,n){tt(e.rank===t.length,"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."),tt(e.rank===n.length,"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+").");for(var r=0;r<e.rank;++r)tt(t[r]+n[r]<=e.shape[r],"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")")}function lR(e,t,n,r,o,i,l,d,p){if(o===void 0&&(o=0),i===void 0&&(i=0),l===void 0&&(l=0),d===void 0&&(d=0),p===void 0&&(p=0),l!==0)throw new Error("ellipsis mask is not yet supported");if(d!==0)throw new Error("new axis mask is not yet supported");for(var h=[],g=[],y=[],x=0;x<e.length;x++)h[x]=uQ(o,t,r,e,x),g[x]=cQ(i,n,r,e,x),p&1<<x&&(g[x]=h[x]+1,y.push(x));var C=new Array(e.length).fill(0);return C=C.map(function(_,k){for(var A=0,I=h[k];!(r[k]>0?I>=g[k]:I<=g[k]);I+=r[k])A+=1;return A}),[h,C,y]}function uQ(e,t,n,r,o){var i=t[o];e&1<<o&&(i=n[o]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var l=r[o];return i<0&&(i+=l),i=hv(0,i,l-1)}function cQ(e,t,n,r,o){var i=t[o];e&1<<o&&(i=n[o]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var l=r[o];return i<0&&(i+=l),i=n[o]>0?hv(0,i,l):hv(-1,i,l-1)}function es(e){var t=e;if(Xa(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];t instanceof Array||Xa(t);)n.push(t.length),t=t[0];return e instanceof Array&&ot.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&dR(e,n,[]),n}function dR(e,t,n){if(n=n||[],e instanceof Array||Xa(e)){tt(t.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),tt(e.length===t[0],function(){return"Element arr["+n.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"});for(var r=t.slice(1),o=0;o<e.length;++o)dR(e[o],r,n.concat(o))}else tt(t.length===0,function(){return"Element arr["+n.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function dS(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function G(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof Kt)return dS(r,e.dtype,t,n),e;var o=Kp(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),dS(r,o,t,n),!Xa(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+e.constructor.name+"'");var i=es(e);Xa(e)||Array.isArray(e)||(e=[e]);var l=o!=="string"?Zk(e,o,ot.get("DEBUG")):cc(e);return Kt.make(i,{values:l},o)}function vp(e,t,n){if(!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(r,o){return G(r,t+"["+o+"]",n)})}function ct(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];ot.engine.startScope(n);try{var d=r.apply(void 0,i);return d instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ot.engine.endScope(d),d}catch(p){throw ot.engine.endScope(null),p}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}function lQ(e,t){t===void 0&&(t=-1);var n=G(e,"logits","softmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return md(function(r){var o=r.logSumExp([t],!0),i=r.toFloat().sub(o).exp();return{value:i,gradFunc:function(l){var d=l.mul(i);return d.sub(d.sum([t],!0).mul(i))}}})(n)}function dQ(e,t){t===void 0&&(t=-1);var n=G(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return md(function(r){var o=r.max(t,!0),i=r.sub(o),l=i.toFloat().sub(i.exp().sum(t,!0).log());return{value:l,gradFunc:function(d){var p=l.exp();return d.sub(d.sum(t,!0).mul(p))}}})(n)}var Xp=ct({softmax_:lQ}),fQ=ct({logSoftmax_:dQ});function pQ(e,t){var n=G(e,"real","complex"),r=G(t,"imag","complex");return an(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),ot.engine.runKernel(function(o){return o.complex(n,r)},{$real:n,$imag:r})}function hQ(e){var t=G(e,"input","real");return ot.engine.runKernel(function(n){return n.real(t)},{$input:t})}function mQ(e){var t=G(e,"input","imag");return ot.engine.runKernel(function(n){return n.imag(t)},{$input:t})}var Yr=ct({complex_:pQ}),ja=ct({real_:hQ}),Ns=ct({imag_:mQ});function An(e,t,n){if(n==null&&(n=Kp(e)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Xa(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var r=es(e);if(t!=null){var o=ie(t),i=ie(r);tt(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var l=0;l<r.length;++l){var d=r[l],p=l!==r.length-1||d!==ie(t.slice(l));tt(r[l]===t[l]||!p,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return Xa(e)||Array.isArray(e)||(e=[e]),t=t||r,e=n!=="string"?Zk(e,n,ot.get("DEBUG")):cc(e),Kt.make(t,{values:e},n)}function Lt(e,t){if((Xa(e)||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return An(e,[],t)}function Ya(e,t){xc(e);var n=es(e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return An(e,n,t)}function Yp(e,t,n){if(xc(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=es(e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return An(e,t=t||r,n)}function fR(e,t,n){if(xc(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=es(e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return An(e,t=t||r,n)}function fa(e,t,n){if(xc(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=es(e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return An(e,t=t||r,n)}function gQ(e,t,n){if(xc(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=es(e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return An(e,t=t||r,n)}function vQ(e,t,n){if(xc(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=es(e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return An(e,t=t||r,n)}function qi(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=qi(e,"float32"),r=qi(e,"float32");return Yr(n,r)}var o=tR(ie(e),t);return Kt.make(e,{values:o},t)}function jn(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=jn(e,"float32"),r=jn(e,"float32");return Yr(n,r)}var o=hd(ie(e),t);return Kt.make(e,{values:o},t)}function ec(e,t,n){var r=Yk(n=n||Kp(t),ie(e));return r.fill(t),Kt.make(e,{values:r},n)}function yQ(e){var t=G(e,"x","onesLike");return qi(t.shape,t.dtype)}function bQ(e){var t=G(e,"x","zerosLike");return jn(t.shape,t.dtype)}function xQ(e,t,n){if(n===0)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),o=hd(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Ya(o,"float32")}function pR(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return jn([0],r);var o=hd(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return Ya(o,r)}var wQ=ct({onesLike_:yQ}),_n=ct({zerosLike_:bQ}),hR=function(){function e(t){this.dataMover=t,this.data=new WeakMap}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},e.prototype.set=function(t,n){this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.data.delete(t)},e}();function mR(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=jn(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!xY(e.dtype,t))return Kt.make(e.shape,{dataId:e.dataId},t);if(e.dtype==="complex64"){var l=n.real(e);return i=l.cast(t),l.dispose(),i}if(t==="int32")return n.int(e);if(t==="bool"){var d=Lt(0,e.dtype);return i=n.notEqual(e,d),d.dispose(),i}throw new Error("Error in Cast: unknown dtype argument ("+t+")")}function Sv(e,t){return Kt.make(t,{dataId:e.dataId},e.dtype)}function gR(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function CQ(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function SQ(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function _Q(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function fS(e,t){return{real:e[2*t],imag:e[2*t+1]}}function EQ(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function kQ(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var i=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}function RQ(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function k0(e,t,n,r,o){for(var i=Array.from(t).map(function(C,_){return{score:C,boxIndex:_}}).filter(function(C){return C.score>o}).sort(function(C,_){return _.score-C.score}),l=[],d=0;d<i.length;d++){var p=i[d],h=p.score,g=p.boxIndex;if(h<o)break;for(var y=!1,x=l.length-1;x>=0;--x)if(TQ(e,g,l[x])>=r){y=!0;break}if(!y&&(l.push(g),l.length>=n))break}return Ya(l,"int32")}function TQ(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),l=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),h=Math.min(o[0],o[2]),g=Math.min(o[1],o[3]),y=Math.max(o[0],o[2]),x=Math.max(o[1],o[3]),C=(d-i)*(p-l),_=(y-h)*(x-g);if(C<=0||_<=0)return 0;var k=Math.max(i,h),A=Math.max(l,g),I=Math.min(d,y),N=Math.min(p,x),D=Math.max(I-k,0)*Math.max(N-A,0);return D/(C+_-D)}function vR(e,t,n){var r=Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(i){o[n]=i;var l=e.slice(r,o);return r[n]+=i,l})}function yR(e,t,n,r,o){for(var i=t[t.length-1],l=[e.length/i,i],d=l[0],p=l[1],h=mv(n,d*r),g=mv("int32",d*r),y=0;y<d;y++){for(var x=y*p,C=e.subarray(x,x+p),_=[],k=0;k<C.length;k++)_.push({value:C[k],index:k});_.sort(function(M,F){return F.value-M.value});var A=y*r,I=h.subarray(A,A+r),N=g.subarray(A,A+r);for(k=0;k<r;k++)I[k]=_[k].value,N[k]=_[k].index}var D=t.slice();return D[D.length-1]=r,[An(h,D,n),An(g,D,"int32")]}var DQ=function(){return function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,l=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,l];var d=t==="max"?">":"<",p=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+p+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+d+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}(),AQ=function(){return function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,l=e.dilationWidth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=d-1-e.padInfo.top,g=p-1-e.padInfo.left,y=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+g+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+p+`;
            wC+= `+l+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}();function Ps(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,l=e[i]||1;(t[t.length-1-o]||1)>1&&l===1&&r.unshift(i)}return r}function mr(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,l=t[i];(o==null||o===1&&l>1)&&n.unshift(i)}return n}function IQ(e){for(var t=0;t<e.length;t++)if(e[t]!==t)return!1;return!0}function je(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var l=t[t.length-o-1];if(l==null&&(l=1),i===1)n.unshift(l);else if(l===1)n.unshift(i);else{if(i!==l)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}var NQ=function(){return function(e,t,n,r,o,i){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],je(e,t),je(e,n);var l="0.0";r!=null&&(je(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var d="1.0";o!=null&&(je(e,o),this.variableNames.push("scale"),d="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+l+`;
        float scale = `+d+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),PQ=function(){return function(e,t,n,r,o,i){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],je(e,t),je(e,n);var l="vec4(0.0)";r!=null&&(je(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");var d="vec4(1.0)";o!=null&&(je(e,o),this.variableNames.push("scale"),d="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+l+`;
        vec4 scale = `+d+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),pS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},hS=function(){return function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=je(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),R0=`
  if (isNaN(a)) return a;
  if (isNaN(b)) return b;
`,mS="return a + b;",gS="return a - b;",MQ="return a * b;",OQ=`if (a == b) return 1.0;
  return a / b;`,FQ=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,$Q=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,BQ="return (a - b) * (a - b);",LQ="return float(a == b);",WQ="return float(a != b);",UQ="return float(a < b);",zQ="return float(a <= b);",VQ="return float(a > b);",HQ="return float(a >= b);",GQ="return float(a >= 1.0 && b >= 1.0);",qQ="return float(a >= 1.0 || b >= 1.0);",jQ=R0+`
  return max(a, b);
`,KQ=R0+`
  return min(a, b);
`,XQ=`if (b == 0.0) return NAN;
  return mod(a, b);`,YQ=R0+`
  return atan(a, b);
`,QQ="return (b >= 1.0) ? a : a * (b + 1.0);",Ln=function(){function e(t,n,r){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=je(n,r),this.userCode=`
      uniform float NAN;
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}return e.prototype.getCustomSetupFunc=function(){var t=this;return function(n,r){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(r,"NAN"),t.startLoc==null)||n.gl.uniform1f(t.startLoc,NaN)}},e}(),JQ=function(){return function(e,t,n){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      void main() {
        float value = getAAtOutCoords();
        if (isNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, float(`+t+"), float("+n+`)));
      }
    `}}(),ZQ=function(){return function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (hasNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(`+t+"), vec4("+n+`)));
      }
    `}}(),tJ=function(){return function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),eJ=function(){return function(e,t){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=Ql([e,t],1),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        float value = 0.0;
        if (yC < `+e[1]+`) {
          value = getA(yR, yC);
        } else {
          yC -= `+e[1]+`;
          value = getB(yR, yC);
        }

        setOutput(value);
      }
    `}}(),nJ=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),rJ=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,l=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),oJ=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,l=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+l+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),aJ=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,d=t-1-e.padInfo.front,p=n-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+l+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),iJ=function(){return function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),sJ=function(){return function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,l=n-1-e.padInfo.left,d=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+d+`; dm++) {
              int d2 = d1 * `+d+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),uJ=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,l=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,h=4*Math.floor(e.inChannels/4),g=e.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+o+`);
      const ivec2 pads = ivec2(`+t+", "+n+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+i+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(g===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+h+`) *
                getW(wR, wC, `+h+`, d2);
            } else if (`+(g===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(g===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+h+`),
                getX(batch, xR, xC, `+h+` + 1),
                getX(batch, xR, xC, `+h+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),cJ=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,p=e.dilationHeight,h=e.dilationWidth,g=e.filterDepth,y=e.filterHeight,x=e.filterWidth,C=4*Math.floor(e.inChannels/4),_=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+l+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+g+`; wF++) {
          int xF = xFCorner + wF * `+d+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+y+`; wR++) {
            int xR = xRCorner + wR * `+p+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+C+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(_===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+C+`) *
                  getW(wF, wR, wC, `+C+`, d2);
              } else if (`+(_===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+C+`),
                  getX(batch, xF, xR, xC, `+C+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+C+`, d2),
                  getW(wF, wR, wC, `+C+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(_===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+C+`),
                  getX(batch, xF, xR, xC, `+C+` + 1),
                  getX(batch, xF, xR, xC, `+C+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+C+`, d2),
                  getW(wF, wR, wC, `+C+` + 1, d2),
                  getW(wF, wR, wC, `+C+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),lJ=function(){return function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,p=e.dilationWidth,h=e.filterHeight,g=e.filterWidth,y=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+l+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+y+`;
        int q = d2 - d1 * `+y+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+t+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+n+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),dJ=function(){return function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.strideHeight,l=e.strideWidth,d=e.filterHeight,p=e.filterWidth,h=Math.ceil((p+1)/2),g="int xR; int xC;",y=0;y<d;y++){for(var x=-o;x<2*h;x++)g+="vec4 "+ko(y,x)+" = vec4(0.);";for(x=0;x<p;x++)g+=`
          vec4 wR`+y+"C"+x+` = vec4(0.);
          vec4 xR`+y+"C"+x+" = vec4(0.);"}for(y=0;y<d;y++)for(x=0;x<h;x++){var C=2*x,_=2*x+o;g+=`
          xR = xRCorner + `+y+`;
          xC = xCCorner + `+_+`;

          if(xR >= 0 && xR < `+t+" && xC >= 0 && xC < "+n+`) {
            `+ko(y,_)+` = getX(batch, xR, xC, d1);
          }`,o===0?C<p&&x===h-1&&(l>1&&(g+=`
                vec4 `+ko(y,_+2)+` = vec4(0.);

                if(xR >= 0 && xR < `+t+" && xC + 2 < "+n+`) {
                  `+ko(y,_+2)+` = getX(batch, xR, xC + 2, d1);
                }`),g+=`
              xR`+y+"C"+_+" = "+_g(y,_,l,o)+`;
            `):x===0&&(g+=`
            if(xR >= 0 && xR < `+t+` && xC - 2 >= 0) {
              `+ko(y,_-2)+` = getX(batch, xR, xC - 2, d1);
            }`),C>0&&(g+="xR"+y+"C"+(_-2)+` =
            `+_g(y,_-2,l,o)+";"),_-1>=0&&_-1<p&&(g+="xR"+y+"C"+(_-1)+` =
              `+_g(y,_-1,l,o)+";"),C<p&&(g+=`
            vec4 wTexel`+y+"C"+C+" = getW("+y+", "+C+`, d1, q);
            wR`+y+"C"+C+" = vec4(wTexel"+y+"C"+C+".xz, wTexel"+y+"C"+C+`.xz);
          `,C+1<p&&(g+=`
              vec4 wTexelR`+y+"C"+(C+1)+" = getW("+y+", "+(C+1)+`, d1, q);
              wR`+y+"C"+(C+1)+` =
                vec4(wTexelR`+y+"C"+(C+1)+".xz, wTexelR"+y+"C"+(C+1)+".xz);"))}for(y=0;y<d;y++)for(x=0;x<p;x++)g+="result += xR"+y+"C"+x+" * wR"+y+"C"+x+";";this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+l+`);
      const ivec2 pads = ivec2(`+r+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+g+`

        setOutput(result);
      }
    `}}();function ko(e,t){return"xTexelR"+e+"C"+(t<0?"minus"+Math.abs(t).toString():t)}function _g(e,t,n,r){return n===1?r%2==t%2?ko(e,t):"vec4("+ko(e,t-1)+".zw, "+ko(e,t+1)+".xy)":r%2==t%2?"vec4("+ko(e,t)+".xy, "+ko(e,t+2)+".xy)":"vec4("+ko(e,t-1)+".zw, "+ko(e,t+1)+".zw)"}var fJ=function(){return function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],l=e[1],d=e[2],p=e[3],h=t[0],g=n[0],y=n[1];this.outputShape=[h,g,y,p];var x=r==="bilinear"?1:0,C=[l-1+".0",d-1+".0"],_=C[0],k=C[1],A=g>1?[""+(l-1)/(g-1),"(y2-y1) * height_ratio","y1*"+_+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+_],I=A[0],N=A[1],D=A[2],M=y>1?[""+(d-1)/(y-1),"(x2-x1) * width_ratio","x1*"+k+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+k],F=M[0],W=M[1],L=M[2];this.userCode=`
      const float height_ratio = float(`+I+`);
      const float width_ratio = float(`+F+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+N+`;
        float width_scale = `+W+`;

        float in_y = `+D+`;
        if( in_y < 0.0 || in_y > `+_+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+L+`;
        if( in_x < 0.0 || in_x > `+k+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexRC = vec2(in_y,in_x);
        if(`+x+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));

          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);
          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);
          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);
          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);

          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

          float top = topLeft + (topRight - topLeft) * fracRC.y;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          float newValue = top + (bottom - top) * fracRC.x;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestRC = ivec2(floor(
            sourceFracIndexRC + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);
          setOutput(newValue);
        }
      }
    `}}();function gd(e,t,n){n===void 0&&(n="index");var r=nu(t);return r.map(function(o,i){return"int "+e[i]+" = "+n+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"}).join("")}function Af(e){return e.length===1?""+e[0]:"vec"+e.length+"("+e.join(",")+")"}function pJ(e,t){if(e.length!==t.length)throw new Error("Vectors to be dotted must be of the same length -got "+e.length+" and "+t.length);for(var n=[],r=Math.floor(e.length/4),o=e.length%4,i=0;i<r;i++){var l=e.slice(4*i,4*i+4),d=t.slice(4*i,4*i+4);n.push(Af(l)+", "+Af(d))}return o!==0&&(l=e.slice(4*r),d=t.slice(4*r),l.length===1&&(l=l.map(function(p){return"float("+p+")"}),d=d.map(function(p){return"float("+p+")"})),n.push(Af(l)+", "+Af(d))),n.map(function(p,h){return"dot("+p+")"}).join("+")}function hJ(e,t,n,r,o){var i=e.map(function(y){var x=ie(y.shapeInfo.logicalShape);return y.shapeInfo.isUniform?"uniform float "+y.name+(x>1?"["+x+"]":"")+";":"uniform sampler2D "+y.name+";"});i=i.join(`
`);var l,d,p=e.map(function(y){return mJ(y,t,r,o)}).join(`
`),h=t.texShape,g=RJ;return t.isPacked?(l=gJ(t.logicalShape,h),d=kJ):(l=vJ(t.logicalShape,h),d=EJ),o&&(g+=TJ),[g,_J,d,i,l,p,n].join(`
`)}function wc(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return WJ(e);case 1:return zJ(e);case 2:return HJ(e);case 3:return qJ(e);case 4:return KJ(e);case 5:return XJ(e);case 6:return YJ(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function bR(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return LJ(e);case 1:return UJ(e);case 2:return VJ(e);case 3:return GJ(e);case 4:return jJ(e);default:throw new Error("Packed "+t.length+"-D input sampling is not yet supported")}}function mJ(e,t,n,r){r===void 0&&(r=!1);var o=QJ(e);return o+=r?bR(e):wc(e),(n||Nr(e.shapeInfo.logicalShape,t.logicalShape))&&(o+=r?ZJ(e,t):tZ(e,t,n)),o}function gJ(e,t){switch(e.length){case 0:return xR();case 1:return DJ(e,t);case 2:return $J(e,t);case 3:return IJ(e,t);case 4:return PJ(e,t);default:throw new Error(e.length+"-D packed output coordinate fetching is not yet supported")}}function vJ(e,t){switch(e.length){case 0:return xR();case 1:return AJ(e,t);case 2:return BJ(e,t);case 3:return NJ(e,t);case 4:return MJ(e,t);case 5:return OJ(e,t);case 6:return FJ(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}}var yJ=`
vec2 UVfrom1D(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,bJ=`
vec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {
  int index = row * numC + col;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xJ=`
vec2 UVfrom3D(int texNumR, int texNumC, int stride0,
    int stride1, int row, int col, int depth) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wJ=`
vec2 UVfrom4D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int row, int col, int depth,
    int depth2) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,
    int texelsInBatch, int texelsInLogicalRow, int b2, int b,
    int row, int col) {
  int index = b2 * texelsInBatch2 + b * texelsInBatch +
    (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CJ=`
vec2 UVfrom5D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int row, int col, int depth,
    int depth2, int depth3) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 +
              depth * stride2 + depth2 * stride3 + depth3;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SJ=`
vec2 UVfrom6D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int stride4,
    int row, int col, int depth, int depth2, int depth3, int depth4) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *
    stride3 + depth3 * stride4 + depth4;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_J=`
  float sampleTexture(sampler2D textureSampler, vec2 uv) {
    return texture2D(textureSampler, uv).r;
  }
`,EJ=`
  void setOutput(float val) {
    gl_FragColor = vec4(val, 0, 0, 0);
  }
`,kJ=`
  void setOutput(vec4 val) {
    gl_FragColor = val;
  }
`,RJ=`
  precision highp float;
  precision highp int;
  varying vec2 resultUV;
  const vec2 halfCR = vec2(0.5, 0.5);

  struct ivec5
  {
    int x;
    int y;
    int z;
    int w;
    int u;
  };

  struct ivec6
  {
    int x;
    int y;
    int z;
    int w;
    int u;
    int v;
  };

  `+(ot.get("PROD")?`
    bool isNaN(float val) {
      return false;
    }

    bool hasNaN(vec4 values) {
      return false;
    }
  `:`
    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    bool hasNaN(vec4 values) {
      return any(bvec4(
        isNaN(values.x),
        isNaN(values.y),
        isNaN(values.z),
        isNaN(values.w)
      ));
    }
  `)+`

  float getNaN(vec4 values) {
    return dot(vec4(1), values);
  }

  int round(float value) {
    return int(floor(value + 0.5));
  }

  int imod(int x, int y) {
    return x - y * (x / y);
  }

  //Based on the work of Dave Hoskins
  //https://www.shadertoy.com/view/4djSRW
  #define HASHSCALE1 443.8975
  float random(float seed){
    vec2 p = resultUV * seed;
    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
  }

  `+yJ+`
  `+bJ+`
  `+xJ+`
  `+wJ+`
  `+CJ+`
  `+SJ+`
`,TJ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function xR(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function DJ(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return t[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+n[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+n[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      return resTexRC.x * `+n[1]+` + resTexRC.y;
    }
  `}function AJ(e,t){return t[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+t[1]+`.0);
      }
    `:t[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+t[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      return resTexRC.x * `+t[1]+` + resTexRC.y;
    }
  `}function IJ(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec3(b, r, c);
    }
  `}function NJ(e,t){var n=gd(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+n+`
      return ivec3(r, c, d);
    }
  `}function PJ(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[3]/2),o=r*Math.ceil(e[2]/2),i=o*e[1];return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b2 = index / `+i+`;
      index -= b2 * `+i+`;

      int b = index / `+o+`;
      index -= b * `+o+`;

      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec4(b2, b, r, c);
    }
  `}function MJ(e,t){var n=gd(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      `+n+`
      return ivec4(r, c, d, d2);
    }
  `}function OJ(e,t){var n=gd(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+t[0]+`,
                             `+t[1]+`));

      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+n+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function FJ(e,t){var n=gd(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;

      `+n+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function $J(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Nr(e,t))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+n[0]+", "+n[1]+`));
      }
    `;var r=Math.ceil(e[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));

      int index = resTexRC.x * `+n[1]+` + resTexRC.y;
      int r = 2 * (index / `+r+`);
      int c = imod(index, `+r+`) * 2;

      return ivec2(r, c);
    }
  `}function BJ(e,t){return Nr(e,t)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+t[0]+", "+t[1]+`));
      }
    `:e[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+t[0]+", "+t[1]+`));
        int index = resTexRC.x * `+t[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+t[0]+", "+t[1]+`));
      int index = resTexRC.x * `+t[1]+` + resTexRC.y;
      int r = index / `+e[1]+`;
      int c = index - r * `+e[1]+`;
      return ivec2(r, c);
    }
  `}function LJ(e){var t=e.name;return`
    vec4 `+("get"+t.charAt(0).toUpperCase()+t.slice(1))+`() {
      return texture2D(`+t+`, halfCR);
    }
  `}function WJ(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);return e.shapeInfo.isUniform?"float "+n+"() {return "+t+";}":`
    float `+n+`() {
      return sampleTexture(`+t+`, halfCR);
    }
  `}function UJ(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 `+n+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return texture2D(`+t+`, uv);
    }
  `}function zJ(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);return`
    float `+n+`(int index) {
      return `+n+`Flat(index);
    }
  `}function VJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=o[0],l=o[1];if(o!=null&&Nr(t,o))return`
      vec4 `+r+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+i+`.0);

        return texture2D(`+n+`, uv);
      }
    `;var d=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 `+r+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(t[1]/2)+", "+d[0]+", "+d[1]+`, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function HJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(o!=null&&Nr(t,o)){var i=o[0];return`
    float `+r+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+o[1]+".0, "+i+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `}var l=eu(t),d=l.newShape,p=l.keptDims,h=d;if(h.length<t.length)return`
      `+wc(Cc(e,h))+`
      float `+r+`(int row, int col) {
        return `+r+"("+Sc(["row","col"],p)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col) {
        float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=o[0],y=o[1];return y===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:g===1?`
    float `+r+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      vec2 uv = vec2((index + 0.5) / `+y+`.0, 0.5);
      return sampleTexture(`+n+`, uv);
    }
  `:`
  float `+r+`(int row, int col) {
    vec2 uv = UVfrom2D(`+g+", "+y+", "+t[1]+`, row, col);
    return sampleTexture(`+n+`, uv);
  }
`}function GJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1)return`
        `+bR(Cc(e,t.slice(1)))+`
        vec4 `+r+`(int b, int row, int col) {
          return `+r+"("+Sc(["b","row","col"],[1,2])+`);
        }
      `;var l=i[0],d=i[1],p=Math.ceil(t[2]/2);return`
    vec4 `+r+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+l+", "+d+", "+p*Math.ceil(t[1]/2)+", "+p+`, b, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function qJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],i=t[2],l=eu(t),d=l.newShape,p=l.keptDims,h=d;if(h.length<t.length)return`
        `+wc(Cc(e,h))+`
        float `+r+`(int row, int col, int depth) {
          return `+r+"("+Sc(["row","col","depth"],p)+`);
        }
      `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth) {
        float index = dot(vec3(row, col, depth),
                          vec3(`+o+", "+i+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=e.shapeInfo.texShape,y=g[0],x=g[1];return x===o?`
        float `+r+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+i+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+y+`.0);
          return sampleTexture(`+n+`, uv);
        }
      `:x===i?`
    float `+r+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+y+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:`
      float `+r+`(int row, int col, int depth) {
        vec2 uv = UVfrom3D(
            `+y+", "+x+", "+o+", "+i+`, row, col, depth);
        return sampleTexture(`+n+`, uv);
      }
  `}function jJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=i[0],d=i[1],p=Math.ceil(t[3]/2),h=p*Math.ceil(t[2]/2);return`
    vec4 `+r+`(int b2, int b, int row, int col) {
      vec2 uv = packedUVfrom4D(
        `+l+", "+d+", "+h*t[1]+`,
        `+h+", "+p+`, b2, b, row, col);
      return texture2D(`+n+`, uv);
    }
  `}function KJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],i=t[2]*o,l=t[1]*i,d=eu(t),p=d.newShape,h=d.keptDims;if(p.length<t.length)return`
      `+wc(Cc(e,p))+`
      float `+r+`(int row, int col, int depth, int depth2) {
        return `+r+"("+Sc(["row","col","depth","depth2"],h)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2) {
        float index = dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+i+", "+o+`, 1));
        return `+r+`Flat(round(index));
      }
    `;var g=e.shapeInfo.texShape,y=g[0],x=g[1];return x===l?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2), vec3(`+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:x===o?`
      float `+r+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2) {
      vec2 uv = UVfrom4D(`+y+", "+x+", "+l+", "+i+`,
          `+o+`, row, col, depth, depth2);
      return sampleTexture(`+n+`, uv);
    }
  `}function XJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],i=t[3]*o,l=t[2]*i,d=t[1]*l,p=eu(t),h=p.newShape,g=p.keptDims;if(h.length<t.length)return`
      `+wc(Cc(e,h))+`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        return `+r+"("+Sc(["row","col","depth","depth2","depth3"],g)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+d+", "+l+", "+i+", "+o+`)) +
          depth3;
        return `+r+`Flat(index);
      }
    `;var y=e.shapeInfo.texShape,x=y[0],C=y[1];return C===d?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+l+", "+i+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+C+".0, "+x+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:C===o?`
      float `+r+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]+", "+t[2]*t[3]+`,
            `+t[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+C+".0, "+x+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth, int depth2, int depth3) {
      vec2 uv = UVfrom5D(`+x+", "+C+", "+d+", "+l+`,
          `+i+", "+o+`, row, col, depth, depth2, depth3);
      return sampleTexture(`+n+`, uv);
    }
  `}function YJ(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[5],i=t[4]*o,l=t[3]*i,d=t[2]*l,p=t[1]*d,h=eu(t),g=h.newShape,y=h.keptDims;if(g.length<t.length)return`
      `+wc(Cc(e,g))+`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+r+"("+Sc(["row","col","depth","depth2","depth3","depth4"],y)+`);
      }
    `;if(e.shapeInfo.isUniform)return`
      float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+l+", "+i+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+o+`, 1));
        return `+r+`Flat(index);
      }
    `;var x=e.shapeInfo.texShape,C=x[0],_=x[1];return _===p?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+l+", "+i+", "+o+`)) + depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:_===o?`
      float `+r+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]*t[4]+`,
               `+t[2]*t[3]*t[4]+`,
               `+t[3]*t[4]+`,
               `+t[4]+`)) + depth3;
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+C+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+r+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      vec2 uv = UVfrom6D(`+C+", "+_+", "+p+", "+d+`,
          `+l+", "+i+", "+o+`
          ,row, col, depth, depth2, depth3, depth4);
      return sampleTexture(`+n+`, uv);
    }
  `}function QJ(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1)+"Flat",r=ie(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform)return r===1?"float "+n+"(int index) {return "+t+";}":`
      float `+n+`(int index) {
        for (int i = 0; i < `+r+`; i++) {
          if (i == index) {
            return `+t+`[i];
          }
        }
      }
    `;var o=e.shapeInfo.texShape,i=o[0],l=o[1];return l===1&&i===1?`
      float `+n+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `:l===1?`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index) + 0.5) / `+i+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:i===1?`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index) + 0.5) / `+l+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+n+`(int index) {
      vec2 uv = UVfrom1D(`+i+", "+l+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function JJ(e,t,n,r){var o=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,l="int";i===2?l="ivec2":i===3?l="ivec3":i===4&&(l="ivec4");var d=Ps(e.shapeInfo.logicalShape,t.logicalShape),p=i-o;return`
    float `+r+`() {
      `+l+` coords = getOutputCoords();
      `+(o===0?"":i<2&&d.length>=1?"coords = 0;":d.map(function(h){return"coords["+(h+p)+"] = 0;"}).join(`
`))+`
      return get`+n+"("+(i<2&&o>0?"coords":e.shapeInfo.logicalShape.map(function(h,g){return"coords["+(g+p)+"]"}).join(", "))+`);
    }
  `}function ZJ(e,t,n){var r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,l="get"+o+"AtOutCoords",d=t.texShape,p=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=p[0],g=p[1],y=Ps(e.shapeInfo.logicalShape,t.logicalShape),x=e.shapeInfo.logicalShape.length,C=t.logicalShape.length;if(y.length)throw Error("Packed broadcast sampling is not implemented yet.");if(Nr(e.shapeInfo.texShape,d))return`
      vec4 `+l+`() {
        return texture2D(`+r+`, resultUV);
      }
    `;var _="return texture2D("+r+", uv)";return x===1&&C>1?_=`
      vec4 sample = texture2D(`+r+`, uv);
      return vec4(sample.xy, sample.xy);
    `:x===0&&C>0&&(_=C===1?`
        vec4 sample = texture2D(`+r+`, uv);
        return vec4(sample.x, sample.x, 0., 0.);
      `:`
        vec4 sample = texture2D(`+r+`, uv);
        return vec4(sample.x);
      `),`
    vec4 `+l+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+p[0]+", "+p[1]+`));
      int index = resTexRC.x * `+p[1]+` + resTexRC.y;

      int texR = index / `+g+`;
      int texC = index - texR * `+g+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+", "+h+`);

      `+_+`;
    }
  `}function tZ(e,t,n){var r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",l=Ps(e.shapeInfo.logicalShape,t.logicalShape),d=e.shapeInfo.logicalShape.length,p=t.logicalShape.length,h=n&&(p>d||l.length>0),g=IQ(l),y=e.shapeInfo.isUniform;if(h&&!g)return JJ(e,t,o,i);var x=ie(e.shapeInfo.logicalShape),C="";h&&g&&(C=`
        int mainPart = index / `+x+`;
        index -= mainPart * `+x+`;
      `);var _=t.texShape;if(y)return x===1?"float "+i+"() {return "+r+";}":`
      float `+i+`() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                              vec2(`+_[0]+", "+_[1]+`));
        int index = resTexRC.x * `+_[1]+` + resTexRC.y;
        `+C+`
        return get`+o+`Flat(index);
      }
    `;var k=e.shapeInfo.texShape;return Nr(k,_)?`
      float `+i+`() {
        return sampleTexture(`+r+`, resultUV);
      }
    `:`
    float `+i+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      `+C+`
      int texR = index / `+k[1]+`;
      int texC = index - texR * `+k[1]+`;
      vec2 uv = (vec2(texC, texR) + halfCR) /
                 vec2(`+k[1]+".0, "+k[0]+`.0);

      return sampleTexture(`+r+`, uv);
    }
  `}function Pr(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Cc(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Sc(e,t){return t.map(function(n){return e[n]}).join(", ")}var eZ=function(){return function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Pr(r)+` coords = getOutputCoords();
        int end = `+vS(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+vS(r,"coords")+` = idx;
          val += getX(`+nZ(r,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function nZ(e,t){if(e===1)return""+t;if(e===2)return t+".x, "+t+".y";if(e===3)return t+".x, "+t+".y, "+t+".z";if(e===4)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}function vS(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var rZ=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),oZ=function(){return function(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isNaN(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        gl_FragColor = encode_float(x);
      }
    `}}(),yS={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},bS=function(){return function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),aZ=function(){return function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = texture2D(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),iZ=function(){return function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Pr(this.rank),i=sZ(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}}();function sZ(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(n===1)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<e.length;i++)i===t?o.push("int(getIndices("+r[i]+"))"):o.push(""+r[i]);return o.join()}var ma,to,uZ=function(){return function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Pr(t.length),o=Pr(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function _c(e,t){return[t,e]}function Ec(e,t){return e*t}function cZ(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}function lZ(e,t,n){var r=Ec(e.length,n);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var o=0,i=0;i<e.length;++i)t[o]=e[i],o+=n}function wR(e,t,n){var r=cZ(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var o=0,i=0;i<e.length;i+=n)t[o++]=e[i]}function ru(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Qp(e,t){var n=ru(e,t);return n[0]*n[1]*4}function dZ(e,t,n,r,o){var i=Qp(n,r);if(o.length<i)throw new Error("packedRGBA length ("+o.length+`) must be >=
        `+i);for(var l=r%2==1,d=n%2==1,p=Math.floor(r/2),h=Math.floor(n/2),g=Math.ceil(r/2),y=g*Math.ceil(n/2),x=Xl(n)*Xl(r),C=0;C<t;C++){for(var _=C*n*r,k=C*x,A=l?4:0,I=r,N=k,D=0;D<h;++D){for(var M=2*D*r,F=0;F<p;++F){var W=_+M+2*F;o[N]=e[W],o[N+1]=e[W+1],o[N+2]=e[W+I],o[N+3]=e[W+I+1],N+=4}N+=A}if(l){W=_+r-1,N=k+4*(g-1);var L=2*r;for(A=4*g,D=0;D<h;++D)o[N]=e[W],o[N+2]=e[W+r],W+=L,N+=A}if(d){for(W=_+(n-1)*r,N=k+4*(y-g),F=0;F<p;++F)o[N++]=e[W++],o[N++]=e[W++],N+=2;l&&d&&(o[k+x-4]=e[W])}}return o}function CR(e,t,n,r,o){var i=n*r;if(o.length<i)throw new Error("matrix length ("+o.length+") must be >= "+i);for(var l=r%2==1,d=n%2==1,p=Math.floor(r/2),h=Math.floor(n/2),g=Math.ceil(r/2),y=g*Math.ceil(n/2),x=Xl(n)*Xl(r),C=0;C<t;C++){for(var _=C*n*r,k=C*x,A=l?4:0,I=r+(l?1:0),N=k,D=_,M=_+r,F=0;F<h;++F){for(var W=0;W<p;++W)o[D++]=e[N++],o[D++]=e[N++],o[M++]=e[N++],o[M++]=e[N++];N+=A,D+=I,M+=I}if(l){N=k+4*(g-1);var L=_+r-1;for(A=4*g,I=2*r,F=0;F<h;++F)o[L]=e[N],o[L+r]=e[N+2],N+=A,L+=I}if(d){for(N=k+4*(y-g),L=_+(n-1)*r,W=0;W<p;++W)o[L++]=e[N++],o[L++]=e[N++],N+=2;l&&(o[_+n*r-1]=e[N])}}return o}function ae(e,t){var n=t();return pZ(e),n}(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(ma||(ma={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(to||(to={}));var SR=!1;function fZ(e){SR=e}function pZ(e){if(SR){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+hZ(e,t))}}function hZ(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function If(e,t){return ai(e,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function mZ(e,t){var n=ai(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ae(e,function(){return e.shaderSource(n,t)}),ae(e,function(){return e.compileShader(n)}),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function gZ(e,t){var n=ai(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ae(e,function(){return e.shaderSource(n,t)}),ae(e,function(){return e.compileShader(n)}),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw yZ(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var vZ=/ERROR: [0-9]+:([0-9]+):/g;function yZ(e,t){var n=vZ.exec(t);if(n==null)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split(`
`),i=o.length.toString().length+2,l=o.map(function(x,C){return tc((C+1).toString(),i)+x}),d=0,p=0;p<l.length;p++)d=Math.max(l[p].length,d);var h=l.slice(0,r-1),g=l.slice(r-1,r),y=l.slice(r);console.log(h.join(`
`)),console.log(t.split(`
`)[0]),console.log("%c "+tc(g[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(y.join(`
`))}function bZ(e){return ai(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function xZ(e,t){if(ae(e,function(){return e.linkProgram(t)}),e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Eg(e,t){if(ae(e,function(){return e.validateProgram(t)}),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function wZ(e,t){var n=ai(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ae(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),ae(e,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function CZ(e,t){var n=ai(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ae(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)}),ae(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),n}function SZ(){return ot.get("WEBGL_VERSION")===2?1:4}function _Z(e){return ai(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function _R(e,t){var n=ot.get("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function EZ(e){return ai(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function xS(e,t,n,r,o,i,l){var d=e.getAttribLocation(t,n);return d!==-1&&(ae(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),ae(e,function(){return e.vertexAttribPointer(d,o,e.FLOAT,!1,i,l)}),ae(e,function(){return e.enableVertexAttribArray(d)}),!0)}function kZ(e,t,n){IZ(e,n),ae(e,function(){return e.activeTexture(e.TEXTURE0+n)}),ae(e,function(){return e.bindTexture(e.TEXTURE_2D,t)})}function RZ(e,t,n){return ai(e,function(){return e.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function TZ(e,t,n){return e.getUniformLocation(t,n)}function DZ(e,t,n,r,o){ae(e,function(){return kZ(e,n,o)}),ae(e,function(){return e.uniform1i(r,o)})}function kg(e,t,n){ae(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),ae(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})}function wS(e,t){ae(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),ae(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Nf(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+AZ(e,t))}function AZ(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function ai(e,t,n){var r=ae(e,function(){return t()});if(r==null)throw new Error(n);return r}function IZ(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function NZ(e,t){t===void 0&&(t=!1);var n=ot.get("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map(function(i,l){return l>=e.length-2?Xl(e[l]):e[l]})),e.length!==2){var r=eu(e);e=r.newShape}var o=ie(e);return e.length<=1&&o<=n?[1,o]:e.length===2&&e[0]<=n&&e[1]<=n?e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n?[e[0],e[1]*e[2]*e[3]]:gY(o)}function Wu(e){return e%2==0}function CS(e,t){if(Nr(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Wu(n)&&Wu(r)&&(e[0]===1||t[0]===1))return!0}else if(Wu(e[0])&&Wu(t[0])&&(Wu(e[1])&&Wu(t[1])||e[1]===t[1]))return!0;return!1}function PZ(e){return mZ(e,`
    precision highp float;
    attribute vec3 clipSpacePos;
    attribute vec2 uv;
    varying vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function MZ(e){return wZ(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function OZ(e){return CZ(e,new Uint16Array([0,1,2,2,1,3]))}function FZ(e,t){var n,r,o,i,l,d,p,h=e;return ot.get("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,o=h.RGBA32F,i=h.RED,l=4,d=1,p=h.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,o=h.RGBA,i=e.RGBA,l=4,d=4,p=t!=null?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:p}}function vd(e,t,n,r,o,i){_R(t,n);var l=_Z(e),d=e.TEXTURE_2D;return ae(e,function(){return e.bindTexture(d,l)}),ae(e,function(){return e.texParameteri(d,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),ae(e,function(){return e.texParameteri(d,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),ae(e,function(){return e.texParameteri(d,e.TEXTURE_MIN_FILTER,e.NEAREST)}),ae(e,function(){return e.texParameteri(d,e.TEXTURE_MAG_FILTER,e.NEAREST)}),ae(e,function(){return e.texImage2D(d,0,r,t,n,0,o,i,null)}),ae(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),l}function $Z(e,t,n,r){var o=_c(t,n);return vd(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,e.FLOAT)}function BZ(e,t,n,r){var o=_c(t,n);return vd(e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function LZ(e,t,n,r){var o=_c(t,n);return vd(e,o[0],o[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function WZ(e,t,n,r){var o=ru(t,n);return vd(e,o[0],o[1],r.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function UZ(e,t,n,r){var o=ru(t,n);return vd(e,o[0],o[1],r.internalFormatHalfFloat,e.RGBA,r.textureTypeHalfFloat)}function zZ(e,t,n){return ae(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),xS(e,t,"clipSpacePos",n,3,20,0)&&xS(e,t,"uv",n,2,20,12)}function VZ(e,t,n){ae(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),ae(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}),ae(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function ER(e,t,n,r,o,i){_R(n,r),ae(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),ae(e,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,i,e.FLOAT,o)}),ae(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function HZ(e,t,n,r,o,i,l){var d,p=_c(n,r),h=p[0],g=p[1];l.defaultNumChannels===1?d=o:lZ(o,d=new Float32Array(Ec(o.length,i)),i),ER(e,t,h,g,d,l.textureFormatFloat)}function GZ(e,t,n,r,o,i,l,d,p){var h=ru(i,l),g=h[0],y=h[1],x=new Float32Array(n*Qp(r,o));dZ(d,n,r,o,x),ER(e,t,g,y,x,e.RGBA)}function qZ(e,t,n,r,o){var i=t;if(ot.get("WEBGL_VERSION")===2){var l=e,d=l.createBuffer();ae(e,function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,d)});var p=4*Ec(n*r,o.downloadUnpackNumChannels);ae(e,function(){return e.bufferData(l.PIXEL_PACK_BUFFER,p,e.STATIC_DRAW)}),ae(e,function(){return l.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),ae(e,function(){return e.bindBuffer(l.PIXEL_PACK_BUFFER,null)}),i=d}return i}function jZ(e,t,n,r,o){var i=e,l=new Float32Array(Ec(n*r,o.downloadUnpackNumChannels));i.bindBuffer(e.ARRAY_BUFFER,t),i.getBufferSubData(e.ARRAY_BUFFER,0,l),i.bindBuffer(e.ARRAY_BUFFER,null);var d=new Float32Array(n*r);return wR(l,d,o.downloadUnpackNumChannels),d}function KZ(e,t,n,r){var o=_c(t,n),i=o[0],l=o[1],d=new Float32Array(Ec(t*n,r.downloadUnpackNumChannels));ae(e,function(){return e.readPixels(0,0,i,l,r.downloadTextureFormat,e.FLOAT,d)});var p=new Float32Array(t*n);return wR(d,p,r.downloadUnpackNumChannels),p}function XZ(e,t,n,r){var o=_c(t,n),i=o[0],l=o[1],d=new Uint8Array(Ec(t*n,4));return ae(e,function(){return e.readPixels(0,0,i,l,r.downloadTextureFormat,e.UNSIGNED_BYTE,d)}),new Float32Array(d.buffer)}function YZ(e,t,n,r,o,i,l,d){var p=e,h=new Float32Array(Qp(i,l));p.bindBuffer(e.ARRAY_BUFFER,t),p.getBufferSubData(e.ARRAY_BUFFER,0,h),p.bindBuffer(e.ARRAY_BUFFER,null);var g=new Float32Array(ie([n,r,o]));return CR(h,n,r,o,g),g}function QZ(e,t,n,r,o,i,l){var d=ru(o,i),p=d[0],h=d[1],g=new Float32Array(Qp(o,i));ae(e,function(){return e.readPixels(0,0,p,h,e.RGBA,e.FLOAT,g)});var y=new Float32Array(ie([t,n,r]));return CR(g,t,n,r,y)}var JZ=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=t??oi(ot.get("WEBGL_VERSION")),ot.get("WEBGL_VERSION")===1?(this.textureFloatExtension=If(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),ot.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=If(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=If(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=MZ(this.gl),this.indexBuffer=OZ(this.gl),this.framebuffer=EZ(this.gl),this.textureConfig=FZ(this.gl,this.textureHalfFloatExtension)}return e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;ae(n,function(){return n.finish()}),ae(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ae(n,function(){return n.deleteFramebuffer(t.framebuffer)}),ae(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),ae(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),ae(n,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,fZ(t)},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),$Z(this.gl,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),BZ(this.gl,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),LZ(this.gl,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),VZ(this.gl,t,n)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),UZ(this.gl,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),WZ(this.gl,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(wS(this.gl,this.framebuffer),this.outputTexture=null),ae(this.gl,function(){return n.gl.deleteTexture(t)})},e.prototype.uploadMatrixToTexture=function(t,n,r,o){this.throwIfDisposed();var i=SZ();return HZ(this.gl,t,n,r,o,i,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(t,n,r,o,i,l,d){return this.throwIfDisposed(),GZ(this.gl,t,n,r,o,i,l,d,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return KZ(o.gl,n,r,o.textureConfig)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return XZ(o.gl,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,i,l){return YZ(this.gl,t,n,r,o,i,l,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n,r){return jZ(this.gl,t,n,r,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=qZ(this.gl,t,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(ot.get("WEBGL_FENCE_API_ENABLED")){var i=t,l=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var d=i.clientWaitSync(l,0,0);return d===i.ALREADY_SIGNALED||d===i.CONDITION_SATISFIED},n=l}else ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r,o,i,l){var d=this;return this.downloadMatrixDriver(t,function(){return QZ(d.gl,n,r,o,i,l,d.textureConfig)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=gZ(n,t),o=PZ(n),i=bZ(n);return ae(n,function(){return n.attachShader(i,o)}),ae(n,function(){return n.attachShader(i,r)}),xZ(n,i),this.autoDebugValidate&&Eg(n,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=zZ(n,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&ae(this.gl,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.autoDebugValidate&&Eg(this.gl,this.program),ae(this.gl,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?RZ(this.gl,t,n):TZ(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),ae(this.gl,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),DZ(this.gl,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=ru(n,r),i=o[0],l=o[1];this.setOutputMatrixTextureDriver(t,i,l)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Eg(this.gl,this.program),Nf(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),ae(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),ae(this.gl,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=If(this.gl,ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return Re(this,void 0,void 0,function(){var n=this;return Te(this,function(r){switch(r.label){case 0:return[4,aS(function(){return n.disposed||n.isQueryAvailable(t,ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=ZZ(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||aS(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),kg(this.gl,t,this.framebuffer),this.autoDebugValidate&&Nf(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(kg(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&Nf(this.gl)):wS(this.gl,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;kg(o,t,this.framebuffer),this.autoDebugValidate&&Nf(o),this.outputTexture=t,ae(o,function(){return o.viewport(0,0,n,r)}),ae(o,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var i=this;this.throwIfDisposed(),ae(this.gl,function(){return i.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function ZZ(e){for(var t=0,n=e.length-1,r=-1;t<=n;){var o=t+n>>1;e[o]()?(r=o,t=o+1):n=o-1}return r}function ttt(e,t,n,r){for(var o=t.userCode,i=n.map(function(C,_){var k={logicalShape:C.shape,texShape:C.isUniform?null:C.texData.texShape,isUniform:C.isUniform,isPacked:!C.isUniform&&C.texData.isPacked};return{name:t.variableNames[_],shapeInfo:k}}),l=i.map(function(C){return C.shapeInfo}),d={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked},p=hJ(i,d,o,t.supportsBroadcasting===!0,t.usesPackedTextures),h=e.createProgram(p),g={},y=0;y<t.variableNames.length;y++){var x=t.variableNames[y];g[x]=e.getUniformLocation(h,x,!1)}return{program:t,source:p,webGLProgram:h,uniformLocations:g,gpgpu:e,inShapeInfos:l,outShapeInfo:d}}function SS(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,i=t[r],l=i.shape;if(!Nr(o,l))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+l+" must match");if(!n.isUniform||!i.isUniform){var d=n.texShape,p=i.isUniform?null:i.texData.texShape;if(!Nr(d,p))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+d+" and "+p+" must match")}})}function ett(e,t,n,r){SS(e.inShapeInfos,t),SS([e.outShapeInfo],[n]);var o=n.texData.texture,i=n.texData.texShape,l=e.gpgpu;n.texData.isPacked?l.setOutputPackedMatrixTexture(o,i[0],i[1]):l.setOutputMatrixTexture(o,i[0],i[1]),l.setProgram(e.webGLProgram),t.forEach(function(d,p){var h=e.program.variableNames[p],g=e.uniformLocations[h];if(g!=null){if(d.isUniform){if(ie(d.shape)===1)l.gl.uniform1f(g,d.uniformValues[0]);else{var y=d.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),l.gl.uniform1fv(g,y)}return}var x=d.texData.texture;l.setInputMatrixTexture(x,g,p)}}),r!=null&&r(l,e.webGLProgram),l.executeProgram()}function ntt(e,t,n){var r="";t.concat(n).forEach(function(d){r+=d.shape+"_"+(d.isUniform?"uniform":d.texData.texShape)});var o=e.userCode,i=(e.supportsBroadcasting===!0).toString(),l=e.constructor.name;return l+="_"+i+"_"+r+"_"+o}var rtt=function(){return function(e,t,n){this.variableNames=["A"],this.outputShape=e;var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,l=n.strideHeight,d=n.padInfo,p=n.outWidth,h=n.dilationWidth,g=n.dilationHeight,y=d.left,x=d.top,C=o*r;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+e[1]+" || pos >= "+e[0]+`) continue;

            int offsetY = int(blockIndex / (`+p+")) * "+l+" - "+x+`;
            int d0 = offsetY + `+g+" * (pos / "+C+`);

            if(d0 >= `+t[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+p+".) * "+i+". - "+y+`.);
            int d1 = offsetX + `+h+" * (int(mod(float(pos), "+C+".) / "+o+`.));

            if(d1 >= `+t[1]+` || d1 < 0) continue;

            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), `+o+`.)));
          }
        }

        gl_FragColor = result;
      }
    `}}(),ott=function(){return function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,l=t,d=e[3]-1;this.outputShape=e;var p="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+p+")":o===1?"1.0/("+p+")":"exp(log("+p+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+l+"; j <= "+l+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+d+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `}}(),att=function(){return function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),itt=function(){return function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,l=o-1-e.padInfo.top,d=i-1-e.padInfo.left,p=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+p+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),stt=function(){return function(e,t,n,r){n===void 0&&(n=!1),r===void 0&&(r=!1),this.variableNames=["matrixA","matrixB"];var o=e[0],i=n?e[2]:e[1],l=r?t[1]:t[2],d=n?e[1]:e[2];this.outputShape=[o,i,l];var p=function(x,C){return n?"batch, "+C+" + "+x+", aRow":"batch, aRow, "+C+" + "+x},h=function(x,C){return r?"batch, bCol, "+C+" + "+x:"batch, "+C+" + "+x+", bCol"},g=4*Math.floor(d/4),y=d%4;this.userCode=` float dotARowBCol(int batch, int aRow, int bCol) {
      float result = 0.0;
      for (int i = 0; i < `+g+`; i += 4) {
        vec4 a = vec4(
          getMatrixA(`+p(0,"i")+`),
          getMatrixA(`+p(1,"i")+`),
          getMatrixA(`+p(2,"i")+`),
          getMatrixA(`+p(3,"i")+`)
        );
        vec4 b = vec4(
          getMatrixB(`+h(0,"i")+`),
          getMatrixB(`+h(1,"i")+`),
          getMatrixB(`+h(2,"i")+`),
          getMatrixB(`+h(3,"i")+`)
        );

        result += dot(a, b);
      }

      if (`+(y===1)+`) {
        result += getMatrixA(`+p(0,g)+`) *
          getMatrixB(`+h(0,g)+`);
      } else if (`+(y===2)+`) {
        vec2 a = vec2(
          getMatrixA(`+p(0,g)+`),
          getMatrixA(`+p(1,g)+`)
        );
        vec2 b = vec2(
          getMatrixB(`+h(0,g)+`),
          getMatrixB(`+h(1,g)+`)
        );
        result += dot(a, b);
      } else if (`+(y===3)+`) {
        vec3 a = vec3(
          getMatrixA(`+p(0,g)+`),
          getMatrixA(`+p(1,g)+`),
          getMatrixA(`+p(2,g)+`)
        );
        vec3 b = vec3(
          getMatrixB(`+h(0,g)+`),
          getMatrixB(`+h(1,g)+`),
          getMatrixB(`+h(2,g)+`)
        );
        result += dot(a, b);
      }

      return result;
    }

    void main() {
      ivec3 resBRC = getOutputCoords();
      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));
    }
    `}}(),_S=function(){return function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=n;var i=r?e[0]:e[1],l=Math.ceil(i/2),d=r?"i * 2, rc.x":"rc.x, i * 2",p=o?"rc.y, i * 2":"i * 2, rc.y",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode=`
      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec2 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(`+d+`);
          vec4 b = getMatrixB(`+p+`);

          result += (`+h[0]+" * "+g[0]+") + ("+h[1]+" * "+g[1]+`);
        }
        return result;
      }

      void main() {
        ivec2 rc = getOutputCoords();
        setOutput(dot2x2ARowBCol(rc));
      }
    `}}(),utt=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),ctt=function(){return function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `}}();function ltt(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function kR(e,t){return t===1?[e]:ltt(e,t)}function dtt(e,t){if(e===1)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}var ftt=function(){return function(e){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=kR("rc",t),r=Pr(t),o=htt(t,e,n),i=mtt(t,e[e.length-1],e[e.length-2],n),l=gtt(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+l+`));
          }
        }
      `}}}();function ptt(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(r===0?"r":"rp1")+", "+(o===0?"c":"cp1"),l=2;l<e;l++)i=t[t.length-1-l]+","+i;n.push(i)}return n}function htt(e,t,n){if(e===1)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}function mtt(e,t,n,r){if(e===1)return"";var o=r.slice(-2);return`
    int r = `+o[0]+`;
    int c = `+o[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+t+`;
    bool rEdge = rp1 >= `+n+`;
  `}function gtt(e,t){var n=e.length,r=ptt(n,t);return n===1?`getA(rc),
            rc + 1 >= `+e[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+r[0]+`),
          cEdge ? 0. : getA(`+r[1]+`),
          rEdge ? 0. : getA(`+r[2]+`),
          rEdge || cEdge ? 0. : getA(`+r[3]+")"}var vtt=function(){return function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(p,h){return p[0]+e[h]+p[1]});var r=e.length,o=Pr(r),i=t.map(function(p){return p[0]}).join(","),l=t.map(function(p,h){return p[0]+e[h]}).join(","),d=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+l+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+d+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+l+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),Rg=function(){return function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterHeight,h=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var x=t==="avg",C="0.0";if(x||(C="-1.0 / 0.0"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+g+", "+y+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+p+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+d+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(_="avgValue / count");var k=4*Math.floor(r/4),A=r%4,I=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+g+", "+y+`);
      const float initializationValue = `+C+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+C+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+p+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+k+`; wC += 4) {
            int xC = xCCorner + wC * `+d+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              getValue(batch, xR, xC + 2 * `+d+`, d),
              getValue(batch, xR, xC + 3 * `+d+`, d)
            );

            `+I+`
          }

          int xC = xCCorner + `+k+`;
          if (`+(A===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+I+`
          } else if (`+(A===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              initializationValue,
              initializationValue
            );

            `+I+`
          } else if (`+(A===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+d+`, d),
              getValue(batch, xR, xC + 2 * `+d+`, d),
              initializationValue
            );

            `+I+`
          }
        }
        setOutput(`+_+`);
      }
    `}}}(),ytt=function(){return function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var l="0.0",d="";t==="prod"?l="1.0":t==="min"?(l="1.0 / 0.0",d="min"):t==="max"&&(l="-1.0 / 0.0",d="max");var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?p="sumValue":t==="prod"?p="prodValue":t==="all"?p="allValue":t==="any"&&(p="anyValue");var h=4*Math.floor(n/4),g=n%4,y=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+d+`(values, minMaxValue);
      }
    `,x="vec4";t==="all"?(l="1.0",y=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,x="bvec4"):t==="any"&&(l="0.0",y=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,x="bvec4");var C="";o%n>0&&(C=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+l+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+C+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+l+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+y+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(g===1)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+y+`
        } else if (`+(g===2)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+y+`
        } else if (`+(g===3)+`) {
          `+x+" values = "+x+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+y+`
        }
        setOutput(`+p+`);
      }
    `}}(),btt=function(){return function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      `+wtt(t)+`
      `+xtt(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `}}();function xtt(e){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+pJ(["coords.x","coords.y","coords.z"],nu(e).map(function(t){return t.toString()}).concat(["1."]))+`);
    }
  `}function wtt(e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+gd(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  `}var Ctt=function(){return function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],l=e.shape,d=l[1],p=l[2],h=[n&&d>1?o-1:o,n&&p>1?i-1:i],g=[n&&d>1?d-1:d,n&&p>1?p-1:p],y=h[0]/g[0],x=h[1]/g[1],C=1/y,_=1/x,k=2*Math.ceil(C)+2,A=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+y+`);
        const float widthScale = float(`+x+`);

        const float invHeightScale = float(`+C+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+k+`);
        const int winWidth = int(`+A+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+d+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+p+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),Stt=function(){return function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],l=e[2],d=e[3];this.outputShape=[o,t,n,d];var p=[r&&t>1?i-1:i,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+p[0]/h[0]+`,
          `+p[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),_tt=function(){return function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],l=e.shape,d=l[1],p=l[2],h=[n&&d>1?o-1:o,n&&p>1?i-1:i],g=[n&&d>1?d-1:d,n&&p>1?p-1:p],y=h[0]/g[0],x=h[1]/g[1],C=1/y,_=1/x,k=2*Math.ceil(C)+2,A=2*Math.ceil(_)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+y+`);
        const float widthScale = float(`+x+`);

        const float invHeightScale = float(`+C+`);
        const float invWidthScale = float(`+_+`);

        const int winHeight = int(`+k+`);
        const int winWidth = int(`+A+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+d+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+p+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+g[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+g[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),Ett=function(){return function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],l=e[2],d=e[3];this.outputShape=[o,t,n,d];var p=[r&&t>1?i-1:i,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],g=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+p[0]/h[0]+`,
          `+p[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+g+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),ktt=function(){return function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(i,l){return function(d){return t.indexOf(d)!==-1&&e[d]!==1?e[d]+" - coords["+d+"] - 1":"coords["+d+"]"}(l)}).join(","),o=Pr(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `}}(),ES=function(){return function(e,t,n,r,o,i,l){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var d=Pr(o.length),p=Pr(i.length),h="";n===1?h="i":n===2&&(h="i, j");var g="getIndices("+h+")",y="";r===1?y="i":r===2&&(y="i, coords[1]");var x="getUpdates("+y+")",C=t>1?"strides[j]":"strides";this.userCode=`
        `+d+" strides = "+d+"("+o+`);

        void main() {
          `+p+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+g+`);
              flattenedIndex += index * `+C+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+x+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),Rtt=function(){return function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,l=i*Math.ceil(o/n);this.outputShape=[r,l];var d=4*Math.floor(n/4),p=n%4,h=`
        sumValue += dot(values, filter);
    `,g="";o%n>0&&(g=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var y="";o%n>0&&(y=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+g+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+y+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+d+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+d+`;
        if (`+(p===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(p===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(p===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `}}(),Ttt=function(){return function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=[],p=0;p<t.length;p++)d.push(""+i[p]),p<e&&l.push(""+i[p]);r=l.join(),o=d.join()}var h=Pr(n);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `}}(),Dtt=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Pr(this.rank),r=Att(this.rank);this.userCode=`
      uniform `+n+` start;

      void main() {
        `+n+` sourceLoc = start + getOutputCoords();
        setOutput(getSource(`+r+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){if(n.startLoc!=null||(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc!=null))if(n.rank===1)r.gl.uniform1i(n.startLoc,t[0]);else if(n.rank===2)r.gl.uniform2i(n.startLoc,t[0],t[1]);else if(n.rank===3)r.gl.uniform3i(n.startLoc,t[0],t[1],t[2]);else{if(n.rank!==4)throw Error("Slicing for rank "+n.rank+" is not yet supported");r.gl.uniform4i(n.startLoc,t[0],t[1],t[2],t[3])}}},e}();function Att(e){if(e===1)return"sourceLoc";if(e===2)return"sourceLoc.x, sourceLoc.y";if(e===3)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(e===4)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+e+" is not yet supported")}var Itt=function(){return function(e,t,n,r){this.variableNames=["x"];var o=n.filter(function(g,y){return r.indexOf(y)===-1});this.outputShape=o;var i=n.length,l=Pr(n.length),d=Pr(o.length),p="";if(i===1)p="coords * strides + begin";else{var h=0;p=n.map(function(g,y){return r.indexOf(y)===-1?(h++,o.length===1?"coords * strides["+y+"] + begin["+y+"]":"coords["+(h-1)+"] * strides["+y+"] + begin["+y+"]"):"begin["+y+"]"}).join(",")}this.userCode=`
      `+l+" begin = "+l+"("+e+`);
      `+l+" strides = "+l+"("+t+`);

      void main() {
        `+d+` coords = getOutputCoords();
        setOutput(getX(`+p+`));
      }
    `}}(),Ntt=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,i=kS(n,r),l=RS(t,i,r);if(l in this.freeTextures||(this.freeTextures[l]=[]),l in this.usedTextures||(this.usedTextures[l]=[]),this.freeTextures[l].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var d=this.freeTextures[l].shift();return this.usedTextures[l].push(d),d}return this.numUsedTextures++,this.log(),i===to.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===to.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===to.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===to.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===to.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[l].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var i=RS(n,kS(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var l=this.usedTextures[i],d=l.indexOf(t);if(d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(d,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function kS(e,t){if(e===ma.UPLOAD)return t?to.PACKED_2X2_FLOAT32:to.UNPACKED_FLOAT32;if(e===ma.RENDER||e==null)return t?ot.get("WEBGL_RENDER_FLOAT32_ENABLED")?to.PACKED_2X2_FLOAT32:to.PACKED_2X2_FLOAT16:ot.get("WEBGL_RENDER_FLOAT32_ENABLED")?to.UNPACKED_FLOAT32:to.UNPACKED_FLOAT16;if(e===ma.DOWNLOAD||e===ma.PIXELS)return to.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function RS(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Ptt=function(){return function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Pr(this.rank),i=Mtt(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `}}();function Mtt(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(t===1)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}var Ott=function(){return function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Pr(this.rank),i=Ftt(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `}}();function Ftt(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}var RR=.3275911,TR=.254829592,DR=-.284496736,AR=1.421413741,IR=-1.453152027,NR=1.061405429,T0=1.7580993408473768,D0=1.0507009873554805,We=function(){function e(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float NAN;
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}return e.prototype.getCustomSetupFunc=function(){var t=this;return function(n,r){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(r,"NAN"),t.startLoc==null)||n.gl.uniform1f(t.startLoc,NaN)}},e}(),ou="if (isNaN(x)) return x;",$tt="return abs(x);",Btt=ou+`
  return (x < 0.0) ? 0.0 : x;
`,Ltt="return (x >= 0.0) ? x : (exp(x) - 1.0);",Wtt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+T0+`;
  float scale = `+D0+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function Utt(e){return e===void 0&&(e=0),ou+`
    return x > 0.0 ? 1.0 : float(`+e+`);
  `}var ztt="return -x;",Vtt="return ceil(x);",Htt="return floor(x);",Gtt=`
  if (isNaN(x)) { return 0.0; }
  return sign(x);
`,qtt=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,jtt="return exp(x);",Ktt="return exp(x) - 1.0;",Xtt=`if (x < 0.0) return NAN;
  return log(x);`,Ytt="return log(1.0 + x);",Qtt="return sqrt(x);",Jtt="return inversesqrt(x);",Ztt="return 1.0 / (1.0 + exp(-1.0 * x));",tet=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,eet=ou+`
  return sin(x);
`,net=ou+`
  return cos(x);
`,ret="return tan(x);",oet="return asin(x);",aet="return acos(x);",iet=ou+`
  return atan(x);
`,set=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,uet=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,cet=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,det="return log(x + sqrt(x * x + 1.0));",fet=ou+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,pet=ou+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,het=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+RR+`;
  float a1 = `+TR+`;
  float a2 = `+DR+`;
  float a3 = `+AR+`;
  float a4 = `+IR+`;
  float a5 = `+NR+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,met="return x * x;",get="return 1.0 / x;",vet="return float(!(x >= 1.0));",yet="return float(int(x));",TS=function(){return function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=kR("rc",t),r=Pr(t),o=dtt(t,n),i=n.slice(-2),l=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+l+`));
      }
    `}}();function bet(e){return ii(e,0)}function xet(e,t){return ii(e,t)}function wet(e,t){return ii(e,t)}function Cet(e,t){return ii(e,t)}function _et(e,t){t===void 0&&(t=0),tt(e.length>=1,"Pass at least one tensor to concat");var n=vp(e,"tensors","concat");t=Or(t,n[0].shape)[0];var r=Ql(n.map(function(l){return l.shape}),t);if(ie(r)===0)return An([],r);if((n=n.filter(function(l){return l.size>0})).length===1)return n[0];var o=n.map(function(l){return l.shape});nQ(o,t);var i=n;return ot.engine.runKernel(function(l){return l.concat(n,t)},i,function(l){var d=o.map(function(p){return p[t]});return A0(l,d,t).map(function(p){return function(){return p}})})}function Eet(e,t,n){n===void 0&&(n=0);var r,o=G(e,"x","split");return n=Or(n,o.shape)[0],typeof t=="number"?(tt(o.shape[n]%t==0,"Number of splits must evenly divide the axis."),r=Array(t).fill(o.shape[n]/t)):(tt(o.shape[n]===t.reduce(function(i,l){return i+l}),"The sum of sizes must match the size of the axis dimension."),r=t),ot.engine.runKernel(function(i){return i.split(o,r,n)},{$x:o},function(i){return{$x:function(){return ii(i,n)}}})}var ii=ct({concat_:_et}),ket=ct({concat1d_:bet}),Ret=ct({concat2d_:xet}),Tet=ct({concat3d_:wet}),Det=ct({concat4d_:Cet}),A0=ct({split_:Eet});function au(e,t){return e(t={exports:{}},t.exports),t.exports}var Aet=au(function(e){(function(t,n,r){function o(l,d){return d.c=l.c,d.s0=l.s0,d.s1=l.s1,d.s2=l.s2,d}function i(l,d){var p=new function(y){var x,C=this,_=(x=4022871197,function(k){k=k.toString();for(var A=0;A<k.length;A++){var I=.02519603282416938*(x+=k.charCodeAt(A));I-=x=I>>>0,x=(I*=x)>>>0,x+=4294967296*(I-=x)}return 23283064365386963e-26*(x>>>0)});C.next=function(){var k=2091639*C.s0+23283064365386963e-26*C.c;return C.s0=C.s1,C.s1=C.s2,C.s2=k-(C.c=0|k)},C.c=1,C.s0=_(" "),C.s1=_(" "),C.s2=_(" "),C.s0-=_(y),C.s0<0&&(C.s0+=1),C.s1-=_(y),C.s1<0&&(C.s1+=1),C.s2-=_(y),C.s2<0&&(C.s2+=1),_=null}(l),h=d&&d.state,g=p.next;return g.int32=function(){return 4294967296*p.next()|0},g.double=function(){return g()+11102230246251565e-32*(2097152*g()|0)},g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.alea=i})(0,e)}),Iet=au(function(e){(function(t,n,r){function o(l,d){return d.x=l.x,d.y=l.y,d.z=l.z,d.w=l.w,d}function i(l,d){var p=new function(y){var x=this,C="";x.x=0,x.y=0,x.z=0,x.w=0,x.next=function(){var k=x.x^x.x<<11;return x.x=x.y,x.y=x.z,x.z=x.w,x.w^=x.w>>>19^k^k>>>8},y===(0|y)?x.x=y:C+=y;for(var _=0;_<C.length+64;_++)x.x^=0|C.charCodeAt(_),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xor128=i})(0,e)}),Net=au(function(e){(function(t,n,r){function o(l,d){return d.x=l.x,d.y=l.y,d.z=l.z,d.w=l.w,d.v=l.v,d.d=l.d,d}function i(l,d){var p=new function(y){var x=this,C="";x.next=function(){var k=x.x^x.x>>>2;return x.x=x.y,x.y=x.z,x.z=x.w,x.w=x.v,(x.d=x.d+362437|0)+(x.v=x.v^x.v<<4^k^k<<1)|0},x.x=0,x.y=0,x.z=0,x.w=0,x.v=0,y===(0|y)?x.x=y:C+=y;for(var _=0;_<C.length+64;_++)x.x^=0|C.charCodeAt(_),_==C.length&&(x.d=x.x<<10^x.x>>>4),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xorwow=i})(0,e)}),Pet=au(function(e){(function(t,n,r){function o(l,d){return d.x=l.x.slice(),d.i=l.i,d}function i(l,d){l==null&&(l=+new Date);var p=new function(y){var x=this;x.next=function(){var C,_,k=x.x,A=x.i;return C=k[A],_=(C^=C>>>7)^C<<24,_^=(C=k[A+1&7])^C>>>10,_^=(C=k[A+3&7])^C>>>3,_^=(C=k[A+4&7])^C<<7,C=k[A+7&7],_^=(C^=C<<13)^C<<9,k[A]=_,x.i=A+1&7,_},function(C,_){var k,A=[];if(_===(0|_))A[0]=_;else for(_=""+_,k=0;k<_.length;++k)A[7&k]=A[7&k]<<15^_.charCodeAt(k)+A[k+1&7]<<13;for(;A.length<8;)A.push(0);for(k=0;k<8&&A[k]===0;++k);for(k==8?A[7]=-1:A[k],C.x=A,C.i=0,k=256;k>0;--k)C.next()}(x,y)}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(h.x&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xorshift7=i})(0,e)}),Met=au(function(e){(function(t,n,r){function o(l,d){return d.i=l.i,d.w=l.w,d.X=l.X.slice(),d}function i(l,d){l==null&&(l=+new Date);var p=new function(y){var x=this;x.next=function(){var C,_,k=x.w,A=x.X,I=x.i;return x.w=k=k+1640531527|0,_=A[I+34&127],C=A[I=I+1&127],_^=_<<13,C^=C<<17,_^=_>>>15,C^=C>>>12,_=A[I]=_^C,x.i=I,_+(k^k>>>16)|0},function(C,_){var k,A,I,N,D,M=[],F=128;for(_===(0|_)?(A=_,_=null):(_+="\0",A=0,F=Math.max(F,_.length)),I=0,N=-32;N<F;++N)_&&(A^=_.charCodeAt((N+32)%_.length)),N===0&&(D=A),A^=A<<10,A^=A>>>15,A^=A<<4,A^=A>>>13,N>=0&&(D=D+1640531527|0,I=(k=M[127&N]^=A+D)==0?I+1:0);for(I>=128&&(M[127&(_&&_.length||0)]=-1),I=127,N=512;N>0;--N)A=M[I+34&127],k=M[I=I+1&127],A^=A<<13,k^=k<<17,A^=A>>>15,k^=k>>>12,M[I]=A^k;C.w=D,C.X=M,C.i=I}(x,y)}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(h.X&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.xor4096=i})(0,e)}),Oet=au(function(e){(function(t,n,r){function o(l,d){return d.a=l.a,d.b=l.b,d.c=l.c,d.d=l.d,d}function i(l,d){var p=new function(y){var x=this,C="";x.next=function(){var k=x.b,A=x.c,I=x.d,N=x.a;return k=k<<25^k>>>7^A,A=A-I|0,I=I<<24^I>>>8^N,N=N-k|0,x.b=k=k<<20^k>>>12^A,x.c=A=A-I|0,x.d=I<<16^A>>>16^N,x.a=N-k|0},x.a=0,x.b=0,x.c=-1640531527,x.d=1367130551,y===Math.floor(y)?(x.a=y/4294967296|0,x.b=0|y):C+=y;for(var _=0;_<C.length+20;_++)x.b^=0|C.charCodeAt(_),x.next()}(l),h=d&&d.state,g=function(){return(p.next()>>>0)/4294967296};return g.double=function(){do var y=((p.next()>>>11)+(p.next()>>>0)/4294967296)/2097152;while(y===0);return y},g.int32=p.next,g.quick=g,h&&(typeof h=="object"&&o(h,p),g.state=function(){return o(p,{})}),g}n&&n.exports?n.exports=i:this.tychei=i})(0,e)}),ks=au(function(e){(function(t,n){var r,o=this,i=256,l=6,d="random",p=n.pow(i,l),h=n.pow(2,52),g=2*h,y=i-1;function x(A,I,N){var D=[],M=_(function L(X,q){var Q,it=[],at=typeof X;if(q&&at=="object")for(Q in X)try{it.push(L(X[Q],q-1))}catch{}return it.length?it:at=="string"?X:X+"\0"}((I=I==1?{entropy:!0}:I||{}).entropy?[A,k(t)]:A??function(){try{var L;return r&&(L=r.randomBytes)?L=L(i):(L=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(L)),k(L)}catch{var X=o.navigator,q=X&&X.plugins;return[+new Date,o,q,o.screen,k(t)]}}(),3),D),F=new function(L){var X,q=L.length,Q=this,it=0,at=Q.i=Q.j=0,ht=Q.S=[];for(q||(L=[q++]);it<i;)ht[it]=it++;for(it=0;it<i;it++)ht[it]=ht[at=y&at+L[it%q]+(X=ht[it])],ht[at]=X;(Q.g=function(gt){for(var Ct,pt=0,lt=Q.i,ft=Q.j,Tt=Q.S;gt--;)Ct=Tt[lt=y&lt+1],pt=pt*i+Tt[y&(Tt[lt]=Tt[ft=y&ft+Ct])+(Tt[ft]=Ct)];return Q.i=lt,Q.j=ft,pt})(i)}(D),W=function(){for(var L=F.g(l),X=p,q=0;L<h;)L=(L+q)*i,X*=i,q=F.g(1);for(;L>=g;)L/=2,X/=2,q>>>=1;return(L+q)/X};return W.int32=function(){return 0|F.g(4)},W.quick=function(){return F.g(4)/4294967296},W.double=W,_(k(F.S),t),(I.pass||N||function(L,X,q,Q){return Q&&(Q.S&&C(Q,F),L.state=function(){return C(F,{})}),q?(n[d]=L,X):L})(W,M,"global"in I?I.global:this==n,I.state)}function C(A,I){return I.i=A.i,I.j=A.j,I.S=A.S.slice(),I}function _(A,I){for(var N,D=A+"",M=0;M<D.length;)I[y&M]=y&(N^=19*I[y&M])+D.charCodeAt(M++);return k(I)}function k(A){return String.fromCharCode.apply(0,A)}if(n["seed"+d]=x,_(n.random(),t),e.exports){e.exports=x;try{r=require("crypto")}catch{}}})([],Math)});ks.alea=Aet,ks.xor128=Iet,ks.xorwow=Net,ks.xorshift7=Pet,ks.xor4096=Met,ks.tychei=Oet;var Fet=ks,PR=Fet.alea,MR=function(){function e(t,n,r,o,i){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var l=i||Math.random();this.random=PR(l.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var i=void 0,l=void 0,d=void 0;do d=(i=2*this.random()-1)*i+(l=2*this.random()-1)*l;while(d>=1||d===0);var p=Math.sqrt(-2*Math.log(d)/d);n=this.mean+this.stdDev*i*p,r=this.mean+this.stdDev*l*p,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}();function $et(e){var t=G(e,"x","clone",null);return ot.engine.runKernel(function(n){return Kt.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}function Bet(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=Fe([e,t],r),i=e<=t?e:t,l=0;l<i;++l)o.set(1,l,l);var d=o.toTensor().as2D(e,t);if(n==null)return d;if(n.length===1)return Tl(Ni(d,0),[n[0],1,1]);if(n.length===2)return Tl(Ni(Ni(d,0),0),[n[0],n[1],1,1]);if(n.length===3)return Tl(Ni(Ni(Ni(d,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}function Let(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new MR(t,n,r,!1,o),l=Fe(e,r),d=0;d<l.values.length;d++)l.values[d]=i.nextValue();return l.toTensor()}function Wet(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new MR(t,n,r,!0,o),l=Fe(e,r),d=0;d<l.values.length;d++)l.values[d]=i.nextValue();return l.toTensor()}function Uet(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var o=Fe(e,r),i=0;i<o.values.length;i++)o.values[i]=hY(t,n);return o.toTensor()}function zet(e,t,n){var r=ie(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return Kt.make(e,{values:o},n)}function Vet(e,t,n,r){r===void 0&&(r=!1);var o=G(e,"logits","multinomial"),i=o.size,l=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(l>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+l);n=n||Math.random();var d=l===1?o.as2D(1,-1):o,p=ot.engine.runKernel(function(h){return h.multinomial(d,r,t,n)},{logits2D:d});return l===1?p.as1D():p}function Het(e,t,n,r){n===void 0&&(n=1),r===void 0&&(r=0);var o=G(e,"indices","oneHot","int32");if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);return ot.engine.runKernel(function(i){return i.oneHot(o,t,n,r)},{$indices:o},function(i){return{$indices:function(){return jn(o.shape,"float32")}}})}function Get(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return ot.engine.fromPixels(e,t)}function OR(e,t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D,M,F;return Te(this,function(W){switch(W.label){case 0:if(n=G(e,"img","toPixels"),e instanceof Kt||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(l=n.rank===2?1:n.shape[2])>4||l===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+l);return d=n.min(),p=n.max(),[4,d.data()];case 1:return h=W.sent()[0],[4,p.data()];case 2:if(g=W.sent()[0],d.dispose(),p.dispose(),n.dtype==="float32"){if(h<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+g+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+g+"].")}return[4,n.data()];case 3:for(y=W.sent(),x=n.dtype==="float32"?255:1,C=new Uint8ClampedArray(i*o*4),_=0;_<o*i;++_)k=void 0,A=void 0,I=void 0,N=void 0,l===1?(k=y[_]*x,A=y[_]*x,I=y[_]*x,N=255):l===3?(k=y[3*_]*x,A=y[3*_+1]*x,I=y[3*_+2]*x,N=255):l===4&&(k=y[4*_]*x,A=y[4*_+1]*x,I=y[4*_+2]*x,N=y[4*_+3]*x),C[(D=4*_)+0]=Math.round(k),C[D+1]=Math.round(A),C[D+2]=Math.round(I),C[D+3]=Math.round(N);return t!=null&&(t.width=i,t.height=o,M=t.getContext("2d"),F=new ImageData(C,i,o),M.putImageData(F,0,0)),n!==e&&n.dispose(),[2,C]}})})}function qet(e,t){var n=G(e,"x","reshape",null);return t=vY(t,n.size),tt(n.size===ie(t),"new shape and old shape must have the same number of elements."),ot.engine.runKernel(function(r){return r.reshape(n,t)},{$x:n},function(r){return{$x:function(){return r.reshape(n.shape)}}})}function jet(e,t){var n=G(e,"x","squeeze");return I0(n,eu(n.shape,t).newShape)}function Ket(e,t){var n=G(e,"x","cast");return ot.engine.runKernel(function(r){return r.cast(n,t)},{$x:n},function(r){return{$x:function(){return r.clone()}}})}function Xet(e,t){var n=G(e,"x","tile");return tt(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."),ot.engine.runKernel(function(r){return r.tile(n,t)},{$x:n},function(r){return{$x:function(){var o=_n(n);if(n.rank===1)for(var i=0;i<t[0];++i)o=o.add(r.slice([i*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(i=0;i<t[0];++i)for(var l=0;l<t[1];++l)o=o.add(r.slice([i*n.shape[0],l*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(i=0;i<t[0];++i)for(l=0;l<t[1];++l)for(var d=0;d<t[2];++d)o=o.add(r.slice([i*n.shape[0],l*n.shape[1],d*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(n.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(i=0;i<t[0];++i)for(l=0;l<t[1];++l)for(d=0;d<t[2];++d)for(var p=0;p<t[3];++p)o=o.add(r.slice([i*n.shape[0],l*n.shape[1],d*n.shape[2],p*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return o}}})}function Yet(e,t,n){return n===void 0&&(n=0),tt(t.length===2,"Invalid number of paddings. Must be length of 2."),iu(e,[t],n)}function Qet(e,t,n){return n===void 0&&(n=0),tt(t.length===2&&t[0].length===2&&t[1].length===2,"Invalid number of paddings. Must be length of 2 each."),iu(e,t,n)}function Jet(e,t,n){return n===void 0&&(n=0),tt(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,"Invalid number of paddings. Must be length of 2 each."),iu(e,t,n)}function Zet(e,t,n){return n===void 0&&(n=0),tt(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,"Invalid number of paddings. Must be length of 2 each."),iu(e,t,n)}function tnt(e,t,n){n===void 0&&(n=0);var r=G(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=t.map(function(i){return i[0]});return ot.engine.runKernel(function(i){return i.pad(r,t,n)},{$x:r},function(i){return{$x:function(){return i.slice(o,r.shape)}}})}function ent(e,t){t===void 0&&(t=0);var n=vp(e,"tensors","stack");if(tt(n.length>=1,"Pass at least one tensor to tf.stack"),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;tt(t<=r,"Axis must be <= rank of the tensor"),n.forEach(function(d){an(o,d.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(d){tt(i===d.dtype,"All tensors passed to stack must have matching dtypes")});var l=n.map(function(d){return d.expandDims(t)});return ii(l,t)}function nnt(e,t,n){var r=G(e,"x","batchToSpaceND"),o=t.reduce(function(i,l){return i*l});return tt(r.rank>=1+t.length,"input rank is "+r.rank+" but should be > than blockShape.length "+t.length),tt(n.length===t.length,"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length),tt(r.shape[0]%o==0,"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o),ot.engine.runKernel(function(i){return i.batchToSpaceND(r,t,n)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,n)}}})}function rnt(e,t,n){var r=G(e,"x","spaceToBatchND");return tt(r.rank>=1+t.length,"input rank "+r.rank+" should be > than [blockShape] "+t.length),tt(n.length===t.length,"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length),tt(r.shape.reduce(function(o,i,l){return l>0&&l<=t.length?o&&(i+n[l-1][0]+n[l-1][1])%t[l-1]==0:o},!0),"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()),ot.engine.runKernel(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}function ont(e,t){t===void 0&&(t=0);for(var n,r=G(e,"x","unstack"),o=r.shape[t],i=Array(r.rank-1).fill(0),l=0,d=0;d<r.rank;d++)d!==t&&(i[l]=r.shape[d],l++);n=Array(o).fill(1);var p=Array(r.rank).fill(0),h=r.shape.slice();return n.map(function(g){h[t]=g;var y=r.slice(p,h);return p[t]+=g,y.reshape(i)})}function ant(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=G(e,"x","cumsum"),i=Ra([t|=0],o.rank),l=o;i!=null&&(l=o.transpose(i));var d=Ta(1,o.rank)[0],p=ot.engine.runKernel(function(h){return h.cumsum(l,d,n,r)},{permutedX:l},function(h){return{permutedX:function(){return h.cumsum(t,n,!r)}}});return i!=null&&(p=p.transpose(i)),p}function int(e,t){t===void 0&&(t=0);var n=G(e,"x","expandDims");tt(t<=n.rank,"Axis must be <= rank of the tensor");var r=n.shape.slice();return t<0&&(tt(-(n.rank+1)<=t,"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"),t=n.rank+t+1),r.splice(t,0,1),I0(n,r)}function snt(e,t,n){n===void 0&&(n="NHWC");var r=G(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],l=n==="NHWC"?r.shape[3]:r.shape[1];return tt(o*t>=0,`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape),tt(i*t>=0,`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape),tt(l%(t*t)==0,"Dimension size must be evenly divisible by "+t*t+" but is "+l+" for depthToSpace with input shape "+r.shape),ot.engine.runKernel(function(d){return d.depthToSpace(r,t,n)},{$x:r})}function unt(e,t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y;return Te(this,function(x){switch(x.label){case 0:return n=G(e,"x","setdiff1d"),r=G(t,"y","setdiff1d"),tt(n.dtype===r.dtype,"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."),tt(n.rank===1,"x should be 1D tensor, but got x ("+n.shape+")."),tt(r.rank===1,"y should be 1D tensor, but got y ("+r.shape+")."),[4,n.data()];case 1:return o=x.sent(),[4,r.data()];case 2:for(i=x.sent(),l=new Set(i),d=0,g=0;g<o.length;g++)l.has(o[g])||d++;for(p=new Yl([d],n.dtype),h=new Yl([d],"int32"),g=0,y=0;g<o.length;g++)l.has(o[g])||(p.values[y]=o[g],h.values[y]=g,y++);return[2,[p.toTensor(),h.toTensor()]]}})})}function Fe(e,t,n){return t===void 0&&(t="float32"),new Yl(e,t=t||"float32",n)}function cnt(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var FR=ct({batchToSpaceND_:nnt}),lnt=ct({cast_:Ket}),dnt=ct({clone_:$et}),fnt=ct({cumsum_:ant}),pnt=ct({depthToSpace_:snt}),Ni=ct({expandDims_:int}),$R=ct({eye_:Bet}),BR=ct({fromPixels_:Get}),hnt=ct({multinomial_:Vet}),_v=ct({oneHot_:Het}),iu=ct({pad_:tnt}),mnt=ct({pad1d_:Yet}),gnt=ct({pad2d_:Qet}),vnt=ct({pad3d_:Jet}),ynt=ct({pad4d_:Zet}),bnt=ct({rand_:zet}),xnt=ct({randomNormal_:Let}),wnt=ct({randomUniform_:Uet}),I0=ct({reshape_:qet}),LR=ct({spaceToBatchND_:rnt}),WR=ct({squeeze_:jet}),lc=ct({stack_:ent}),Tl=ct({tile_:Xet}),Cnt=ct({truncatedNormal_:Wet}),N0=ct({unstack_:ont}),Snt=unt;function P0(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Fe(e,"int32"),i=Fe([n.length,e.length],"int32");for(r=0;r<n.length;r++){var l=o.indexToLoc(n[r]),d=r*e.length;i.values.set(l,d)}return i.toTensor()}var _nt=10,Ent=300,knt=1e3,Rnt=function(){function e(t,n){if(n===void 0&&(n=!0),this.gpgpu=t,this.delayedStorage=n,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,ot.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(t==null){var r=oi(ot.get("WEBGL_VERSION"));this.gpgpu=new JZ(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;ot.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*Ent),this.textureManager=new Ntt(this.gpgpu)}return e.prototype.register=function(t,n,r){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:n,dtype:r})},e.prototype.setDataMover=function(t){this.texData=new hR(t)},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var r=[t.height,t.width],o=[t.height,t.width,n];if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(!ot.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var i=this.makeTensorHandle(r,"int32");this.texData.get(i.dataId).usage=ma.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var l=new aZ(o),d=this.compileAndRun(l,[i]);return this.disposeData(i.dataId),d},e.prototype.makeTensorHandle=function(t,n){var r={};return this.register(r,t,n),{dataId:r,shape:t,dtype:n}},e.prototype.write=function(t,n){if(n==null)throw new Error("MathBackendWebGL.write(): values can not be null");var r=this.texData.get(t),o=r.texture,i=r.texShape,l=r.usage,d=r.dtype,p=r.isPacked;if(d==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");o!=null&&(this.releaseTexture(t,o,i,l,p),r.texture=null,r.texShape=null),r.usage=ma.UPLOAD,r.values=n,this.delayedStorage||this.uploadToGPU(t)},e.prototype.readSync=function(t){var n=this.texData.get(t),r=n.values,o=n.dtype,i=n.complexTensors;if(r!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return r;var l,d,p=this.activeTimers!=null;return p&&(l=performance.now()),o==="complex64"?d=gR(i.real.dataSync(),i.imag.dataSync()):d=this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=performance.now()-l),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D;return Te(this,function(M){switch(M.label){case 0:if(this.pendingRead.has(t))return o=this.pendingRead.get(t),[2,new Promise(function(F){return o.push(F)})];if(i=this.texData.get(t),l=i.texture,d=i.values,p=i.texShape,h=i.isPacked,g=i.shape,d!=null)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!ot.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ot.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return y=p[1],x=p[0],h&&(n=ru(p[0],p[1]),y=n[0],x=n[1]),C=this.gpgpu.maybeCreateBufferFromTexture(l,x,y),[4,this.gpgpu.createAndWaitForFence()];case 1:return M.sent(),C instanceof WebGLTexture?_=this.getValuesFromTexture(t):h?(k=this.getBatchDim(g),A=1,I=1,g.length&&(r=this.getRowsCols(g),A=r[0],I=r[1]),_=this.gpgpu.downloadPackedMatrixFromBuffer(C,k,A,I,p[0],p[1])):_=this.gpgpu.downloadFloat32MatrixFromBuffer(C,p[0],p[1]),N=this.convertAndCacheOnCPU(t,_),D=this.pendingRead.get(t),this.pendingRead.delete(t),D.forEach(function(F){return F(N)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,N]}})})},e.prototype.getValuesFromTexture=function(t){var n,r=this.texData.get(t),o=r.shape,i=r.dtype,l=r.texture,d=r.texShape;if(ot.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var p=this.getBatchDim(o),h=1,g=1;return o.length&&(h=(n=this.getRowsCols(o))[0],g=n[1]),this.gpgpu.downloadMatrixFromPackedTexture(l,p,h,g,d[0],d[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(l,d[0],d[1])}var y=this.makeTensorHandle(o,"float32");y.size=ie(o),this.texData.get(y.dataId).usage=ma.DOWNLOAD;var x=new oZ(o);this.compileAndRun(x,[{shape:o,dtype:i,dataId:t}],y,null,!1);var C=this.texData.get(y.dataId),_=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(C.texture,C.texShape[0],C.texShape[1]);return this.disposeData(y.dataId),_},e.prototype.time=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d,p;return Te(this,function(h){switch(h.label){case 0:return n=this.activeTimers,r=[],o=!1,this.programTimersStack==null?(this.programTimersStack=r,o=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=cc(this.activeTimers.map(function(g){return g.query})).filter(function(g){return g!=null}),l=cc(this.activeTimers.map(function(g){return g.name})).filter(function(g){return g!=null}),this.activeTimers=n,o&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return d=h.sent(),p={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:pY(d),getExtraProfileInfo:function(){return d.map(function(g,y){return{name:l[y],ms:g}}).map(function(g){return g.name+": "+g.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,p]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(t){return ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},e.prototype.getQueryTime=function(t){return Re(this,void 0,void 0,function(){var n;return Te(this,function(r){return ot.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){var n=this.texData.get(t),r=n.texture,o=n.texShape,i=n.usage,l=n.complexTensors,d=n.isPacked;r!=null&&this.releaseTexture(t,r,o,i,d),l!=null&&(l.real.dispose(),l.imag.dispose()),this.texData.delete(t)}}},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getCPUBackend=function(){return ot.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ot.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var r=this;return n===void 0&&(n=_nt),this.getCPUBackend()!=null&&t.every(function(o){return r.texData.get(o.dataId).texture==null&&o.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.complex=function(t,n){var r=this.makeOutputArray(t.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:ot.engine.keep(t.clone()),imag:ot.engine.keep(n.clone())},r},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,r);var o=new Dtt(r),i=o.getCustomSetupFunc(n);return this.compileAndRun(o,[t],null,i)},e.prototype.stridedSlice=function(t,n,r,o,i,l,d,p,h){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,r,o,i,l,d,p,h);var g=lR(t.shape,n,r,o,i,l,d,p,h),y=g[0],x=g[1],C=g[2],_=x.filter(function(A,I){return C.indexOf(I)===-1});if(_.some(function(A){return A===0}))return An([],_);var k=new Itt(y,o,x,C);return this.compileAndRun(k,[t])},e.prototype.reverse=function(t,n){var r=new ktt(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.concat2Tensors=function(t,n,r){var o=Ql([t.shape,n.shape],r),i=t.as2D(-1,ie(t.shape.slice(r))),l=n.as2D(-1,ie(n.shape.slice(r))),d=new eJ(i.shape,l.shape);return this.compileAndRun(d,[i,l]).reshape(o)},e.prototype.concat=function(t,n){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];for(var r=t[0],o=1;o<t.length;++o)r=this.concat2Tensors(r,t[o],n);return r},e.prototype.neg=function(t){var n=new We(t.shape,ztt);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,r,o){var i=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],d=r?t.shape[1]:t.shape[2],p=t.shape[0];if((i===1||l===1)&&d>knt){r&&(t=t.transpose([0,2,1])),o&&(n=n.transpose([0,2,1]));var h=l===1?t:t.as3D(p,d,1),g=l===1?2:1,y=l===1?n.as3D(p,1,d):n;return this.multiply(h,y).sum(g,!0)}var x=dr(t.dtype,n.dtype);if(p===1){var C=t.as2D(t.shape[1],t.shape[2]),_=n.as2D(n.shape[1],n.shape[2]),k=new _S(C.shape,_.shape,[i,l],r,o),A=this.makePackedTensor(k.outputShape,x),I=this.compileAndRun(k,[C,_],A);return I.reshape([1,I.shape[0],I.shape[1]])}return k=new stt(t.shape,n.shape,r,o),A=this.makeOutputArray(k.outputShape,x),this.compileAndRun(k,[t,n],A)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var r=this.texData.get(t.dataId),o=this.texData.get(n.dataId),i=new hS(pS.REAL,t.shape,n.shape),l=new hS(pS.IMAG,t.shape,n.shape),d=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag),this.makeComplexComponentTensorHandle(n,o.complexTensors.real),this.makeComplexComponentTensorHandle(n,o.complexTensors.imag)],p=this.compileAndRun(i,d),h=this.compileAndRun(l,d),g=this.complex(p,h);return p.dispose(),h.dispose(),g}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);var y=new Ln(MQ,t.shape,n.shape),x=this.makeOutputArray(y.outputShape,t.dtype);return this.compileAndRun(y,[t,n],x)},e.prototype.batchNormalization=function(t,n,r,o,i,l){var d=[t,n,r],p=null;l!=null&&(p=l.shape,d.push(l));var h=null;if(i!=null&&(h=i.shape,d.push(i)),ot.get("WEBGL_PACK_BATCHNORMALIZATION")){var g=new PQ(t.shape,n.shape,r.shape,p,h,o);return this.compileAndRun(g,d)}var y=new NQ(t.shape,n.shape,r.shape,p,h,o);return this.compileAndRun(y,d)},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){var l=new ott(t.shape,n,r,o,i);return this.compileAndRun(l,[t])},e.prototype.LRNGrad=function(t,n,r,o,i,l,d){var p=new att(n.shape,o,i,l,d);return this.compileAndRun(p,[n,r,t])},e.prototype.tile=function(t,n){var r=new Ptt(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,n,r){var o=new vtt(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,n){var r=new Ott(t.shape,n);return this.compileAndRun(r,[t])},e.prototype.gather=function(t,n,r){var o=new iZ(t.shape,n.size,r);return this.compileAndRun(o,[t,n])},e.prototype.batchToSpaceND=function(t,n,r){tt(t.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var o=n.reduce(function(g,y){return g*y}),i=pp(t.shape,n,o),l=hp(i.length,n.length),d=mp(t.shape,n,o),p=aR(r,n.length),h=iR(d,r,n.length);return t.reshape(i).transpose(l).reshape(d).slice(p,h)},e.prototype.spaceToBatchND=function(t,n,r){tt(t.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var o=n.reduce(function(y,x){return y*x}),i=[[0,0]];i.push.apply(i,r);for(var l=1+n.length;l<t.shape.length;++l)i.push([0,0]);var d=t.pad(i),p=pp(d.shape,n,o,!1),h=hp(p.length,n.length,!1),g=mp(d.shape,n,o,!1);return d.reshape(p).transpose(h).reshape(g)},e.prototype.reduce=function(t,n,r){var o=t.shape[0],i=t.shape[1],l=lS(i),d=new ytt({windowSize:l,inSize:i,batchSize:o},n),p=d.outputShape,h=p[0],g=p[1],y=this.makeOutputArray([h,g],r);return this.compileAndRun(d,[t],y),y.shape[1]===1?y:this.reduce(y,n,r)},e.prototype.argReduce=function(t,n,r){r===void 0&&(r=null);var o=t.shape[0],i=t.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);var l=lS(i),d=new DQ({windowSize:l,inSize:i,batchSize:o},n,r==null),p=d.outputShape,h=p[0],g=p[1],y=this.makeOutputArray([h,g],"int32"),x=[t];return r!=null&&x.push(r),this.compileAndRun(d,x,y),y.shape[1]===1?y:this.argReduce(t,n,y)},e.prototype.sum=function(t,n){Zr("sum",n,t.rank);var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i),d=Cg(t.dtype);return this.reduce(l,"sum",d).reshape(o)},e.prototype.prod=function(t,n){var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i),d=Cg(t.dtype);return this.reduce(l,"prod",d).reshape(o)},e.prototype.unsortedSegmentSum=function(t,n,r){var o=0,i=Ra([o],t.rank),l=t;i!=null&&(l=t.transpose(i),o=Ta(1,t.rank)[0]);var d=iQ(l.shape,o,r),p=ie([l.shape[o]]),h=l.as2D(-1,p),g=Cg(t.dtype),y=this.segOpCompute(h,"unsortedSegmentSum",n,g,r).reshape(d);return i!=null&&(y=y.transpose(E0(i))),y},e.prototype.segOpCompute=function(t,n,r,o,i){var l=t.shape[0],d=t.shape[1],p=aQ(d,i),h=new Rtt({windowSize:p,inSize:d,batchSize:l,numSegments:i},n),g=h.outputShape,y=g[0],x=g[1],C=this.makeOutputArray([y,x],o);return this.compileAndRun(h,[t,r],C),C.shape[1]===i?C:(r=pR(0,i).tile([d/p]),this.segOpCompute(C,n,r,o,i))},e.prototype.argMin=function(t,n){var r=[n];Zr("argMin",r,t.rank);var o=ur(t.shape,r),i=o[0],l=ie(o[1]),d=t.as2D(-1,l);return this.argReduce(d,"min").reshape(i)},e.prototype.argMax=function(t,n){var r=[n];Zr("argMax",r,t.rank);var o=ur(t.shape,r),i=o[0],l=ie(o[1]),d=t.as2D(-1,l);return this.argReduce(d,"max").reshape(i)},e.prototype.cumsum=function(t,n,r,o){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var i=new eZ(t.shape,r,o);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,n){var r=new Ln(LQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.notEqual=function(t,n){var r=new Ln(WQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);var r=new Ln(UQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.lessEqual=function(t,n){var r=new Ln(zQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);var r=new Ln(VQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.greaterEqual=function(t,n){var r=new Ln(HQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.logicalNot=function(t){var n=new We(t.shape,vet);return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){var r=new Ln(GQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.logicalOr=function(t,n){var r=new Ln(qQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[t,n],o)},e.prototype.select=function(t,n,r){var o=new Ttt(t.rank,n.shape,n.rank),i=this.makeOutputArray(o.outputShape,dr(n.dtype,r.dtype));return this.compileAndRun(o,[t,n,r],i)},e.prototype.where=function(t){Cv("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return P0(t.shape,n)},e.prototype.topk=function(t,n,r){return yR(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Zr("min",n,t.rank);var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i);return this.reduce(l,"min",l.dtype).reshape(o)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var r=new Ln(KQ,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.mod=function(t,n){var r=new Ln(XQ,t.shape,n.shape),o=r.getCustomSetupFunc();return this.compileAndRun(r,[t,n],null,o)},e.prototype.max=function(t,n){Zr("max",n,t.rank);var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i);return this.reduce(l,"max",l.dtype).reshape(o)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var r=new Ln(jQ,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.all=function(t,n){Zr("all",n,t.rank);var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i);return this.reduce(l,"all",l.dtype).reshape(o)},e.prototype.any=function(t,n){Zr("any",n,t.rank);var r=ur(t.shape,n),o=r[0],i=ie(r[1]),l=t.as2D(-1,i);return this.reduce(l,"any",l.dtype).reshape(o)},e.prototype.squaredDifference=function(t,n){var r=new Ln(BQ,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.realDivide=function(t,n){var r=new Ln(OQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t,n],o)},e.prototype.floorDiv=function(t,n){var r=new Ln(FQ,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[t,n],o)},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,mS);var r=new Ln(mS,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,dr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],o)},e.prototype.complexSeparableBinaryOp=function(t,n,r){var o=this,i=this.texData.get(t.dataId),l=this.texData.get(n.dataId),d=[[i.complexTensors.real,l.complexTensors.real],[i.complexTensors.imag,l.complexTensors.imag]].map(function(y){var x=y[0],C=y[1],_=new Ln(r,t.shape,n.shape),k=o.makeOutputArray(_.outputShape,dr(x.dtype,C.dtype)),A=o.makeComplexComponentTensorHandle(t,x),I=o.makeComplexComponentTensorHandle(n,C);return o.compileAndRun(_,[A,I],k)}),p=d[0],h=d[1],g=this.complex(p,h);return p.dispose(),h.dispose(),g},e.prototype.makeComplexComponentTensorHandle=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){for(var n=t[0],r=1;r<t.length;r++)n=this.add(n,t[r]);return n},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,gS);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var r=new Ln(gS,t.shape,n.shape),o=this.makeOutputArray(r.outputShape,dr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],o)},e.prototype.pow=function(t,n){var r=new Ln($Q,t.shape,n.shape),o=r.getCustomSetupFunc(),i=this.makeOutputArray(r.outputShape,dr(t.dtype,n.dtype));return this.compileAndRun(r,[t,n],i,o)},e.prototype.ceil=function(t){var n=new We(t.shape,Vtt);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){var n=new We(t.shape,Htt);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new We(t.shape,Gtt);return this.compileAndRun(n,[t])},e.prototype.round=function(t){var n=new We(t.shape,qtt);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){var n=new We(t.shape,jtt);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){var n=new We(t.shape,Ktt);return this.compileAndRun(n,[t])},e.prototype.log=function(t){var n=new We(t.shape,Xtt),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.log1p=function(t){var n=new We(t.shape,Ytt);return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new We(t.shape,Qtt);return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){var n=new We(t.shape,Jtt);return this.compileAndRun(n,[t])},e.prototype.square=function(t){var n=new We(t.shape,met);return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new We(t.shape,get);return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n=new We(t.shape,Btt);return this.compileAndRun(n,[t])},e.prototype.elu=function(t){var n=new We(t.shape,Ltt);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var r=new Ln(QQ,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.selu=function(t){var n=new We(t.shape,Wtt);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new We(t.shape,yet),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t],r)},e.prototype.clip=function(t,n,r){var o;return o=ot.get("WEBGL_PACK_CLIP")?new ZQ(t.shape,n,r):new JQ(t.shape,n,r),this.compileAndRun(o,[t])},e.prototype.abs=function(t){var n=new We(t.shape,$tt);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),r=new tJ(t.shape),o=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)];return this.compileAndRun(r,o)},e.prototype.sigmoid=function(t){var n=new We(t.shape,Ztt);return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new We(t.shape,tet);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new We(t.shape,eet);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new We(t.shape,net);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new We(t.shape,ret);return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new We(t.shape,oet);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new We(t.shape,aet);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new We(t.shape,iet);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var r=new Ln(YQ,t.shape,n.shape);return this.compileAndRun(r,[t,n])},e.prototype.sinh=function(t){var n=new We(t.shape,set);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new We(t.shape,uet);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new We(t.shape,cet);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new We(t.shape,det);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new We(t.shape,fet),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.atanh=function(t){var n=new We(t.shape,pet),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t],null,r)},e.prototype.erf=function(t){var n=new We(t.shape,het);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var r=new We(t.shape,Utt(n));return this.compileAndRun(r,[t])},e.prototype.conv2dWithIm2Row=function(t,n,r){var o=r.filterWidth,i=r.filterHeight,l=r.inChannels,d=r.outWidth,p=r.outHeight,h=o*i*l,g=p*d,y=[h,g],x=t.squeeze([0]),C=n.reshape([h,-1]),_=new rtt(y,x.shape,r),k=this.compileAndRun(_,[x]),A=new _S(k.shape,C.shape,[g,r.outChannels],!0,!1);return this.compileAndRun(A,[k,C]).reshape([1,p,d,r.outChannels])},e.prototype.conv2d=function(t,n,r){if(ot.get("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,r);var o=new uJ(r);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerInput=function(t,n,r){var o=new rJ(r);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerFilter=function(t,n,r){var o=new nJ(r);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2D=function(t,n,r){var o;return ot.get("WEBGL_PACK_DEPTHWISECONV")&&r.dilationWidth===1&&r.dilationHeight===1&&r.padInfo.left<=1&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(o=new dJ(r),this.compileAndRun(o,[t,n],this.makePackedTensor(r.outShape,t.dtype))):(o=new lJ(r),this.compileAndRun(o,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,r){var o=new sJ(r);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){var o=new iJ(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3d=function(t,n,r){var o=new cJ(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerInput=function(t,n,r){var o=new aJ(r);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerFilter=function(t,n,r){var o=new oJ(r);return this.compileAndRun(o,[t,n])},e.prototype.maxPool=function(t,n){var r=new Rg(n,"max",!1),o=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[t],o)},e.prototype.avgPool=function(t,n){var r=new Rg(n,"avg",!1),o=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[t],o)},e.prototype.maxPoolBackprop=function(t,n,r,o){var i=new Rg(o,"max",!0),l=this.compileAndRun(i,[n]),d=new itt(o),p=this.makeOutputArray(d.outputShape,n.dtype),h=this.compileAndRun(d,[t,l],p);return l.dispose(),h},e.prototype.avgPoolBackprop=function(t,n,r){var o=new AQ(r),i=this.makeOutputArray(o.outputShape,n.dtype);return this.compileAndRun(o,[t],i)},e.prototype.cast=function(t,n){return mR(t,n,this)},e.prototype.reshape=function(t,n){return this.texData.get(t.dataId).isPacked&&!CS(t.shape,n)?this.packedReshape(t,n):Sv(t,n)},e.prototype.resizeBilinear=function(t,n,r,o){var i=new Stt(t.shape,n,r,o);return this.compileAndRun(i,[t])},e.prototype.resizeBilinearBackprop=function(t,n,r){var o=new Ctt(t,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,n,r,o){var i=new Ett(t.shape,n,r,o);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){var o=new _tt(t,n,r);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,n,r,o){var i=n?t:Xp(t),l=i.shape[0],d=i.shape[1],p=new utt(l,d,r),h=this.makeOutputArray(p.outputShape,"int32"),g=p.getCustomSetupFunc(o);return this.compileAndRun(p,[i],h,g)},e.prototype.oneHot=function(t,n,r,o){var i=new ctt(t.size,n,r,o);return this.compileAndRun(i,[t])},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return Cv("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),k0(t.dataSync(),n.dataSync(),r,o,i)},e.prototype.cropAndResize=function(t,n,r,o,i,l){var d=new fJ(t.shape,n.shape,o,i,l);return this.compileAndRun(d,[t,n,r])},e.prototype.depthToSpace=function(t,n,r){tt(n>1,"blockSize should be > 1 for depthToSpace, but was: "+n);var o=t.shape[0],i=(r==="NHWC"?t.shape[1]:t.shape[2])*n,l=(r==="NHWC"?t.shape[2]:t.shape[3])*n,d=(r==="NHWC"?t.shape[3]:t.shape[1])/(n*n),p=new rZ(r==="NHWC"?[o,i,l,d]:[o,d,i,l],n,r);return this.compileAndRun(p,[t])},e.prototype.split=function(t,n,r){return vR(t,n,r)},e.prototype.scatterND=function(t,n,r){var o=gp(n,t,r),i=o.sliceRank,l=o.numUpdates,d=o.sliceSize,p=o.strides,h=o.outputSize,g=[h/d,d],y=t.reshape([l,i]),x=n.reshape([l,d]);if(h===0)return Sv(An([]),r);var C=Lt(0),_=new ES(l,i,y.rank,x.rank,p,g);return this.compileAndRun(_,[x,y,C]).reshape(r)},e.prototype.sparseToDense=function(t,n,r,o){var i=gp(n,t,r),l=i.sliceRank,d=i.numUpdates,p=i.strides,h=i.outputSize,g=new ES(d,l,t.rank,n.rank,p,[h,1],!1);return this.compileAndRun(g,[n,t,o]).reshape(r)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var r=this.texData.get(t.dataId),o=new bS(yS.REAL,t.shape,n),i=new bS(yS.IMAG,t.shape,n),l=[this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],d=this.compileAndRun(o,l),p=this.compileAndRun(i,l),h=this.complex(d,p).as2D(t.shape[0],t.shape[1]);return d.dispose(),p.dispose(),h},e.prototype.gatherND=function(t,n){var r=n.shape,o=r[r.length-1],i=uR(t,n),l=i[0],d=i[1],p=i[2],h=i[3],g=n.reshape([d,o]),y=t.reshape([t.size/p,p]),x=new uZ(o,h,[d,p]);return this.compileAndRun(x,[y,g]).reshape(l)},e.prototype.makeOutputArray=function(t,n){return Kt.make(t,{},n)},e.prototype.makePackedTensor=function(t,n){var r=Kt.make(t,{},n);return this.texData.get(r.dataId).isPacked=!0,r},e.prototype.unpackTensor=function(t){var n=new TS(t.shape);return this.compileAndRun(n,[t],Kt.make(n.outputShape,{},t.dtype))},e.prototype.getBatchDim=function(t,n){return n===void 0&&(n=2),ie(t.slice(0,t.length-n))},e.prototype.getRowsCols=function(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]},e.prototype.packedReshape=function(t,n){var r=t.reshape([this.getBatchDim(t.shape)].concat(this.getRowsCols(t.shape))),o=[this.getBatchDim(n)].concat(this.getRowsCols(n)),i=new btt(o,r.shape);return this.compileAndRun(i,[r]).reshape(n)},e.prototype.compileAndRun=function(t,n,r,o,i){var l=this;if(i===void 0&&(i=!0),r==null&&(r=t.usesPackedTextures?this.makePackedTensor(t.outputShape,n[0].dtype):this.makeOutputArray(t.outputShape,n[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=mv(r.dtype,0),r;var d=n.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var D=l.texData.get(N.dataId);if(D.texture==null){if(!t.usesPackedTextures&&ie(N.shape)<=ot.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:l.readSync(N.dataId)};t.usesPackedTextures&&(D.isPacked=!0,D.shape=N.shape)}else if(!!D.isPacked!=!!t.usesPackedTextures){var M=void 0,F=void 0;D.isPacked?(M=new TS(N.shape),F=l.compileAndRun(M,[N],Kt.make(M.outputShape,{},N.dtype))):(M=new ftt(N.shape),F=l.compileAndRun(M,[N],l.makePackedTensor(N.shape,N.dtype))),D=l.texData.get(F.dataId),N=F}else if(D.isPacked&&!CS(D.shape,N.shape)){l.delayedStorage=!1;var W=N.dataSync();l.delayedStorage=!0,N=Kt.make(N.shape,{values:W},N.dtype),(D=l.texData.get(N.dataId)).isPacked=!0}return l.uploadToGPU(N.dataId),{shape:N.shape,texData:D,isUniform:!1}});this.uploadToGPU(r.dataId);var p,h={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},g=ntt(t,d,h),y=this.getAndSaveBinary(g,function(){return ttt(l.gpgpu,t,d,h)}),x=this.activeTimers!=null;if(x&&(p=this.startTimer()),ett(y,d,h,o),ot.get("WEBGL_PAGING_ENABLED")&&i&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var C=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;C>0&&this.lruDataGPU.length>0;){var _=this.lruDataGPU.shift(),k=this.texData.get(_),A=k.shape,I=k.dtype;C-=this.computeBytes(A,I),this.read(_)}return x&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),ot.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(r.dataId).isPacked||t.isPackShader?r:this.unpackTensor(r)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return rn(function(){return t.abs(Lt(1e-8)).get()>0?32:16})},e.prototype.uploadToGPU=function(t){var n,r=this.texData.get(t),o=r.shape,i=r.values,l=r.texture,d=r.usage,p=r.isPacked;if(l==null){var h,g=this.activeTimers!=null;g&&(h=performance.now());var y=NZ(o,p);r.texShape=y;var x=this.acquireTexture(t,y,d,p);if(r.texture=x,i!=null){if(p){var C=this.getBatchDim(o),_=1,k=1;o.length&&(_=(n=this.getRowsCols(o))[0],k=n[1]),this.gpgpu.uploadMatrixToPackedTexture(x,C,_,k,y[0],y[1],DS(i))}else this.gpgpu.uploadMatrixToTexture(x,y[0],y[1],DS(i));r.values=null,g&&(this.uploadWaitMs+=performance.now()-h)}}else ot.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.indexOf(t)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))},e.prototype.convertAndCacheOnCPU=function(t,n){var r=this.delayedStorage,o=this.texData.get(t),i=o.texture,l=o.texShape,d=o.dtype,p=o.usage,h=o.isPacked;return r&&i!=null&&(this.releaseTexture(t,i,l,p,h),o.texture=null,o.texShape=null),o.usage=ma.UPLOAD,n!=null&&(o.values=Tnt(n,d)),o.values},e.prototype.releaseTexture=function(t,n,r,o,i){var l=this.texData.get(t),d=l.shape,p=l.dtype;if(ot.get("WEBGL_PAGING_ENABLED")){var h=this.lruDataGPU.indexOf(t);h>=0&&this.lruDataGPU.splice(h,1)}this.numBytesInGPU-=this.computeBytes(d,p),this.textureManager.releaseTexture(n,r,o,i)},e.prototype.acquireTexture=function(t,n,r,o){var i=this.texData.get(t),l=i.shape,d=i.dtype;return ot.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(l,d),this.textureManager.acquireTexture(n,r,o)},e.prototype.computeBytes=function(t,n){return ie(t)*Qk(n)},e}();function Tnt(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){for(var n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}function DS(e){return e instanceof Float32Array?e:new Float32Array(e)}function Dnt(e){var t=G(e,"x","neg");return ot.engine.runKernel(function(n){return n.neg(t)},{$x:t},function(n){return{$x:function(){return n.neg()}}})}function Ant(e){var t=G(e,"x","ceil");return ot.engine.runKernel(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return _n(n)}}})}function Int(e){var t=G(e,"x","floor");return ot.engine.runKernel(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return _n(n)}}})}function Nnt(e){var t=G(e,"x","sign");return ot.engine.runKernel(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return _n(n)}}})}function Pnt(e){var t=G(e,"x","round");return ot.engine.runKernel(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return _n(n)}}})}function Mnt(e){var t=G(e,"x","exp");return ot.engine.runKernel(function(n,r){return r(n.exp(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mulStrict(o)}}})}function Ont(e){var t=G(e,"x","expm1");return ot.engine.runKernel(function(n){return n.expm1(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.exp())}}})}function Fnt(e){var t=G(e,"x","log");return ot.engine.runKernel(function(n){return n.log(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.toFloat())}}})}function $nt(e){var t=G(e,"x","log1p");return ot.engine.runKernel(function(n){return n.log1p(t)},{$x:t},function(n){return{$x:function(){return n.div(t.add(1))}}})}function Bnt(e){var t=G(e,"x","sqrt");return ot.engine.runKernel(function(n){return n.sqrt(t)},{$x:t},function(n){return{$x:function(){return n.div(t.toFloat().sqrt().mul(2))}}})}function Lnt(e){var t=G(e,"x","rsqrt");return ot.engine.runKernel(function(n){return n.rsqrt(t)},{$x:t},function(n){return{$x:function(){return n.div(t.pow(1.5).mul(2)).neg()}}})}function Wnt(e){var t=G(e,"x","square");return ot.engine.runKernel(function(n){return n.square(t)},{$x:t},function(n){return{$x:function(){return n.mul(t.toFloat().mul(2))}}})}function Unt(e){var t=G(e,"x","reciprocal");return ot.engine.runKernel(function(n){return n.reciprocal(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.square().neg())}}})}function znt(e){var t=G(e,"x","abs");return t.dtype==="complex64"?ot.engine.runKernel(function(n){return n.complexAbs(t)},{$x:t}):ot.engine.runKernel(function(n){return n.abs(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.toFloat().step(-1))}}})}function Vnt(e,t,n){var r=G(e,"x","clipByValue");return tt(t<=n,"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."),ot.engine.runKernel(function(o){return o.clip(r,t,n)},{$x:r},function(o){return{$x:function(){return o.where(r.greaterEqual(t).logicalAnd(r.lessEqual(n)),_n(o))}}})}function Hnt(e){var t=G(e,"x","sigmoid");return ot.engine.runKernel(function(n,r){return r(n.sigmoid(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.mul(Lt(1).sub(o)))}}})}function Gnt(e){var t=G(e,"x","logSigmoid");return ot.engine.runKernel(function(n){return n.softplus(t.neg()).neg()},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.neg().sigmoid())}}})}function qnt(e){var t=G(e,"x","softplus");return ot.engine.runKernel(function(n){return n.softplus(t)},{$x:t},function(n){return{$x:function(){return n.mulStrict(t.sigmoid())}}})}function jnt(e){var t=G(e,"x","sin");return ot.engine.runKernel(function(n){return n.sin(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().cos().mulStrict(n)}}})}function Knt(e){var t=G(e,"x","cos");return ot.engine.runKernel(function(n){return n.cos(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().sin().neg().mulStrict(n)}}})}function Xnt(e){var t=G(e,"x","tan");return ot.engine.runKernel(function(n){return n.tan(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.cos().square())}}})}function Ynt(e){var t=G(e,"x","asin");return ot.engine.runKernel(function(n){return n.asin(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Lt(1).sub(t.toFloat().square()).sqrt())}}})}function Qnt(e){var t=G(e,"x","acos");return ot.engine.runKernel(function(n){return n.acos(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Lt(1).sub(t.toFloat().square()).sqrt()).neg()}}})}function Jnt(e){var t=G(e,"x","atan");return ot.engine.runKernel(function(n){return n.atan(t)},{$x:t},function(n){return{$x:function(){return n.div(t.toFloat().square().add(1))}}})}function Znt(e){var t=G(e,"x","sinh");return ot.engine.runKernel(function(n){return n.sinh(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().cosh().mulStrict(n)}}})}function trt(e){var t=G(e,"x","cosh");return ot.engine.runKernel(function(n){return n.cosh(t)},{$x:t},function(n){return{$x:function(){return t.toFloat().sinh().mulStrict(n)}}})}function ert(e){var t=G(e,"x","tanh");return ot.engine.runKernel(function(n,r){return r(n.tanh(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return Lt(1).sub(o.square()).mulStrict(n)}}})}function nrt(e){var t=G(e,"x","asinh");return ot.engine.runKernel(function(n){return n.asinh(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(Lt(1).add(t.toFloat().square()).sqrt())}}})}function rrt(e){var t=G(e,"x","acosh");return ot.engine.runKernel(function(n){return n.acosh(t)},{$x:t},function(n){return{$x:function(){return n.divStrict(t.toFloat().square().sub(1).sqrt())}}})}function ort(e){var t=G(e,"x","atanh");return ot.engine.runKernel(function(n){return n.atanh(t)},{$x:t},function(n){return{$x:function(){return n.div(Lt(1).sub(t.toFloat().square()))}}})}function art(e){var t=G(e,"x","erf");return tt(t.dtype==="int32"||t.dtype==="float32","Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=t.toFloat()),ot.engine.runKernel(function(n){return n.erf(t)},{$x:t},function(n){return{$x:function(){return n.mul(t.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function irt(e,t){t===void 0&&(t=0);var n=G(e,"x","step");return ot.engine.runKernel(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return _n(r)}}})}ot.get("IS_BROWSER")&&ot.registerBackend("webgl",function(){return new Rnt},2,_0);var srt=ct({abs_:znt}),urt=ct({acos_:Qnt}),crt=ct({acosh_:rrt}),lrt=ct({asin_:Ynt}),drt=ct({asinh_:nrt}),frt=ct({atan_:Jnt}),prt=ct({atanh_:ort}),hrt=ct({ceil_:Ant}),mrt=ct({clipByValue_:Vnt}),grt=ct({cos_:Knt}),vrt=ct({cosh_:trt}),yrt=ct({erf_:art}),brt=ct({exp_:Mnt}),xrt=ct({expm1_:Ont}),wrt=ct({floor_:Int}),Crt=ct({log_:Fnt}),Srt=ct({log1p_:$nt}),_rt=ct({logSigmoid_:Gnt}),UR=ct({neg_:Dnt}),Ert=ct({reciprocal_:Unt}),krt=ct({round_:Pnt}),zR=ct({rsqrt_:Lnt}),Rrt=ct({sigmoid_:Hnt}),Trt=ct({sign_:Nnt}),Drt=ct({sin_:jnt}),Art=ct({sinh_:Znt}),Irt=ct({softplus_:qnt}),Nrt=ct({sqrt_:Bnt}),Prt=ct({square_:Wnt}),Mrt=ct({step_:irt}),Ort=ct({tan_:Xnt}),Frt=ct({tanh_:ert});function $rt(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=G(e,"x","batchNormalization"),h=G(t,"mean","batchNormalization"),g=G(n,"variance","batchNormalization");return o!=null&&(l=G(o,"scale","batchNormalization")),i!=null&&(d=G(i,"offset","batchNormalization")),tt(p.rank===2,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),tt(h.rank===2||h.rank===1,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."),tt(g.rank===2||g.rank===1,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+g.rank+"."),l!=null&&tt(l.rank===2||l.rank===1,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."),d!=null&&tt(d.rank===2||d.rank===1,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+d.rank+"."),Jp(p,h,g,r,l,d)}function Brt(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=G(e,"x","batchNormalization"),h=G(t,"mean","batchNormalization"),g=G(n,"variance","batchNormalization");return o!=null&&(l=G(o,"scale","batchNormalization")),i!=null&&(d=G(i,"offset","batchNormalization")),tt(p.rank===3,"Error in batchNormalization3D: x must be rank 3 but got rank "+p.rank+"."),tt(h.rank===3||h.rank===1,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."),tt(g.rank===3||g.rank===1,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+g.rank+"."),l!=null&&tt(l.rank===3||l.rank===1,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."),d!=null&&tt(d.rank===3||d.rank===1,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+d.rank+"."),Jp(p,h,g,r,l,d)}function Lrt(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p=G(e,"x","batchNormalization"),h=G(t,"mean","batchNormalization"),g=G(n,"variance","batchNormalization");return o!=null&&(l=G(o,"scale","batchNormalization")),i!=null&&(d=G(i,"offset","batchNormalization")),tt(p.rank===4,"Error in batchNormalization4D: x must be rank 4 but got rank "+p.rank+"."),tt(h.rank===4||h.rank===1,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."),tt(g.rank===4||g.rank===1,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+g.rank+"."),l!=null&&tt(l.rank===4||l.rank===1,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."),d!=null&&tt(d.rank===4||d.rank===1,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+d.rank+"."),Jp(p,h,g,r,l,d)}function Wrt(e,t,n,r,o,i){r===void 0&&(r=.001);var l,d,p,h=G(e,"x","batchNormalization"),g=G(t,"mean","batchNormalization"),y=G(n,"variance","batchNormalization");return o!=null&&(l=G(o,"scale","batchNormalization")),i!=null&&(d=G(i,"offset","batchNormalization")),tt(g.rank===y.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),tt(d==null||g.rank===d.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),tt(l==null||g.rank===l.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),p=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h,ot.engine.runKernel(function(x){return x.batchNormalization(p,Pf(g),Pf(y),r,Pf(l),Pf(d))},{$x:h,$mean:g,$variance:y,$scale:l,$offset:d},function(x){var C=l??Lt(1),_=mr(g.shape,p.shape),k=[];if(g.rank===1){for(var A=0;A<p.shape.length-1;++A)k.push(p.shape[A]);k.push(1)}var I=h.sub(g),N=x.mul(C),D=zR(y.add(Lt(r))),M=D.mul(D).mul(D).mul(Lt(-.5));return{$x:function(){return g.rank===1?x.mul(Tl(D.as4D(1,1,1,g.shape[0]),k)).mul(C).reshape(h.shape):x.mul(D).mul(C).reshape(h.shape)},$mean:function(){var F=D.mul(Lt(-1)).mul(N);return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)},$variance:function(){var F=M.mul(I).mul(N);return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)},$scale:function(){var F=I.mul(D),W=x.mul(F);return g.rank===1&&(W=W.sum(_)),W.reshape(g.shape)},$offset:function(){var F=x;return g.rank===1&&(F=F.sum(_)),F.reshape(g.shape)}}}).reshape(h.shape)}function Pf(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var Urt=ct({batchNormalization2d_:$rt}),zrt=ct({batchNormalization3d_:Brt}),Vrt=ct({batchNormalization4d_:Lrt}),Jp=ct({batchNormalization_:Wrt});function yd(e,t,n,r,o,i,l){l===void 0&&(l="channelsLast");var d,p=yp(t),h=p[0],g=p[1];if(l==="channelsLast")d=[h,g,e[3],e[3]];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);d=[h,g,e[1],e[1]]}return bd(e,d,n,r,o,i,!1,l)}function bd(e,t,n,r,o,i,l,d){l===void 0&&(l=!1),d===void 0&&(d="channelsLast");var p=[-1,-1,-1,-1],h=p[0],g=p[1],y=p[2],x=p[3];if(d==="channelsLast")h=e[0],g=e[1],y=e[2],x=e[3];else{if(d!=="channelsFirst")throw new Error("Unknown dataFormat "+d);h=e[0],x=e[1],g=e[2],y=e[3]}var C,_=t[0],k=t[1],A=t[3],I=yp(n),N=I[0],D=I[1],M=yp(r),F=M[0],W=M[1],L=nc(_,F),X=nc(k,W),q=qrt(o,g,y,N,D,L,X,i),Q=q.padInfo,it=q.outHeight,at=q.outWidth,ht=l?A*x:A;return d==="channelsFirst"?C=[h,ht,it,at]:d==="channelsLast"&&(C=[h,it,at,ht]),{batchSize:h,dataFormat:d,inHeight:g,inWidth:y,inChannels:x,outHeight:it,outWidth:at,outChannels:ht,padInfo:Q,strideHeight:N,strideWidth:D,filterHeight:_,filterWidth:k,effectiveFilterHeight:L,effectiveFilterWidth:X,dilationHeight:F,dilationWidth:W,inShape:e,outShape:C,filterShape:t}}function M0(e,t,n,r,o,i,l){i===void 0&&(i=!1),l===void 0&&(l="channelsLast");var d=[-1,-1,-1,-1,-1],p=d[0],h=d[1],g=d[2],y=d[3],x=d[4];if(l==="channelsLast")p=e[0],h=e[1],g=e[2],y=e[3],x=e[4];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);p=e[0],x=e[1],h=e[2],g=e[3],y=e[4]}var C,_=t[0],k=t[1],A=t[2],I=t[4],N=AS(n),D=N[0],M=N[1],F=N[2],W=AS(r),L=W[0],X=W[1],q=W[2],Q=jrt(o,h,g,y,D,M,F,nc(_,L),nc(k,X),nc(A,q)),it=Q.padInfo,at=Q.outDepth,ht=Q.outHeight,gt=Q.outWidth,Ct=i?I*x:I;return l==="channelsFirst"?C=[p,Ct,at,ht,gt]:l==="channelsLast"&&(C=[p,at,ht,gt,Ct]),{batchSize:p,dataFormat:l,inDepth:h,inHeight:g,inWidth:y,inChannels:x,outDepth:at,outHeight:ht,outWidth:gt,outChannels:Ct,padInfo:it,strideDepth:D,strideHeight:M,strideWidth:F,filterDepth:_,filterHeight:k,filterWidth:A,dilationDepth:L,dilationHeight:X,dilationWidth:q,inShape:e,outShape:C,filterShape:t}}function Hrt(e,t,n,r,o,i){o==null&&(o=Grt(e,t,r));var l=e[0],d=e[1],p=IS((l-t+2*o)/r+1,i);tt(Fo(p),"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters");var h=IS((d-t+2*o)/r+1,i);return tt(Fo(h),"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"),[p,h,n]}function Grt(e,t,n,r){r===void 0&&(r=1);var o=nc(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function yp(e){return typeof e=="number"?[e,e]:e}function AS(e){return typeof e=="number"?[e,e,e]:e}function nc(e,t){return t<=1?e:e+(e-1)*(t-1)}function qrt(e,t,n,r,o,i,l,d){var p,h,g;if(typeof e=="number"){p={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};var y=Hrt([t,n,1],i,1,r,e,d);h=y[0],g=y[1]}else if(e==="same"){var x=((h=Math.ceil(t/r))-1)*r+i-t,C=((g=Math.ceil(n/o))-1)*o+l-n,_=Math.floor(x/2),k=x-_,A=Math.floor(C/2);p={top:_,bottom:k,left:A,right:C-A,type:"SAME"}}else{if(e!=="valid")throw Error("Unknown padding parameter: "+e);p={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((t-i+1)/r),g=Math.ceil((n-l+1)/o)}return{padInfo:p,outHeight:h,outWidth:g}}function jrt(e,t,n,r,o,i,l,d,p,h){var g,y,x,C;if(e==="same"){var _=((y=Math.ceil(t/o))-1)*o+d-t,k=((x=Math.ceil(n/i))-1)*i+p-n,A=((C=Math.ceil(r/l))-1)*l+h-r,I=Math.floor(_/2),N=_-I,D=Math.floor(k/2),M=k-D,F=Math.floor(A/2);g={top:D,bottom:M,left:F,right:A-F,front:I,back:N,type:"SAME"}}else{if(e!=="valid")throw Error("Unknown padding parameter: "+e);g={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},y=Math.ceil((t-d+1)/o),x=Math.ceil((n-p+1)/i),C=Math.ceil((r-h+1)/l)}return{padInfo:g,outDepth:y,outHeight:x,outWidth:C}}function IS(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function bp(e){var t=yp(e),n=t[0],r=t[1];return n===1&&r===1}function ns(e,t){return bp(e)||bp(t)}function Krt(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var i=G(e,"a","matMul"),l=G(t,"b","matMul");i=(o=vr(i,l))[0],l=o[1];var d=n?i.shape[i.rank-2]:i.shape[i.rank-1],p=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?i.shape[i.rank-1]:i.shape[i.rank-2],g=r?l.shape[l.rank-2]:l.shape[l.rank-1],y=i.shape.slice(0,-2),x=l.shape.slice(0,-2),C=ie(y),_=ie(x);tt(i.rank>=2&&l.rank>=2&&i.rank===l.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+l.rank+"."),tt(Nr(y,x),"Error in matMul: outer dimensions ("+y+") and ("+x+") of Tensors with shapes "+i.shape+" and "+l.shape+" must match."),tt(d===p,"Error in matMul: inner shapes ("+d+") and ("+p+") of Tensors with shapes "+i.shape+" and "+l.shape+" and transposeA="+n+" and transposeB="+r+" must match.");var k=i.shape.slice(0,-2).concat([h,g]),A=n?i.as3D(C,d,h):i.as3D(C,h,d),I=r?l.as3D(_,g,p):l.as3D(_,p,g);return ot.engine.runKernel(function(N){return N.batchMatMul(A,I,n,r)},{$a:A,$b:I},function(N){return n||r?!n&&r?{$a:function(){return N.matMul(I,!1,!1)},$b:function(){return N.matMul(A,!0,!1)}}:n&&!r?{$a:function(){return I.matMul(N,!1,!0)},$b:function(){return A.matMul(N,!1,!1)}}:{$a:function(){return I.matMul(N,!0,!0)},$b:function(){return N.matMul(A,!0,!0)}}:{$a:function(){return N.matMul(I,!1,!0)},$b:function(){return A.matMul(N,!0,!1)}}}).reshape(k)}function Xrt(e,t){var n=G(e,"v1","outerProduct"),r=G(t,"v2","outerProduct");return tt(n.rank===1&&r.rank===1,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))}function Yrt(e,t){var n=G(e,"t1","dot"),r=G(t,"t2","dot");tt(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var o=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];return tt(o===i,"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}var VR=ct({matMul_:Krt}),Qrt=ct({dot_:Yrt}),Jrt=ct({outerProduct_:Xrt});function Zrt(e,t,n,r,o,i,l){o===void 0&&(o="NWC"),i===void 0&&(i=1);var d=G(e,"x","conv1d"),p=G(t,"filter","conv1d"),h=d,g=!1;d.rank===2&&(g=!0,h=d.as3D(1,d.shape[0],d.shape[1])),tt(h.rank===3,"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."),tt(p.rank===3,"Error in conv1d: filter must be rank 3, but got rank "+p.rank+"."),l!=null&&tt(Fo(r),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+"."),tt(h.shape[2]===p.shape[1],"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+p.shape[1]+"."),tt(ns(n,i),"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"),tt(o==="NWC","Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported.");var y=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]),x=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),C=kc(x,y,[1,n],r,"NHWC",[1,i],l);return g?C.as2D(C.shape[2],C.shape[3]):C.as3D(C.shape[0],C.shape[2],C.shape[3])}function tot(e,t,n,r,o,i,l){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var d=G(e,"x","conv2d"),p=G(t,"filter","conv2d"),h=d,g=!1;d.rank===3&&(g=!0,h=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),tt(h.rank===4,"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."),tt(p.rank===4,"Error in conv2d: filter must be rank 4, but got rank "+p.rank+"."),l!=null&&tt(Fo(r),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+"."),tt(h.shape[3]===p.shape[2],"Error in conv2d: depth of input ("+h.shape[3]+") must match input depth for filter "+p.shape[2]+"."),tt(ns(n,i),"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),tt(o==="NHWC","Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported.");var y,x=bd(h.shape,p.shape,n,i,r,l);if(x.filterHeight!==1||x.filterWidth!==1||x.dilationHeight!==1||x.dilationWidth!==1||x.strideHeight!==1||x.strideWidth!==1||x.padInfo.type!=="SAME"&&x.padInfo.type!=="VALID")y=ot.engine.runKernel(function(k){return k.conv2d(h,p,x)},{x:h,$filter:p},function(k){return tt(bp(i),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return HR(h.shape,k,p,n,r)},$filter:function(){return GR(h,k,p.shape,n,r)}}});else{var C=h.reshape([-1,x.inChannels]),_=p.reshape([x.inChannels,x.outChannels]);y=VR(C,_).reshape(x.outShape)}return g?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}function HR(e,t,n,r,o,i){tt(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var l=e,d=t,p=!1;t.rank===3&&(p=!0,d=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),l=[1,e[0],e[1],e[2]]);var h=l[3],g=d.shape[3];tt(l.length===4,"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."),tt(d.rank===4,"Error in conv2dDerInput: dy must be rank 4, but got rank "+d.rank),tt(n.rank===4,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),tt(h===n.shape[2],"Error in conv2dDerInput: depth of input ("+h+") must match input depth for filter "+n.shape[2]+"."),tt(g===n.shape[3],"Error in conv2dDerInput: depth of output ("+g+") must match output depth for filter "+n.shape[3]+"."),i!=null&&tt(Fo(o),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var y=bd(l,n.shape,r,1,o,i),x=ot.engine.runKernel(function(C){return C.conv2dDerInput(d,n,y)},{dy4D:d,filter:n},function(C){return{dy4D:function(){return kc(C,n,r,o,"NHWC",1,i)},filter:function(){return qR(C,d,n.shape,r,o,i)}}});return p?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function GR(e,t,n,r,o,i){var l=e;e.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var d=t;d.rank===3&&(d=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),tt(l.rank===4,"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."),tt(d.rank===4,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+d.shape+"."),tt(n.length===4,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),tt(l.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+l.shape[3]+") must match input depth in filter ("+n[2]+"."),tt(d.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+d.shape[3]+") must match output depth for filter ("+n[3]+")."),i!=null&&tt(Fo(o),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var p=bd(l.shape,n,r,1,o,i);return ot.engine.runKernel(function(h){return h.conv2dDerFilter(l,d,p)},{x4D:l,dy4D:d})}function eot(e,t,n,r,o,i){return HR(n,G(e,"x","conv2dTranspose"),G(t,"filter","conv2dTranspose"),r,o,i)}function not(e,t,n,r,o,i,l){i===void 0&&(i=[1,1]);var d=G(e,"x","depthwiseConv2d"),p=G(t,"filter","depthwiseConv2d"),h=d,g=!1;d.rank===3&&(g=!0,h=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),tt(h.rank===4,"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."),tt(p.rank===4,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+p.rank+"."),tt(h.shape[3]===p.shape[2],"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+p.shape[2]+"."),i==null&&(i=[1,1]),tt(ns(n,i),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),l!=null&&tt(Fo(r),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+r+".");var y=bd(h.shape,p.shape,n,i,r,l,!0),x=ot.engine.runKernel(function(C){return C.depthwiseConv2D(h,p,y)},{x:h,$filter:p},function(C){return tt(bp(i),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"),{x:function(){return iot(h.shape,C,p,y)},$filter:function(){return sot(h,C,p.shape,y)}}});return g?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function rot(e,t,n,r,o,i,l){i===void 0&&(i=[1,1]),l===void 0&&(l="NHWC");var d=G(e,"x","separableConv2d"),p=G(t,"depthwiseFilter","separableConv2d"),h=G(n,"pointwiseFilter","separableConv2d"),g=d,y=!1;if(d.rank===3&&(y=!0,g=d.as4D(1,d.shape[0],d.shape[1],d.shape[2])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");tt(g.rank===4,"Error in separableConv2d: input must be rank 4, but got rank "+g.rank+"."),tt(p.rank===4,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+p.rank+"."),tt(h.rank===4,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+p.rank+"."),tt(h.shape[0]===1,"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."),tt(h.shape[1]===1,"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+h.shape[1]+".");var x=p.shape[2],C=p.shape[3];tt(h.shape[2]===x*C,"Error in separableConv2d: the third dimension of pointwise filter must be "+x*C+", but got "+h.shape[2]+".");var _=jR(g,p,r,o,l,i),k=kc(_,h,1,"valid",l);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}function oot(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Ev(e){var t=oot(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function aot(e,t){return Ev(e)||Ev(t)}function iot(e,t,n,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var l=ot.engine.runKernel(function(d){return d.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function sot(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),ot.engine.runKernel(function(l){return l.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}function uot(e,t,n,r,o,i){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1,1]);var l=G(e,"x","conv3d"),d=G(t,"filter","conv3d"),p=l,h=!1;l.rank===4&&(h=!0,p=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),tt(p.rank===5,"Error in conv3d: input must be rank 5, but got rank "+p.rank+"."),tt(d.rank===5,"Error in conv3d: filter must be rank 5, but got rank "+d.rank+"."),tt(p.shape[4]===d.shape[3],"Error in conv3d: depth of input ("+p.shape[4]+") must match input depth for filter "+d.shape[3]+"."),tt(aot(n,i),"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"),tt(o==="NHWC","Error in conv3d: got dataFormat of "+o+" but only NHWC is currently supported.");var g=M0(p.shape,d.shape,n,i,r),y=ot.engine.runKernel(function(x){return x.conv3d(p,d,g)},{x:p,$filter:d},function(x){return tt(Ev(i),"Error in gradient of conv3D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+i+"'"),{x:function(){return cot(p.shape,x,d,n,r)},$filter:function(){return lot(p,x,d.shape,n,r)}}});return h?y.as4D(y.shape[1],y.shape[2],y.shape[3],y.shape[4]):y}function cot(e,t,n,r,o){tt(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var i=e,l=t,d=!1;t.rank===4&&(d=!0,l=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var p=i[4],h=l.shape[4];tt(i.length===5,"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."),tt(l.rank===5,"Error in conv3dDerInput: dy must be rank 5, but got rank "+l.rank),tt(n.rank===5,"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),tt(p===n.shape[3],"Error in conv3dDerInput: depth of input ("+p+") must match input depth for filter "+n.shape[3]+"."),tt(h===n.shape[4],"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[4]+".");var g=M0(i,n.shape,r,1,o),y=ot.engine.runKernel(function(x){return x.conv3dDerInput(l,n,g)},{dy5D:l});return d?y.as4D(y.shape[1],y.shape[2],y.shape[3],y.shape[4]):y}function lot(e,t,n,r,o){var i=e;e.rank===4&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var l=t;l.rank===4&&(l=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),tt(i.rank===5,"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."),tt(l.rank===5,"Error in conv3dDerFilter: dy must be rank 5, but got shape "+l.shape+"."),tt(n.length===5,"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),tt(i.shape[4]===n[3],"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."),tt(l.shape[4]===n[4],"Error in conv3dDerFilter: depth of dy ("+l.shape[4]+") must match output depth for filter ("+n[4]+").");var d=M0(i.shape,n,r,1,o);return ot.engine.runKernel(function(p){return p.conv3dDerFilter(i,l,d)},{x5D:i,dy5D:l})}var dot=ct({conv1d_:Zrt}),kc=ct({conv2d_:tot}),fot=ct({conv3d_:uot}),qR=ct({conv2dDerFilter_:GR}),jR=ct({depthwiseConv2d_:not}),KR=ct({separableConv2d_:rot}),pot=ct({conv2dTranspose_:eot});function hot(e){var t=G(e,"x","reverse");return tt(t.rank===1,`Error in reverse1D: x must be rank 1 but got
             rank `+t.rank+"."),xd(t,0)}function mot(e,t){var n=G(e,"x","reverse");return tt(n.rank===2,`Error in reverse2D: x must be rank 2 but got
             rank `+n.rank+"."),xd(n,t)}function got(e,t){var n=G(e,"x","reverse");return tt(n.rank===3,`Error in reverse3D: x must be rank 3 but got
             rank `+n.rank+"."),xd(n,t)}function vot(e,t){var n=G(e,"x","reverse");return tt(n.rank===4,`Error in reverse4D: x must be rank 4 but got
             rank `+n.rank+"."),xd(n,t)}function yot(e,t){var n=G(e,"x","reverse");if(n.rank===0)return n.clone();var r=Or(t,n.shape);return ot.engine.runKernel(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}var xd=ct({reverse_:yot}),bot=ct({reverse1d_:hot}),xot=ct({reverse2d_:mot}),wot=ct({reverse3d_:got}),Cot=ct({reverse4d_:vot});function XR(e,t,n,r,o,i){var l=G(e,"x","maxPool"),d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),tt(d.rank===4,"Error in maxPool: input must be rank 4 but got rank "+d.rank+"."),tt(ns(n,r),"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"),i!=null&&tt(Fo(o),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var h=yd(d.shape,t,n,r,o,i),g=ot.engine.runKernel(function(y,x){return x(y.maxPool(d,h))},{x:d},function(y,x){var C=x[0];return{x:function(){return kot(y,d,C,t,n,r,o)}}});return p?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function Sot(e,t,n,r,o){return XR(e,t,n,1,r,o)}function YR(e,t,n,r,o,i){var l=G(e,"x","avgPool","float32");tt(ns(n,r),"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'");var d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),tt(d.rank===4,"Error in avgPool: x must be rank 4 but got rank "+d.rank+"."),i!=null&&tt(Fo(o),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+".");var h=yd(d.shape,t,n,r,o),g=ot.engine.runKernel(function(y){return y.avgPool(d,h)},{x:d},function(y){return{x:function(){return Rot(y,d,t,n,r,o)}}});return g=g.cast(l.dtype),p?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function _ot(e,t,n,r,o){return YR(e,t,n,1,r,o)}function Eot(e,t,n,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var l=G(e,"x","maxPool"),d=l,p=!1;l.rank===3&&(p=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),tt(ns(i,o),"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'");var h,g=yd(d.shape,t,i,o,r),y=[g.dilationHeight,g.dilationWidth];h=r==="same"?Dot([g.filterHeight,g.filterWidth],y):[[0,0],[0,0]];var x=y[0]===1&&y[1]===1,C=Tot([g.inHeight,g.inWidth],y,h),_=C[0],k=C[1],A=x?r:"valid",I=x?d:LR(d,y,_),N=(n==="avg"?function(){return YR(I,t,i,1,A)}:function(){return XR(I,t,i,1,A)})(),D=x?N:FR(N,y,k);return p?D.as3D(D.shape[1],D.shape[2],D.shape[3]):D}function kot(e,t,n,r,o,i,l,d){var p=G(e,"dy","maxPoolBackprop"),h=G(t,"input","maxPoolBackprop"),g=G(n,"output","maxPoolBackprop");tt(h.rank===p.rank,"Rank of input ("+h.rank+") does not match rank of dy ("+p.rank+")"),tt(ns(o,i),"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"),tt(p.rank===4,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+p.rank+"."),tt(h.rank===4,"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+".");var y=yd(h.shape,r,o,i,l,d);return ot.engine.runKernel(function(x){return x.maxPoolBackprop(p,h,g,y)},{$dy:p,$input:h})}function Rot(e,t,n,r,o,i){var l=G(e,"dy","avgPoolBackprop"),d=G(t,"input","avgPoolBackprop");tt(d.rank===l.rank,"Rank of input ("+d.rank+") does not match rank of dy ("+l.rank+")"),tt(ns(r,o),"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'");var p=d,h=l,g=!1;d.rank===3&&(g=!0,p=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]),h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),tt(h.rank===4,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+h.rank+"."),tt(p.rank===4,"Error in avgPoolBackprop: input must be rank 4 but got rank "+p.rank+".");var y=yd(p.shape,n,r,o,i),x=ot.engine.runKernel(function(C){return C.avgPoolBackprop(h,p,y)},{dy4D:h,input4D:p});return g?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Tot(e,t,n){var r=n.map(function(p){return p[0]}),o=n.map(function(p){return p[1]}),i=e.concat(r,o),l=t.map(function(p,h){return(p-i[h]%p)%p}),d=o.map(function(p,h){return p+l[h]});return[t.map(function(p,h){return[r[h],d[h]]}),t.map(function(p,h){return[0,l[h]]})]}function Dot(e,t){var n=e.map(function(i,l){return i+(i-1)*(t[l]-1)}).map(function(i){return i-1}),r=n.map(function(i){return Math.floor(i/2)}),o=n.map(function(i,l){return i-r[l]});return n.map(function(i,l){return[r[l],o[l]]})}var so=ct({maxPool_:Sot}),Aot=ct({avgPool_:_ot}),Iot=ct({pool_:Eot});function Not(e,t,n){var r=G(e,"x","slice1d");return tt(r.rank===1,"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"),wd(r,[t],[n])}function Pot(e,t,n){var r=G(e,"x","slice2d");return tt(r.rank===2,"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"),wd(r,t,n)}function Mot(e,t,n){var r=G(e,"x","slice3d");return tt(r.rank===3,"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"),wd(r,t,n)}function Oot(e,t,n){var r=G(e,"x","slice4d");return tt(r.rank===4,"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"),wd(r,t,n)}function Fot(e,t,n){var r,o,i=G(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice(),o=(o=n==null?new Array(i.rank).fill(-1):typeof n=="number"?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(d,p){return d>=0?d:(tt(d===-1,"Bad value in size"),i.shape[p]-r[p])}),sQ(i,r,o);var l=i.shape;return ot.engine.runKernel(function(d){return d.slice(i,r,o)},{$x:i},function(d){for(var p=[],h=0;h<d.rank;h++)p.push([r[h],l[h]-r[h]-o[h]]);return{$x:function(){return d.pad(p)}}})}var wd=ct({slice_:Fot}),$ot=ct({slice1d_:Not}),Bot=ct({slice2d_:Pot}),Lot=ct({slice3d_:Mot}),Wot=ct({slice4d_:Oot});function Uot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","logSumExp"),o=Or(t,r.shape),i=r.max(o,!0),l=r.sub(i).exp().sum(o).log(),d=i.reshape(l.shape).add(l);if(n){var p=$o(d.shape,o);return d.reshape(p)}return d}function zot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=Or(t,r.shape);return md(function(i){var l=Ra(o,i.rank),d=o,p=i;l!=null&&(p=i.transpose(l),d=Ta(d.length,i.rank));var h=ot.engine.runKernel(function(y){return y.sum(p,d)},{permutedX:p});if(n){var g=$o(h.shape,o);h=h.reshape(g)}return{value:h,gradFunc:function(y){var x=i.shape.slice();return o.forEach(function(C){x[C]=1}),y.reshape(x).mul(qi(i.shape,"float32"))}}})(r)}function Vot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=Or(t,r.shape),i=Ra(o,r.rank),l=o,d=r;i!=null&&(d=r.transpose(i),l=Ta(l.length,r.rank));var p=ot.engine.runKernel(function(g){return g.prod(d,l)},{permutedX:d});if(n){var h=$o(p.shape,o);p=p.reshape(h)}return p}function Hot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","mean"),o=Or(t,r.shape),i=ie(ur(r.shape,o)[1]);return md(function(l){var d=Lt(i);return{value:(d.dtype===l.dtype?l:l.cast(d.dtype)).div(d).sum(t,n),gradFunc:function(p){var h=l.shape.slice();return o.forEach(function(g){h[g]=1}),p.reshape(h).mul(qi(l.shape,"float32")).div(d)}}})(r)}function QR(e,t,n,r,o){var i=t[0];return i.rank<n.rank&&(i=i.reshape($o(i.shape,r))),e.rank<n.rank&&(e=e.reshape($o(e.shape,r))),{$x:function(){var l=e.mul(n.equal(i).cast(e.dtype));return o==null?l:l.transpose(o)}}}function Got(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","min"),o=r,i=Or(t,r.shape),l=i,d=Ra(l,r.rank);d!=null&&(r=r.transpose(d),l=Ta(l.length,r.rank));var p=ot.engine.runKernel(function(g,y){return y(g.min(r,l))},{$x:r},function(g,y){return QR(g,y,o,i,d)});if(n){var h=$o(p.shape,i);p=p.reshape(h)}return p}function qot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","max"),o=r,i=Or(t,r.shape),l=i,d=Ra(l,r.rank);d!=null&&(r=r.transpose(d),l=Ta(l.length,r.rank));var p=ot.engine.runKernel(function(g,y){return y(g.max(r,l))},{$x:r},function(g,y){return QR(g,y,o,i,d)});if(n){var h=$o(p.shape,i);p=p.reshape(h)}return p}function jot(e,t){t===void 0&&(t=0);var n=G(e,"x","argMin");t==null&&(t=0);var r=Or(t,n.shape),o=Ra(r,n.rank);return o!=null&&(n=n.transpose(o),r=Ta(r.length,n.rank)),ot.engine.runKernel(function(i){return i.argMin(n,r[0])},{$x:n},function(i){return{$x:function(){return _n(n)}}})}function Kot(e,t){t===void 0&&(t=0);var n=G(e,"x","argMax");t==null&&(t=0);var r=Or(t,n.shape),o=Ra(r,n.rank);return o!=null&&(n=n.transpose(o),r=Ta(r.length,n.rank)),ot.engine.runKernel(function(i){return i.argMax(n,r[0])},{$x:n},function(i){return{$x:function(){return _n(n)}}})}function Xot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","all","bool"),o=Or(t,r.shape),i=o,l=Ra(i,r.rank);l!=null&&(r=r.transpose(l),i=Ta(i.length,r.rank));var d=ot.engine.runKernel(function(h){return h.all(r,i)},{$x:r});if(n){var p=$o(d.shape,o);return d.reshape(p)}return d}function Yot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=G(e,"x","any","bool"),o=Or(t,r.shape),i=o,l=Ra(i,r.rank);l!=null&&(r=r.transpose(l),i=Ta(i.length,r.rank));var d=ot.engine.runKernel(function(h){return h.any(r,i)},{$x:r});if(n){var p=$o(d.shape,o);return d.reshape(p)}return d}function Qot(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=Or(t,(e=G(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;return n||(i=$o(o.shape,r)),{mean:o,variance:e.toFloat().sub(o.reshape(i)).square().mean(r,n)}}var Jot=ct({all_:Xot}),Zot=ct({any_:Yot}),tat=ct({argMax_:Kot}),eat=ct({argMin_:jot}),nat=ct({logSumExp_:Uot}),rat=ct({max_:qot}),oat=ct({mean_:Hot}),aat=ct({min_:Got}),iat=ct({moments_:Qot}),JR=ct({sum_:zot}),sat=ct({prod_:Vot});function uat(e,t){var n,r=G(e,"a","notEqual"),o=G(t,"b","notEqual");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.notEqual(r,o)},{$a:r,$b:o})}function cat(e,t){var n=G(e,"a","notEqualStrict"),r=G(t,"b","notEqualStrict");return an(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}function lat(e,t){var n,r=G(e,"a","less"),o=G(t,"b","less");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.less(r,o)},{$a:r,$b:o})}function dat(e,t){var n=G(e,"a","lessStrict"),r=G(t,"b","lessStrict");return an(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}function fat(e,t){var n,r=G(e,"a","equal"),o=G(t,"b","equal");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.equal(r,o)},{$a:r,$b:o})}function pat(e,t){var n=G(e,"a","equalStrict"),r=G(t,"b","equalStrict");return an(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}function hat(e,t){var n,r=G(e,"a","lessEqual"),o=G(t,"b","lessEqual");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.lessEqual(r,o)},{$a:r,$b:o})}function mat(e,t){var n=G(e,"a","lessEqualStrict"),r=G(t,"b","lessEqualStrict");return an(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}function gat(e,t){var n,r=G(e,"a","greater"),o=G(t,"b","greater");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.greater(r,o)},{$a:r,$b:o})}function vat(e,t){var n=G(e,"a","greaterStrict"),r=G(t,"b","greaterStrict");return an(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}function yat(e,t){var n,r=G(e,"a","greaterEqual"),o=G(t,"b","greaterEqual");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.greaterEqual(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return _n(r)},$b:function(){return _n(o)}}})}function bat(e,t){var n=G(e,"a","greaterEqualStrict"),r=G(t,"b","greaterEqualStrict");return an(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}var ZR=ct({equal_:fat}),xat=ct({equalStrict_:pat}),wat=ct({greater_:gat}),tT=ct({greaterEqual_:yat}),Cat=ct({greaterEqualStrict_:bat}),Sat=ct({greaterStrict_:vat}),_at=ct({less_:lat}),Eat=ct({lessEqual_:hat}),kat=ct({lessEqualStrict_:mat}),Rat=ct({lessStrict_:dat}),Tat=ct({notEqual_:uat}),Dat=ct({notEqualStrict_:cat});function Aat(e,t){var n,r=G(e,"a","add"),o=G(t,"b","add");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.add(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l,p=mr(r.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(r.shape)},$b:function(){var d=l,p=mr(o.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(o.shape)}}})}function Iat(e){tt(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),tt(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,i){return G(o,"tensors"+i,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Nr(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return ot.engine.runKernel(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(l,d){i[d]=function(){return o.clone()}}),i})}function Nat(e,t){var n=G(e,"a","addStrict"),r=G(t,"b","addStrict");return an(n.shape,r.shape,"Error in addStrict: "),n.add(r)}function Pat(e,t){var n,r=G(e,"a","sub"),o=G(t,"b","sub");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.subtract(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l,p=mr(r.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(r.shape)},$b:function(){var d=l,p=mr(o.shape,i);return p.length>0&&(d=d.sum(p)),d.neg().reshape(o.shape)}}})}function Mat(e,t){var n=G(e,"a","subStrict"),r=G(t,"b","subStrict");return an(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}function Oat(e,t){var n=G(e,"base","pow"),r=G(t,"exp","pow"),o=je(n.shape,r.shape);return e=n.cast(dr(n.dtype,r.dtype)),t=r.cast(dr(n.dtype,r.dtype)),ot.engine.runKernel(function(i,l){return l(i.pow(n,r))},{$base:n,$exp:r},function(i,l){var d=l[0];return{$base:function(){var p=r.toFloat(),h=i.mul(p.mul(n.pow(p.sub(Lt(1))))),g=mr(n.shape,o);return g.length>0&&(h=h.sum(g)),h.reshape(n.shape)},$exp:function(){var p=i.mul(d.mul(n.log()).toFloat()),h=mr(r.shape,o);return h.length>0&&(p=p.sum(h)),p.reshape(r.shape)}}})}function Fat(e,t){return an(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}function $at(e,t){var n,r=G(e,"a","mul"),o=G(t,"b","mul");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.multiply(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l.mul(o.toFloat()),p=mr(r.shape,i);return p.length>0?d.sum(p).reshape(r.shape):d},$b:function(){var d=l.mul(r.toFloat()),p=mr(o.shape,i);return p.length>0?d.sum(p).reshape(o.shape):d}}})}function Bat(e,t){var n=G(e,"a","mul"),r=G(t,"b","mul");return an(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}function Lat(e,t){var n,r,o=G(e,"a","div"),i=G(t,"b","div");if(n=vr(o,i),o=n[0],i=n[1],o.dtype==="int32"&&i.dtype==="int32")return eT(o,i);r=function(d){return d.realDivide(o,i)};var l=je(o.shape,i.shape);return ot.engine.runKernel(r,{$a:o,$b:i},function(d){return{$a:function(){var p=d.div(i.toFloat()),h=mr(o.shape,l);return h.length>0?p.sum(h).reshape(o.shape):p},$b:function(){var p=d.mul(o.toFloat()),h=mr(i.shape,l);h.length>0&&(p=p.sum(h).reshape(i.shape));var g=i.square();return p.div(g.toFloat()).neg()}}})}function Wat(e,t){var n,r=G(e,"a","floorDiv"),o=G(t,"b","floorDiv");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.floorDiv(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=l.div(o.toFloat()),p=mr(r.shape,i);return p.length>0?d.sum(p).reshape(r.shape):d},$b:function(){var d=l.mul(r.toFloat()),p=mr(o.shape,i);p.length>0&&(d=d.sum(p).reshape(o.shape));var h=o.square();return d.div(h.toFloat()).neg()}}})}function Uat(e,t){var n=G(e,"a","div"),r=G(t,"b","div");return an(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}function zat(e,t){var n,r=G(e,"a","mod"),o=G(t,"b","mod");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.mod(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=mr(r.shape,i);return d.length>0?l.sum(d).reshape(r.shape):l},$b:function(){var d=l.mul(r.div(o).floor().neg()),p=mr(o.shape,i);return p.length>0?d.sum(p).reshape(o.shape):d}}})}function Vat(e,t){var n=G(e,"a","modStrict"),r=G(t,"b","modStrict");return an(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}function Hat(e,t){var n,r=G(e,"a","minimum"),o=G(t,"b","minimum");return n=vr(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.minimum(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return i.mul(r.lessEqual(o).toFloat())},$b:function(){return i.mul(r.greater(o).toFloat())}}})}function Gat(e,t){var n=G(e,"a","minimumStrict"),r=G(t,"b","minimumStrict");return an(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}function qat(e,t){var n,r=G(e,"a","maximum"),o=G(t,"b","maximum");return n=vr(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.maximum(r,o)},{$a:r,$b:o},function(i){return{$a:function(){return i.mul(r.greaterEqual(o).toFloat())},$b:function(){return i.mul(r.less(o).toFloat())}}})}function jat(e,t){var n=G(e,"a","maximumStrict"),r=G(t,"b","maximumStrict");return an(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}function Kat(e,t){var n,r=G(e,"a","squaredDifference"),o=G(t,"b","squaredDifference");return n=vr(r,o),r=n[0],o=n[1],je(r.shape,o.shape),ot.engine.runKernel(function(i){return i.squaredDifference(r,o)},{$a:r,$b:o},function(i){var l=Lt(2);return{$a:function(){return i.mul(r.sub(o).mul(l))},$b:function(){return i.mul(o.sub(r).mul(l))}}})}function Xat(e,t){var n=G(e,"a","squaredDifferenceStrict"),r=G(t,"b","squaredDifferenceStrict");return an(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}function Yat(e,t){var n,r=G(e,"a","atan2"),o=G(t,"b","atan2");n=vr(r,o),r=n[0],o=n[1];var i=je(r.shape,o.shape);return ot.engine.runKernel(function(l){return l.atan2(r,o)},{$a:r,$b:o},function(l){return{$a:function(){var d=Hs(r.square(),o.square()),p=l.mul(o.div(d)),h=mr(r.shape,i);return h.length>0&&(p=p.sum(h)),p.reshape(r.shape)},$b:function(){var d=Hs(r.square(),o.square()),p=UR(l.mul(r.div(d))),h=mr(o.shape,i);return h.length>0&&(p=p.sum(h)),p.reshape(o.shape)}}})}var Hs=ct({add_:Aat}),Qat=ct({addN_:Iat}),Jat=ct({addStrict_:Nat}),Zat=ct({atan2_:Yat}),tit=ct({div_:Lat}),eit=ct({divStrict_:Uat}),eT=ct({floorDiv_:Wat}),Zp=ct({maximum_:qat}),nit=ct({maximumStrict_:jat}),O0=ct({minimum_:Hat}),rit=ct({minimumStrict_:Gat}),oit=ct({mod_:zat}),ait=ct({modStrict_:Vat}),F0=ct({mul_:$at}),iit=ct({mulStrict_:Bat}),nT=ct({pow_:Oat}),sit=ct({powStrict_:Fat}),uit=ct({squaredDifference_:Kat}),cit=ct({squaredDifferenceStrict_:Xat}),th=ct({sub_:Pat}),lit=ct({subStrict_:Mat});function dit(e){var t=G(e,"x","logicalNot","bool");return ot.engine.runKernel(function(n){return n.logicalNot(t)},{$x:t})}function fit(e,t){var n=G(e,"a","logicalAnd","bool"),r=G(t,"b","logicalAnd","bool");return je(n.shape,r.shape),ot.engine.runKernel(function(o){return o.logicalAnd(n,r)},{$a:n,$b:r})}function pit(e,t){var n=G(e,"a","logicalOr","bool"),r=G(t,"b","logicalOr","bool");return je(n.shape,r.shape),ot.engine.runKernel(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}function hit(e,t){var n=G(e,"a","logicalXor","bool"),r=G(t,"b","logicalXor","bool");return je(n.shape,r.shape),rT(e,t).logicalAnd($0(e,t).logicalNot())}function mit(e,t,n){var r=G(t,"a","where"),o=G(n,"b","where"),i=G(e,"condition","where","bool");return an(r.shape,o.shape,"Error in where: "),i.rank===1?tt(i.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):an(i.shape,o.shape,"Error in where: "),ot.engine.runKernel(function(l){return l.select(i,r,o)},{$condition:i,$a:r,$b:o},function(l){return{$condition:function(){return _n(i).toFloat()},$a:function(){return l.mul(i.cast(l.dtype))},$b:function(){return l.mul(i.logicalNot().cast(l.dtype))}}})}function git(e){return Re(this,void 0,void 0,function(){var t,n,r;return Te(this,function(o){switch(o.label){case 0:return[4,(t=G(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=P0(t.shape,n),e!==t&&t.dispose(),[2,r]}})})}var $0=ct({logicalAnd_:fit}),vit=ct({logicalNot_:dit}),rT=ct({logicalOr_:pit}),yit=ct({logicalXor_:hit}),B0=ct({where_:mit}),bit=git;function xit(e){var t=G(e,"x","relu");return t.dtype==="bool"?t.toInt():ot.engine.runKernel(function(n){return n.relu(t)},{$x:t},function(n){var r=t.step();return{$x:function(){return n.mulStrict(r.toFloat())}}})}function wit(e){var t=G(e,"x","elu");return ot.engine.runKernel(function(n,r){return r(n.elu(t))},{$x:t},function(n,r){var o=r[0];return{$x:function(){return ot.engine.runKernel(function(i){return i.eluDer(n,o)},{dy:n,y:o})}}})}function Cit(e){var t=G(e,"x","selu");return ot.engine.runKernel(function(n){return n.selu(t)},{$x:t},function(n){return{$x:function(){var r=t.greater(Lt(0)),o=Lt(T0),i=Lt(D0),l=n.mul(i),d=n.mul(o).mul(t.toFloat().exp());return B0(r,l,d)}}})}function Sit(e,t){t===void 0&&(t=.2);var n=G(e,"x","leakyRelu");return Zp(Lt(t).mul(n),n)}function _it(e,t){var n=G(e,"x","prelu"),r=G(t,"alpha","prelu"),o=Lt(0);return Zp(o,n).add(r.mul(O0(o,n)))}var Eit=ct({elu_:wit}),kit=ct({leakyRelu_:Sit}),Rit=ct({prelu_:_it}),L0=ct({relu_:xit}),Tit=ct({selu_:Cit});function Dit(e,t){var n=G(e,"x","transpose");return t==null&&(t=n.shape.map(function(r,o){return o}).reverse()),tt(n.rank===t.length,"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."),t.forEach(function(r){tt(r>=0&&r<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)}),n.rank<=1?n.clone():ot.engine.runKernel(function(r){return r.transpose(n,t)},{$x:n},function(r){var o=E0(t);return{$x:function(){return r.transpose(o)}}})}var Ait=ct({transpose_:Dit});function Iit(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=G(e,"x","localResponseNormalization");tt(i.rank===4||i.rank===3,`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."),tt(Fo(t),`Error in localResponseNormalization: depthRadius must be an integer
                     but got depthRadius `+t+".");var l=i,d=!1;i.rank===3&&(d=!0,l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var p=ot.engine.runKernel(function(h,g){return g(h.localResponseNormalization4D(l,t,n,r,o))},{x4D:l},function(h,g){var y=g[0];return{x4D:function(){return ot.engine.runKernel(function(x){return x.LRNGrad(h,l,y,t,n,r,o)},{})}}});return d?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}var Nit=ct({localResponseNormalization_:Iit});function Pit(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=oT(e=G(e,"x","norm"),t,n),i=o.shape;if(r){var l=Or(n,e.shape);i=$o(o.shape,l)}return o.reshape(i)}function oT(e,t,n){if(n===void 0&&(n=null),e.rank===0)return e.abs();if(e.rank!==1&&n===null)return oT(e.reshape([-1]),t,n);if(e.rank===1||typeof n=="number"||n instanceof Array&&n.length===1){if(t===1)return e.abs().sum(n);if(t===1/0)return e.abs().max(n);if(t===-1/0)return e.abs().min(n);if(t==="euclidean"||t===2)return e.abs().pow(Lt(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}if(n instanceof Array&&n.length===2){if(t===1)return e.abs().sum(n[0]).max(n[1]-1);if(t===1/0)return e.abs().sum(n[1]).max(n[0]);if(t===-1/0)return e.abs().sum(n[1]).min(n[0]);if(t==="fro"||t==="euclidean")return e.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+n)}var aT=ct({norm_:Pit});function Mit(e,t,n){var r=G(e,"x","unsortedSegmentSum"),o=G(t,"segmentIds","unsortedSegmentSum","int32");return tt(Fo(n),"numSegments must be of dtype int"),ot.engine.runKernel(function(i){return i.unsortedSegmentSum(r,o,n)},{$x:r},function(i){return{$x:function(){return Fit(i,o)}}})}function Oit(e,t,n){n===void 0&&(n=0);var r=G(e,"x","gather"),o=G(t,"indices","gather","int32");return n=Or(n,r.shape)[0],ot.engine.runKernel(function(i){return i.gather(r,o,n)},{$x:r},function(i){return{$x:function(){if(n===0)return kv(i,o,r.shape[n]);var l=r.shape,d=o.size,p=l.slice(0,n),h=p.length,g=l.slice(n,l.length).slice(1),y=g.length,x=NS(0,h),C=NS(h+1,h+1+y),_=PS([p,[d],g]),k=i.reshape(_),A=o.reshape([d]),I=PS([[h],x,C]),N=k.transpose(I),D=kv(N,A,r.shape[n]),M=E0(I);return D=D.transpose(M)}}})}function NS(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function PS(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}function Fit(e,t){for(var n=Zp(t,_n(t)),r=iT(e,n),o=tT(t,Lt(0,"int32")),i=r.rank-o.rank,l=0;l<i;++l)o=Ni(o,l+1);o=$0(o,qi(r.shape,"bool"));var d=_n(r);return B0(o,r,d)}var iT=ct({gather_:Oit}),kv=ct({unsortedSegmentSum_:Mit});function $it(e,t,n,r){for(var o=G(t,"data","multiRNNCell"),i=vp(n,"c","multiRNNCell"),l=vp(r,"h","multiRNNCell"),d=o,p=[],h=0;h<e.length;h++){var g=e[h](d,i[h],l[h]);p.push(g[0]),p.push(g[1]),d=g[1]}var y=[],x=[];for(h=0;h<p.length;h+=2)y.push(p[h]),x.push(p[h+1]);return[y,x]}function Bit(e,t,n,r,o,i){var l=G(e,"forgetBias","basicLSTMCell"),d=G(t,"lstmKernel","basicLSTMCell"),p=G(n,"lstmBias","basicLSTMCell"),h=G(r,"data","basicLSTMCell"),g=G(o,"c","basicLSTMCell"),y=G(i,"h","basicLSTMCell"),x=h.concat(y,1).matMul(d).add(p),C=x.shape[0],_=x.shape[1]/4,k=[C,_],A=x.slice([0,0],k),I=x.slice([0,_],k),N=x.slice([0,2*_],k),D=x.slice([0,3*_],k),M=A.sigmoid().mulStrict(I.tanh()).addStrict(g.mulStrict(l.add(N).sigmoid()));return[M,M.tanh().mulStrict(D.sigmoid())]}var Lit=ct({basicLSTMCell_:Bit}),Wit=ct({multiRNNCell_:$it});function Uit(e,t,n,r,o){o===void 0&&(o=!0);var i=G(e,"v","movingAverage"),l=G(t,"x","movingAverage"),d=G(n,"decay","movingAverage");PY(i,l),tt(Nr(i.shape,l.shape),"Shape mismatch in v and x");var p=Lt(1),h=p.sub(d),g=l.sub(i).mul(h);if(o){tt(r!=null,"When using zeroDebias: true, step is required.");var y=G(r,"step","movingAverage");g=g.div(p.sub(nT(d,y)))}return i.add(g)}var zit=ct({movingAverage_:Uit});function Vit(e,t,n,r,o,i,l,d,p){if(o===void 0&&(o=0),i===void 0&&(i=0),l===void 0&&(l=0),d===void 0&&(d=0),p===void 0&&(p=0),l!==0)throw new Error("ellipsis mask is not yet supported");if(d!==0)throw new Error("new axis mask is not yet supported");var h=G(e,"x","stridedSlice");return ot.engine.runKernel(function(g){return g.stridedSlice(h,t,n,r,o,i,l,d,p)},{$x:h})}var Hit=ct({stridedSlice_:Vit});function Git(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=G(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=ot.engine.runKernel(function(l){return l.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}var qit=ct({topk_:Git});function jit(e,t,n){var r=G(e,"indices","scatterND","int32"),o=G(t,"updates","scatterND");return oQ(o,r,n),ot.engine.runKernel(function(i){return i.scatterND(r,o,n)},{$indices:r,$updates:o})}var Kit=ct({scatterND_:jit});function Xit(e){tt(e.dtype==="complex64","The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+".");var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ot.engine.runKernel(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}function Yit(e){tt(e.dtype==="complex64","The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+".");var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return ot.engine.runKernel(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}function Qit(e){tt(e.dtype==="float32",`The dtype for rfft() must be real value but
    got `+e.dtype);var t=e.shape[e.shape.length-1],n=e.size/t,r=e.zerosLike(),o=Yr(e,r).as2D(n,t),i=W0(o),l=Math.floor(t/2)+1,d=ja(i),p=Ns(i),h=d.split([l,t-l],d.shape.length-1),g=p.split([l,t-l],p.shape.length-1),y=e.shape.slice();return y[e.shape.length-1]=l,Yr(h[0],g[0]).reshape(y)}function Jit(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=xp(r);return ja(o)}var i=[n,2*(t-1)],l=ja(e).as2D(n,t),d=Ns(e).as2D(n,t),p=l.slice([0,1],[n,t-2]).reverse(1),h=d.slice([0,1],[n,t-2]).reverse(1).mul(Lt(-1)),g=l.concat(p,1),y=d.concat(h,1);return r=Yr(g,y).as2D(i[0],i[1]),o=xp(r),ja(o)}var W0=ct({fft_:Xit}),xp=ct({ifft_:Yit}),sT=ct({rfft_:Qit}),uT=ct({irfft_:Jit}),Zit=Object.freeze({fft:W0,ifft:xp,rfft:sT,irfft:uT});function tst(e,t,n,r){if(e.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var l=t.size;if(t.rank!==0&&(t.rank!==1||l!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function est(e,t,n,r){var o=G(e,"sparseIndices","sparseToDense","int32"),i=G(t,"sparseValues","sparseToDense"),l=G(r,"defaultValue","sparseToDense",i.dtype);return tst(o,i,n,l),ot.engine.runKernel(function(d){return d.sparseToDense(o,i,n,l)},{$sparseIndices:o,$sparseValues:i,$defaultValue:l})}var nst=ct({sparseToDense_:est});function rst(e,t){var n=G(t,"indices","gatherND","int32"),r=G(e,"x","gatherND");return ot.engine.runKernel(function(o){return o.gatherND(r,n)},{$x:r,$indices:n})}var Tr,ost=ct({gatherND_:rst});function ast(e,t,n){n===void 0&&(n=Tr.SUM_BY_NONZERO_WEIGHTS);var r=G(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=G(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(n===Tr.NONE)return i;if(n===Tr.SUM)return i.sum();if(n===Tr.MEAN){if(o==null)return i.mean();var l=ie(r.shape)/ie(o.shape),d=i.sum().div(o.sum());return l>1?d.div(Lt(l)):d}if(n===Tr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(Lt(r.size));var p=o.mul(qi(r.shape)).notEqual(Lt(0)).sum().toFloat();return i.sum().div(p)}throw Error("Unknown reduction: "+n)}function ist(e,t,n,r){r===void 0&&(r=Tr.SUM_BY_NONZERO_WEIGHTS);var o=G(e,"labels","absoluteDifference"),i=G(t,"predictions","absoluteDifference"),l=null;n!=null&&(l=G(n,"weights","absoluteDifference")),an(o.shape,i.shape,"Error in absoluteDifference: ");var d=o.sub(i).abs();return si(d,l,r)}function sst(e,t,n,r){r===void 0&&(r=Tr.SUM_BY_NONZERO_WEIGHTS);var o=G(e,"labels","meanSquaredError"),i=G(t,"predictions","meanSquaredError"),l=null;n!=null&&(l=G(n,"weights","meanSquaredError")),an(o.shape,i.shape,"Error in meanSquaredError: ");var d=o.squaredDifference(i);return si(d,l,r)}function ust(e,t,n,r,o){o===void 0&&(o=Tr.SUM_BY_NONZERO_WEIGHTS);var i=G(e,"labels","cosineDistance"),l=G(t,"predictions","cosineDistance"),d=null;r!=null&&(d=G(r,"weights","cosineDistance")),an(i.shape,l.shape,"Error in cosineDistance: ");var p=Lt(1).sub(i.mul(l).sum(n,!0));return si(p,d,o)}function cst(e,t,n,r){r===void 0&&(r=Tr.SUM_BY_NONZERO_WEIGHTS);var o=G(e,"labels","hingeLoss"),i=G(t,"predictions","hingeLoss"),l=null;n!=null&&(l=G(n,"weights","hingeLoss")),an(o.shape,i.shape,"Error in hingeLoss: ");var d=Lt(1);o=Lt(2).mul(o).sub(d);var p=d.sub(o.mul(i)).relu();return si(p,l,r)}function lst(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Tr.SUM_BY_NONZERO_WEIGHTS);var i=G(e,"labels","logLoss"),l=G(t,"predictions","logLoss"),d=null;n!=null&&(d=G(n,"weights","logLoss")),an(i.shape,l.shape,"Error in logLoss: ");var p=Lt(1),h=Lt(r),g=i.mul(l.add(h).log()).neg().sub(p.sub(i).mul(p.sub(l).add(h).log()));return si(g,d,o)}function dst(e,t){var n=G(e,"labels","sigmoidCrossEntropyWithLogits"),r=G(t,"logits","sigmoidCrossEntropyWithLogits");an(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),l=r.abs().neg().exp().log1p();return o.sub(i).add(l)}function fst(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Tr.SUM_BY_NONZERO_WEIGHTS);var i=G(e,"multiClassLabels","sigmoidCrossEntropy"),l=G(t,"logits","sigmoidCrossEntropy"),d=null;if(n!=null&&(d=G(n,"weights","sigmoidCrossEntropy")),an(i.shape,l.shape,"Error in sigmoidCrossEntropy: "),r>0){var p=Lt(r),h=Lt(1),g=Lt(.5);i=i.mul(h.sub(p)).add(g.mul(p))}var y=dst(i,l);return si(y,d,o)}function pst(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Tr.SUM_BY_NONZERO_WEIGHTS);var i=G(e,"labels","huberLoss"),l=G(t,"predictions","huberLoss"),d=null;n!=null&&(d=G(n,"weights","huberLoss")),an(i.shape,l.shape,"Error in huberLoss: ");var p=Lt(r),h=l.sub(i).abs(),g=O0(h,p),y=h.sub(g),x=Lt(.5).mul(g.square()).add(p.mul(y));return si(x,d,o)}function hst(e,t,n){if(n===void 0&&(n=-1),n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return md(function(r,o){var i=o.logSumExp([n],!0),l=o.toFloat().sub(i);return{value:l.mul(r).neg().sum([n]),gradFunc:function(d){var p=$o(d.shape,[n]);return[d.reshape(p).mul(r.toFloat().sub(l.exp())),d.reshape(p).mul(l.exp().sub(r.toFloat()))]}}})(e,t)}function mst(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Tr.SUM_BY_NONZERO_WEIGHTS);var i=G(e,"onehotLabels","softmaxCrossEntropy"),l=G(t,"logits","softmaxCrossEntropy"),d=null;if(n!=null&&(d=G(n,"weights","softmaxCrossEntropy")),an(i.shape,l.shape,"Error in softmaxCrossEntropy: "),r>0){var p=Lt(r),h=Lt(1),g=Lt(i.shape[1]);i=i.mul(h.sub(p)).add(p.div(g))}var y=hst(i,l);return si(y,d,o)}(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Tr||(Tr={}));var gst=ct({absoluteDifference_:ist}),si=ct({computeWeightedLoss_:ast}),vst=ct({cosineDistance_:ust}),yst=ct({hingeLoss_:cst}),bst=ct({huberLoss_:pst}),xst=ct({logLoss_:lst}),wst=ct({meanSquaredError_:sst}),Cst=ct({sigmoidCrossEntropy_:fst}),Sst=ct({softmaxCrossEntropy_:mst}),_st=Object.freeze({get Reduction(){return Tr},absoluteDifference:gst,computeWeightedLoss:si,cosineDistance:vst,hingeLoss:yst,huberLoss:bst,logLoss:xst,meanSquaredError:wst,sigmoidCrossEntropy:Cst,softmaxCrossEntropy:Sst});function Est(e){var t;if(Array.isArray(e)){t=!1,tt(e!=null&&e.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=e[0].shape[0],r=1;r<e.length;++r)tt(e[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[r].shape[0]+" vs. "+n+")")}else t=!0,e=A0(e,e.shape[0],0).map(function(d){return WR(d,[0])});tt(e.length<=e[0].shape[0],"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+").");var o=[],i=e,l=function(d){o.push(ot.engine.tidy(function(){var p=i[d];if(d>0)for(var h=0;h<d;++h){var g=JR(o[h].mulStrict(p)).mul(o[h]);p=p.sub(g)}return p.div(aT(p,"euclidean"))}))};for(r=0;r<e.length;++r)l(r);return t?lc(o,0):o}function kst(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return MS(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(i,l){return i*l}),r=[],o=[];return N0(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0).forEach(function(i){var l=MS(i,t),d=l[0],p=l[1];r.push(d),o.push(p)}),[lc(r,0).reshape(e.shape),lc(o,0).reshape(e.shape)]}function MS(e,t){return t===void 0&&(t=!1),ot.engine.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=$R(n),i=e.clone(),l=Yp([[1]],[1,1]),d=l.clone(),p=n>=r?r:n,h=function(y){var x,C=i,_=d,k=o;x=ot.engine.tidy(function(){var A=i.slice([y,y],[n-y,1]),I=A.norm(),N=i.slice([y,y],[1,1]),D=N.sign().neg(),M=N.sub(D.mul(I)),F=A.div(M);d=F.shape[0]===1?l.clone():l.concat(F.slice([1,0],[F.shape[0]-1,F.shape[1]]),0);var W=D.matMul(M).div(I).neg(),L=i.slice([y,0],[n-y,r]),X=W.mul(d);i=y===0?L.sub(X.matMul(d.transpose().matMul(L))):i.slice([0,0],[y,r]).concat(L.sub(X.matMul(d.transpose().matMul(L))),0);var q=o.slice([0,y],[n,o.shape[1]-y]);return o=y===0?q.sub(q.matMul(d).matMul(X.transpose())):o.slice([0,0],[n,y]).concat(q.sub(q.matMul(d).matMul(X.transpose())),1),[d,i,o]}),d=x[0],i=x[1],o=x[2],tQ([C,_,k])},g=0;g<p;++g)h(g);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var Rst=ct({gramSchmidt_:Est}),Tst=ct({qr_:kst}),Dst=Object.freeze({gramSchmidt:Rst,qr:Tst});function Ast(e,t,n){n===void 0&&(n=!1);var r=G(e,"images","resizeBilinear");tt(r.rank===3||r.rank===4,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),tt(t.length===2,"Error in resizeBilinear: new shape must 2D, but got shape "+t+".");var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],d=t[1],p=ot.engine.runKernel(function(h,g){return h.resizeBilinear(o,l,d,n)},{batchImages:o},function(h,g){return{batchImages:function(){return ot.engine.runKernel(function(y){return y.resizeBilinearBackprop(h,o,n)},{})}}});return i?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Ist(e,t,n){n===void 0&&(n=!1);var r=G(e,"images","resizeNearestNeighbor");tt(r.rank===3||r.rank===4,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),tt(t.length===2,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),tt(r.dtype==="float32"||r.dtype==="int32","`images` must have `int32` or `float32` as dtype");var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=t[0],d=t[1],p=ot.engine.runKernel(function(h,g){return h.resizeNearestNeighbor(o,l,d,n)},{batchImages:o},function(h,g){return{batchImages:function(){return ot.engine.runKernel(function(y){return y.resizeNearestNeighborBackprop(h,o,n)},{})}}});return i?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Nst(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=G(e,"boxes","nonMaxSuppression"),l=G(t,"scores","nonMaxSuppression"),d=cT(i,l,n,r,o);return n=d.maxOutputSize,r=d.iouThreshold,o=d.scoreThreshold,ot.engine.runKernel(function(p){return p.nonMaxSuppression(i,l,n,r,o)},{$boxes:i})}function Pst(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),Re(this,void 0,void 0,function(){var i,l,d,p,h,g;return Te(this,function(y){switch(y.label){case 0:return i=G(e,"boxes","nonMaxSuppressionAsync"),l=G(t,"scores","nonMaxSuppressionAsync"),d=cT(i,l,n,r,o),n=d.maxOutputSize,r=d.iouThreshold,o=d.scoreThreshold,[4,i.data()];case 1:return p=y.sent(),[4,l.data()];case 2:return h=y.sent(),g=k0(p,h,n,r,o),i!==e&&i.dispose(),l!==t&&l.dispose(),[2,g]}})})}function cT(e,t,n,r,o){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY);var i=e.shape[0];return n=Math.min(n,i),tt(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),tt(e.rank===2,"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"),tt(e.shape[1]===4,"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),tt(t.rank===1,"scores must be a 1D tensor"),tt(t.shape[0]===i,"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}function Mst(e,t,n,r,o,i){var l=G(e,"image","cropAndResize","float32"),d=G(t,"boxes","cropAndResize","float32"),p=G(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var h=d.shape[0];return tt(l.rank===4,"Error in cropAndResize: image must be rank 4,but got rank "+l.rank+"."),tt(d.rank===2&&d.shape[1]===4,"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+d.shape+"."),tt(p.rank===1&&p.shape[0]===h,"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+d.shape+"."),tt(r.length===2,"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."),tt(r[0]>=1&&r[1]>=1,"cropSize must be atleast [1,1], but was "+r),tt(o==="bilinear"||o==="nearest","method must be bilinear or nearest, but was "+o),ot.engine.runKernel(function(g,y){return g.cropAndResize(l,d,p,r,o,i)},{$image:l,$boxes:d})}var Ost=ct({resizeBilinear_:Ast}),Fst=ct({resizeNearestNeighbor_:Ist}),$st=ct({nonMaxSuppression_:Nst}),Bst=Pst,Lst=Mst,lT=Object.freeze({resizeBilinear:Ost,resizeNearestNeighbor:Fst,nonMaxSuppression:$st,nonMaxSuppressionAsync:Bst,cropAndResize:Lst}),Wst=Object.freeze({image:lT,linalg:Dst,losses:_st,spectral:Zit,op:ct,batchNormalization2d:Urt,batchNormalization3d:zrt,batchNormalization4d:Vrt,batchNormalization:Jp,complex:Yr,real:ja,imag:Ns,concat:ii,concat1d:ket,concat2d:Ret,concat3d:Tet,concat4d:Det,split:A0,conv1d:dot,conv2d:kc,conv3d:fot,conv2dDerFilter:qR,depthwiseConv2d:jR,separableConv2d:KR,conv2dTranspose:pot,matMul:VR,dot:Qrt,outerProduct:Jrt,reverse:xd,reverse1d:bot,reverse2d:xot,reverse3d:wot,reverse4d:Cot,maxPool:so,avgPool:Aot,pool:Iot,slice:wd,slice1d:$ot,slice2d:Bot,slice3d:Lot,slice4d:Wot,abs:srt,acos:urt,acosh:crt,asin:lrt,asinh:drt,atan:frt,atanh:prt,ceil:hrt,clipByValue:mrt,cos:grt,cosh:vrt,erf:yrt,exp:brt,expm1:xrt,floor:wrt,log:Crt,log1p:Srt,logSigmoid:_rt,neg:UR,reciprocal:Ert,round:krt,rsqrt:zR,sigmoid:Rrt,sign:Trt,sin:Drt,sinh:Art,softplus:Irt,sqrt:Nrt,square:Prt,step:Mrt,tan:Ort,tanh:Frt,all:Jot,any:Zot,argMax:tat,argMin:eat,logSumExp:nat,max:rat,mean:oat,min:aat,moments:iat,sum:JR,prod:sat,equal:ZR,equalStrict:xat,greater:wat,greaterEqual:tT,greaterEqualStrict:Cat,greaterStrict:Sat,less:_at,lessEqual:Eat,lessEqualStrict:kat,lessStrict:Rat,notEqual:Tat,notEqualStrict:Dat,add:Hs,addN:Qat,addStrict:Jat,atan2:Zat,div:tit,divStrict:eit,floorDiv:eT,maximum:Zp,maximumStrict:nit,minimum:O0,minimumStrict:rit,mod:oit,modStrict:ait,mul:F0,mulStrict:iit,pow:nT,powStrict:sit,squaredDifference:uit,squaredDifferenceStrict:cit,sub:th,subStrict:lit,elu:Eit,leakyRelu:kit,prelu:Rit,relu:L0,selu:Tit,logicalAnd:$0,logicalNot:vit,logicalOr:rT,logicalXor:yit,where:B0,whereAsync:bit,buffer:Fe,toPixels:OR,print:cnt,batchToSpaceND:FR,cast:lnt,clone:dnt,cumsum:fnt,depthToSpace:pnt,expandDims:Ni,eye:$R,fromPixels:BR,multinomial:hnt,oneHot:_v,pad:iu,pad1d:mnt,pad2d:gnt,pad3d:vnt,pad4d:ynt,rand:bnt,randomNormal:xnt,randomUniform:wnt,reshape:I0,spaceToBatchND:LR,squeeze:WR,stack:lc,tile:Tl,truncatedNormal:Cnt,unstack:N0,setdiff1dAsync:Snt,fill:ec,linspace:xQ,ones:qi,range:pR,scalar:Lt,tensor:An,tensor1d:Ya,tensor2d:Yp,tensor3d:fR,tensor4d:fa,tensor5d:gQ,tensor6d:vQ,zeros:jn,onesLike:wQ,zerosLike:_n,transpose:Ait,softmax:Xp,logSoftmax:fQ,localResponseNormalization:Nit,norm:aT,gather:iT,unsortedSegmentSum:kv,basicLSTMCell:Lit,multiRNNCell:Wit,movingAverage:zit,stridedSlice:Hit,topk:qit,scatterND:Kit,fft:W0,ifft:xp,rfft:sT,irfft:uT,sparseToDense:nst,gatherND:ost}),Ust=function(){function e(){this.blockSize=48,this.firstUse=!0,ot.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return e.prototype.setDataMover=function(t){this.data=new hR(t)},e.prototype.register=function(t,n,r){if(this.firstUse&&(this.firstUse=!1,ot.get("IS_NODE")&&Cv(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:r})},e.prototype.write=function(t,n){if(n==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=n},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var r,o;if(ot.get("IS_NODE")&&t.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(t.getContext!=null)r=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)r=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),r=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(n===4)o=new Int32Array(r);else{var i=t.width*t.height;o=new Int32Array(i*n);for(var l=0;l<i;l++)for(var d=0;d<n;++d)o[l*n+d]=r[4*l+d]}return fR(o,[t.height,t.width,n],"int32")},e.prototype.read=function(t){return Re(this,void 0,void 0,function(){return Te(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),r=n.dtype,o=n.complexTensors;return r==="complex64"?gR(o.real.dataSync(),o.imag.dataSync()):this.data.get(t).values},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Re(this,void 0,void 0,function(){var n;return Te(this,function(r){return n=fp(),t(),[2,{kernelMs:fp()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var r=Kt.make(t.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:ot.engine.keep(t.clone()),imag:ot.engine.keep(n.clone())},r},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(r){r!=null&&tt(r.dtype!=="complex64",n+" does not support complex64 tensors.")})},e.prototype.slice=function(t,n,r){this.assertNotComplex(t,"slice");for(var o=Fe(r,t.dtype),i=0;i<o.size;++i){var l=o.indexToLoc(i),d=l.map(function(p,h){return p+n[h]});o.set.apply(o,[t.get.apply(t,d)].concat(l))}return o.toTensor()},e.prototype.stridedSlice=function(t,n,r,o,i,l,d,p,h){this.assertNotComplex(t,"stridedSlice");var g=lR(t.shape,n,r,o,i,l,d,p,h),y=g[0],x=g[1],C=g[2],_=x.filter(function(M,F){return C.indexOf(F)===-1});if(_.some(function(M){return M===0}))return An([],_);for(var k=Fe(x,t.dtype),A=0;A<k.size;A++){for(var I=k.indexToLoc(A),N=new Array(I.length),D=0;D<N.length;D++)N[D]=I[D]*o[D]+y[D];k.set.apply(k,[t.get.apply(t,N)].concat(I))}return k.toTensor().reshape(_)},e.prototype.reverse=function(t,n){this.assertNotComplex(t,"reverse");for(var r=Fe(t.shape,t.dtype),o=t.buffer(),i=function(d){var p=r.indexToLoc(d),h=p.slice();n.forEach(function(g){return h[g]=t.shape[g]-1-h[g]}),r.set.apply(r,[o.get.apply(o,h)].concat(p))},l=0;l<r.size;l++)i(l);return r.toTensor()},e.prototype.concat=function(t,n){this.assertNotComplex(t,"concat");var r=t.map(function(h){var g=ie(h.shape.slice(n));return h.as2D(-1,g)}),o=Ql(r.map(function(h){return h.shape}),1),i=Fe(o,t[0].dtype).values;if(r[0].shape[0]===1){var l=0;r.forEach(function(h){i.set(h.dataSync(),l),l+=h.size})}else{var d=0;r.forEach(function(h){for(var g=h.dataSync(),y=0,x=0;x<h.shape[0];++x)for(var C=x*o[1]+d,_=0;_<h.shape[1];++_)i[C+_]=g[y++];d+=h.shape[1]})}var p=Ql(t.map(function(h){return h.shape}),n);return An(i,p,t[0].dtype)},e.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(Lt(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r+i,imag:o+l}}):this.broadcastedBinaryOp(t,n,dr(t.dtype,n.dtype),function(r,o){return r+o})},e.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var n=t.map(function(p){return p.dataSync()}),r=Fe(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var l=n[i],d=0;d<o.length;d++)o[d]+=l[d];return r.toTensor()},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r-i,imag:o-l}}):this.broadcastedBinaryOp(t,n,dr(t.dtype,n.dtype),function(r,o){return r-o})},e.prototype.pow=function(t,n){return this.assertNotComplex([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.pow(r,o)})},e.prototype.batchMatMul=function(t,n,r,o){this.assertNotComplex([t,n],"matMul");for(var i=r?t.shape[1]:t.shape[2],l=r?t.shape[2]:t.shape[1],d=o?n.shape[1]:n.shape[2],p=t.shape[0],h=t.dataSync(),g=n.dataSync(),y=r?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],x=y[0],C=y[1],_=y[2],k=o?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],A=k[0],I=k[1],N=k[2],D=l*d,M=Fe([p,l,d],t.dtype),F=M.values,W=this.blockSize,L=0;L<p;L++)for(var X=0;X<l;X+=W)for(var q=0;q<d;q+=W)for(var Q=0;Q<i;Q+=W)for(var it=Math.min(X+W,l),at=Math.min(q+W,d),ht=Math.min(Q+W,i),gt=X;gt<it;gt++)for(var Ct=q;Ct<at;Ct++){for(var pt=0,lt=Q;lt<ht;lt++)pt+=h[L*x+gt*C+lt*_]*g[lt*A+Ct*I+L*N];F[L*D+(gt*d+Ct)]+=pt}return M.toTensor()},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(r,o,i,l){return{real:r*i-o*l,imag:r*l+o*i}}):this.broadcastedBinaryOp(t,n,dr(t.dtype,n.dtype),function(r,o){return r*o})},e.prototype.realDivide=function(t,n){return this.assertNotComplex([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(r,o){return r/o})},e.prototype.floorDiv=function(t,n){return this.assertNotComplex([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(r,o){return Math.floor(r/o)})},e.prototype.sum=function(t,n){this.assertNotComplex(t,"sum"),Zr("sum",n,t.rank);for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,dr(t.dtype,"int32")),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=0,C=0;C<d;++C)x+=h[y+C];p[g]=x}return l},e.prototype.prod=function(t,n){this.assertNotComplex(t,"sum");for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,dr(t.dtype,"int32")),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=1,C=0;C<d;++C)x*=h[y+C];p[g]=x}return l},e.prototype.unsortedSegmentSum=function(t,n,r){this.assertNotComplex(t,"unsortedSegmentSum");for(var o=[],i=t.rank-n.rank,l=0;l<i;++l)n=n.expandDims(l+1);for(l=0;l<r;++l){var d=Lt(l,"int32"),p=ZR(d,n).asType("float32").mul(t).sum(0);o.push(p)}return lc(o)},e.prototype.argMin=function(t,n){this.assertNotComplex(t,"argMin");var r=[n];Zr("argMin",r,t.rank);for(var o=ur(t.shape,r),i=o[0],l=o[1],d=jn(i,"int32"),p=ie(l),h=d.dataSync(),g=t.dataSync(),y=0;y<h.length;++y){for(var x=y*p,C=g[x],_=0,k=0;k<p;++k){var A=g[x+k];A<C&&(C=A,_=k)}h[y]=_}return d},e.prototype.argMax=function(t,n){this.assertNotComplex(t,"argMax");var r=[n];Zr("argMax",r,t.rank);for(var o=ur(t.shape,r),i=o[0],l=o[1],d=jn(i,"int32"),p=ie(l),h=d.dataSync(),g=t.dataSync(),y=0;y<h.length;++y){for(var x=y*p,C=g[x],_=0,k=0;k<p;++k){var A=g[x+k];A>C&&(C=A,_=k)}h[y]=_}return d},e.prototype.cumsum=function(t,n,r,o){if(this.assertNotComplex(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var i=dr(t.dtype,"int32"),l=jn(t.shape,i),d=l.dataSync(),p=t.dataSync(),h=t.shape[t.rank-1],g=o?function(k,A){return k+h-A-1}:function(k,A){return k+A},y=0;y<p.length;y+=h)for(var x=0;x<h;x++){var C=g(y,x);if(x===0)d[C]=r?0:p[C];else{var _=g(y,x-1);d[C]=r?p[_]+d[_]:p[C]+d[_]}}return l},e.prototype.equal=function(t,n){return this.assertNotComplex([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r===o?1:0})},e.prototype.notEqual=function(t,n){return this.assertNotComplex([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r!==o?1:0})},e.prototype.less=function(t,n){return this.assertNotComplex([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r<o?1:0})},e.prototype.lessEqual=function(t,n){return this.assertNotComplex([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r<=o?1:0})},e.prototype.greater=function(t,n){return this.assertNotComplex([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r>o?1:0})},e.prototype.greaterEqual=function(t,n){return this.assertNotComplex([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r>=o?1:0})},e.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var n=t.dataSync(),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n[o]?0:1;return Kt.make(t.shape,{values:r},"bool")},e.prototype.logicalAnd=function(t,n){return this.assertNotComplex([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r&&o})},e.prototype.logicalOr=function(t,n){return this.assertNotComplex([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(r,o){return r||o})},e.prototype.select=function(t,n,r){this.assertNotComplex([t,n,r],"select");for(var o=t.dataSync(),i=n.dataSync(),l=r.dataSync(),d=jn(n.shape,dr(n.dtype,r.dtype)),p=d.dataSync(),h=0,g=t.rank===0||t.rank>1||n.rank===1?1:n.shape[1],y=0;y<o.length;y++)for(var x=0;x<g;x++)o[y]===1?p[h++]=i[y]:p[h++]=l[y];return d},e.prototype.where=function(t){this.assertNotComplex([t],"where");var n=t.dataSync();return P0(t.shape,n)},e.prototype.topk=function(t,n,r){return this.assertNotComplex(t,"topk"),yR(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){this.assertNotComplex(t,"min"),Zr("min",n,t.rank);for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,t.dtype),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];_<x&&(x=_)}p[g]=x}return l},e.prototype.minimum=function(t,n){return this.assertNotComplex([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.min(r,o)})},e.prototype.mod=function(t,n){return this.assertNotComplex([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){var i=r%o;return r<0&&o<0||r>=0&&o>=0?i:(i+o)%o})},e.prototype.max=function(t,n){this.assertNotComplex(t,"max"),Zr("max",n,t.rank);for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,t.dtype),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];_>x&&(x=_)}p[g]=x}return l},e.prototype.maximum=function(t,n){return this.assertNotComplex([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.max(r,o)})},e.prototype.all=function(t,n){this.assertNotComplex(t,"all"),Zr("all",n,t.rank);for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,t.dtype),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];x=x&&_}p[g]=x}return l},e.prototype.any=function(t,n){this.assertNotComplex(t,"any"),Zr("any",n,t.rank);for(var r=ur(t.shape,n),o=r[0],i=r[1],l=jn(o,t.dtype),d=ie(i),p=l.dataSync(),h=t.dataSync(),g=0;g<p.length;++g){for(var y=g*d,x=h[y],C=0;C<d;++C){var _=h[y+C];x=x||_}p[g]=x}return l},e.prototype.squaredDifference=function(t,n){return this.assertNotComplex([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){var i=r-o;return i*i})},e.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.ceil(n[o]);return Kt.make(t.shape,{values:r})},e.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.floor(n[o]);return Kt.make(t.shape,{values:r})},e.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)n[o]<0?r[o]=-1:n[o]>0?r[o]=1:r[o]=0;return Kt.make(t.shape,{values:r})},e.prototype.round=function(t){this.assertNotComplex(t,"round");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=Math.floor(n[o]);n[o]-i<.5?r[o]=Math.floor(n[o]):n[o]-i>.5?r[o]=Math.ceil(n[o]):r[o]=i%2==0?i:i+1}return Kt.make(t.shape,{values:r})},e.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.exp(n[o]);return Kt.make(t.shape,{values:r})},e.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=Math.expm1(n[o]);return Kt.make(t.shape,{values:r})},e.prototype.log=function(t){this.assertNotComplex(t,"log");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.log(i)}return Kt.make(t.shape,{values:r})},e.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.log1p(i)}return Kt.make(t.shape,{values:r})},e.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=Math.sqrt(i)}return Kt.make(t.shape,{values:r})},e.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=1/Math.sqrt(i)}return Kt.make(t.shape,{values:r})},e.prototype.square=function(t){this.assertNotComplex(t,"square");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o){var i=n[o];r[o]=i*i}return Kt.make(t.shape,{values:r})},e.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var n=t.dataSync(),r=new Float32Array(n.length),o=0;o<n.length;++o)r[o]=1/n[o];return Kt.make(t.shape,{values:r})},e.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var n=jn(t.shape,t.dtype),r=n.dataSync(),o=t.dataSync(),i=0;i<o.length;++i)r[i]=Math.max(0,o[i]);return n},e.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o){var i=r[o];n[o]=i>=0?i:Math.exp(i)-1}return Kt.make(t.shape,{values:n})},e.prototype.eluDer=function(t,n){this.assertNotComplex([t,n],"eluDer");for(var r=new Float32Array(n.size),o=n.dataSync(),i=t.dataSync(),l=0;l<o.length;++l){var d=o[l];r[l]=d>=1?i[l]:i[l]*(d+1)}return Kt.make(n.shape,{values:r})},e.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var n=T0,r=D0,o=new Float32Array(t.size),i=t.dataSync(),l=0;l<i.length;++l){var d=i[l];o[l]=d>=0?r*d:n*(Math.exp(d)-1)}return Kt.make(t.shape,{values:o})},e.prototype.clip=function(t,n,r){this.assertNotComplex(t,"clip");for(var o=new Float32Array(t.size),i=t.dataSync(),l=0;l<i.length;++l){var d=i[l];o[l]=d>r?r:d<n?n:d}return Kt.make(t.shape,{values:o})},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.abs(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<t.size;++o){var i=r[2*o],l=r[2*o+1];n[o]=Math.hypot(i,l)}return Kt.make(t.shape,{values:n})},e.prototype.int=function(t){this.assertNotComplex(t,"int");for(var n=new Int32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=r[o];return Kt.make(t.shape,{values:n},"int32")},e.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=1/(1+Math.exp(-r[o]));return Kt.make(t.shape,{values:n})},e.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var l=o[i]>-n,d=o[i]<n,p=Math.exp(o[i]),h=void 0;h=d?p:l?o[i]:Math.log(1+p),r[i]=h}return Kt.make(t.shape,{values:r})},e.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.sin(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.cos(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.tan(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.asin(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.acos(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.atan(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.atan2=function(t,n){return this.assertNotComplex([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(r,o){return Math.atan2(r,o)})},e.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.sinh(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.cosh(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=mY(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.asinh(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.acosh(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var n=new Float32Array(t.size),r=t.dataSync(),o=0;o<r.length;++o)n[o]=Math.atanh(r[o]);return Kt.make(t.shape,{values:n})},e.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var n=new Float32Array(t.size),r=t.dataSync(),o=RR,i=TR,l=DR,d=AR,p=IR,h=NR,g=0;g<r.length;++g){var y=r[g],x=1/(1+o*y);n[g]=1-((((h*x+p)*x+d)*x+l)*x+i)*x*Math.exp(-y*y)}return Kt.make(t.shape,{values:n})},e.prototype.step=function(t,n){n===void 0&&(n=0),this.assertNotComplex(t,"step");for(var r=new Float32Array(t.size),o=t.dataSync(),i=0;i<o.length;++i){var l=o[i];isNaN(l)?r[i]=NaN:r[i]=l>0?1:n}return Kt.make(t.shape,{values:r})},e.prototype.conv2d=function(t,n,r){this.assertNotComplex([t,n],"conv2d");for(var o=r.filterHeight,i=r.filterWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.padInfo.left,h=r.padInfo.top,g=Fe(r.outShape,t.dtype),y=t.dataSync(),x=n.dataSync(),C=g.values,_=0;_<r.batchSize;++_)for(var k=_*t.strides[0],A=_*g.strides[0],I=0;I<r.outHeight;++I)for(var N=A+I*g.strides[1],D=I*r.strideHeight-p,M=0;M<o;M++){var F=D+M*l;if(!(F<0||F>=r.inHeight))for(var W=M*n.strides[0],L=k+F*t.strides[1],X=0;X<r.outWidth;++X)for(var q=N+X*r.outChannels,Q=X*r.strideWidth-h,it=0;it<i;it++){var at=Q+it*d;if(!(at<0||at>=r.inWidth))for(var ht=W+it*n.strides[1],gt=L+at*r.inChannels,Ct=ht,pt=0;pt<r.inChannels;++pt){for(var lt=y[gt+pt],ft=0;ft<r.outChannels;++ft)C[q+ft]+=lt*x[Ct+ft];Ct+=r.outChannels}}}return g.toTensor()},e.prototype.conv3d=function(t,n,r){for(var o=r.filterDepth,i=r.filterHeight,l=r.filterWidth,d=r.dilationDepth,p=r.dilationHeight,h=r.dilationWidth,g=r.padInfo.front,y=r.padInfo.left,x=r.padInfo.top,C=Fe(r.outShape,t.dtype),_=t.dataSync(),k=n.dataSync(),A=C.values,I=0;I<r.batchSize;++I)for(var N=I*t.strides[0],D=I*C.strides[0],M=0;M<r.outDepth;++M)for(var F=D+M*C.strides[1],W=M*r.strideDepth-g,L=0;L<o;L++){var X=W+L*d;if(!(X<0||X>=r.inDepth))for(var q=L*n.strides[0],Q=N+X*t.strides[1],it=0;it<r.outHeight;++it)for(var at=F+it*C.strides[2],ht=it*r.strideHeight-x,gt=0;gt<i;gt++){var Ct=ht+gt*p;if(!(Ct<0||Ct>=r.inHeight))for(var pt=q+gt*n.strides[1],lt=Q+Ct*t.strides[2],ft=0;ft<r.outWidth;++ft)for(var Tt=at+ft*r.outChannels,Pt=ft*r.strideWidth-y,Bt=0;Bt<l;Bt++){var Ut=Pt+Bt*h;if(!(Ut<0||Ut>=r.inWidth))for(var Zt=pt+Bt*n.strides[2],Xt=lt+Ut*r.inChannels,ce=Zt,fe=0;fe<r.inChannels;++fe){for(var se=_[Xt+fe],jt=0;jt<r.outChannels;++jt)A[Tt+jt]+=se*k[ce+jt];ce+=r.outChannels}}}}return C.toTensor()},e.prototype.conv2dDerInput=function(t,n,r){this.assertNotComplex([t,n],"conv2dDerInput");for(var o=Fe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=t.dataSync(),y=t.strides,x=y[0],C=y[1],_=y[2],k=n.dataSync(),A=n.strides,I=A[0],N=A[1],D=A[2],M=r.batchSize,F=r.filterHeight,W=r.filterWidth,L=r.inChannels,X=r.inHeight,q=r.inWidth,Q=r.outChannels,it=r.outHeight,at=r.outWidth,ht=r.strideHeight,gt=r.strideWidth,Ct=F-1-r.padInfo.top,pt=W-1-r.padInfo.left,lt=0;lt<M;++lt)for(var ft=0;ft<L;++ft)for(var Tt=0;Tt<X;++Tt)for(var Pt=Tt-Ct,Bt=Math.max(0,Math.ceil(Pt/ht)),Ut=Math.min(it,(F+Pt)/ht),Zt=0;Zt<q;++Zt){for(var Xt=Zt-pt,ce=Math.max(0,Math.ceil(Xt/gt)),fe=Math.min(at,(W+Xt)/gt),se=0,jt=Bt;jt<Ut;++jt)for(var Pe=jt*ht-Pt,re=ce;re<fe;++re)for(var _e=x*lt+C*jt+_*re,Y=I*(F-1-Pe)+N*(W-1-(re*gt-Xt))+D*ft,nt=0;nt<Q;++nt)se+=g[_e+nt]*k[Y+nt];i[d*lt+p*Tt+h*Zt+ft]=se}return o.toTensor()},e.prototype.conv3dDerInput=function(t,n,r){for(var o=Fe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=l[3],y=t.dataSync(),x=t.strides,C=x[0],_=x[1],k=x[2],A=x[3],I=n.dataSync(),N=n.strides,D=N[0],M=N[1],F=N[2],W=N[3],L=r.batchSize,X=r.filterDepth,q=r.filterHeight,Q=r.filterWidth,it=r.inChannels,at=r.inDepth,ht=r.inHeight,gt=r.inWidth,Ct=r.outChannels,pt=r.outDepth,lt=r.outHeight,ft=r.outWidth,Tt=r.strideDepth,Pt=r.strideHeight,Bt=r.strideWidth,Ut=X-1-r.padInfo.front,Zt=q-1-r.padInfo.top,Xt=Q-1-r.padInfo.left,ce=0;ce<L;++ce)for(var fe=0;fe<it;++fe)for(var se=0;se<at;++se)for(var jt=se-Ut,Pe=Math.max(0,Math.ceil(jt/Tt)),re=Math.min(pt,(X+jt)/Tt),_e=0;_e<ht;++_e)for(var Y=_e-Zt,nt=Math.max(0,Math.ceil(Y/Pt)),mt=Math.min(lt,(q+Y)/Pt),Et=0;Et<gt;++Et){for(var St=Et-Xt,Dt=Math.max(0,Math.ceil(St/Bt)),$t=Math.min(ft,(Q+St)/Bt),Ft=0,It=Pe;It<re;++It)for(var Rt=It*Tt-jt,Ht=nt;Ht<mt;++Ht)for(var Wt=Ht*Pt-Y,Yt=Dt;Yt<$t;++Yt)for(var he=C*ce+_*It+k*Ht+A*Yt,Ce=D*(X-1-Rt)+M*(q-1-Wt)+F*(Q-1-(Yt*Bt-St))+W*fe,Ee=0;Ee<Ct;++Ee)Ft+=y[he+Ee]*I[Ce+Ee];i[d*ce+p*se+h*_e+g*Et+fe]=Ft}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,n,r){this.assertNotComplex([t,n],"conv2dDerFilter");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=Fe(r.filterShape,"float32"),h=r.padInfo.left,g=r.padInfo.top,y=0;y<l;++y)for(var x=Math.max(0,Math.ceil((g-y)/o)),C=Math.min(r.outHeight,(r.inHeight+g-y)/o),_=0;_<d;++_)for(var k=Math.max(0,Math.ceil((h-_)/i)),A=Math.min(r.outWidth,(r.inWidth+h-_)/i),I=0;I<r.inChannels;++I)for(var N=0;N<r.outChannels;++N){for(var D=0,M=0;M<r.batchSize;++M)for(var F=x;F<C;++F)for(var W=y+F*o-g,L=k;L<A;++L){var X=_+L*i-h;D+=t.get(M,W,X,I)*n.get(M,F,L,N)}p.set(D,y,_,I,N)}return p.toTensor()},e.prototype.conv3dDerFilter=function(t,n,r){for(var o=r.strideDepth,i=r.strideHeight,l=r.strideWidth,d=r.filterDepth,p=r.filterHeight,h=r.filterWidth,g=Fe(r.filterShape,"float32"),y=g.values,x=g.strides,C=x[0],_=x[1],k=x[2],A=x[3],I=n.dataSync(),N=n.strides,D=N[0],M=N[1],F=N[2],W=N[3],L=t.dataSync(),X=t.strides,q=X[0],Q=X[1],it=X[2],at=X[3],ht=r.padInfo.front,gt=r.padInfo.left,Ct=r.padInfo.top,pt=0;pt<d;++pt)for(var lt=Math.max(0,Math.ceil((ht-pt)/o)),ft=Math.min(r.outDepth,(r.inDepth+ht-pt)/o),Tt=pt*C,Pt=0;Pt<p;++Pt)for(var Bt=Math.max(0,Math.ceil((Ct-Pt)/i)),Ut=Math.min(r.outHeight,(r.inHeight+Ct-Pt)/i),Zt=Pt*_+Tt,Xt=0;Xt<h;++Xt)for(var ce=Math.max(0,Math.ceil((gt-Xt)/l)),fe=Math.min(r.outWidth,(r.inWidth+gt-Xt)/l),se=Xt*k+Zt,jt=0;jt<r.inChannels;++jt)for(var Pe=jt*A+se,re=0;re<r.outChannels;++re){for(var _e=0,Y=0;Y<r.batchSize;++Y)for(var nt=Y*q,mt=Y*D,Et=lt;Et<ft;++Et)for(var St=(pt+Et*o-ht)*Q+nt,Dt=Et*M+mt,$t=Bt;$t<Ut;++$t)for(var Ft=(Pt+$t*i-Ct)*it+St,It=$t*F+Dt,Rt=ce;Rt<fe;++Rt){var Ht=Rt*W+It;_e+=L[(Xt+Rt*l-gt)*at+Ft+jt]*I[Ht+re]}y[Pe+re]=_e}return g.toTensor()},e.prototype.depthwiseConv2D=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2D");for(var o=r.filterHeight,i=r.filterWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.padInfo.left,h=r.padInfo.top,g=r.outChannels/r.inChannels,y=Fe(r.outShape,t.dtype),x=t.dataSync(),C=n.dataSync(),_=y.values,k=0;k<r.batchSize;++k)for(var A=k*t.strides[0],I=k*y.strides[0],N=0;N<r.outHeight;++N)for(var D=I+N*y.strides[1],M=N*r.strideHeight-p,F=0;F<o;++F){var W=M+F*l;if(!(W<0||W>=r.inHeight))for(var L=F*n.strides[0],X=A+W*t.strides[1],q=0;q<r.outWidth;++q)for(var Q=D+q*y.strides[2],it=q*r.strideWidth-h,at=0;at<i;++at){var ht=it+at*d;if(!(ht<0||ht>=r.inWidth))for(var gt=L+at*n.strides[1],Ct=X+ht*r.inChannels,pt=Q,lt=gt,ft=0;ft<r.inChannels;++ft){for(var Tt=x[Ct+ft],Pt=0;Pt<g;++Pt)_[pt+Pt]+=Tt*C[lt+Pt];pt+=g,lt+=g}}}return y.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2DDerInput");for(var o=Fe(r.inShape,"float32"),i=o.values,l=o.strides,d=l[0],p=l[1],h=l[2],g=t.dataSync(),y=t.strides,x=y[0],C=y[1],_=y[2],k=n.dataSync(),A=n.strides,I=A[0],N=A[1],D=A[2],M=r.batchSize,F=r.filterHeight,W=r.filterWidth,L=r.inChannels,X=r.inHeight,q=r.inWidth,Q=r.outChannels,it=r.outHeight,at=r.outWidth,ht=r.strideHeight,gt=r.strideWidth,Ct=F-1-r.padInfo.top,pt=W-1-r.padInfo.left,lt=Q/L,ft=0;ft<M;++ft)for(var Tt=0;Tt<L;++Tt)for(var Pt=0;Pt<X;++Pt)for(var Bt=Pt-Ct,Ut=Math.max(0,Math.ceil(Bt/ht)),Zt=Math.min(it,(F+Bt)/ht),Xt=0;Xt<q;++Xt){for(var ce=Xt-pt,fe=Math.max(0,Math.ceil(ce/gt)),se=Math.min(at,(W+ce)/gt),jt=0,Pe=Ut;Pe<Zt;++Pe)for(var re=Pe*ht-Bt,_e=fe;_e<se;++_e)for(var Y=x*ft+C*Pe+_*_e,nt=I*(F-1-re)+N*(W-1-(_e*gt-ce))+D*Tt,mt=0;mt<lt;++mt)jt+=g[Y+(Tt*lt+mt)]*k[nt+mt];i[d*ft+p*Pt+h*Xt+Tt]=jt}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){this.assertNotComplex([t,n],"depthwiseConv2DDerFilter");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=Fe(r.filterShape,"float32"),h=r.padInfo.left,g=r.padInfo.top,y=r.outChannels/r.inChannels,x=0;x<l;++x)for(var C=Math.max(0,Math.ceil((g-x)/o)),_=Math.min(r.outHeight,(r.inHeight+g-x)/o),k=0;k<d;++k)for(var A=Math.max(0,Math.ceil((h-k)/i)),I=Math.min(r.outWidth,(r.inWidth+h-k)/i),N=0;N<r.outChannels;++N){for(var D=Math.trunc(N/y),M=N%y,F=0,W=0;W<r.batchSize;++W)for(var L=C;L<_;++L)for(var X=x+L*o-g,q=A;q<I;++q){var Q=k+q*i-h;F+=t.get(W,X,Q,D)*n.get(W,L,q,N)}p.set(F,x,k,D,M)}return p.toTensor()},e.prototype.tile=function(t,n){this.assertNotComplex(t,"tile");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[o]*n[o];var i=Fe(r,t.dtype),l=t.buffer();for(o=0;o<i.values.length;++o){for(var d=i.indexToLoc(o),p=new Array(t.rank),h=0;h<p.length;h++)p[h]=d[h]%t.shape[h];var g=l.locToIndex(p);i.values[o]=l.values[g]}return i.toTensor()},e.prototype.pad=function(t,n,r){this.assertNotComplex(t,"pad");var o=n.map(function(y,x){return y[0]+t.shape[x]+y[1]}),i=n.map(function(y){return y[0]}),l=t.buffer(),d=Fe(o,t.dtype);r!==0&&d.values.fill(r);for(var p=0;p<t.size;p++){var h=l.indexToLoc(p),g=h.map(function(y,x){return y+i[x]});d.set.apply(d,[t.get.apply(t,h)].concat(g))}return d.toTensor()},e.prototype.transpose=function(t,n){this.assertNotComplex(t,"transpose");for(var r=new Array(t.rank),o=0;o<r.length;o++)r[o]=t.shape[n[o]];var i=t.dataSync(),l=Fe(r,t.dtype),d=t.buffer();for(o=0;o<t.size;++o){for(var p=d.indexToLoc(o),h=new Array(p.length),g=0;g<h.length;g++)h[g]=p[n[g]];var y=l.locToIndex(h);l.values[y]=i[o]}return l.toTensor()},e.prototype.gather=function(t,n,r){this.assertNotComplex([t,n],"gather");var o=t.shape.slice(),i=n.dataSync();o[r]=i.length;for(var l=Fe(o,t.dtype),d=t.buffer(),p=0;p<l.size;++p){var h=l.indexToLoc(p),g=h.slice();g[r]=i[h[r]];var y=d.locToIndex(g);l.values[p]=d.values[y]}return l.toTensor()},e.prototype.batchToSpaceND=function(t,n,r){this.assertNotComplex([t],"batchToSpaceND");var o=n.reduce(function(g,y){return g*y}),i=pp(t.shape,n,o),l=hp(i.length,n.length),d=mp(t.shape,n,o),p=aR(r,n.length),h=iR(d,r,n.length);return t.reshape(i).transpose(l).reshape(d).slice(p,h)},e.prototype.spaceToBatchND=function(t,n,r){this.assertNotComplex([t],"spaceToBatchND");var o=n.reduce(function(y,x){return y*x}),i=[[0,0]];i.push.apply(i,r);for(var l=1+n.length;l<t.shape.length;++l)i.push([0,0]);var d=t.pad(i),p=pp(d.shape,n,o,!1),h=hp(p.length,n.length,!1),g=mp(d.shape,n,o,!1);return d.reshape(p).transpose(h).reshape(g)},e.prototype.pool=function(t,n,r){this.assertNotComplex(t,"pool");for(var o=n.strideHeight,i=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.top,y=n.padInfo.left,x=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=t.dataSync(),_=Fe(n.outShape,t.dtype),k=_.values,A=n.outShape[1]*n.outShape[2]*n.outShape[3],I=n.outShape[2]*n.outShape[3],N=n.outShape[3],D=0;D<n.batchSize;++D)for(var M=D*A,F=D*t.strides[0],W=0;W<n.inChannels;++W)for(var L=0;L<n.outHeight;++L)for(var X=L*o-g,q=Math.max(0,X),Q=Math.min(n.inHeight,p+X),it=M+L*I,at=0;at<n.outWidth;++at){for(var ht=at*i-y,gt=Math.max(0,ht),Ct=Math.min(n.inWidth,h+ht),pt=x,lt=0,ft=0,Tt=q;Tt<Q;Tt+=l){for(var Pt=F+Tt*t.strides[1],Bt=gt;Bt<Ct;Bt+=d){var Ut=C[Pt+Bt*t.strides[2]+W];r==="max"&&Ut>pt?pt=Ut:r==="avg"&&(lt+=Ut,ft++)}if(isNaN(pt))break}k[it+at*N+W]=r==="avg"?lt/ft:pt}return _.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var r=Fe(n.outShape,"int32"),o=n.strideHeight,i=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,p=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.top,y=n.padInfo.left,x=0;x<n.batchSize;++x)for(var C=0;C<n.inChannels;++C)for(var _=0;_<n.outHeight;++_){for(var k=_*o-g,A=k;A<0;)A+=l;for(var I=Math.min(n.inHeight,p+k),N=0;N<n.outWidth;++N){for(var D=N*i-y,M=D;M<0;)M+=d;for(var F=Math.min(n.inWidth,h+D),W=Number.NEGATIVE_INFINITY,L=-1,X=A;X<I;X+=l)for(var q=X-k,Q=M;Q<F;Q+=d){var it=Q-D,at=t.get(x,X,Q,C);at>W&&(W=at,L=q*h+it)}r.set(L,x,_,N,C)}}return r.toTensor()},e.prototype.maxPoolBackprop=function(t,n,r,o){this.assertNotComplex([n,r],"maxPoolBackprop");for(var i=this.maxPoolPositions(n,o),l=o.strideHeight,d=o.strideWidth,p=o.dilationHeight,h=o.dilationWidth,g=o.effectiveFilterHeight,y=o.effectiveFilterWidth,x=y-1-o.padInfo.left,C=g-1-o.padInfo.top,_=Fe(n.shape,"float32"),k=0;k<o.batchSize;++k)for(var A=0;A<o.inChannels;++A)for(var I=0;I<o.inHeight;++I)for(var N=0;N<o.inWidth;++N){for(var D=I-C,M=N-x,F=0,W=0;W<g;W+=p){var L=(D+W)/l;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var X=0;X<y;X+=h){var q=(M+X)/d;if(!(q<0||q>=o.outWidth||Math.floor(q)!==q)){var Q=g*y-1-i.get(k,L,q,A)===W*y+X?1:0;Q!==0&&(F+=t.get(k,L,q,A)*Q)}}}_.set(F,k,I,N,A)}return _.toTensor()},e.prototype.avgPoolBackprop=function(t,n,r){this.assertNotComplex([t,n],"avgPoolBackprop");for(var o=r.strideHeight,i=r.strideWidth,l=r.filterHeight,d=r.filterWidth,p=r.dilationHeight,h=r.dilationWidth,g=r.effectiveFilterHeight,y=r.effectiveFilterWidth,x=y-1-r.padInfo.left,C=g-1-r.padInfo.top,_=Fe(n.shape,"float32"),k=1/(l*d),A=0;A<r.batchSize;++A)for(var I=0;I<r.inChannels;++I)for(var N=0;N<r.inHeight;++N)for(var D=0;D<r.inWidth;++D){for(var M=N-C,F=D-x,W=0,L=0;L<g;L+=p){var X=(M+L)/o;if(!(X<0||X>=r.outHeight||Math.floor(X)!==X))for(var q=0;q<y;q+=h){var Q=(F+q)/i;Q<0||Q>=r.outWidth||Math.floor(Q)!==Q||(W+=t.get(A,X,Q,I))}}_.set(W*k,A,N,D,I)}return _.toTensor()},e.prototype.cast=function(t,n){return mR(t,n,this)},e.prototype.reshape=function(t,n){return Sv(t,n)},e.prototype.avgPool=function(t,n){return this.assertNotComplex(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,r,o){this.assertNotComplex(t,"resizeBilinear");for(var i=t.shape,l=i[0],d=i[1],p=i[2],h=i[3],g=t.dataSync(),y=new Float32Array(ie([l,n,r,h])),x=[o&&n>1?d-1:d,o&&r>1?p-1:p],C=[o&&n>1?n-1:n,o&&r>1?r-1:r],_=0,k=x[0]/C[0],A=x[1]/C[1],I=0;I<l;I++)for(var N=0;N<n;N++)for(var D=k*N,M=Math.floor(D),F=D-M,W=Math.min(d-1,Math.ceil(D)),L=I*t.strides[0]+M*t.strides[1],X=I*t.strides[0]+W*t.strides[1],q=0;q<r;q++)for(var Q=A*q,it=Math.floor(Q),at=Q-it,ht=Math.min(p-1,Math.ceil(Q)),gt=L+it*t.strides[2],Ct=X+it*t.strides[2],pt=L+ +ht*t.strides[2],lt=X+ht*t.strides[2],ft=0;ft<h;ft++){var Tt=g[gt+ft],Pt=g[Ct+ft],Bt=Tt+(g[pt+ft]-Tt)*at,Ut=Bt+(Pt+(g[lt+ft]-Pt)*at-Bt)*F;y[_++]=Ut}return An(y,[l,n,r,h])},e.prototype.resizeBilinearBackprop=function(t,n,r){this.assertNotComplex([t,n],"resizeBilinearBackprop");for(var o=n.shape,i=o[0],l=o[1],d=o[2],p=o[3],h=t.shape,g=h[1],y=h[2],x=new Float32Array(i*l*d*p),C=[r&&g>1?l-1:l,r&&y>1?d-1:d],_=[r&&g>1?g-1:g,r&&y>1?y-1:y],k=C[0]/_[0],A=C[1]/_[1],I=t.dataSync(),N=0,D=0;D<i;D++)for(var M=D*n.strides[0],F=0;F<g;F++)for(var W=F*k,L=Math.floor(W),X=Math.min(Math.ceil(W),l-1),q=M+L*n.strides[1],Q=M+X*n.strides[1],it=W-L,at=1-it,ht=0;ht<y;ht++)for(var gt=ht*A,Ct=Math.floor(gt),pt=Math.min(Math.ceil(gt),d-1),lt=gt-Ct,ft=1-lt,Tt=q+Ct*n.strides[2],Pt=q+pt*n.strides[2],Bt=Q+Ct*n.strides[2],Ut=Q+pt*n.strides[2],Zt=at*ft,Xt=at*lt,ce=it*ft,fe=it*lt,se=0;se<p;se++){var jt=I[N++];x[Tt+se]+=jt*Zt,x[Pt+se]+=jt*Xt,x[Bt+se]+=jt*ce,x[Ut+se]+=jt*fe}return fa(x,[i,d,l,p],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,r,o){this.assertNotComplex(t,"resizeNearestNeighbor");for(var i=t.shape,l=i[0],d=i[1],p=i[2],h=i[3],g=t.dataSync(),y=new Float32Array(l*n*r*h),x=[o&&n>1?d-1:d,o&&r>1?p-1:p],C=[o&&n>1?n-1:n,o&&r>1?r-1:r],_=x[0]/C[0],k=x[1]/C[1],A=0,I=0;I<l;I++)for(var N=I*t.strides[0],D=0;D<n;D++)for(var M=_*D,F=N+Math.min(d-1,o?Math.round(M):Math.floor(M))*t.strides[1],W=0;W<r;W++)for(var L=k*W,X=F+Math.min(p-1,o?Math.round(L):Math.floor(L))*t.strides[2],q=0;q<h;q++){var Q=g[X+q];y[A++]=Q}return An(y,[l,n,r,h],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){this.assertNotComplex([t,n],"resizeNearestNeighborBackprop");for(var o=n.shape,i=o[0],l=o[1],d=o[2],p=o[3],h=t.shape,g=h[1],y=h[2],x=new Float32Array(i*l*d*p),C=t.dataSync(),_=[r&&g>1?l-1:l,r&&y>1?d-1:d],k=[r&&g>1?g-1:g,r&&y>1?y-1:y],A=_[0]/k[0],I=_[1]/k[1],N=1/A,D=1/I,M=2*Math.ceil(N)+2,F=2*Math.ceil(D)+2,W=0;W<i;W++)for(var L=W*n.strides[0],X=0;X<l;X++)for(var q=L+X*n.strides[1],Q=Math.floor(X*N),it=Math.floor(Q-M/2),at=0;at<d;at++)for(var ht=q+at*n.strides[2],gt=Math.floor(at*D),Ct=Math.floor(gt-F/2),pt=0;pt<p;pt++){for(var lt=0,ft=0;ft<M;ft++){var Tt=ft+it;if(!(Tt<0||Tt>=g)){var Pt=L+Tt*t.strides[1],Bt=Tt*A;if(X===Math.min(l-1,r?Math.round(Bt):Math.floor(Bt)))for(var Ut=0;Ut<F;Ut++){var Zt=Ut+Ct;if(!(Zt<0||Zt>=y)){var Xt=Pt+Zt*t.strides[2],ce=Zt*I;at===Math.min(d-1,r?Math.round(ce):Math.floor(ce))&&(lt+=C[Xt+pt])}}}}x[ht+pt]=lt}return fa(x,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,r,o,i,l){this.assertNotComplex([t,n,r,i,l],"batchNormalization");for(var d=t.dataSync(),p=n.dataSync(),h=r.dataSync(),g=i?i.dataSync():new Float32Array([1]),y=l?l.dataSync():new Float32Array([0]),x=new Float32Array(d.length),C=y.length,_=g.length,k=h.length,A=p.length,I=0,N=0,D=0,M=0,F=0;F<d.length;++F)x[F]=y[I++]+(d[F]-p[N++])*g[D++]/Math.sqrt(h[M++]+o),I>=C&&(I=0),N>=A&&(N=0),D>=_&&(D=0),M>=k&&(M=0);return fa(x,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){this.assertNotComplex(t,"localResponseNormalization4D");var l=t.shape[3],d=l-1,p=t.dataSync(),h=ie(t.shape),g=new Float32Array(h);function y(k){for(var A=k%l,I=k-A+Math.max(0,A-n),N=k-A+Math.min(A+n,d),D=0;I<=N;I++){var M=p[I];D+=M*M}return D}for(var x=0;x<h;x++){var C=y(x),_=p[x]*Math.pow(r+o*C,-i);g[x]=_}return fa(g,t.shape)},e.prototype.LRNGrad=function(t,n,r,o,i,l,d){this.assertNotComplex(t,"LRNGrad");for(var p=t.shape[3],h=t.dataSync(),g=n.dataSync(),y=r.dataSync(),x=new Float32Array(ie(t.shape)),C=ie(t.shape),_=0;_<C;_++){for(var k=_%p,A=_-k+Math.max(0,k-o),I=_-k+Math.min(p,k+o+1),N=0,D=A;D<I;D++)N+=Math.pow(g[D],2);for(N=l*N+i,D=A;D<I;D++){var M=-2*l*d*g[D]*y[_]/N;_===D&&(M+=Math.pow(N,-d)),M*=h[_],x[D]+=M}}return fa(x,t.shape)},e.prototype.multinomial=function(t,n,r,o){this.assertNotComplex(t,"multinomial");for(var i=n?t:Xp(t),l=i.shape[0],d=i.shape[1],p=jn([l,r],"int32"),h=p.dataSync(),g=i.dataSync(),y=0;y<l;++y){var x=y*d,C=new Float32Array(d-1);C[0]=g[x];for(var _=1;_<C.length;++_)C[_]=C[_-1]+g[x+_];for(var k=PR(o.toString()),A=y*r,I=0;I<r;++I){var N=k();h[A+I]=C.length;for(var D=0;D<C.length;D++)if(N<C[D]){h[A+I]=D;break}}}return p},e.prototype.oneHot=function(t,n,r,o){this.assertNotComplex(t,"oneHot");var i=new Float32Array(t.size*n);i.fill(o);for(var l=0;l<t.size;++l)t.get(l)>=0&&t.get(l)<n&&(i[l*n+t.get(l)]=r);return Yp(i,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return this.assertNotComplex(t,"nonMaxSuppression"),k0(t.dataSync(),n.dataSync(),r,o,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var r=t.shape[0],o=t.shape[1],i=Fe(t.shape,"float32"),l=Fe(t.shape,"float32"),d=ja(t).as2D(r,o),p=Ns(t).as2D(r,o),h=0;h<r;h++)for(var g=d.slice([h,0],[1,o]),y=p.slice([h,0],[1,o]),x=Yr(g,y),C=this.fftImpl(x,n).dataSync(),_=0;_<o;_++){var k=fS(C,_);i.values[h*o+_]=k.real,l.values[h*o+_]=k.imag}return Yr(i.toTensor(),l.toTensor()).as2D(r,o)},e.prototype.fftImpl=function(t,n){var r=t.as1D(),o=r.size;if(this.isExponentOf2(o)){var i=this.fftRadix2(r,o,n).as2D(t.shape[0],t.shape[1]);return n&&(i=Yr(ja(i).div(Lt(o)),Ns(i).div(Lt(o)))),i}var l=t.dataSync(),d=CQ(this.fourierTransformByMatmul(l,o,n));return Yr(d.real,d.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,r){if(n===1)return t;var o=t.dataSync(),i=n/2,l=SQ(o),d=Yr(l.real,l.imag).as1D(),p=_Q(o),h=Yr(p.real,p.imag).as1D();d=this.fftRadix2(d,i,r),h=this.fftRadix2(h,i,r);var g=kQ(n,r),y=Yr(g.real,g.imag).mul(h),x=d.add(y),C=d.sub(y),_=ja(x).concat(ja(C)),k=Ns(x).concat(Ns(C));return Yr(_,k).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,r){for(var o=new Float32Array(2*n),i=0;i<n;i++){for(var l=0,d=0,p=0;p<n;p++){var h=RQ(i*p,n,r),g=fS(t,p);l+=g.real*h.real-g.imag*h.imag,d+=g.real*h.imag+g.imag*h.real}r&&(l/=n,d/=n),EQ(o,l,d,i)}return o},e.prototype.depthToSpace=function(t,n,r){tt(r==="NHWC","Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r),tt(n>1,"blockSize should be > 1 for depthToSpace, but was: "+n);for(var o=t.shape[0],i=t.shape[1],l=t.shape[2],d=t.shape[3],p=i*n,h=l*n,g=d/(n*n),y=t.dataSync(),x=new Float32Array(o*p*h*g),C=0,_=0;_<o;++_)for(var k=0;k<p;++k)for(var A=Math.floor(k/n),I=k%n,N=0;N<h;++N)for(var D=Math.floor(N/n),M=(I*n+N%n)*g,F=0;F<g;++F){var W=F+M+d*(D+l*(A+i*_));x[C++]=y[W]}return fa(x,[o,p,h,g])},e.prototype.broadcastedBinaryOp=function(t,n,r,o){var i=je(t.shape,n.shape),l=Fe(i,r),d=t.dataSync(),p=n.dataSync(),h=Ps(t.shape,i),g=Ps(n.shape,i),y=l.values;if(h.length+g.length===0)for(var x=0;x<y.length;++x)y[x]=o(d[x%d.length],p[x%p.length]);else{var C=t.buffer(),_=n.buffer(),k=function(A){var I=l.indexToLoc(A),N=I.slice(-t.rank);h.forEach(function(W){return N[W]=0});var D=C.locToIndex(N),M=I.slice(-n.rank);g.forEach(function(W){return M[W]=0});var F=_.locToIndex(M);y[A]=o(d[D],p[F])};for(x=0;x<y.length;++x)k(x)}return l.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,r){var o=je(t.shape,n.shape),i=Fe(o,"float32"),l=Fe(o,"float32"),d=t.dataSync(),p=n.dataSync(),h=Ps(t.shape,o),g=Ps(n.shape,o),y=i.values,x=l.values;if(h.length+g.length===0)for(var C=0;C<y.length;C++){var _=C%d.length,k=C%p.length,A=r(d[2*_],d[2*_+1],p[2*k],p[2*k+1]);y[C]=A.real,x[C]=A.imag}else{var I=this.data.get(t.dataId).complexTensors.real.buffer(),N=this.data.get(n.dataId).complexTensors.real.buffer(),D=function(M){var F=i.indexToLoc(M),W=F.slice(-t.rank);h.forEach(function(it){return W[it]=0});var L=I.locToIndex(W),X=F.slice(-n.rank);g.forEach(function(it){return X[it]=0});var q=N.locToIndex(X),Q=r(d[2*L],d[2*L+1],p[2*q],p[2*q+1]);y[M]=Q.real,x[M]=Q.imag};for(C=0;C<y.length;C++)D(C)}return this.complex(i.toTensor(),l.toTensor())},e.prototype.split=function(t,n,r){return vR(t,n,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.cropAndResize=function(t,n,r,o,i,l){for(var d=t.shape,p=d[0],h=d[1],g=d[2],y=d[3],x=n.shape[0],C=o[0],_=o[1],k=Fe([x,C,_,y],t.dtype),A=n.dataSync(),I=r.dataSync(),N=t.dataSync(),D=t.strides,M=k.strides,F=0;F<x;F++){var W=4*F,L=A[W],X=A[W+1],q=A[W+2],Q=A[W+3],it=I[F];if(!(it>=p))for(var at=C>1?(q-L)*(h-1)/(C-1):0,ht=_>1?(Q-X)*(g-1)/(_-1):0,gt=0;gt<C;gt++){var Ct=C>1?L*(h-1)+gt*at:.5*(L+q)*(h-1);if(Ct<0||Ct>h-1)for(var pt=0;pt<_;pt++)for(var lt=0;lt<y;lt++){var ft=lt+pt*M[2]+gt*M[1]+F*M[0];k.values[ft]=l}else if(i==="bilinear"){var Tt=Math.floor(Ct),Pt=Math.ceil(Ct),Bt=Ct-Tt;for(pt=0;pt<_;pt++)if((re=_>1?X*(g-1)+pt*ht:.5*(X+Q)*(g-1))<0||re>g-1)for(lt=0;lt<y;lt++)ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=l;else{var Ut=Math.floor(re),Zt=Math.ceil(re),Xt=re-Ut;for(lt=0;lt<y;lt++){var ce=N[ft=lt+Ut*D[2]+Tt*D[1]+it*D[0]],fe=N[ft=lt+Zt*D[2]+Tt*D[1]+it*D[0]],se=N[ft=lt+Ut*D[2]+Pt*D[1]+it*D[0]],jt=ce+(fe-ce)*Xt,Pe=se+(N[ft=lt+Zt*D[2]+Pt*D[1]+it*D[0]]-se)*Xt;ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=jt+(Pe-jt)*Bt}}}else for(pt=0;pt<_;++pt){var re;if((re=_>1?X*(g-1)+pt*ht:.5*(X+Q)*(g-1))<0||re>g-1)for(lt=0;lt<y;lt++)ft=lt+pt*M[2]+gt*M[1]+F*M[0],k.values[ft]=l;else{var _e=Math.round(re),Y=Math.round(Ct);for(lt=0;lt<y;lt++){var nt=lt+_e*D[2]+Y*D[1]+it*D[0],mt=lt+pt*M[2]+gt*M[1]+F*M[0];k.values[mt]=N[nt]}}}}}return k.toTensor()},e.prototype.sparseToDense=function(t,n,r,o){var i=gp(n,t,r),l=i.sliceRank,d=i.numUpdates,p=i.sliceSize,h=i.strides,g=i.outputSize;return this.scatter(t,n,r,g,p,d,l,h,o,!1)},e.prototype.gatherND=function(t,n){var r=n.shape,o=r[r.length-1],i=uR(t,n),l=i[0],d=i[1],p=i[2],h=i[3];if(d===0)return An([],l,t.dtype);for(var g=new Yl([d,p],t.dtype),y=n.dataSync(),x=t.dataSync(),C=0;C<d;C++){for(var _=[],k=0,A=0;A<o;A++){var I=y[C*o+A];k+=I*h[A],_.push(I)}if(k<0||k>=t.size/p)throw new Error("Invalid indices: "+_+" does not index into "+t.shape);for(var N=0;N<p;N++)g.values[C*p+N]=x[k*p+N]}return g.toTensor().reshape(l)},e.prototype.scatterND=function(t,n,r){var o=gp(n,t,r),i=o.sliceRank,l=o.numUpdates,d=o.sliceSize,p=o.strides,h=o.outputSize,g=Lt(0);return this.scatter(t,n,r,h,d,l,i,p,g,!0)},e.prototype.scatter=function(t,n,r,o,i,l,d,p,h,g){var y=[o/i,i],x=t.dataSync(),C=n.dataSync();if(o===0)return An([],r,n.dtype);var _=new Yl(y,n.dtype);_.values.fill(h.dataSync()[0]);for(var k=0;k<l;k++){for(var A=[],I=0,N=0;N<d;N++){var D=x[k*d+N];A.push(D),I+=D*p[N]}if(I<0||I>=o/i)throw new Error("Invalid indices: "+A+" does not index into "+r);for(var M=0;M<i;M++)g?_.values[I*i+M]+=C[k*i+M]:_.values[I*i+M]=n.rank===0?C[0]:C[k*i+M]}return _.toTensor().reshape(r)},e}();ot.registerBackend("cpu",function(){return new Ust},1,_0);typeof requestAnimationFrame<"u"||setImmediate;var Rv={float32:4,int32:4,uint16:2,uint8:1,bool:1};function zst(e){return Re(this,void 0,void 0,function(){var t,n,r,o;return Te(this,function(i){switch(i.label){case 0:for(r in t=[],n=[],e){if((o=e[r]).dtype!=="float32"&&o.dtype!=="int32"&&o.dtype!=="bool")throw new Error("Unsupported dtype in weight '"+r+"': "+o.dtype);t.push({name:r,shape:o.shape,dtype:o.dtype}),n.push(o.data())}return[4,Promise.all(n)];case 1:return[2,{data:Vst(i.sent()),specs:t}]}})})}function dT(e,t){for(var n={},r=0,o=function(d){var p=d.name,h=d.dtype,g=d.shape,y=ie(g),x=void 0;if("quantization"in d){var C=d.quantization;if(C.dtype!=="uint8"&&C.dtype!=="uint16")throw new Error("Weight "+d.name+" has unknown quantization dtype "+C.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var _=Rv[C.dtype],k=e.slice(r,r+y*_),A=C.dtype==="uint8"?new Uint8Array(k):new Uint16Array(k);if(h==="float32")x=Float32Array.from(A,function(D){return D*C.scale+C.min});else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+p+"': "+h);x=Int32Array.from(A,function(D){return Math.round(D*C.scale+C.min)})}r+=y*_}else{var I=Rv[h];if(k=e.slice(r,r+y*I),h==="float32")x=new Float32Array(k);else if(h==="int32")x=new Int32Array(k);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+p+"': "+h);x=new Uint8Array(k)}r+=y*I}var N=void 0;if(h==="float32")N=An(x,g,"float32");else if(h==="int32")N=An(x,g,"int32");else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+p+"': "+h);N=An(x,g,"bool")}n[p]=N},i=0,l=t;i<l.length;i++)o(l[i]);return n}function Vst(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(i){if(t+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var U0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function OS(e){return U0?Buffer.byteLength(e):new Blob([e]).size}function Hst(e){return U0?Buffer.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function Gst(e){if(U0){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}function z0(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function FS(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Cd(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:OS(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:OS(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var ho=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t){return e.getHandlers(t,"load")},e.getHandlers=function(t,n){var r=[];return(n==="load"?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(o){var i=o(t);i!==null&&r.push(i)}),r},e}(),rc="://",ji=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){tt(t!=null,"scheme must not be undefined or null."),t.endsWith(rc)&&(t=t.slice(0,t.indexOf(rc))),tt(t.length>0,"scheme must not be an empty string.");var r=e.getInstance();tt(r.managers[t]==null,"A model store manager is already registered for scheme '"+t+"'."),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function qf(e){if(e.indexOf(rc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ji.getSchemes().join(","));return{scheme:e.split(rc)[0],path:e.split(rc)[1]}}function fT(e,t,n){return n===void 0&&(n=!1),Re(this,void 0,void 0,function(){var r,o,i,l,d,p,h,g,y;return Te(this,function(x){switch(x.label){case 0:return tt(e!==t,"Old path and new path are the same: '"+e+"'"),tt((r=ho.getLoadHandlers(e)).length>0,"Copying failed because no load handler is found for source URL "+e+"."),tt(r.length<2,"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."),o=r[0],tt((i=ho.getSaveHandlers(t)).length>0,"Copying failed because no save handler is found for destination URL "+t+"."),tt(i.length<2,"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."),l=i[0],d=qf(e).scheme,p=qf(e).path,h=d===qf(e).scheme,[4,o.load()];case 1:return g=x.sent(),n&&h?[4,ji.getManager(d).removeModel(p)]:[3,3];case 2:x.sent(),x.label=3;case 3:return[4,l.save(g)];case 4:return y=x.sent(),!n||h?[3,6]:[4,ji.getManager(d).removeModel(p)];case 5:x.sent(),x.label=6;case 6:return[2,y.modelArtifactsInfo]}})})}function qst(){return Re(this,void 0,void 0,function(){var e,t,n,r,o,i,l;return Te(this,function(d){switch(d.label){case 0:e=ji.getSchemes(),t={},n=0,r=e,d.label=1;case 1:return n<r.length?(o=r[n],[4,ji.getManager(o).listModels()]):[3,4];case 2:for(l in i=d.sent())t[o+rc+l]=i[l];d.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})}function jst(e){return Re(this,void 0,void 0,function(){var t;return Te(this,function(n){switch(n.label){case 0:return t=qf(e),[4,ji.getManager(t.scheme).removeModel(t.path)];case 1:return[2,n.sent()]}})})}function Kst(e,t){return Re(this,void 0,void 0,function(){return Te(this,function(n){switch(n.label){case 0:return[4,fT(e,t,!1)];case 1:return[2,n.sent()]}})})}function Xst(e,t){return Re(this,void 0,void 0,function(){return Te(this,function(n){switch(n.label){case 0:return[4,fT(e,t,!0)];case 1:return[2,n.sent()]}})})}var Tv="tensorflowjs",Dv=1,Ms="models_store",Bi="model_info_store";function pT(){if(!ot.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Av(e){var t=e.result;t.createObjectStore(Ms,{keyPath:"modelPath"}),t.createObjectStore(Bi,{keyPath:"modelPath"})}var dc=function(){function e(t){if(this.indexedDB=pT(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return Re(this,void 0,void 0,function(){return Te(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return Re(this,void 0,void 0,function(){return Te(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,i){var l=r.indexedDB.open(Tv,Dv);l.onupgradeneeded=function(){return Av(l)},l.onsuccess=function(){var d=l.result;if(n==null){var p=d.transaction(Ms,"readonly"),h=p.objectStore(Ms).get(r.modelPath);h.onsuccess=function(){if(h.result==null)return d.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(h.result.modelArtifacts)},h.onerror=function(k){return d.close(),i(h.error)},p.oncomplete=function(){return d.close()}}else{var g,y=Cd(n),x=d.transaction(Bi,"readwrite"),C=x.objectStore(Bi),_=C.put({modelPath:r.modelPath,modelArtifactsInfo:y});_.onsuccess=function(){var k=(g=d.transaction(Ms,"readwrite")).objectStore(Ms).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:y});k.onsuccess=function(){return o({modelArtifactsInfo:y})},k.onerror=function(A){var I=(C=x.objectStore(Bi)).delete(r.modelPath);I.onsuccess=function(){return d.close(),i(k.error)},I.onerror=function(N){return d.close(),i(k.error)}}},_.onerror=function(k){return d.close(),i(_.error)},x.oncomplete=function(){g==null?d.close():g.oncomplete=function(){return d.close()}}}},l.onerror=function(d){return i(l.error)}})},e.URL_SCHEME="indexeddb://",e}(),$S=function(e){return ot.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(dc.URL_SCHEME)?Yst(e.slice(dc.URL_SCHEME.length)):null};function Yst(e){return new dc(e)}function Qst(e){return e.startsWith(dc.URL_SCHEME)?e.slice(dc.URL_SCHEME.length):e}ho.registerSaveRouter($S),ho.registerLoadRouter($S);var Jst=function(){function e(){this.indexedDB=pT()}return e.prototype.listModels=function(){return Re(this,void 0,void 0,function(){var t=this;return Te(this,function(n){return[2,new Promise(function(r,o){var i=t.indexedDB.open(Tv,Dv);i.onupgradeneeded=function(){return Av(i)},i.onsuccess=function(){var l=i.result,d=l.transaction(Bi,"readonly"),p=d.objectStore(Bi).getAll();p.onsuccess=function(){for(var h={},g=0,y=p.result;g<y.length;g++){var x=y[g];h[x.modelPath]=x.modelArtifactsInfo}r(h)},p.onerror=function(h){return l.close(),o(p.error)},d.oncomplete=function(){return l.close()}},i.onerror=function(l){return o(i.error)}})]})})},e.prototype.removeModel=function(t){return Re(this,void 0,void 0,function(){var n=this;return Te(this,function(r){return t=Qst(t),[2,new Promise(function(o,i){var l=n.indexedDB.open(Tv,Dv);l.onupgradeneeded=function(){return Av(l)},l.onsuccess=function(){var d,p=l.result,h=p.transaction(Bi,"readwrite"),g=h.objectStore(Bi),y=g.get(t);y.onsuccess=function(){if(y.result==null)return p.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var x=g.delete(t),C=function(){var _=(d=p.transaction(Ms,"readwrite")).objectStore(Ms).delete(t);_.onsuccess=function(){return o(y.result.modelArtifactsInfo)},_.onerror=function(k){return i(y.error)}};x.onsuccess=C,x.onerror=function(_){return C(),p.close(),i(y.error)}},y.onerror=function(x){return p.close(),i(y.error)},h.oncomplete=function(){d==null?p.close():d.oncomplete=function(){return p.close()}}},l.onerror=function(d){return i(l.error)}})]})})},e}();if(ot.get("IS_BROWSER"))try{ji.registerManager(dc.URL_SCHEME,new Jst)}catch{}var Li="/",vl="tensorflowjs_models",hT="info",Zst="model_topology",tut="weight_specs",eut="weight_data";function mT(e){return{info:[vl,e,hT].join(Li),topology:[vl,e,Zst].join(Li),weightSpecs:[vl,e,tut].join(Li),weightData:[vl,e,eut].join(Li)}}function nut(e){var t=e.split(Li);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Li)}function rut(e){return e.startsWith(fc.URL_SCHEME)?e.slice(fc.URL_SCHEME.length):e}var fc=function(){function e(t){if(!ot.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=mT(this.modelPath)}return e.prototype.save=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i;return Te(this,function(l){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=Cd(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Hst(t.weightData)),[2,{modelArtifactsInfo:o}]}catch{for(i in this.keys)this.LS.removeItem(this.keys[i]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return Re(this,void 0,void 0,function(){var t,n,r,o,i;return Te(this,function(l){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(i=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=Gst(i),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),BS=function(e){return ot.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(fc.URL_SCHEME)?out(e.slice(fc.URL_SCHEME.length)):null};function out(e){return new fc(e)}ho.registerSaveRouter(BS),ho.registerLoadRouter(BS);var aut=function(){function e(){tt(ot.get("IS_BROWSER"),"Current environment is not a web browser"),tt(window.localStorage!==void 0,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return e.prototype.listModels=function(){return Re(this,void 0,void 0,function(){var t,n,r,o,i,l;return Te(this,function(d){for(t={},n=vl+Li,r=Li+hT,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(n)&&i.endsWith(r)&&(l=nut(i),t[l]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},e.prototype.removeModel=function(t){return Re(this,void 0,void 0,function(){var n,r;return Te(this,function(o){if(t=rut(t),n=mT(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(ot.get("IS_BROWSER"))try{ji.registerManager(fc.URL_SCHEME,new aut)}catch{}var iut="model",sut=".json",uut=".weights.bin",Iv=function(){function e(t){if(!ot.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=iut),this.modelTopologyFileName=t+sut,this.weightDataFileName=t+uut}return e.prototype.save=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d;return Te(this,function(p){if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(l=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,l.href=i,l.click(),t.weightData!=null&&((d=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,d.href=n,d.click()),[2,{modelArtifactsInfo:Cd(t)}]})})},e.URL_SCHEME="downloads://",e}(),cut=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return Re(this,void 0,void 0,function(){var t,n,r=this;return Te(this,function(o){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(i,l){var d=new FileReader;d.onload=function(p){var h=JSON.parse(p.target.result),g=h.modelTopology;if(g!=null){n.length===0&&i({modelTopology:g});var y=h.weightsManifest;if(y!=null){var x;try{x=r.checkManifestAndWeightFiles(y,n)}catch(A){return void l(A)}var C=[],_=[],k=[];y.forEach(function(A){A.paths.forEach(function(I){_.push(I),k.push(null)}),C.push.apply(C,A.weights)}),y.forEach(function(A){A.paths.forEach(function(I){var N=new FileReader;N.onload=function(D){var M=D.target.result,F=_.indexOf(I);k[F]=M,k.indexOf(null)===-1&&i({modelTopology:g,weightSpecs:C,weightData:z0(k)})},N.onerror=function(D){return l("Failed to weights data from file of path '"+I+"'.")},N.readAsArrayBuffer(x[I])})})}else l(new Error("weightManifest field is missing from file "+t.name))}else l(new Error("modelTopology field is missing from file "+t.name))},d.onerror=function(p){return l("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},d.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],o=n.map(function(p){return FS(p.name)}),i={},l=0,d=t;l<d.length;l++)d[l].paths.forEach(function(p){var h=FS(p);if(r.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(r.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");i[p]=n[o.indexOf(h)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return i},e}(),lut=function(e){return ot.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Iv.URL_SCHEME)?dut(e.slice(Iv.URL_SCHEME.length)):null};function dut(e){return e===void 0&&(e="model"),new Iv(e)}function fut(e){return new cut(e)}function gT(e,t,n){return Re(this,void 0,void 0,function(){var r,o;return Te(this,function(i){switch(i.label){case 0:return n==null&&(n=fetch),r=e.map(function(l){return n(l,t)}),[4,Promise.all(r)];case 1:return o=i.sent(),[4,Promise.all(o.map(function(l){return l.arrayBuffer()}))];case 2:return[2,i.sent()]}})})}function put(e,t,n,r){return t===void 0&&(t=""),Re(this,void 0,void 0,function(){return Te(this,function(o){return[2,vT(function(i){return gT(i,r)})(e,t,n)]})})}function vT(e){var t=this;return function(n,r,o){return r===void 0&&(r=""),Re(t,void 0,void 0,function(){var i,l,d,p,h,g,y,x,C,_;return Te(this,function(k){switch(k.label){case 0:if(i=n.map(function(){return!1}),l={},d=o!=null?o.map(function(){return!1}):[],p=[],n.forEach(function(A,I){var N=0;A.weights.forEach(function(D){var M="quantization"in D?D.quantization.dtype:D.dtype,F=Rv[M]*ie(D.shape),W=function(){i[I]=!0,l[I]==null&&(l[I]=[]),l[I].push({manifestEntry:D,groupOffset:N,sizeBytes:F})};o!=null?o.forEach(function(L,X){L===D.name&&(W(),d[X]=!0)}):W(),p.push(D.name),N+=F})}),!d.every(function(A){return A}))throw h=o.filter(function(A,I){return!d[I]}),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+p.join(", ")+".");return g=i.reduce(function(A,I,N){return I&&A.push(N),A},[]),y=[],g.forEach(function(A){n[A].paths.forEach(function(I){var N=r+(r.endsWith("/")?"":"/")+I;y.push(N)})}),[4,e(y)];case 1:return x=k.sent(),C={},_=0,g.forEach(function(A){for(var I=n[A].paths.length,N=0,D=0;D<I;D++)N+=x[_+D].byteLength;for(var M=new ArrayBuffer(N),F=new Uint8Array(M),W=0,L=0;L<I;L++){var X=new Uint8Array(x[_+L]);F.set(X,W),W+=X.byteLength}l[A].forEach(function(q){var Q=dT(M.slice(q.groupOffset,q.groupOffset+q.sizeBytes),[q.manifestEntry]);for(var it in Q)C[it]=Q[it]}),_+=I}),[2,C]}})})}}ho.registerSaveRouter(lut);var yT=function(){function e(t,n,r,o){if(this.weightPathPrefix=r,this.DEFAULT_METHOD="POST",o==null){if(typeof fetch>"u")throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");this.fetchFunc=fetch.bind(typeof window>"u"?null:window)}else tt(typeof o=="function","Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetchFunc=o;if(tt(t!=null&&t.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(t)&&tt(t.length===2,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+t.length+")."),this.path=t,n!=null&&n.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n||{}}return e.prototype.save=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i;return Te(this,function(l){switch(l.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,n)];case 1:if((i=l.sent()).ok)return[2,{modelArtifactsInfo:Cd(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return Re(this,void 0,void 0,function(){return Te(this,function(t){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},e.prototype.loadBinaryTopology=function(){return Re(this,void 0,void 0,function(){var t,n;return Te(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.getFetchFunc()(this.path[0],this.requestInit)];case 1:if(!(t=r.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.arrayBuffer()];case 2:return[2,r.sent()];case 3:throw n=r.sent(),new Error(this.path[0]+" not found. "+n);case 4:return[2]}})})},e.prototype.loadBinaryModel=function(){return Re(this,void 0,void 0,function(){var t,n,r,o,i,l,d,p;return Te(this,function(h){switch(h.label){case 0:return t=this.loadBinaryTopology(),[4,this.getFetchFunc()(this.path[1],this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+n.statusText);return[4,Promise.all([t,n])];case 2:return r=h.sent(),o=r[0],[4,r[1].json()];case 3:return(i=h.sent())==null?[3,5]:[4,this.loadWeights(i)];case 4:p=h.sent(),l=p[0],d=p[1],h.label=5;case 5:return[2,{modelTopology:o,weightSpecs:l,weightData:d}]}})})},e.prototype.loadJSONModel=function(){return Re(this,void 0,void 0,function(){var t,n,r,o,i,l,d,p;return Te(this,function(h){switch(h.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.json()];case 2:if(n=h.sent(),r=n.modelTopology,o=n.weightsManifest,r==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,4]:(d=n.weightsManifest,[4,this.loadWeights(d)]);case 3:p=h.sent(),i=p[0],l=p[1],h.label=4;case 4:return[2,{modelTopology:r,weightSpecs:i,weightData:l}]}})})},e.prototype.loadWeights=function(t){return Re(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y,x,C;return Te(this,function(_){switch(_.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=hut(n),o=r[0],i=r[1],l=this.weightPathPrefix||o,d=[],p=0,h=t;p<h.length;p++)g=h[p],d.push.apply(d,g.weights);return y=[],t.forEach(function(k){k.paths.forEach(function(A){y.push(l+A+i)})}),x=[d],C=z0,[4,gT(y,this.requestInit,this.getFetchFunc())];case 1:return[2,x.concat([C.apply(void 0,[_.sent()])])]}})})},e.prototype.getFetchFunc=function(){return this.fetchFunc},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function hut(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Nv(e){return e.match(yT.URL_SCHEME_REGEX)!=null}var LS=function(e){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(t){return Nv(t)}):Nv(e))?bT(e):null};function bT(e,t,n,r){return new yT(e,t,n,r)}ho.registerSaveRouter(LS),ho.registerLoadRouter(LS);var mut=function(){function e(t,n,r){this.modelTopology=t,this.weightSpecs=n,this.weightData=r}return e.prototype.load=function(){return Re(this,void 0,void 0,function(){var t;return Te(this,function(n){return t={},this.modelTopology!=null&&(t=bg({modelTopology:this.modelTopology},t)),this.weightSpecs!=null&&this.weightSpecs.length>0&&(t=bg({weightSpecs:this.weightSpecs},t)),this.weightData!=null&&this.weightData.byteLength>0&&(t=bg({weightData:this.weightData},t)),[2,t]})})},e}(),gut=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return Re(this,void 0,void 0,function(){return Te(this,function(n){return[2,this.saveHandler(t)]})})},e}();function vut(e,t,n){return new mut(e,t,n)}function yut(e){return new gut(e)}var but=ho.registerSaveRouter,xut=ho.registerLoadRouter,wut=ho.getSaveHandlers,Cut=ho.getLoadHandlers,xT=Object.freeze({browserFiles:fut,browserHTTPRequest:bT,concatenateArrayBuffers:z0,decodeWeights:dT,encodeWeights:zst,fromMemory:vut,getLoadHandlers:Cut,getModelArtifactsInfoForJSON:Cd,getSaveHandlers:wut,isHTTPScheme:Nv,loadWeights:put,registerLoadRouter:xut,registerSaveRouter:but,weightsLoaderFactory:vT,withSaveHandler:yut,copyModel:Kst,listModels:qst,moveModel:Xst,removeModel:jst});function Sut(e,t,n){var r=G(e,"labels","confusionMatrix"),o=G(t,"predictions","confusionMatrix");tt(n==null||n>0&&Number.isInteger(n),"If provided, numClasses must be a positive integer, but got "+n),tt(r.rank===1,"Expected the rank of labels to be 1, but got "+r.rank),tt(o.rank===1,"Expected the rank of predictions to be 1, but got "+o.rank),tt(r.shape[0]===o.shape[0],"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."),tt(n>0&&Number.isInteger(n),"numClasses is required to be a positive integer, but got "+n);var i=_v(r.asType("int32"),n),l=_v(o.asType("int32"),n);return i.transpose().matMul(l).asType("int32")}ct({confusionMatrix_:Sut});var _ut=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),Eut=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function su(e){tt(e.className!=null,"Class being registered does not have the static className property defined."),tt(typeof e.className=="string","className is required to be a string, but got type "+typeof e.className),tt(e.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),Eut.register(e)}var Rc=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return ri(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var i=this.computeGradients(n,o),l=i.value,d=i.grads;return this.applyGradients(d),Object.keys(d).forEach(function(p){return d[p].dispose()}),r?l:(l.dispose(),null)},t.prototype.computeGradients=function(n,r){return ZY(n,r)},t}(_ut),kut=function(e){function t(n,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=n,i.rho=r,i.epsilon=o,i.accumulatedGrads={},i.accumulatedUpdates={},i.c=wn(Lt(-n)),i.rhoScalar=wn(Lt(r)),i.oneMinusRho=wn(Lt(1-r)),o===null&&(o=ot.get("EPSILON")),i.epsilonScalar=wn(Lt(o)),i}return ri(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=ot.engine.registeredVariables[d];i.accumulatedGrads[d]==null&&rn(function(){r.accumulatedGrads[d]=_n(p).variable(!1)}),i.accumulatedUpdates[d]==null&&rn(function(){r.accumulatedUpdates[d]=_n(p).variable(!1)});var h=n[d],g=i.accumulatedGrads[d],y=i.accumulatedUpdates[d];rn(function(){var x=r.rhoScalar.mul(g).add(r.oneMinusRho.mul(h.square())),C=y.add(r.epsilonScalar).sqrt().div(g.add(r.epsilonScalar).sqrt()).mul(h),_=r.rhoScalar.mul(y).add(r.oneMinusRho.mul(C.square()));r.accumulatedGrads[d].assign(x),r.accumulatedUpdates[d].assign(_);var k=r.c.mul(C).add(p);p.assign(k)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(r){return n.accumulatedUpdates[r].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(r){return n.accumulatedGrads[r].dispose()}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="AdadeltaOptimizer",t}(Rc);su(kut);var Rut=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads={},o.c=wn(Lt(-n)),o.epsilon=wn(Lt(ot.get("EPSILON"))),o}return ri(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=ot.engine.registeredVariables[d];i.accumulatedGrads[d]==null&&rn(function(){r.accumulatedGrads[d]=ec(p.shape,r.initialAccumulatorValue).variable(!1)});var h=n[d],g=i.accumulatedGrads[d];rn(function(){var y=g.add(h.square());r.accumulatedGrads[d].assign(y);var x=r.c.mul(h.div(y.add(r.epsilon).sqrt())).add(p);p.assign(x)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(r){return n.accumulatedGrads[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="AdagradOptimizer",t}(Rc);su(Rut);var Tut=function(e){function t(n,r,o,i){i===void 0&&(i=null);var l=e.call(this)||this;return l.learningRate=n,l.beta1=r,l.beta2=o,l.epsilon=i,l.accumulatedFirstMoment={},l.accumulatedSecondMoment={},l.c=wn(Lt(-n)),l.beta1Scalar=wn(Lt(r)),l.beta2Scalar=wn(Lt(o)),rn(function(){l.accBeta1=Lt(r).variable(),l.accBeta2=Lt(o).variable()}),l.oneMinusBeta1=wn(Lt(1-r)),l.oneMinusBeta2=wn(Lt(1-o)),l.one=wn(Lt(1)),i===null&&(i=ot.get("EPSILON")),l.epsScalar=wn(Lt(i)),l}return ri(t,e),t.prototype.applyGradients=function(n){var r=this;rn(function(){var o=r.one.sub(r.accBeta1),i=r.one.sub(r.accBeta2);for(var l in n){var d=ot.engine.registeredVariables[l];if(r.accumulatedFirstMoment[l]==null){var p=!1;r.accumulatedFirstMoment[l]=_n(d).variable(p)}r.accumulatedSecondMoment[l]==null&&(p=!1,r.accumulatedSecondMoment[l]=_n(d).variable(p));var h=n[l],g=r.accumulatedFirstMoment[l],y=r.accumulatedSecondMoment[l],x=r.beta1Scalar.mul(g).add(r.oneMinusBeta1.mul(h)),C=r.beta2Scalar.mul(y).add(r.oneMinusBeta2.mul(h.square())),_=x.div(o),k=C.div(i);r.accumulatedFirstMoment[l].assign(x),r.accumulatedSecondMoment[l].assign(C);var A=r.c.mul(_.div(r.epsScalar.add(k.sqrt()))).add(d);d.assign(A)}r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar)),r.accBeta2.assign(r.accBeta2.mul(r.beta2Scalar))})},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return n.accumulatedFirstMoment[r].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(r){return n.accumulatedSecondMoment[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="AdamOptimizer",t}(Rc);su(Tut);var Dut=function(e){function t(n,r,o,i,l){i===void 0&&(i=null),l===void 0&&(l=0);var d=e.call(this)||this;return d.learningRate=n,d.beta1=r,d.beta2=o,d.epsilon=i,d.decay=l,d.accumulatedFirstMoment={},d.accumulatedWeightedInfNorm={},d.c=wn(Lt(-n)),d.beta1Scalar=wn(Lt(r)),d.beta2Scalar=wn(Lt(o)),d.decayScalar=wn(Lt(l)),rn(function(){d.iteration=Lt(0).variable(),d.accBeta1=Lt(r).variable()}),d.oneMinusBeta1=wn(Lt(1-r)),d.one=wn(Lt(1)),i===null&&(i=ot.get("EPSILON")),d.epsScalar=wn(Lt(i)),d}return ri(t,e),t.prototype.applyGradients=function(n){var r=this;rn(function(){var o=r.one.sub(r.accBeta1),i=r.c.div(r.one.add(r.decayScalar.mul(r.iteration)));for(var l in n){var d=ot.engine.registeredVariables[l];if(r.accumulatedFirstMoment[l]==null){var p=!1;r.accumulatedFirstMoment[l]=_n(d).variable(p)}r.accumulatedWeightedInfNorm[l]==null&&(p=!1,r.accumulatedWeightedInfNorm[l]=_n(d).variable(p));var h=n[l],g=r.accumulatedFirstMoment[l],y=r.accumulatedWeightedInfNorm[l],x=r.beta1Scalar.mul(g).add(r.oneMinusBeta1.mul(h)),C=r.beta2Scalar.mul(y),_=h.abs(),k=C.maximum(_);r.accumulatedFirstMoment[l].assign(x),r.accumulatedWeightedInfNorm[l].assign(k);var A=i.div(o).mul(x.div(r.epsScalar.add(k))).add(d);d.assign(A)}r.iteration.assign(r.iteration.add(r.one)),r.accBeta1.assign(r.accBeta1.mul(r.beta1Scalar))})},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(r){return n.accumulatedFirstMoment[r].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(r){return n.accumulatedWeightedInfNorm[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="AdamaxOptimizer",t}(Rc);su(Dut);var wT=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return ri(t,e),t.prototype.applyGradients=function(n){var r=this;Object.keys(n).forEach(function(o){var i=n[o],l=ot.engine.registeredVariables[o];rn(function(){var d=r.c.mul(i).add(l);l.assign(d)})})},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=wn(Lt(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGDOptimizer",t}(Rc);su(wT);var Aut=function(e){function t(n,r,o){o===void 0&&(o=!1);var i=e.call(this,n)||this;return i.learningRate=n,i.momentum=r,i.useNesterov=o,i.m=Lt(i.momentum),i.accumulations={},i}return ri(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=ot.engine.registeredVariables[d];i.accumulations[d]==null&&rn(function(){r.accumulations[d]=_n(p).variable(!1)});var h=i.accumulations[d],g=n[d];rn(function(){var y,x=r.m.mul(h).add(g);y=r.useNesterov?r.c.mul(g.add(x.mul(r.m))).add(p):r.c.mul(x).add(p),r.accumulations[d].assign(x),p.assign(y)})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var n in this.accumulations)this.accumulations[n].dispose()},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="MomentumOptimizer",t}(wT);su(Aut);var Iut=function(e){function t(n,r,o,i,l){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),l===void 0&&(l=!1);var d=e.call(this)||this;return d.learningRate=n,d.decay=r,d.momentum=o,d.epsilon=i,d.accumulatedMeanSquares={},d.accumulatedMeanGrads={},d.accumulatedMoments={},d.c=wn(Lt(n)),d.decayScalar=wn(Lt(r)),d.momentumScalar=wn(Lt(o)),d.oneMinusDecay=wn(Lt(1-r)),d.centered=l,i===null&&(i=ot.get("EPSILON")),d.epsilonScalar=wn(Lt(i)),d}return ri(t,e),t.prototype.applyGradients=function(n){var r=this,o=function(d){var p=ot.engine.registeredVariables[d];i.accumulatedMeanSquares[d]==null&&rn(function(){r.accumulatedMeanSquares[d]=_n(p).variable(!1)}),i.accumulatedMeanGrads[d]==null&&i.centered&&rn(function(){r.accumulatedMeanGrads[d]=_n(p).variable(!1)}),i.accumulatedMoments[d]==null&&rn(function(){r.accumulatedMoments[d]=_n(p).variable(!1)});var h=i.accumulatedMeanSquares[d],g=i.accumulatedMeanGrads[d],y=i.accumulatedMoments[d],x=n[d];rn(function(){var C=r.decayScalar.mul(h).add(r.oneMinusDecay.mul(x.square()));if(r.centered){var _=r.decayScalar.mul(g).add(r.oneMinusDecay.mul(x)),k=r.momentumScalar.mul(y).add(r.c.mul(x).div(C.sub(_.square().add(r.epsilonScalar)).sqrt()));r.accumulatedMeanSquares[d].assign(C),r.accumulatedMeanGrads[d].assign(_),r.accumulatedMoments[d].assign(k);var A=p.sub(k);p.assign(A)}else{var I=r.decayScalar.mul(h).add(r.oneMinusDecay.mul(x.square()));k=r.momentumScalar.mul(y).add(r.c.mul(x).div(I.add(r.epsilonScalar).sqrt())),r.accumulatedMeanSquares[d].assign(I),r.accumulatedMoments[d].assign(k),A=p.sub(k),p.assign(A)}})},i=this;for(var l in n)o(l)},t.prototype.dispose=function(){var n=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(r){return n.accumulatedMeanSquares[r].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(r){return n.accumulatedMeanGrads[r].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(r){return n.accumulatedMoments[r].dispose()})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSPropOptimizer",t}(Rc);su(Iut);ka.setBackend;ka.getBackend;ka.disposeVariables;ka.memory;DY(Wst);function jo(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),rn(function(){var o=Hs(kc(e,t.filters,[1,1],n),t.bias);return r?L0(o):o})}function uu(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function V0(e,t){return function(n,r,o,i){var l=fa(e(n*r*o*o),[o,o,n,r]),d=Ya(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:l,bias:d}}}function CT(e,t){return function(n,r,o){var i=Yp(e(n*r),[n,r]),l=Ya(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:l}}}var eh=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function Nut(e,t){return function(n,r,o){var i=fa(e(9*n),[3,3,n,1]),l=fa(e(n*r),[1,1,n,r]),d=Ya(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new eh(i,l,d)}}function Put(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new eh(n,r,o)}}var oc=function(){function e(t,n){if(!Ls(t)||!Ls(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),gn=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}();function nh(e,t){return e instanceof Kt&&e.shape.length===t}function Mut(e){return nh(e,2)}function rh(e){return nh(e,3)}function zi(e){return nh(e,4)}function Out(e){return e%1!==0}function WS(e){return e%2===0}function Fut(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function US(e){return e&&e.width&&e.height}function $ut(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new oc(Math.round(n*o),Math.round(r*o))}function H0(e){return e.reduce(function(t,n){return t.add(n)},new gn(0,0)).div(new gn(e.length,e.length))}function zS(e,t,n){return Array(e).fill(0).map(function(r,o){return t+o*n})}function Ls(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function VS(e){return Ls(e)&&0<=e&&e<=1}function Tc(e,t){return function(n,r,o){var i=e[n];if(!nh(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:o||n}),i}}function cu(e){var t=e;function n(o){var i=t.slice(0,o);return t=t.slice(o),i}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function ST(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(d){return d}),i=e.endsWith(".json")?o[o.length-1]:n,l=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return l=e.startsWith("/")?"/"+l:l,{modelBaseUri:l,manifestUri:l==="/"?"/"+i:l+"/"+i}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Pv=function(e,t){return Pv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},Pv(e,t)};function Ne(e,t){Pv(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var ba=function(){return ba=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ba.apply(this,arguments)};function xe(e,t,n,r){function o(i){return i instanceof n?i:new n(function(l){l(i)})}return new(n||(n=Promise))(function(i,l){function d(g){try{h(r.next(g))}catch(y){l(y)}}function p(g){try{h(r.throw(g))}catch(y){l(y)}}function h(g){g.done?i(g.value):o(g.value).then(d,p)}h((r=r.apply(e,[])).next())})}function we(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(h){return function(g){return p([h,g])}}function p(h){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=h[0]&2?o.return:h[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,h[1])).done)return i;switch(o=0,i&&(h=[h[0]&2,i.value]),h[0]){case 0:case 1:i=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,o=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){n.label=h[1];break}if(h[0]===6&&n.label<i[1]){n.label=i[1],i=h;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(h);break}i[2]&&n.ops.pop(),n.trys.pop();continue}h=t.call(e,n)}catch(g){h=[6,g],o=0}finally{r=i=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var Ki=function(){function e(t,n){n===void 0&&(n=!1);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(Ls),i=[r.x,r.y,r.width,r.height].every(Ls);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var l=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],d=l[0],p=l[1],h=l[2],g=l[3];e.assertIsValidBox({x:d,y:p,width:h,height:g},"Box.constructor",n),this._x=d,this._y=p,this._width=h,this._height=g}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Ls)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(l){return Math.round(l)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(l){return Math.floor(l)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,i=t.height,l=Math.abs(o-i);return o<i&&(n-=l/2,o+=l),i<o&&(r-=l/2,i+=l),new e({x:n,y:r,width:o,height:i})},e.prototype.rescale=function(t){var n=US(t)?t.width:t,r=US(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],o=r[0],i=r[1],l=r[2],d=r[3];return new e({x:o,y:i,width:l,height:d})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,i=r.y,l=r.right,d=r.bottom,p=Math.max(o,0),h=Math.max(i,0),g=l-p,y=d-h,x=Math.min(g,t-p),C=Math.min(y,n-h);return new e({x:p,y:h,width:x,height:C}).floor()},e.prototype.shift=function(t,n){var r=this,o=r.width,i=r.height,l=this.x+t,d=this.y+n;return new e({x:l,y:d,width:o,height:i})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,o=this.height+1,i=1,l=1,d=r,p=o,h=this.left,g=this.top,y=this.right,x=this.bottom;return y>n&&(d=-y+n+r,y=n),x>t&&(p=-x+t+o,x=t),h<1&&(p=2-h,h=1),g<1&&(p=2-g,g=1),{dy:l,edy:p,dx:i,edx:d,y:g,ey:x,x:h,ex:y,w:r,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),G0=function(e){Ne(t,e);function t(n,r,o,i){return e.call(this,{left:n,top:r,right:o,bottom:i})||this}return t}(Ki),_T=function(){function e(t,n,r,o,i){this._imageDims=new oc(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new Ki(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Ki(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}();function ET(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function kT(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(o,i){e.readFile(r,function(l,d){return l?i(l):o(d)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function RT(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=kT();return ba({Canvas:e||function(){function l(){}return l}(),Image:t||function(){function l(){}return l}(),ImageData:global.ImageData||function(){function l(){}return l}(),Video:global.HTMLVideoElement||function(){function l(){}return l}(),createCanvasElement:n,createImageElement:r,fetch:o},i)}function TT(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"}function DT(){return typeof global=="object"&&typeof require=="function"&&typeof oD<"u"&&typeof process<"u"&&!!process.version}var qn;function But(){if(!qn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return qn}function Mv(e){qn=e}function q0(){TT()&&Mv(ET()),DT()&&Mv(RT())}function Lut(e){if(qn||q0(),!qn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?qn.Canvas:t,r=e.Image,o=r===void 0?qn.Image:r;qn.Canvas=n,qn.Image=o,qn.createCanvasElement=e.createCanvasElement||function(){return new n},qn.createImageElement=e.createImageElement||function(){return new o},qn.ImageData=e.ImageData||qn.ImageData,qn.Video=e.Video||qn.Video,qn.fetch=e.fetch||qn.fetch,qn.readFile=e.readFile||qn.readFile}var Ur={getEnv:But,setEnv:Mv,initialize:q0,createBrowserEnv:ET,createFileSystem:kT,createNodejsEnv:RT,monkeyPatch:Lut,isBrowser:TT,isNodejs:DT};q0();function AT(e){var t=Ur.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Wut(e){return new Promise(function(t,n){if(e instanceof Ur.getEnv().Canvas||AT(e))return t();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function Gs(e){var t=e.getContext("2d");if(!t)throw new Error("canvas 2d context is null");return t}function IT(e){var t=Ur.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new oc(e.naturalWidth,e.naturalHeight):e instanceof r?new oc(e.videoWidth,e.videoHeight):new oc(e.width,e.height)}function oh(e){var t=e.width,n=e.height,r=Ur.getEnv().createCanvasElement,o=r();return o.width=t,o.height=n,o}function j0(e,t){var n=Ur.getEnv().ImageData;if(!(e instanceof n)&&!AT(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=IT(e),o=r.width,i=r.height,l=oh({width:o,height:i});return e instanceof n?Gs(l).putImageData(e,0,0):Gs(l).drawImage(e,0,0,o,i),l}(function(e){Ne(t,e);function t(n,r){var o=e.call(this,n)||this;return o._text=r,o}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),t})(Ki);var HS=function(e){Ne(t,e);function t(n,r){var o=e.call(this,n)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(n,r){if(Ki.assertIsValidBox(n,r),!Ls(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Ki);(function(e){Ne(t,e);function t(n,r,o,i){var l=e.call(this,n,r)||this;return l._score=o,l._classScore=i,l}return t.assertIsValidPredictedBox=function(n,r){if(HS.assertIsValidLabeledBox(n,r),!VS(n.score)||!VS(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(HS);function Uut(e){return!Ur.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function zut(e,t){return xe(this,void 0,void 0,function(){var n,r;return we(this,function(o){switch(o.label){case 0:return n=Ur.getEnv().fetch,[4,n(e,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Vut(e){return xe(this,void 0,void 0,function(){return we(this,function(t){switch(t.label){case 0:return[4,zut(e)];case 1:return[2,t.sent().json()]}})})}function Hut(e,t){return xe(this,void 0,void 0,function(){var n,r,o,i,l,d;return we(this,function(p){switch(p.label){case 0:return n=Ur.getEnv().createCanvasElement(),r=e.shape.slice(zi(e)?1:0),o=r[0],i=r[1],l=r[2],d=rn(function(){return e.as3D(o,i,l).toInt()}),[4,OR(d,n)];case 1:return p.sent(),d.dispose(),[2,n]}})})}function Gut(e,t,n){n===void 0&&(n=!1);var r=Ur.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var l=IT(e),d=t/Math.max(l.height,l.width),p=d*l.width,h=d*l.height,g=oh({width:t,height:t}),y=e instanceof i?e:j0(e),x=Math.abs(p-h)/2,C=n&&p<h?x:0,_=n&&h<p?x:0;return Gs(g).drawImage(y,C,_,p,h),g}function GS(e){var t=Ur.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function qut(e,t){return xe(this,void 0,void 0,function(){var n,r,o,i;return we(this,function(l){switch(l.label){case 0:return n=ST(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,Vut(r)];case 1:return i=l.sent(),[2,xT.loadWeights(i,o)]}})})}function jut(e,t){return t===void 0&&(t=!1),rn(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var i=Math.abs(r-o),l=Math.round(i*(t?.5:1)),d=r>o?2:1,p=function(C){var _=e.shape.slice();return _[d]=C,ec(_,0)},h=p(l),g=i-h.shape[d],y=t&&g?p(g):null,x=[y,e,h].filter(function(C){return!!C}).map(function(C){return C.toFloat()});return ii(x,d)})}var Ov=function(){function e(t,n){n===void 0&&(n=!1);var r=this;if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(o,i){if(rh(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(zi(o)){var l=o.shape[0];if(l!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+l+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var d=o instanceof Ur.getEnv().Canvas?o:j0(o);r._canvases[i]=d,r._inputDimensions[i]=[d.height,d.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return zS(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return $ut({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,rn(function(){var o=zS(r.batchSize,0,1).map(function(l){var d=r.getInput(l);if(d instanceof Kt){var p=zi(d)?d:d.expandDims();return p=jut(p,n),(p.shape[1]!==t||p.shape[2]!==t)&&(p=lT.resizeBilinear(p,[t,t])),p.as3D(t,t,3)}if(d instanceof Ur.getEnv().Canvas)return BR(Gut(d,t,n));throw new Error("toBatchTensor - at batchIdx "+l+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+d)}),i=lc(o.map(function(l){return l.toFloat()})).as4D(r.batchSize,t,t,3);return i})},e}();function zr(e){return xe(this,void 0,void 0,function(){var t,n,r;return we(this,function(o){switch(o.label){case 0:if(e instanceof Ov)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=t.map(Uut),r.forEach(function(i,l){if(!GS(i)&&!rh(i)&&!zi(i))throw typeof t[l]=="string"?new Error("toNetInput -"+n(l)+" string passed, but could not resolve HTMLElement for element id "+t[l]):new Error("toNetInput -"+n(l)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(zi(i)){var d=i.shape[0];if(d!==1)throw new Error("toNetInput -"+n(l)+" tf.Tensor4D with batchSize "+d+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return GS(i)&&Wut(i)}))];case 1:return o.sent(),[2,new Ov(r,Array.isArray(e))]}})})}var lu=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;return r[o]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Vs})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Vs)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,o=n.tensor;t.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,o=n.tensor,i=An(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return xe(this,void 0,void 0,function(){return we(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return xe(this,void 0,void 0,function(){var n;return we(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,qut(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return xe(this,void 0,void 0,function(){var n,r,o,i,l,d,p,h,g,y;return we(this,function(x){switch(x.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Ur.getEnv().readFile,r=ST(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,l=function(C){return Promise.all(C.map(function(_){return n(_).then(function(k){return k.buffer})}))},d=xT.weightsLoaderFactory(l),g=(h=JSON).parse,[4,n(o)];case 1:return p=g.apply(h,[x.sent().toString()]),[4,d(p,i)];case 2:return y=x.sent(),this.loadFromWeightMap(y),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(i,l){if(!i.nextObj.hasOwnProperty(l))throw new Error("traversePropertyPath - object does not have property "+l+", for path "+t);return{obj:i.nextObj,objProp:l,nextObj:i.nextObj[l]}},{nextObj:this.params}),r=n.obj,o=n.objProp;if(!r||!o||!(r[o]instanceof Kt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},e}();function Kut(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*o;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function Jl(e,t,n,r){r===void 0&&(r=!0);for(var o=t.map(function(d,p){return{score:d,boxIndex:p}}).sort(function(d,p){return d.score-p.score}).map(function(d){return d.boxIndex}),i=[],l=function(){var d=o.pop();i.push(d);for(var p=o,h=[],g=0;g<p.length;g++){var y=p[g],x=e[d],C=e[y];h.push(Kut(x,C,r))}o=o.filter(function(_,k){return h[k]<=n})};o.length>0;)l();return i}function ah(e,t){return rn(function(){var n=t[0],r=t[1],o=t[2],i=ec(e.shape.slice(0,3).concat([1]),n),l=ec(e.shape.slice(0,3).concat([1]),r),d=ec(e.shape.slice(0,3).concat([1]),o),p=ii([i,l,d],3);return th(e,p)})}function Tg(e){return 1/(1+Math.exp(-e))}var Mf=function(e){return typeof e=="number"};function Xut(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Mf(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return Mf(t.x)&&Mf(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Mf)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function K0(e){return rn(function(){var t=F0(e,Lt(.10000000149011612));return Hs(L0(th(e,t)),t)})}function ki(e,t){return rn(function(){var n=iu(e,[[0,0],[1,1],[1,1],[0,0]]);return n=kc(n,t.conv.filters,[1,1],"valid"),n=th(n,t.bn.sub),n=F0(n,t.bn.truediv),n=Hs(n,t.conv.bias),K0(n)})}function Ri(e,t){return rn(function(){var n=iu(e,[[0,0],[1,1],[1,1],[0,0]]);return n=KR(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Hs(n,t.bias),K0(n)})}function Yut(e,t){var n=V0(e,t);function r(l,d){var p=Ya(e(l)),h=Ya(e(l));return t.push({paramPath:d+"/sub"},{paramPath:d+"/truediv"}),{sub:p,truediv:h}}function o(l,d,p){var h=n(l,d,3,p+"/conv"),g=r(d,p+"/bn");return{conv:h,bn:g}}var i=Nut(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function Qut(e,t,n,r){var o=cu(e),i=o.extractWeights,l=o.getRemainingWeights,d=[],p=Yut(i,d),h=p.extractConvParams,g=p.extractConvWithBatchNormParams,y=p.extractSeparableConvParams,x;if(t.withSeparableConvs){var C=r[0],_=r[1],k=r[2],A=r[3],I=r[4],N=r[5],D=r[6],M=r[7],F=r[8],W=t.isFirstLayerConv2d?h(C,_,3,"conv0"):y(C,_,"conv0"),L=y(_,k,"conv1"),X=y(k,A,"conv2"),q=y(A,I,"conv3"),Q=y(I,N,"conv4"),it=y(N,D,"conv5"),at=M?y(D,M,"conv6"):void 0,ht=F?y(M,F,"conv7"):void 0,gt=h(F||M||D,5*n,1,"conv8");x={conv0:W,conv1:L,conv2:X,conv3:q,conv4:Q,conv5:it,conv6:at,conv7:ht,conv8:gt}}else{var C=r[0],_=r[1],k=r[2],A=r[3],I=r[4],N=r[5],D=r[6],M=r[7],F=r[8],W=g(C,_,"conv0"),L=g(_,k,"conv1"),X=g(k,A,"conv2"),q=g(A,I,"conv3"),Q=g(I,N,"conv4"),it=g(N,D,"conv5"),at=g(D,M,"conv6"),ht=g(M,F,"conv7"),gt=h(F,5*n,1,"conv8");x={conv0:W,conv1:L,conv2:X,conv3:q,conv4:Q,conv5:it,conv6:at,conv7:ht,conv8:gt}}if(l().length!==0)throw new Error("weights remaing after extract: "+l().length);return{params:x,paramMappings:d}}function Jut(e,t){var n=Tc(e,t);function r(d){var p=n(d+"/sub",1),h=n(d+"/truediv",1);return{sub:p,truediv:h}}function o(d){var p=n(d+"/filters",4),h=n(d+"/bias",1);return{filters:p,bias:h}}function i(d){var p=o(d+"/conv"),h=r(d+"/bn");return{conv:p,bn:h}}var l=Put(n);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:l}}function Zut(e,t){var n=[],r=Jut(e,n),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,l=r.extractSeparableConvParams,d;if(t.withSeparableConvs){var p=t.filterSizes&&t.filterSizes.length||9;d={conv0:t.isFirstLayerConv2d?o("conv0"):l("conv0"),conv1:l("conv1"),conv2:l("conv2"),conv3:l("conv3"),conv4:l("conv4"),conv5:l("conv5"),conv6:p>7?l("conv6"):void 0,conv7:p>8?l("conv7"):void 0,conv8:o("conv8")}}else d={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return uu(e,n),{params:d,paramMappings:n}}var qS;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(qS||(qS={}));var X0=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,o=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),NT=function(e){Ne(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return Xut(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var o=ki(n,r.conv0);return o=so(o,[2,2],[2,2],"same"),o=ki(o,r.conv1),o=so(o,[2,2],[2,2],"same"),o=ki(o,r.conv2),o=so(o,[2,2],[2,2],"same"),o=ki(o,r.conv3),o=so(o,[2,2],[2,2],"same"),o=ki(o,r.conv4),o=so(o,[2,2],[2,2],"same"),o=ki(o,r.conv5),o=so(o,[2,2],[1,1],"same"),o=ki(o,r.conv6),o=ki(o,r.conv7),jo(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var o=this.config.isFirstLayerConv2d?K0(jo(n,r.conv0,"valid",!1)):Ri(n,r.conv0);return o=so(o,[2,2],[2,2],"same"),o=Ri(o,r.conv1),o=so(o,[2,2],[2,2],"same"),o=Ri(o,r.conv2),o=so(o,[2,2],[2,2],"same"),o=Ri(o,r.conv3),o=so(o,[2,2],[2,2],"same"),o=Ri(o,r.conv4),o=so(o,[2,2],[2,2],"same"),o=Ri(o,r.conv5),o=so(o,[2,2],[1,1],"same"),o=r.conv6?Ri(o,r.conv6):o,o=r.conv7?Ri(o,r.conv7):o,jo(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return rn(function(){var l=n.toBatchTensor(r,!1).toFloat();return l=o.config.meanRgb?ah(l,o.config.meanRgb):l,l=l.div(Lt(256)),o.config.withSeparableConvs?o.runMobilenet(l,i):o.runTinyYolov2(l,i)})},t.prototype.forward=function(n,r){return xe(this,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,zr(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var o,i,l,d,p,h,g,y,x,C,_,k,A,I,N=this;return we(this,function(D){switch(D.label){case 0:return o=new X0(r),i=o.inputSize,l=o.scoreThreshold,[4,zr(n)];case 1:return d=D.sent(),[4,this.forwardInput(d,i)];case 2:return p=D.sent(),h=rn(function(){return N0(p)[0].expandDims()}),g={width:d.getInputWidth(0),height:d.getInputHeight(0)},y=this.extractBoxes(h,d.getReshapedInputDimensions(0),l),p.dispose(),h.dispose(),x=y.map(function(M){return M.box}),C=y.map(function(M){return M.score}),_=y.map(function(M){return M.classScore}),k=y.map(function(M){return N.config.classes[M.label]}),A=Jl(x.map(function(M){return M.rescale(i)}),C,this.config.iouThreshold,!0),I=A.map(function(M){return new _T(C[M],_[M],k[M],x[M],g)}),[2,I]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return Zut(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return Qut(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,o){for(var i=this,l=r.width,d=r.height,p=Math.max(l,d),h=p/l,g=p/d,y=n.shape[1],x=this.config.anchors.length,C=rn(function(){var pt=n.reshape([y,y,x,i.boxEncodingSize]),lt=pt.slice([0,0,0,0],[y,y,x,4]),ft=pt.slice([0,0,0,4],[y,y,x,1]),Tt=i.withClassScores?Xp(pt.slice([0,0,0,5],[y,y,x,i.config.classes.length]),3):Lt(0);return[lt,ft,Tt]}),_=C[0],k=C[1],A=C[2],I=[],N=0;N<y;N++)for(var D=0;D<y;D++)for(var M=0;M<x;M++){var F=Tg(k.get(N,D,M,0));if(!o||F>o){var W=(D+Tg(_.get(N,D,M,0)))/y*h,L=(N+Tg(_.get(N,D,M,1)))/y*g,X=Math.exp(_.get(N,D,M,2))*this.config.anchors[M].x/y*h,q=Math.exp(_.get(N,D,M,3))*this.config.anchors[M].y/y*g,Q=W-X/2,it=L-q/2,at={row:N,col:D,anchor:M},ht=this.withClassScores?this.extractPredictedClass(A,at):{classScore:1,label:0},gt=ht.classScore,Ct=ht.label;I.push(ba({box:new G0(Q,it,Q+X,it+q),score:F,classScore:F*gt,label:Ct},at))}}return _.dispose(),k.dispose(),A.dispose(),I},t.prototype.extractPredictedClass=function(n,r){var o=r.row,i=r.col,l=r.anchor;return Array(this.config.classes.length).fill(0).map(function(d,p){return n.get(o,i,l,p)}).map(function(d,p){return{classScore:d,label:p}}).reduce(function(d,p){return d.classScore>p.classScore?d:p})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(lu),Y0=function(e){Ne(t,e);function t(n,r,o,i){return e.call(this,{x:n,y:r,width:o,height:i})||this}return t}(Ki),Ca=function(e){Ne(t,e);function t(n,r,o){return e.call(this,n,n,"",r,o)||this}return t.prototype.forSize=function(n,r){return e.prototype.forSize.call(this,n,r)},t}(_T),tct=.5,ect=.43,nct=.45,wp=function(){function e(t,n,r){r===void 0&&(r=new gn(0,0));var o=n.width,i=n.height;this._imgDims=new oc(o,i),this._shift=r,this._positions=t.map(function(l){return l.mul(new gn(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new gn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new gn(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new gn(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t){if(t){var n=t instanceof Ca?t.box.floor():t;return this.shiftBy(n.x,n.y).align()}var r=this.getRefPointsForAlignment(),o=r[0],i=r[1],l=r[2],d=function(C){return l.sub(C).magnitude()},p=(d(o)+d(i))/2,h=Math.floor(p/nct),g=H0(r),y=Math.floor(Math.max(0,g.x-tct*h)),x=Math.floor(Math.max(0,g.y-ect*h));return new Y0(y,x,Math.min(h,this.imageWidth+y),Math.min(h,this.imageHeight+x))},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),rct=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],H0([n[3],n[4]])]},t}(wp),oct=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(H0)},t}(wp),jS=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+Fut(this.distance)+")":"")},e}(),Dg=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}();function Dc(e,t){return xe(this,void 0,void 0,function(){var n,r,o,i,l,d,p;return we(this,function(h){switch(h.label){case 0:return n=Ur.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,zr(e)];case 1:if(o=h.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof n?(l=i,[3,4]):[3,2];case 2:return[4,Hut(i)];case 3:l=h.sent(),h.label=4;case 4:r=l,h.label=5;case 5:return d=Gs(r),p=t.map(function(g){return g instanceof Ca?g.forSize(r.width,r.height).box.floor():g}).map(function(g){return g.clipAtImageBorders(r.width,r.height)}),[2,p.map(function(g){var y=g.x,x=g.y,C=g.width,_=g.height,k=oh({width:C,height:_});return Gs(k).putImageData(d.getImageData(y,x,C,_),0,0),k})]}})})}function Ac(e,t){return xe(this,void 0,void 0,function(){return we(this,function(n){if(!rh(e)&&!zi(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(zi(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ve(function(){var r=e.shape.slice(zi(e)?1:0),o=r[0],i=r[1],l=r[2],d=t.map(function(h){return h instanceof Ca?h.forSize(i,o).box:h}).map(function(h){return h.clipAtImageBorders(i,o)}),p=d.map(function(h){var g=h.x,y=h.y,x=h.width,C=h.height;return Dk(e.as3D(o,i,l),[y,g,0],[C,x,l])});return p})]})})}function Os(e,t,n){return ve(function(){var r=kk(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=nn(r,t.bias),r})}function Ag(e,t,n){return n===void 0&&(n=!1),ve(function(){var r=po(n?nn(ts(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Os(e,t.conv0,[2,2])),o=Os(r,t.conv1,[1,1]),i=po(nn(r,o)),l=Os(i,t.conv2,[1,1]);return po(nn(r,nn(o,l)))})}function Of(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),ve(function(){var o=po(n?nn(ts(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Os(e,t.conv0,r?[2,2]:[1,1])),i=Os(o,t.conv1,[1,1]),l=po(nn(o,i)),d=Os(l,t.conv2,[1,1]),p=po(nn(o,nn(i,d))),h=Os(p,t.conv3,[1,1]);return po(nn(o,nn(i,nn(d,h))))})}function PT(e,t){function n(l,d,p){var h=lo(e(9*l),[3,3,l,1]),g=lo(e(l*d),[1,1,l,d]),y=eo(e(d));return t.push({paramPath:p+"/depthwise_filter"},{paramPath:p+"/pointwise_filter"},{paramPath:p+"/bias"}),new eh(h,g,y)}var r=V0(e,t);function o(l,d,p,h){h===void 0&&(h=!1);var g=h?r(l,d,3,p+"/conv0"):n(l,d,p+"/conv0"),y=n(d,d,p+"/conv1"),x=n(d,d,p+"/conv2");return{conv0:g,conv1:y,conv2:x}}function i(l,d,p,h){h===void 0&&(h=!1);var g=o(l,d,p,h),y=g.conv0,x=g.conv1,C=g.conv2,_=n(d,d,p+"/conv3");return{conv0:y,conv1:x,conv2:C,conv3:_}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function act(e){var t=[],n=cu(e),r=n.extractWeights,o=n.getRemainingWeights,i=PT(r,t).extractDenseBlock4Params,l=i(3,32,"dense0",!0),d=i(32,64,"dense1"),p=i(64,128,"dense2"),h=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:l,dense1:d,dense2:p,dense3:h}}}function MT(e,t){var n=Tc(e,t);function r(d){var p=n(d+"/filters",4),h=n(d+"/bias",1);return{filters:p,bias:h}}function o(d){var p=n(d+"/depthwise_filter",4),h=n(d+"/pointwise_filter",4),g=n(d+"/bias",1);return new eh(p,h,g)}function i(d,p){p===void 0&&(p=!1);var h=p?r(d+"/conv0"):o(d+"/conv0"),g=o(d+"/conv1"),y=o(d+"/conv2");return{conv0:h,conv1:g,conv2:y}}function l(d,p){p===void 0&&(p=!1);var h=p?r(d+"/conv0"):o(d+"/conv0"),g=o(d+"/conv1"),y=o(d+"/conv2"),x=o(d+"/conv3");return{conv0:h,conv1:g,conv2:y,conv3:x}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:l}}function ict(e){var t=[],n=MT(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return uu(e,t),{params:r,paramMappings:t}}var OT=function(e){Ne(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ve(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],l=ah(o,i).div(Ot(255)),d=Of(l,r.dense0,!0);return d=Of(d,r.dense1),d=Of(d,r.dense2),d=Of(d,r.dense3),d=Hp(d,[7,7],[2,2],"valid"),d})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return ict(n)},t.prototype.extractParams=function(n){return act(n)},t}(lu);function Wi(e,t){return ve(function(){return nn(Vp(e,t.weights),t.bias)})}function sct(e,t,n){var r=[],o=cu(e),i=o.extractWeights,l=o.getRemainingWeights,d=CT(i,r),p=d(t,n,"fc");if(l().length!==0)throw new Error("weights remaing after extract: "+l().length);return{paramMappings:r,params:{fc:p}}}function uct(e){var t=[],n=Tc(e,t);function r(i){var l=n(i+"/weights",2),d=n(i+"/bias",1);return{weights:l,bias:d}}var o={fc:r("fc")};return uu(e,t),{params:o,paramMappings:t}}function cct(e){var t={},n={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?n:t;o[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var FT=function(e){Ne(t,e);function t(n,r){var o=e.call(this,n)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ve(function(){var i=n instanceof Ov?r.faceFeatureExtractor.forwardInput(n):n;return Wi(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return sct(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=cct(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),uct(i)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,l=n.slice(0,n.length-i),d=n.slice(n.length-i);return this.faceFeatureExtractor.extractWeights(l),this.extractClassifierParams(d)},t}(lu),Ig={neutral:0,happy:1,sad:2,angry:3,fearful:4,disgusted:5,surprised:6},lct=function(e){Ne(t,e);function t(n){return n===void 0&&(n=new OT),e.call(this,"FaceExpressionNet",n)||this}return t.getFaceExpressionLabel=function(n){var r=Ig[n];if(typeof r!="number")throw new Error("getFaceExpressionLabel - no label for faceExpression: "+n);return r},t.decodeProbabilites=function(n){if(n.length!==7)throw new Error("decodeProbabilites - expected probabilities.length to be 7, have: "+n.length);return Object.keys(Ig).map(function(r){return{expression:r,probability:n[Ig[r]]}})},t.prototype.forwardInput=function(n){var r=this;return ve(function(){return Ys(r.runNet(n))})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(n){return xe(this,void 0,void 0,function(){var r,o,i,l,d=this;return we(this,function(p){switch(p.label){case 0:return[4,zr(n)];case 1:return r=p.sent(),[4,this.forwardInput(r)];case 2:return o=p.sent(),[4,Promise.all(Wr(o).map(function(h){return xe(d,void 0,void 0,function(){var g;return we(this,function(y){switch(y.label){case 0:return[4,h.data()];case 1:return g=y.sent(),h.dispose(),[2,g]}})})}))];case 3:return i=p.sent(),o.dispose(),l=i.map(function(h){return t.decodeProbabilites(h)}),[2,r.isBatchInput?l:l[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(FT),$T=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,o){var i=o.map(function(d){var p=d.width,h=d.height,g=r/Math.max(h,p);return{width:p*g,height:h*g}}),l=i.length;return ve(function(){var d=function(x,C){return ya([Rl([68],x),Rl([68],C)],1).as2D(1,136).as1D()},p=function(x,C){var _=i[x],k=_.width,A=_.height;return C(k,A)?Math.abs(k-A)/2:0},h=function(x){return p(x,function(C,_){return C<_})},g=function(x){return p(x,function(C,_){return _<C})},y=n.mul(Rl([l,136],r)).sub(ya(Array.from(Array(l),function(x,C){return d(h(C),g(C))}))).div(ya(Array.from(Array(l),function(x,C){return d(i[C].width,i[C].height)})));return y})},t.prototype.forwardInput=function(n){var r=this;return ve(function(){var o=r.runNet(n);return r.postProcess(o,n.inputSize,n.inputDimensions.map(function(i){var l=i[0],d=i[1];return{height:l,width:d}}))})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(n){return xe(this,void 0,void 0,function(){var r,o,i,l=this;return we(this,function(d){switch(d.label){case 0:return[4,zr(n)];case 1:return r=d.sent(),o=ve(function(){return Wr(l.forwardInput(r))}),[4,Promise.all(o.map(function(p,h){return xe(l,void 0,void 0,function(){var g,y,x,C,_;return we(this,function(k){switch(k.label){case 0:return x=(y=Array).from,[4,p.data()];case 1:return g=x.apply(y,[k.sent()]),C=g.filter(function(A,I){return WS(I)}),_=g.filter(function(A,I){return!WS(I)}),[2,new oct(Array(68).fill(0).map(function(A,I){return new gn(C[I],_[I])}),{height:r.getInputHeight(h),width:r.getInputWidth(h)})]}})})}))];case 2:return i=d.sent(),o.forEach(function(p){return p.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(FT),BT=function(e){Ne(t,e);function t(n){return n===void 0&&(n=new OT),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}($T);function dct(e){var t=[],n=MT(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return uu(e,t),{params:r,paramMappings:t}}function fct(e){var t=[],n=cu(e),r=n.extractWeights,o=n.getRemainingWeights,i=PT(r,t).extractDenseBlock3Params,l=i(3,32,"dense0",!0),d=i(32,64,"dense1"),p=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:l,dense1:d,dense2:p}}}var pct=function(e){Ne(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ve(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],l=ah(o,i).div(Ot(255)),d=Ag(l,r.dense0,!0);return d=Ag(d,r.dense1),d=Ag(d,r.dense2),d=Hp(d,[14,14],[2,2],"valid"),d})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return dct(n)},t.prototype.extractParams=function(n){return fct(n)},t}(lu),hct=function(e){Ne(t,e);function t(n){return n===void 0&&(n=new pct),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}($T);(function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(BT);function mct(e,t){return nn(qa(e,t.weights),t.biases)}function Q0(e,t,n,r,o){o===void 0&&(o="same");var i=t.conv,l=i.filters,d=i.bias,p=ts(e,l,n,o);return p=nn(p,d),p=mct(p,t.scale),r?po(p):p}function gct(e,t){return Q0(e,t,[1,1],!0)}function LT(e,t){return Q0(e,t,[1,1],!1)}function WT(e,t){return Q0(e,t,[2,2],!0,"valid")}function vct(e,t){function n(d,p,h){var g=e(d),y=g.length/(p*h*h);if(Out(y))throw new Error("depth has to be an integer: "+y+", weights.length: "+g.length+", numFilters: "+p+", filterSize: "+h);return ve(function(){return Gi(lo(g,[p,y,h,h]),[2,3,1,0])})}function r(d,p,h,g){var y=n(d,p,h),x=eo(e(p));return t.push({paramPath:g+"/filters"},{paramPath:g+"/bias"}),{filters:y,bias:x}}function o(d,p){var h=eo(e(d)),g=eo(e(d));return t.push({paramPath:p+"/weights"},{paramPath:p+"/biases"}),{weights:h,biases:g}}function i(d,p,h,g){var y=r(d,p,h,g+"/conv"),x=o(p,g+"/scale");return{conv:y,scale:x}}function l(d,p,h,g,y){y===void 0&&(y=!1);var x=i((y?.5:1)*d,p,h,g+"/conv1"),C=i(d,p,h,g+"/conv2");return{conv1:x,conv2:C}}return{extractConvLayerParams:i,extractResidualLayerParams:l}}function yct(e){var t=cu(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=vct(n,o),l=i.extractConvLayerParams,d=i.extractResidualLayerParams,p=l(4704,32,7,"conv32_down"),h=d(9216,32,3,"conv32_1"),g=d(9216,32,3,"conv32_2"),y=d(9216,32,3,"conv32_3"),x=d(36864,64,3,"conv64_down",!0),C=d(36864,64,3,"conv64_1"),_=d(36864,64,3,"conv64_2"),k=d(36864,64,3,"conv64_3"),A=d(147456,128,3,"conv128_down",!0),I=d(147456,128,3,"conv128_1"),N=d(147456,128,3,"conv128_2"),D=d(589824,256,3,"conv256_down",!0),M=d(589824,256,3,"conv256_1"),F=d(589824,256,3,"conv256_2"),W=d(589824,256,3,"conv256_down_out"),L=ve(function(){return Gi(Up(n(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var X={conv32_down:p,conv32_1:h,conv32_2:g,conv32_3:y,conv64_down:x,conv64_1:C,conv64_2:_,conv64_3:k,conv128_down:A,conv128_1:I,conv128_2:N,conv256_down:D,conv256_1:M,conv256_2:F,conv256_down_out:W,fc:L};return{params:X,paramMappings:o}}function bct(e,t){var n=Tc(e,t);function r(l){var d=n(l+"/scale/weights",1),p=n(l+"/scale/biases",1);return{weights:d,biases:p}}function o(l){var d=n(l+"/conv/filters",4),p=n(l+"/conv/bias",1),h=r(l);return{conv:{filters:d,bias:p},scale:h}}function i(l){return{conv1:o(l+"/conv1"),conv2:o(l+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function xct(e){var t=[],n=bct(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),l=o("conv32_1"),d=o("conv32_2"),p=o("conv32_3"),h=o("conv64_down"),g=o("conv64_1"),y=o("conv64_2"),x=o("conv64_3"),C=o("conv128_down"),_=o("conv128_1"),k=o("conv128_2"),A=o("conv256_down"),I=o("conv256_1"),N=o("conv256_2"),D=o("conv256_down_out"),M=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Mut(M))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+M);var F={conv32_down:i,conv32_1:l,conv32_2:d,conv32_3:p,conv64_down:h,conv64_1:g,conv64_2:y,conv64_3:x,conv128_down:C,conv128_1:_,conv128_2:k,conv256_down:A,conv256_1:I,conv256_2:N,conv256_down_out:D,fc:M};return uu(e,t),{params:F,paramMappings:t}}function ua(e,t){var n=gct(e,t.conv1);return n=LT(n,t.conv2),n=nn(n,e),n=po(n),n}function Ff(e,t){var n=WT(e,t.conv1);n=LT(n,t.conv2);var r=Hp(e,2,2,"valid"),o=Fn(r.shape),i=r.shape[3]!==n.shape[3],l=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(l){var d=n.shape.slice();d[1]=1;var p=Fn(d);n=oo([n,p],1);var h=n.shape.slice();h[2]=1;var g=Fn(h);n=oo([n,g],2)}return r=i?oo([r,o],3):r,n=nn(r,n),n=po(n),n}var wct=function(e){Ne(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ve(function(){var o=n.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],l=ah(o,i).div(Ot(256)),d=WT(l,r.conv32_down);d=Kl(d,3,2,"valid"),d=ua(d,r.conv32_1),d=ua(d,r.conv32_2),d=ua(d,r.conv32_3),d=Ff(d,r.conv64_down),d=ua(d,r.conv64_1),d=ua(d,r.conv64_2),d=ua(d,r.conv64_3),d=Ff(d,r.conv128_down),d=ua(d,r.conv128_1),d=ua(d,r.conv128_2),d=Ff(d,r.conv256_down),d=ua(d,r.conv256_1),d=ua(d,r.conv256_2),d=Ff(d,r.conv256_down_out);var p=d.mean([1,2]),h=Vp(p,r.fc);return h})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return xe(this,void 0,void 0,function(){var r,o,i,l=this;return we(this,function(d){switch(d.label){case 0:return[4,zr(n)];case 1:return r=d.sent(),o=ve(function(){return Wr(l.forwardInput(r))}),[4,Promise.all(o.map(function(p){return p.data()}))];case 2:return i=d.sent(),o.forEach(function(p){return p.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return xct(n)},t.prototype.extractParams=function(n){return yct(n)},t}(lu);function UT(e,t){var n={descriptor:t};return Object.assign({},e,n)}function Zl(e,t){var n={detection:t};return Object.assign({},e,n)}function zT(e,t){var n={expressions:t};return Object.assign({},e,n)}function ih(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),i=e.detection.imageDims,l=new Ca(e.detection.score,o.rescale(i.reverse()),i),d={landmarks:r,unshiftedLandmarks:t,alignedRect:l};return Object.assign({},e,d)}var VT=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,o=n.scaleFactor,i=n.maxNumScales,l=n.scoreThresholds,d=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=l||[.6,.7,.7],this._scaleSteps=d,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(p){return typeof p!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(p){return typeof p!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Cct(e,t){function n(p,h){var g=lo(e(9*p),[3,3,p,1]),y=eo(e(p)),x=eo(e(p)),C=eo(e(p)),_=eo(e(p));return t.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:g,batch_norm_scale:y,batch_norm_offset:x,batch_norm_mean:C,batch_norm_variance:_}}function r(p,h,g,y,x){var C=lo(e(p*h*g*g),[g,g,p,h]),_=eo(e(h));return t.push({paramPath:y+"/filters"},{paramPath:y+"/"+(x?"batch_norm_offset":"bias")}),{filters:C,bias:_}}function o(p,h,g,y){var x=r(p,h,g,y,!0),C=x.filters,_=x.bias;return{filters:C,batch_norm_offset:_}}function i(p,h,g){var y=n(p,g+"/depthwise_conv"),x=o(p,h,1,g+"/pointwise_conv");return{depthwise_conv:y,pointwise_conv:x}}function l(){var p=o(3,32,3,"mobilenetv1/conv_0"),h=i(32,64,"mobilenetv1/conv_1"),g=i(64,128,"mobilenetv1/conv_2"),y=i(128,128,"mobilenetv1/conv_3"),x=i(128,256,"mobilenetv1/conv_4"),C=i(256,256,"mobilenetv1/conv_5"),_=i(256,512,"mobilenetv1/conv_6"),k=i(512,512,"mobilenetv1/conv_7"),A=i(512,512,"mobilenetv1/conv_8"),I=i(512,512,"mobilenetv1/conv_9"),N=i(512,512,"mobilenetv1/conv_10"),D=i(512,512,"mobilenetv1/conv_11"),M=i(512,1024,"mobilenetv1/conv_12"),F=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:p,conv_1:h,conv_2:g,conv_3:y,conv_4:x,conv_5:C,conv_6:_,conv_7:k,conv_8:A,conv_9:I,conv_10:N,conv_11:D,conv_12:M,conv_13:F}}function d(){var p=o(1024,256,1,"prediction_layer/conv_0"),h=o(256,512,3,"prediction_layer/conv_1"),g=o(512,128,1,"prediction_layer/conv_2"),y=o(128,256,3,"prediction_layer/conv_3"),x=o(256,128,1,"prediction_layer/conv_4"),C=o(128,256,3,"prediction_layer/conv_5"),_=o(256,64,1,"prediction_layer/conv_6"),k=o(64,128,3,"prediction_layer/conv_7"),A=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),I=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),N=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),D=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),M=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),F=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),W=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),L=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),X=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),q=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),Q=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),it=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),at={box_encoding_predictor:A,class_predictor:I},ht={box_encoding_predictor:N,class_predictor:D},gt={box_encoding_predictor:M,class_predictor:F},Ct={box_encoding_predictor:W,class_predictor:L},pt={box_encoding_predictor:X,class_predictor:q},lt={box_encoding_predictor:Q,class_predictor:it};return{conv_0:p,conv_1:h,conv_2:g,conv_3:y,conv_4:x,conv_5:C,conv_6:_,conv_7:k,box_predictor_0:at,box_predictor_1:ht,box_predictor_2:gt,box_predictor_3:Ct,box_predictor_4:pt,box_predictor_5:lt}}return{extractMobilenetV1Params:l,extractPredictionLayerParams:d}}function Sct(e){var t=[],n=cu(e),r=n.extractWeights,o=n.getRemainingWeights,i=Cct(r,t),l=i.extractMobilenetV1Params,d=i.extractPredictionLayerParams,p=l(),h=d(),g=c0(r(5118*4),[1,5118,4]),y={extra_dim:g};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:p,prediction_layer:h,output_layer:y},paramMappings:t}}function _ct(e,t){var n=Tc(e,t);function r(h,g,y){var x=n(h+"/Conv2d_"+g+"_pointwise/weights",4,y+"/filters"),C=n(h+"/Conv2d_"+g+"_pointwise/convolution_bn_offset",1,y+"/batch_norm_offset");return{filters:x,batch_norm_offset:C}}function o(h){var g="mobilenetv1/conv_"+h,y="MobilenetV1/Conv2d_"+h+"_depthwise",x=g+"/depthwise_conv",C=g+"/pointwise_conv",_=n(y+"/depthwise_weights",4,x+"/filters"),k=n(y+"/BatchNorm/gamma",1,x+"/batch_norm_scale"),A=n(y+"/BatchNorm/beta",1,x+"/batch_norm_offset"),I=n(y+"/BatchNorm/moving_mean",1,x+"/batch_norm_mean"),N=n(y+"/BatchNorm/moving_variance",1,x+"/batch_norm_variance");return{depthwise_conv:{filters:_,batch_norm_scale:k,batch_norm_offset:A,batch_norm_mean:I,batch_norm_variance:N},pointwise_conv:r("MobilenetV1",h,C)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function l(h,g){var y=n(h+"/weights",4,g+"/filters"),x=n(h+"/biases",1,g+"/bias");return{filters:y,bias:x}}function d(h){var g=l("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),y=l("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:g,class_predictor:y}}function p(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:d(0),box_predictor_1:d(1),box_predictor_2:d(2),box_predictor_3:d(3),box_predictor_4:d(4),box_predictor_5:d(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:p}}function Ect(e){var t=[],n=_ct(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!rh(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var l={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return uu(e,t),{params:l,paramMappings:t}}function la(e,t,n){return ve(function(){var r=ts(e,t.filters,n,"same");return r=nn(r,t.batch_norm_offset),g0(r,0,6)})}var kct=.0010000000474974513;function Rct(e,t,n){return ve(function(){var r=y0(e,t.filters,n,"same");return r=ld(r,t.batch_norm_mean,t.batch_norm_variance,kct,t.batch_norm_scale,t.batch_norm_offset),g0(r,0,6)})}function Tct(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function Dct(e,t){return ve(function(){var n=null,r=la(e,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(i,l){var d=l+1,p=Tct(d);r=Rct(r,i.depthwise_conv,p),r=la(r,i.pointwise_conv,[1,1]),d===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Act(e,t,n,r,o){var i=e.shape[0],l=Math.min(n,i),d=t.map(function(g,y){return{score:g,boxIndex:y}}).filter(function(g){return g.score>o}).sort(function(g,y){return y.score-g.score}),p=function(g){return g<=r?1:0},h=[];return d.forEach(function(g){if(!(h.length>=l)){for(var y=g.score,x=h.length-1;x>=0;--x){var C=Ict(e,g.boxIndex,h[x]);if(C!==0&&(g.score*=p(C),g.score<=o))break}y===g.score&&h.push(g.boxIndex)}}),h}function Ict(e,t,n){var r=Math.min(e.get(t,0),e.get(t,2)),o=Math.min(e.get(t,1),e.get(t,3)),i=Math.max(e.get(t,0),e.get(t,2)),l=Math.max(e.get(t,1),e.get(t,3)),d=Math.min(e.get(n,0),e.get(n,2)),p=Math.min(e.get(n,1),e.get(n,3)),h=Math.max(e.get(n,0),e.get(n,2)),g=Math.max(e.get(n,1),e.get(n,3)),y=(i-r)*(l-o),x=(h-d)*(g-p);if(y<=0||x<=0)return 0;var C=Math.max(r,d),_=Math.max(o,p),k=Math.min(i,h),A=Math.min(l,g),I=Math.max(k-C,0)*Math.max(A-_,0);return I/(y+x-I)}function Nct(e){var t=Wr(Gi(e,[1,0])),n=[wa(t[2],t[0]),wa(t[3],t[1])],r=[nn(t[0],Ua(n[0],Ot(2))),nn(t[1],Ua(n[1],Ot(2)))];return{sizes:n,centers:r}}function Pct(e,t){var n=Nct(e),r=n.sizes,o=n.centers,i=Wr(Gi(t,[1,0])),l=Ua(qa(sv(Ua(i[2],Ot(5))),r[0]),Ot(2)),d=nn(qa(Ua(i[0],Ot(10)),r[0]),o[0]),p=Ua(qa(sv(Ua(i[3],Ot(5))),r[1]),Ot(2)),h=nn(qa(Ua(i[1],Ot(10)),r[1]),o[1]);return Gi(ya([wa(d,l),wa(h,p),nn(d,l),nn(h,p)]),[1,0])}function Mct(e,t,n){return ve(function(){var r=e.shape[0],o=Pct(Ho(Ju(n.extra_dim,[r,1,1]),[-1,4]),Ho(e,[-1,4]));o=Ho(o,[r,o.shape[0]/r,4]);var i=Ck(zs(t,[0,0,1],[-1,-1,-1])),l=zs(i,[0,0,0],[-1,-1,1]);l=Ho(l,[r,l.shape[1]]);var d=Wr(o),p=Wr(l);return{boxes:d,scores:p}})}function Uu(e,t){return ve(function(){var n=e.shape[0],r=Ho(jo(e,t.box_encoding_predictor),[n,-1,1,4]),o=Ho(jo(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function Oct(e,t,n){return ve(function(){var r=la(e,n.conv_0,[1,1]),o=la(r,n.conv_1,[2,2]),i=la(o,n.conv_2,[1,1]),l=la(i,n.conv_3,[2,2]),d=la(l,n.conv_4,[1,1]),p=la(d,n.conv_5,[2,2]),h=la(p,n.conv_6,[1,1]),g=la(h,n.conv_7,[2,2]),y=Uu(t,n.box_predictor_0),x=Uu(e,n.box_predictor_1),C=Uu(o,n.box_predictor_2),_=Uu(l,n.box_predictor_3),k=Uu(p,n.box_predictor_4),A=Uu(g,n.box_predictor_5),I=oo([y.boxPredictionEncoding,x.boxPredictionEncoding,C.boxPredictionEncoding,_.boxPredictionEncoding,k.boxPredictionEncoding,A.boxPredictionEncoding],1),N=oo([y.classPrediction,x.classPrediction,C.classPrediction,_.classPrediction,k.classPrediction,A.classPrediction],1);return{boxPredictions:I,classPredictions:N}})}var sh=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,o=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),HT=function(e){Ne(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ve(function(){var o=n.toBatchTensor(512,!1).toFloat(),i=wa(qa(o,Ot(.007843137718737125)),Ot(1)),l=Dct(i,r.mobilenetv1),d=Oct(l.out,l.conv11,r.prediction_layer),p=d.boxPredictions,h=d.classPredictions;return Mct(p,h,r.output_layer)})},t.prototype.forward=function(n){return xe(this,void 0,void 0,function(){var r;return we(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,zr(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D,M,F,W,L;return we(this,function(X){switch(X.label){case 0:return o=new sh(r),i=o.maxResults,l=o.minConfidence,[4,zr(n)];case 1:for(d=X.sent(),p=this.forwardInput(d),h=p.boxes,g=p.scores,y=h[0],x=g[0],C=1;C<h.length;C++)h[C].dispose(),g[C].dispose();return A=(k=Array).from,[4,x.data()];case 2:return _=A.apply(k,[X.sent()]),I=.5,N=Act(y,_,i,I,l),D=d.getReshapedInputDimensions(0),M=d.inputSize,F=M/D.width,W=M/D.height,L=N.map(function(q){var Q=[Math.max(0,y.get(q,0)),Math.min(1,y.get(q,2))].map(function(pt){return pt*W}),it=Q[0],at=Q[1],ht=[Math.max(0,y.get(q,1)),Math.min(1,y.get(q,3))].map(function(pt){return pt*F}),gt=ht[0],Ct=ht[1];return new Ca(_[q],new Y0(gt,it,Ct-gt,at-it),{height:d.getInputHeight(0),width:d.getInputWidth(0)})}),y.dispose(),x.dispose(),[2,L]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return Ect(n)},t.prototype.extractParams=function(n){return Sct(n)},t}(lu);(function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(HT);var GT=function(e){Ne(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(X0),uh=function(){function e(){}return e.prototype.then=function(t){return xe(this,void 0,void 0,function(){var n;return we(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return xe(this,void 0,void 0,function(){return we(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Fct(e){return ve(function(){return ya(Wr(e,3).reverse(),3)})}var $f=2,Cp=12;function $ct(e,t){var n=V0(e,t),r=CT(e,t);function o(h,g){var y=eo(e(h));return t.push({paramPath:g}),y}function i(h,g,y){y===void 0&&(y=!1);var x=n(h[0],h[1],3,g+"/conv1"),C=o(h[1],g+"/prelu1_alpha"),_=n(h[1],h[2],3,g+"/conv2"),k=o(h[2],g+"/prelu2_alpha"),A=n(h[2],h[3],y?2:3,g+"/conv3"),I=o(h[3],g+"/prelu3_alpha");return{conv1:x,prelu1_alpha:C,conv2:_,prelu2_alpha:k,conv3:A,prelu3_alpha:I}}function l(){var h=i([3,10,16,32],"pnet"),g=n(32,2,1,"pnet/conv4_1"),y=n(32,4,1,"pnet/conv4_2");return ba({},h,{conv4_1:g,conv4_2:y})}function d(){var h=i([3,28,48,64],"rnet",!0),g=r(576,128,"rnet/fc1"),y=o(128,"rnet/prelu4_alpha"),x=r(128,2,"rnet/fc2_1"),C=r(128,4,"rnet/fc2_2");return ba({},h,{fc1:g,prelu4_alpha:y,fc2_1:x,fc2_2:C})}function p(){var h=i([3,32,64,64],"onet"),g=n(64,128,2,"onet/conv4"),y=o(128,"onet/prelu4_alpha"),x=r(1152,256,"onet/fc1"),C=o(256,"onet/prelu5_alpha"),_=r(256,2,"onet/fc2_1"),k=r(256,4,"onet/fc2_2"),A=r(256,10,"onet/fc2_3");return ba({},h,{conv4:g,prelu4_alpha:y,fc1:x,prelu5_alpha:C,fc2_1:_,fc2_2:k,fc2_3:A})}return{extractPNetParams:l,extractRNetParams:d,extractONetParams:p}}function Bct(e){var t=cu(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=$ct(n,o),l=i.extractPNetParams,d=i.extractRNetParams,p=i.extractONetParams,h=l(),g=d(),y=p();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:h,rnet:g,onet:y},paramMappings:o}}function Lct(e,t){var n=Tc(e,t);function r(g){var y=n(g+"/weights",4,g+"/filters"),x=n(g+"/bias",1);return{filters:y,bias:x}}function o(g){var y=n(g+"/weights",2),x=n(g+"/bias",1);return{weights:y,bias:x}}function i(g){return n(g,1)}function l(g){var y=r(g+"/conv1"),x=i(g+"/prelu1_alpha"),C=r(g+"/conv2"),_=i(g+"/prelu2_alpha"),k=r(g+"/conv3"),A=i(g+"/prelu3_alpha");return{conv1:y,prelu1_alpha:x,conv2:C,prelu2_alpha:_,conv3:k,prelu3_alpha:A}}function d(){var g=l("pnet"),y=r("pnet/conv4_1"),x=r("pnet/conv4_2");return ba({},g,{conv4_1:y,conv4_2:x})}function p(){var g=l("rnet"),y=o("rnet/fc1"),x=i("rnet/prelu4_alpha"),C=o("rnet/fc2_1"),_=o("rnet/fc2_2");return ba({},g,{fc1:y,prelu4_alpha:x,fc2_1:C,fc2_2:_})}function h(){var g=l("onet"),y=r("onet/conv4"),x=i("onet/prelu4_alpha"),C=o("onet/fc1"),_=i("onet/prelu5_alpha"),k=o("onet/fc2_1"),A=o("onet/fc2_2"),I=o("onet/fc2_3");return ba({},g,{conv4:y,prelu4_alpha:x,fc1:C,prelu5_alpha:_,fc2_1:k,fc2_2:A,fc2_3:I})}return{extractPNetParams:d,extractRNetParams:p,extractONetParams:h}}function Wct(e){var t=[],n=Lct(e,t),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,l=r(),d=o(),p=i();return uu(e,t),{params:{pnet:l,rnet:d,onet:p},paramMappings:t}}function Fv(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function Uct(e,t,n){for(var r=n[0],o=n[1],i=Cp/e,l=[],d=Math.min(r,o)*i,p=0;d>=12;)l.push(i*Math.pow(t,p)),d=d*t,p+=1;return l}var J0=function(e){Ne(t,e);function t(n,r,o,i){return e.call(this,{left:n,top:r,right:o,bottom:i},!0)||this}return t}(Ki);function qT(e){return ve(function(){return qa(wa(e,Ot(127.5)),Ot(.0078125))})}function ac(e,t){return ve(function(){return nn(po(e),qa(t,up(po(up(e)))))})}function Z0(e,t,n){return n===void 0&&(n=!1),ve(function(){var r=jo(e,t.conv1,"valid");return r=ac(r,t.prelu1_alpha),r=Kl(r,n?[2,2]:[3,3],[2,2],"same"),r=jo(r,t.conv2,"valid"),r=ac(r,t.prelu2_alpha),r=n?r:Kl(r,[3,3],[2,2],"valid"),r=jo(r,t.conv3,"valid"),r=ac(r,t.prelu3_alpha),r})}function zct(e,t){return ve(function(){var n=Z0(e,t,!0),r=jo(n,t.conv4_1,"valid"),o=To(Gp(r,3),3),i=Ys(wa(r,o),3),l=jo(n,t.conv4_2,"valid");return{prob:i,regions:l}})}function Vct(e,t){return ve(function(){var n=Fv(t,e.shape.slice(1)),r=n.height,o=n.width,i=Vk.resizeBilinear(e,[r,o]),l=qT(i);return Gi(l,[0,2,1,3])})}function Hct(e,t,n,r){for(var o=[],i=0;i<e.shape[0];i++)for(var l=0;l<e.shape[1];l++)e.get(i,l)>=r&&o.push(new gn(l,i));var d=o.map(function(p){var h=new G0(Math.round((p.y*$f+1)/n),Math.round((p.x*$f+1)/n),Math.round((p.y*$f+Cp)/n),Math.round((p.x*$f+Cp)/n)),g=e.get(p.y,p.x),y=new J0(t.get(p.y,p.x,0),t.get(p.y,p.x,1),t.get(p.y,p.x,2),t.get(p.y,p.x,3));return{cell:h,score:g,region:y}});return d}function Gct(e,t,n,r,o){o.stage1=[];var i=t.map(function(x){return ve(function(){var C={scale:x},_=Vct(e,x),k=Date.now(),A=zct(_,r),I=A.prob,N=A.regions;C.pnet=Date.now()-k;var D=Wr(Wr(I,3)[1])[0],M=Wr(N)[0];return{scoresTensor:D,regionsTensor:M,scale:x,statsForScale:C}})}),l=i.map(function(x){var C=x.scoresTensor,_=x.regionsTensor,k=x.scale,A=x.statsForScale,I=Hct(C,_,k,n);if(C.dispose(),_.dispose(),!I.length)return o.stage1.push(A),[];var N=Date.now(),D=Jl(I.map(function(M){return M.cell}),I.map(function(M){return M.score}),.5);return A.nms=Date.now()-N,A.numBoxes=D.length,o.stage1.push(A),D.map(function(M){return I[M]})}),d=l.reduce(function(x,C){return x.concat(C)},[]),p=[],h=[];if(d.length>0){var g=Date.now(),y=Jl(d.map(function(x){return x.cell}),d.map(function(x){return x.score}),.7);o.stage1_nms=Date.now()-g,h=y.map(function(x){return d[x].score}),p=y.map(function(x){return d[x]}).map(function(x){var C=x.cell,_=x.region;return new G0(C.left+_.left*C.width,C.top+_.top*C.height,C.right+_.right*C.width,C.bottom+_.bottom*C.height).toSquare().round()})}return{boxes:p,scores:h}}function jT(e,t,n){var r=n.width,o=n.height;return xe(this,void 0,void 0,function(){var i,l,d,p=this;return we(this,function(h){switch(h.label){case 0:return i=Gs(e),[4,Promise.all(t.map(function(g){return xe(p,void 0,void 0,function(){var y,x,C,_,k,A,I,N;return we(this,function(D){return y=g.padAtBorders(e.height,e.width),x=y.y,C=y.ey,_=y.x,k=y.ex,A=_-1,I=x-1,N=i.getImageData(A,I,k-A,C-I),[2,Ur.isNodejs()?j0(N):createImageBitmap(N)]})})}))];case 1:return l=h.sent(),d=[],l.forEach(function(g){var y=oh({width:r,height:o}),x=Gs(y);x.drawImage(g,0,0,r,o);for(var C=x.getImageData(0,0,r,o).data,_=[],k=0;k<C.length;k+=4)_.push(C[k+2]),_.push(C[k+1]),_.push(C[k]);d.push(_)}),[2,d.map(function(g){var y=ve(function(){var x=Gi(lo(g,[1,r,o,3]),[0,2,1,3]).toFloat();return qT(x)});return y})]}})})}function qct(e,t){return ve(function(){var n=Z0(e,t),r=Ho(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Wi(r,t.fc1),i=ac(o,t.prelu4_alpha),l=Wi(i,t.fc2_1),d=To(Gp(l,1),1),p=Ys(wa(l,d),1),h=Wi(i,t.fc2_2),g=Wr(p,1)[1];return{scores:g,regions:h}})}function jct(e,t,n,r,o){return xe(this,void 0,void 0,function(){var i,l,d,p,h,g,y,x,C,_,k,A,I,N;return we(this,function(D){switch(D.label){case 0:return i=Date.now(),[4,jT(e,t,{width:24,height:24})];case 1:return l=D.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),d=l.map(function(M){var F=qct(M,r);return M.dispose(),F}),o.stage2_rnet=Date.now()-i,p=d.length>1?oo(d.map(function(M){return M.scores})):d[0].scores,y=(g=Array).from,[4,p.data()];case 2:return h=y.apply(g,[D.sent()]),p.dispose(),x=h.map(function(M,F){return{score:M,idx:F}}).filter(function(M){return M.score>n}).map(function(M){var F=M.idx;return F}),C=x.map(function(M){return t[M]}),_=x.map(function(M){return h[M]}),k=[],A=[],C.length>0&&(i=Date.now(),I=Jl(C,_,.7),o.stage2_nms=Date.now()-i,N=I.map(function(M){return new J0(d[x[M]].regions.get(0,0),d[x[M]].regions.get(0,1),d[x[M]].regions.get(0,2),d[x[M]].regions.get(0,3))}),A=I.map(function(M){return _[M]}),k=I.map(function(M,F){return C[M].calibrate(N[F])})),d.forEach(function(M){M.regions.dispose(),M.scores.dispose()}),[2,{boxes:k,scores:A}]}})})}function Kct(e,t){return ve(function(){var n=Z0(e,t);n=Kl(n,[2,2],[2,2],"same"),n=jo(n,t.conv4,"valid"),n=ac(n,t.prelu4_alpha);var r=Ho(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Wi(r,t.fc1),i=ac(o,t.prelu5_alpha),l=Wi(i,t.fc2_1),d=To(Gp(l,1),1),p=Ys(wa(l,d),1),h=Wi(i,t.fc2_2),g=Wi(i,t.fc2_3),y=Wr(p,1)[1];return{scores:y,regions:h,points:g}})}function Xct(e,t,n,r,o){return xe(this,void 0,void 0,function(){var i,l,d,p,h,g,y,x,C,_,k,A,I,N,D;return we(this,function(M){switch(M.label){case 0:return i=Date.now(),[4,jT(e,t,{width:48,height:48})];case 1:return l=M.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),d=l.map(function(F){var W=Kct(F,r);return F.dispose(),W}),o.stage3_onet=Date.now()-i,p=d.length>1?oo(d.map(function(F){return F.scores})):d[0].scores,y=(g=Array).from,[4,p.data()];case 2:return h=y.apply(g,[M.sent()]),p.dispose(),x=h.map(function(F,W){return{score:F,idx:W}}).filter(function(F){return F.score>n}).map(function(F){var W=F.idx;return W}),C=x.map(function(F){return new J0(d[F].regions.get(0,0),d[F].regions.get(0,1),d[F].regions.get(0,2),d[F].regions.get(0,3))}),_=x.map(function(F,W){return t[F].calibrate(C[W])}),k=x.map(function(F){return h[F]}),A=[],I=[],N=[],_.length>0&&(i=Date.now(),D=Jl(_,k,.7,!1),o.stage3_nms=Date.now()-i,A=D.map(function(F){return _[F]}),I=D.map(function(F){return k[F]}),N=D.map(function(F,W){return Array(5).fill(0).map(function(L,X){return new gn(d[F].points.get(0,X)*(A[W].width+1)+A[W].left,d[F].points.get(0,X+5)*(A[W].height+1)+A[W].top)})})),d.forEach(function(F){F.regions.dispose(),F.scores.dispose(),F.points.dispose()}),[2,{boxes:A,scores:I,points:N}]}})})}var Yct=function(e){Ne(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var o,i,l,d,p,h,g,y,x,C,_,k,A,I,N,D,M,F,W,L,X;return we(this,function(q){switch(q.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=n.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return l={},d=Date.now(),p=ve(function(){return Fct(To(yk(i)).toFloat())}),h=function(Q){return p.dispose(),l.total=Date.now()-d,Q},g=p.shape.slice(1),y=g[0],x=g[1],C=new VT(r),_=C.minFaceSize,k=C.scaleFactor,A=C.maxNumScales,I=C.scoreThresholds,N=C.scaleSteps,D=(N||Uct(_,k,[y,x])).filter(function(Q){var it=Fv(Q,[y,x]);return Math.min(it.width,it.height)>Cp}).slice(0,A),l.scales=D,l.pyramid=D.map(function(Q){return Fv(Q,[y,x])}),M=Date.now(),[4,Gct(p,D,I[0],o.pnet,l)];case 1:return F=q.sent(),l.total_stage1=Date.now()-M,F.boxes.length?(l.stage2_numInputBoxes=F.boxes.length,M=Date.now(),[4,jct(i,F.boxes,I[1],o.rnet,l)]):[2,h({results:[],stats:l})];case 2:return W=q.sent(),l.total_stage2=Date.now()-M,W.boxes.length?(l.stage3_numInputBoxes=W.boxes.length,M=Date.now(),[4,Xct(i,W.boxes,I[2],o.onet,l)]):[2,h({results:[],stats:l})];case 3:return L=q.sent(),l.total_stage3=Date.now()-M,X=L.boxes.map(function(Q,it){return ih(Zl({},new Ca(L.scores[it],new Y0(Q.left/x,Q.top/y,Q.width/x,Q.height/y),{height:y,width:x})),new rct(L.points[it].map(function(at){return at.sub(new gn(Q.left,Q.top)).div(new gn(Q.width,Q.height))}),{width:Q.width,height:Q.height}))}),[2,h({results:X,stats:l})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,zr(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,zr(n)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return Wct(n)},t.prototype.extractParams=function(n){return Bct(n)},t}(lu),Qct=.4,Jct=[new gn(1.603231,2.094468),new gn(6.041143,7.080126),new gn(2.882459,3.518061),new gn(4.266906,5.178857),new gn(9.041765,10.66308)],Zct=[117.001,114.697,97.404],tlt=function(e){Ne(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:Qct,classes:["face"],anchors:Jct,meanRgb:Zct,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return xe(this,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(l){return new Ca(l.score,l.relativeBox,{width:l.imageWidth,height:l.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(NT),elt=.4,nlt=[new gn(.738768,.874946),new gn(2.42204,2.65704),new gn(4.30971,7.04493),new gn(10.246,4.59428),new gn(12.6868,11.8741)],rlt=[new gn(1.603231,2.094468),new gn(6.041143,7.080126),new gn(2.882459,3.518061),new gn(4.266906,5.178857),new gn(9.041765,10.66308)],olt=[117.001,114.697,97.404],alt="tiny_yolov2_model",ilt="tiny_yolov2_separable_conv_model",slt=function(e){Ne(t,e);function t(n){n===void 0&&(n=!0);var r=this,o=Object.assign({},{withSeparableConvs:n,iouThreshold:elt,classes:["face"]},n?{anchors:rlt,meanRgb:olt}:{anchors:nlt,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return xe(this,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(l){return new Ca(l.score,l.relativeBox,{width:l.imageWidth,height:l.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?ilt:alt},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(NT),Go={ssdMobilenetv1:new HT,tinyFaceDetector:new tlt,tinyYolov2:new slt,mtcnn:new Yct,faceLandmark68Net:new BT,faceLandmark68TinyNet:new hct,faceRecognitionNet:new wct,faceExpressionNet:new lct},KT=function(e){Ne(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(uh),ult=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l,d=this;return we(this,function(p){switch(p.label){case 0:return[4,this.parentTask];case 1:return n=p.sent(),r=n.map(function(h){var g=h.alignedRect;return g}),this.input instanceof zt?[4,Ac(this.input,r)]:[3,3];case 2:return i=p.sent(),[3,5];case 3:return[4,Dc(this.input,r)];case 4:i=p.sent(),p.label=5;case 5:return o=i,[4,Promise.all(n.map(function(h,g){return xe(d,void 0,void 0,function(){var y;return we(this,function(x){switch(x.label){case 0:return[4,Go.faceRecognitionNet.computeFaceDescriptor(o[g])];case 1:return y=x.sent(),[2,UT(h,y)]}})})}))];case 6:return l=p.sent(),o.forEach(function(h){return h instanceof zt&&h.dispose()}),[2,l]}})})},t}(KT),clt=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l;return we(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return n=d.sent(),n?(r=n.alignedRect,this.input instanceof zt?[4,Ac(this.input,[r])]:[3,3]):[2];case 2:return i=d.sent(),[3,5];case 3:return[4,Dc(this.input,[r])];case 4:i=d.sent(),d.label=5;case 5:return o=i,[4,Go.faceRecognitionNet.computeFaceDescriptor(o[0])];case 6:return l=d.sent(),o.forEach(function(p){return p instanceof zt&&p.dispose()}),[2,UT(n,l)]}})})},t}(KT),XT=function(e){Ne(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Go.faceLandmark68TinyNet:Go.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(uh),YT=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l,d=this;return we(this,function(p){switch(p.label){case 0:return[4,this.parentTask];case 1:return n=p.sent(),r=n.map(function(h){return h.detection}),this.input instanceof zt?[4,Ac(this.input,r)]:[3,3];case 2:return i=p.sent(),[3,5];case 3:return[4,Dc(this.input,r)];case 4:i=p.sent(),p.label=5;case 5:return o=i,[4,Promise.all(o.map(function(h){return d.landmarkNet.detectLandmarks(h)}))];case 6:return l=p.sent(),o.forEach(function(h){return h instanceof zt&&h.dispose()}),[2,n.map(function(h,g){return ih(h,l[g])})]}})})},t.prototype.withFaceDescriptors=function(){return new ult(this,this.input)},t}(XT),QT=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l;return we(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return n=d.sent(),n?(r=n.detection,this.input instanceof zt?[4,Ac(this.input,[r])]:[3,3]):[2];case 2:return i=d.sent(),[3,5];case 3:return[4,Dc(this.input,[r])];case 4:i=d.sent(),d.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return l=d.sent(),o.forEach(function(p){return p instanceof zt&&p.dispose()}),[2,ih(n,l)]}})})},t.prototype.withFaceDescriptor=function(){return new clt(this,this.input)},t}(XT),JT=function(e){Ne(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(uh),llt=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l;return we(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return n=d.sent(),r=n.map(function(p){return p.detection}),this.input instanceof zt?[4,Ac(this.input,r)]:[3,3];case 2:return i=d.sent(),[3,5];case 3:return[4,Dc(this.input,r)];case 4:i=d.sent(),d.label=5;case 5:return o=i,[4,Promise.all(o.map(function(p){return Go.faceExpressionNet.predictExpressions(p)}))];case 6:return l=d.sent(),o.forEach(function(p){return p instanceof zt&&p.dispose()}),[2,n.map(function(p,h){return zT(p,l[h])})]}})})},t.prototype.withFaceLandmarks=function(){return new YT(this,this.input,!1)},t}(JT),dlt=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i,l;return we(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return n=d.sent(),n?(r=n.detection,this.input instanceof zt?[4,Ac(this.input,[r])]:[3,3]):[2];case 2:return i=d.sent(),[3,5];case 3:return[4,Dc(this.input,[r])];case 4:i=d.sent(),d.label=5;case 5:return o=i,[4,Go.faceExpressionNet.predictExpressions(o[0])];case 6:return l=d.sent(),o.forEach(function(p){return p instanceof zt&&p.dispose()}),[2,zT(n,l)]}})})},t.prototype.withFaceLandmarks=function(){return new QT(this,this.input,!1)},t}(JT),ZT=function(e){Ne(t,e);function t(n,r){r===void 0&&(r=new sh);var o=e.call(this)||this;return o.input=n,o.options=r,o}return t}(uh),tD=function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r,o,i;return we(this,function(l){switch(l.label){case 0:return n=this,r=n.input,o=n.options,o instanceof VT?[4,Go.mtcnn.forward(r,o)]:[3,2];case 1:return[2,l.sent().map(function(d){return d.detection})];case 2:if(i=o instanceof GT?function(d){return Go.tinyFaceDetector.locateFaces(d,o)}:o instanceof sh?function(d){return Go.ssdMobilenetv1.locateFaces(d,o)}:o instanceof X0?function(d){return Go.tinyYolov2.locateFaces(d,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return xe(n,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(l){return Zl({},l)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new YT(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new llt(this.runAndExtendWithFaceDetections(),this.input)},t}(ZT);(function(e){Ne(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var n,r;return we(this,function(o){switch(o.label){case 0:return[4,new tD(this.input,this.options)];case 1:return n=o.sent(),r=n[0],n.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return xe(n,void 0,void 0,function(){var o;return we(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Zl({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new QT(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new dlt(this.runAndExtendWithFaceDetection(),this.input)},t})(ZT);function flt(e,t){return t===void 0&&(t=new sh),new tD(e,t)}function plt(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(l){if(l instanceof Dg)return l;if(l instanceof Float32Array)return new Dg(i(),[l]);if(l.descriptor&&l.descriptor instanceof Float32Array)return new Dg(i(),[l.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return plt(r,t)}).reduce(function(r,o){return r+o},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new jS(i,n.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new jS("unknown",n.distance)},e})();function eD(e,t){var n=t.width,r=t.height;if(Array.isArray(e))return e.map(function(p){return eD(p,{width:n,height:r})});var o=e.unshiftedLandmarks&&e.unshiftedLandmarks instanceof wp,i=e.detection&&e.detection instanceof Ca;if(o){var l=e.detection.forSize(n,r),d=e.unshiftedLandmarks.forSize(l.box.width,l.box.height);return ih(Zl(e,l),d)}return i?Zl(e,e.detection.forSize(n,r)):e instanceof wp||e instanceof Ca?e.forSize(n,r):e}var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hlt(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}function mlt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var yl={exports:{}};const glt={},vlt=Object.freeze(Object.defineProperty({__proto__:null,default:glt},Symbol.toStringTag,{value:"Module"})),KS=hlt(vlt);var ylt=yl.exports,XS;function blt(){return XS||(XS=1,function(e,t){(function(n,r){r(t)})(ylt,function(n){/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,a){u.__proto__=a}||function(u,a){for(var s in a)a.hasOwnProperty(s)&&(u[s]=a[s])};function o(u,a){function s(){this.constructor=u}r(u,a),u.prototype=a===null?Object.create(a):(s.prototype=a.prototype,new s)}var i=Object.assign||function(u){for(var a,s=1,c=arguments.length;s<c;s++)for(var f in a=arguments[s])Object.prototype.hasOwnProperty.call(a,f)&&(u[f]=a[f]);return u};function l(u,a,s,c){return new(s||(s=Promise))(function(f,m){function v(S){try{w(c.next(S))}catch(E){m(E)}}function b(S){try{w(c.throw(S))}catch(E){m(E)}}function w(S){S.done?f(S.value):new s(function(E){E(S.value)}).then(v,b)}w((c=c.apply(u,[])).next())})}function d(u,a){var s,c,f,m,v={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return m={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function b(w){return function(S){return function(E){if(s)throw new TypeError("Generator is already executing.");for(;v;)try{if(s=1,c&&(f=2&E[0]?c.return:E[0]?c.throw||((f=c.return)&&f.call(c),0):c.next)&&!(f=f.call(c,E[1])).done)return f;switch(c=0,f&&(E=[2&E[0],f.value]),E[0]){case 0:case 1:f=E;break;case 4:return v.label++,{value:E[1],done:!1};case 5:v.label++,c=E[1],E=[0];continue;case 7:E=v.ops.pop(),v.trys.pop();continue;default:if(!(f=(f=v.trys).length>0&&f[f.length-1])&&(E[0]===6||E[0]===2)){v=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){v.label=E[1];break}if(E[0]===6&&v.label<f[1]){v.label=f[1],f=E;break}if(f&&v.label<f[2]){v.label=f[2],v.ops.push(E);break}f[2]&&v.ops.pop(),v.trys.pop();continue}E=a.call(u,v)}catch(R){E=[6,R],c=0}finally{s=f=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([w,S])}}}var p={},h={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function g(u){u in p||(document.createElement("canvas").addEventListener("webglcontextlost",function(s){s.preventDefault(),delete p[u]},!1),p[u]=y(u));var a=p[u];return a.isContextLost()?(delete p[u],g(u)):(a.disable(a.DEPTH_TEST),a.disable(a.STENCIL_TEST),a.disable(a.BLEND),a.disable(a.DITHER),a.disable(a.POLYGON_OFFSET_FILL),a.disable(a.SAMPLE_COVERAGE),a.enable(a.SCISSOR_TEST),a.enable(a.CULL_FACE),a.cullFace(a.BACK),p[u])}function y(u){if(u!==1&&u!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var a=document.createElement("canvas");return u===1?a.getContext("webgl",h)||a.getContext("experimental-webgl",h):a.getContext("webgl2",h)}function x(){var u=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,4))}function C(u){for(var a=u.length,s=0,c=0;a>0;)c=Math.random()*a|0,s=u[--a],u[a]=u[c],u[c]=s}function _(u,a,s){return Math.max(u,Math.min(a,s))}function k(u){return u%2==0?u:u+1}function A(u){for(var a=0,s=0;s<u.length;s++)a+=u[s];return a}function I(u,a){var s=Math.random();return a*s+(1-s)*u}function N(u,a){for(var s=0,c=0;c<u.length;c++){var f=Number(u[c])-Number(a[c]);s+=f*f}return s}function D(u,a){if(!u)throw new Error(typeof a=="string"?a:a())}function M(u,a,s){s===void 0&&(s=""),D(q(u,a),s+" Shapes "+u+" and "+a+" must match")}function F(u){D(u!=null,"The input to the tensor constructor must be a non-null value.")}function W(u,a){if(a===void 0&&(a=[]),Array.isArray(u)||Zt(u))for(var s=0;s<u.length;++s)W(u[s],a);else a.push(u);return a}function L(u){if(u.length===0)return 1;for(var a=u[0],s=1;s<u.length;s++)a*=u[s];return a}function X(u){return u.length===0}function q(u,a){if(u===a)return!0;if(u==null||a==null||u.length!==a.length)return!1;for(var s=0;s<u.length;s++)if(u[s]!==a[s])return!1;return!0}function Q(u){return u%1==0}function it(u){if(Math.tanh!=null)return Math.tanh(u);if(u===1/0)return 1;if(u===-1/0)return-1;var a=Math.exp(2*u);return(a-1)/(a+1)}function at(u){for(var a=Math.floor(Math.sqrt(u));a>1;--a)if(u%a==0)return[a,u/a];return[1,u]}function ht(u){for(var a=new Uint32Array(u),s=0;s<u;++s)a[s]=s;return C(a),a}function gt(u,a){return a<=u.length?u:u+" ".repeat(a-u.length)}function Ct(u,a,s){return a===void 0&&(a=function(c){return 0}),new Promise(function(c,f){var m=0,v=function(){if(u())c();else{var b=a(++m);s!=null&&m>=s?f():setTimeout(v,b)}};v()})}function pt(u,a){for(var s=1,c=-1,f=0;f<u.length;++f)if(u[f]>=0)s*=u[f];else if(u[f]===-1){if(c!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+c+" and dim "+f);c=f}else if(u[f]<0)throw Error("Shapes can not be < 0. Found "+u[f]+" at dim "+f);if(c===-1){if(a>0&&a!==s)throw Error("Size("+a+") must match the product of shape "+u);return u}if(s===0)throw Error("Cannot infer the missing size in ["+u+"] when there are 0 elements");if(a%s!=0)throw Error("The implicit shape can't be a fractional number. Got "+a+" / "+s);var m=u.slice();return m[c]=a/s,m}function lt(u,a){for(var s=[],c=[],f=0,m=0;m<u.length;++m){if(a!=null){if(a[f]===m&&u[m]!==1)throw new Error("Can't squeeze axis "+m+" since its dim '"+u[m]+"' is not 1");(a[f]==null||a[f]>m)&&u[m]===1&&(s.push(u[m]),c.push(m)),a[f]<=m&&f++}u[m]!==1&&(s.push(u[m]),c.push(m))}return{newShape:s,keptDims:c}}function ft(u,a){var s=null;if(u==null||u==="float32")s=new Float32Array(a);else if(u==="int32")s=new Int32Array(a);else{if(u!=="bool")throw new Error("Unknown data type "+u);s=new Uint8Array(a)}return s}function Tt(u,a){var s=null;if(u==null||u==="float32")s=new Float32Array(a);else if(u==="int32")s=new Int32Array(a);else if(u==="bool")s=new Uint8Array(a);else{if(u!=="string")throw new Error("Unknown data type "+u);s=new Array(a)}return s}function Pt(u,a,s){if(a==="float32"){for(var c=0;c<u.length;c++)if(isNaN(u[c]))throw Error("The result of the '"+s+"' has NaNs.")}}function Bt(u,a){if(a!=="float32"){for(var s=0;s<u.length;s++)if(isNaN(u[s]))throw Error("NaN is not a valid value for dtype: '"+a+"'.")}}function Ut(u,a){return a!=="complex64"&&(a!=="float32"||u==="complex64")&&(a!=="int32"||u==="float32"||u==="complex64")&&(a!=="bool"||u!=="bool")}function Zt(u){return u instanceof Float32Array||u instanceof Int32Array||u instanceof Uint8Array}function Xt(u){if(u==="float32"||u==="int32")return 4;if(u==="complex64")return 8;if(u==="bool")return 1;throw new Error("Unknown dtype "+u)}function ce(u){if(u==null)return 0;var a=0;return u.forEach(function(s){return a+=2*s.length}),a}function fe(u){return typeof u=="string"||u instanceof String}function se(u){return typeof u=="boolean"}function jt(u){return typeof u=="number"}function Pe(u){return u instanceof Array?Pe(u[0]):u instanceof Float32Array?"float32":u instanceof Int32Array||u instanceof Uint8Array?"int32":jt(u)?"float32":fe(u)?"string":se(u)?"bool":"float32"}function re(u){return!!(u&&u.constructor&&u.call&&u.apply)}function _e(u,a){for(var s=a;s<u;++s)if(u%s==0)return s;return u}function Y(u){var a=u.length;if(a<2)return[];var s=new Array(a-1);s[a-2]=u[a-1];for(var c=a-3;c>=0;--c)s[c]=s[c+1]*u[c+1];return s}function nt(u,a,s){if(a==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(mt(u,a))return u;if(Array.isArray(u)&&(u=W(u)),a==null||a==="float32"||a==="complex64")return new Float32Array(u);if(a==="int32")return s&&Bt(u,a),new Int32Array(u);if(a==="bool"){for(var c=new Uint8Array(u.length),f=0;f<c.length;++f)Math.round(u[f])!==0&&(c[f]=1);return c}throw new Error("Unknown data type "+a)}function mt(u,a){return u instanceof Float32Array&&a==="float32"||u instanceof Int32Array&&a==="int32"||u instanceof Uint8Array&&a==="bool"}function Et(u,a){for(var s=St(u,a),c=0;c<s.length;c++)s[c]=1;return s}function St(u,a){if(a==null||a==="float32"||a==="complex64")return new Float32Array(u);if(a==="int32")return new Int32Array(u);if(a==="bool")return new Uint8Array(u);throw new Error("Unknown data type "+a)}function Dt(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var u=process.hrtime();return 1e3*u[0]+u[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}var $t=Object.freeze({shuffle:C,clamp:_,nearestLargerEven:k,sum:A,randUniform:I,distSquared:N,assert:D,assertShapesMatch:M,assertNonNull:F,flatten:W,sizeFromShape:L,isScalarShape:X,arraysEqual:q,isInt:Q,tanh:it,sizeToSquarishShape:at,createShuffledIndices:ht,rightPad:gt,repeatedTry:Ct,inferFromImplicitShape:pt,squeezeShape:lt,getTypedArrayFromDType:ft,getArrayFromDType:Tt,checkComputationForNaN:Pt,checkConversionForNaN:Bt,hasEncodingLoss:Ut,isTypedArray:Zt,bytesPerElement:Xt,bytesFromStringArray:ce,isString:fe,isBoolean:se,isNumber:jt,inferDtype:Pe,isFunction:re,nearestDivisor:_e,computeStrides:Y,toTypedArray:nt,makeOnesTypedArray:Et,makeZerosTypedArray:St,now:Dt}),Ft=function(){function u(a,s){this.backendTimer=a,this.logger=s,s==null&&(this.logger=new It)}return u.prototype.profileKernel=function(a,s){var c,f=this,m=this.backendTimer.time(function(){c=s()});return(Array.isArray(c)?c:[c]).forEach(function(v){var b=v.dataSync();Pt(b,v.dtype,a),m.then(function(w){var S="";w.getExtraProfileInfo!=null&&(S=w.getExtraProfileInfo()),f.logger.logKernelProfile(a,v,b,w.kernelMs,S)})}),c},u}(),It=function(){function u(){}return u.prototype.logKernelProfile=function(a,s,c,f,m){var v=gt(f+"ms",9),b=gt(a,25),w=s.rank,S=s.size,E=gt(s.shape.toString(),14);console.log("%c"+b+"	%c"+v+"	%c"+w+"D "+E+"	%c"+S+"	%c"+m,"font-weight:bold","color:red","color:blue","color: orange","color: green")},u}(),Rt=20,Ht=3,Wt=7;function Yt(u,a,s,c){var f=Y(a),m=he(u,a,s,f),v=a.length,b=Ee(u,a,s,f,m),w=["Tensor"];return c&&(w.push("  dtype: "+s),w.push("  rank: "+v),w.push("  shape: ["+a+"]"),w.push("  values:")),w.push(b.map(function(S){return"    "+S}).join(`
`)),w.join(`
`)}function he(u,a,s,c){var f=L(a),m=c[c.length-1],v=new Array(m).fill(0),b=a.length,w=s==="complex64"?$e(u):u;if(b>1)for(var S=0;S<f/m;S++)for(var E=S*m,R=0;R<m;R++)v[R]=Math.max(v[R],Ce(w[E+R],0).length);return v}function Ce(u,a){return gt(Array.isArray(u)?parseFloat(u[0].toFixed(Wt))+" + "+parseFloat(u[1].toFixed(Wt))+"j":fe(u)?"'"+u+"'":parseFloat(u.toFixed(Wt)).toString(),a)}function Ee(u,a,s,c,f,m){m===void 0&&(m=!0);var v=s==="complex64"?2:1,b=a[0],w=a.length;if(w===0)return s==="complex64"?[Ce($e(u)[0],0)]:[u[0].toString()];if(w===1){if(b>Rt){var S=Ht*v,E=Array.from(u.slice(0,S)),R=Array.from(u.slice(b-Ht*v,b));return s==="complex64"&&(E=$e(E),R=$e(R)),["["+E.map(function(J,dt){return Ce(J,f[dt])}).join(", ")+", ..., "+R.map(function(J,dt){return Ce(J,f[b-Ht+dt])}).join(", ")+"]"]}return["["+(s==="complex64"?$e(u):Array.from(u)).map(function(J,dt){return Ce(J,f[dt])}).join(", ")+"]"]}var T=a.slice(1),P=c.slice(1),O=c[0]*v,$=[];if(b>Rt){for(var B=0;B<Ht;B++){var U=(z=B*O)+O;$.push.apply($,Ee(u.slice(z,U),T,s,P,f,!1))}for($.push("..."),B=b-Ht;B<b;B++)U=(z=B*O)+O,$.push.apply($,Ee(u.slice(z,U),T,s,P,f,B===b-1))}else for(B=0;B<b;B++){var z;U=(z=B*O)+O,$.push.apply($,Ee(u.slice(z,U),T,s,P,f,B===b-1))}var j=w===2?",":"";for($[0]="["+$[0]+j,B=1;B<$.length-1;B++)$[B]=" "+$[B]+j;var K=`,
`;for(B=2;B<w;B++)K+=`
`;return $[$.length-1]=" "+$[$.length-1]+"]"+(m?"":K),$}function $e(u){for(var a=[],s=0;s<u.length;s+=2)a.push([u[s],u[s+1]]);return a}var Wn=function(){function u(a,s,c){if(this.dtype=s,this.shape=a.slice(),this.size=L(a),c!=null){var f=c.length;D(f===this.size,"Length of values '"+f+"' does not match the size inferred by the shape '"+this.size+"'.")}if(s==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=c||Tt(s,L(this.shape)),this.strides=Y(a)}return u.prototype.set=function(a){for(var s=[],c=1;c<arguments.length;c++)s[c-1]=arguments[c];s.length===0&&(s=[0]),D(s.length===this.rank,"The number of provided coordinates ("+s.length+") must match the rank ("+this.rank+")");var f=this.locToIndex(s);this.values[f]=a},u.prototype.get=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];a.length===0&&(a=[0]);for(var c=a[a.length-1],f=0;f<a.length-1;++f)c+=this.strides[f]*a[f];return this.values[c]},u.prototype.locToIndex=function(a){if(this.rank===0)return 0;if(this.rank===1)return a[0];for(var s=a[a.length-1],c=0;c<a.length-1;++c)s+=this.strides[c]*a[c];return s},u.prototype.indexToLoc=function(a){if(this.rank===0)return[];if(this.rank===1)return[a];for(var s=new Array(this.shape.length),c=0;c<s.length-1;++c)s[c]=Math.floor(a/this.strides[c]),a-=s[c]*this.strides[c];return s[s.length-1]=a,s},Object.defineProperty(u.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),u.prototype.toTensor=function(){return At.make(this.shape,{values:this.values},this.dtype)},u}(),sn=null,yt=null;function Vr(u){sn=u}function rs(u){yt=u}var At=function(){function u(a,s,c,f){this.isDisposedInternal=!1,this.shape=a.slice(),this.dtype=s||"float32",this.size=L(a),this.strides=Y(a),this.dataId=f??{},this.id=sn().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",sn().registerTensor(this),c!=null&&sn().write(this.dataId,c)}return u.make=function(a,s,c){return new u(a,c,s.values,s.dataId)},u.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},u.prototype.asScalar=function(){return this.throwIfDisposed(),D(this.size===1,"The array must have only 1 element."),this.reshape([])},u.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},u.prototype.as2D=function(a,s){return this.throwIfDisposed(),this.reshape([a,s])},u.prototype.as3D=function(a,s,c){return this.throwIfDisposed(),this.reshape([a,s,c])},u.prototype.as4D=function(a,s,c,f){return this.throwIfDisposed(),this.reshape([a,s,c,f])},u.prototype.as5D=function(a,s,c,f,m){return this.throwIfDisposed(),this.reshape([a,s,c,f,m])},u.prototype.asType=function(a){return this.throwIfDisposed(),yt.cast(this,a)},Object.defineProperty(u.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),u.prototype.get=function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];D(a.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),D(this.dtype!=="complex64","Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),a.length===0&&(a=[0]);for(var c=a[a.length-1],f=0;f<a.length-1;++f)c+=this.strides[f]*a[f];return this.dataSync()[c]},u.prototype.buffer=function(){return yt.buffer(this.shape,this.dtype,this.dataSync())},u.prototype.data=function(){return l(this,void 0,void 0,function(){return d(this,function(a){return this.throwIfDisposed(),[2,sn().read(this.dataId)]})})},u.prototype.dataSync=function(){return this.throwIfDisposed(),sn().readSync(this.dataId)},u.prototype.dispose=function(){this.isDisposed||(sn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(u.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),u.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},u.prototype.toFloat=function(){return this.asType("float32")},u.prototype.toInt=function(){return this.asType("int32")},u.prototype.toBool=function(){return this.asType("bool")},u.prototype.print=function(a){return a===void 0&&(a=!1),yt.print(this,a)},u.prototype.reshape=function(a){return this.throwIfDisposed(),yt.reshape(this,a)},u.prototype.reshapeAs=function(a){return this.throwIfDisposed(),this.reshape(a.shape)},u.prototype.expandDims=function(a){return a===void 0&&(a=0),yt.expandDims(this,a)},u.prototype.cumsum=function(a,s,c){return a===void 0&&(a=0),s===void 0&&(s=!1),c===void 0&&(c=!1),yt.cumsum(this,a,s,c)},u.prototype.squeeze=function(a){return this.throwIfDisposed(),yt.squeeze(this,a)},u.prototype.clone=function(){return this.throwIfDisposed(),yt.clone(this)},u.prototype.toString=function(a){return a===void 0&&(a=!1),Yt(this.dataSync(),this.shape,this.dtype,a)},u.prototype.tile=function(a){return this.throwIfDisposed(),yt.tile(this,a)},u.prototype.gather=function(a,s){return s===void 0&&(s=0),this.throwIfDisposed(),yt.gather(this,a,s)},u.prototype.matMul=function(a,s,c){return s===void 0&&(s=!1),c===void 0&&(c=!1),this.throwIfDisposed(),yt.matMul(this,a,s,c)},u.prototype.dot=function(a){return this.throwIfDisposed(),yt.dot(this,a)},u.prototype.norm=function(a,s,c){return a===void 0&&(a="euclidean"),s===void 0&&(s=null),c===void 0&&(c=!1),this.throwIfDisposed(),yt.norm(this,a,s,c)},u.prototype.slice=function(a,s){return this.throwIfDisposed(),yt.slice(this,a,s)},u.prototype.reverse=function(a){return this.throwIfDisposed(),yt.reverse(this,a)},u.prototype.concat=function(a,s){return s===void 0&&(s=0),this.throwIfDisposed(),a instanceof u&&(a=[a]),yt.concat([this].concat(a),s)},u.prototype.split=function(a,s){return s===void 0&&(s=0),this.throwIfDisposed(),yt.split(this,a,s)},u.prototype.stack=function(a,s){return s===void 0&&(s=0),yt.stack([this,a],s)},u.prototype.unstack=function(a,s){return s===void 0&&(s=0),yt.unstack(this,s)},u.prototype.pad=function(a,s){return s===void 0&&(s=0),yt.pad(this,a,s)},u.prototype.batchNormalization=function(a,s,c,f,m){return c===void 0&&(c=.001),this.throwIfDisposed(),yt.batchNormalization(this,a,s,c,f,m)},u.prototype.all=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.all(this,a,s)},u.prototype.any=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.any(this,a,s)},u.prototype.logSumExp=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.logSumExp(this,a,s)},u.prototype.sum=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.sum(this,a,s)},u.prototype.prod=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.prod(this,a,s)},u.prototype.mean=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.mean(this,a,s)},u.prototype.min=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.min(this,a,s)},u.prototype.max=function(a,s){return a===void 0&&(a=null),s===void 0&&(s=!1),this.throwIfDisposed(),yt.max(this,a,s)},u.prototype.argMin=function(a){return a===void 0&&(a=null),this.throwIfDisposed(),yt.argMin(this,a)},u.prototype.argMax=function(a){return a===void 0&&(a=null),this.throwIfDisposed(),yt.argMax(this,a)},u.prototype.cast=function(a){return this.throwIfDisposed(),yt.cast(this,a)},u.prototype.add=function(a){return this.throwIfDisposed(),yt.add(this,a)},u.prototype.addStrict=function(a){return this.throwIfDisposed(),yt.addStrict(this,a)},u.prototype.atan2=function(a){return this.throwIfDisposed(),yt.atan2(this,a)},u.prototype.sub=function(a){return this.throwIfDisposed(),yt.sub(this,a)},u.prototype.subStrict=function(a){return this.throwIfDisposed(),yt.subStrict(this,a)},u.prototype.pow=function(a){return this.throwIfDisposed(),yt.pow(this,a)},u.prototype.powStrict=function(a){return this.throwIfDisposed(),yt.powStrict(this,a)},u.prototype.mul=function(a){return this.throwIfDisposed(),yt.mul(this,a)},u.prototype.mulStrict=function(a){return this.throwIfDisposed(),yt.mulStrict(this,a)},u.prototype.div=function(a){return this.throwIfDisposed(),yt.div(this,a)},u.prototype.floorDiv=function(a){return this.throwIfDisposed(),yt.floorDiv(this,a)},u.prototype.divStrict=function(a){return this.throwIfDisposed(),yt.divStrict(this,a)},u.prototype.minimum=function(a){return this.throwIfDisposed(),yt.minimum(this,a)},u.prototype.minimumStrict=function(a){return this.throwIfDisposed(),yt.minimumStrict(this,a)},u.prototype.maximum=function(a){return this.throwIfDisposed(),yt.maximum(this,a)},u.prototype.maximumStrict=function(a){return this.throwIfDisposed(),yt.maximumStrict(this,a)},u.prototype.mod=function(a){return this.throwIfDisposed(),yt.mod(this,a)},u.prototype.modStrict=function(a){return this.throwIfDisposed(),yt.modStrict(this,a)},u.prototype.squaredDifference=function(a){return this.throwIfDisposed(),yt.squaredDifference(this,a)},u.prototype.squaredDifferenceStrict=function(a){return this.throwIfDisposed(),yt.squaredDifferenceStrict(this,a)},u.prototype.transpose=function(a){return this.throwIfDisposed(),yt.transpose(this,a)},u.prototype.notEqual=function(a){return this.throwIfDisposed(),yt.notEqual(this,a)},u.prototype.notEqualStrict=function(a){return this.throwIfDisposed(),yt.notEqualStrict(this,a)},u.prototype.less=function(a){return this.throwIfDisposed(),yt.less(this,a)},u.prototype.lessStrict=function(a){return this.throwIfDisposed(),yt.lessStrict(this,a)},u.prototype.equal=function(a){return this.throwIfDisposed(),yt.equal(this,a)},u.prototype.equalStrict=function(a){return this.throwIfDisposed(),yt.equalStrict(this,a)},u.prototype.lessEqual=function(a){return this.throwIfDisposed(),yt.lessEqual(this,a)},u.prototype.lessEqualStrict=function(a){return this.throwIfDisposed(),yt.lessEqualStrict(this,a)},u.prototype.greater=function(a){return this.throwIfDisposed(),yt.greater(this,a)},u.prototype.greaterStrict=function(a){return this.throwIfDisposed(),yt.greaterStrict(this,a)},u.prototype.greaterEqual=function(a){return this.throwIfDisposed(),yt.greaterEqual(this,a)},u.prototype.greaterEqualStrict=function(a){return this.throwIfDisposed(),yt.greaterEqualStrict(this,a)},u.prototype.logicalAnd=function(a){return this.throwIfDisposed(),yt.logicalAnd(this,a)},u.prototype.logicalOr=function(a){return this.throwIfDisposed(),yt.logicalOr(this,a)},u.prototype.logicalNot=function(){return this.throwIfDisposed(),yt.logicalNot(this)},u.prototype.logicalXor=function(a){return this.throwIfDisposed(),yt.logicalXor(this,a)},u.prototype.where=function(a,s){return this.throwIfDisposed(),yt.where(a,this,s)},u.prototype.neg=function(){return this.throwIfDisposed(),yt.neg(this)},u.prototype.ceil=function(){return this.throwIfDisposed(),yt.ceil(this)},u.prototype.floor=function(){return this.throwIfDisposed(),yt.floor(this)},u.prototype.sign=function(){return this.throwIfDisposed(),yt.sign(this)},u.prototype.exp=function(){return this.throwIfDisposed(),yt.exp(this)},u.prototype.expm1=function(){return this.throwIfDisposed(),yt.expm1(this)},u.prototype.log=function(){return this.throwIfDisposed(),yt.log(this)},u.prototype.log1p=function(){return this.throwIfDisposed(),yt.log1p(this)},u.prototype.sqrt=function(){return this.throwIfDisposed(),yt.sqrt(this)},u.prototype.rsqrt=function(){return this.throwIfDisposed(),yt.rsqrt(this)},u.prototype.square=function(){return this.throwIfDisposed(),yt.square(this)},u.prototype.reciprocal=function(){return this.throwIfDisposed(),yt.reciprocal(this)},u.prototype.abs=function(){return this.throwIfDisposed(),yt.abs(this)},u.prototype.clipByValue=function(a,s){return this.throwIfDisposed(),yt.clipByValue(this,a,s)},u.prototype.relu=function(){return this.throwIfDisposed(),yt.relu(this)},u.prototype.elu=function(){return this.throwIfDisposed(),yt.elu(this)},u.prototype.selu=function(){return this.throwIfDisposed(),yt.selu(this)},u.prototype.leakyRelu=function(a){return a===void 0&&(a=.2),this.throwIfDisposed(),yt.leakyRelu(this,a)},u.prototype.prelu=function(a){return this.throwIfDisposed(),yt.prelu(this,a)},u.prototype.sigmoid=function(){return this.throwIfDisposed(),yt.sigmoid(this)},u.prototype.logSigmoid=function(){return this.throwIfDisposed(),yt.logSigmoid(this)},u.prototype.softplus=function(){return this.throwIfDisposed(),yt.softplus(this)},u.prototype.zerosLike=function(){return this.throwIfDisposed(),yt.zerosLike(this)},u.prototype.onesLike=function(){return this.throwIfDisposed(),yt.onesLike(this)},u.prototype.sin=function(){return this.throwIfDisposed(),yt.sin(this)},u.prototype.cos=function(){return this.throwIfDisposed(),yt.cos(this)},u.prototype.tan=function(){return this.throwIfDisposed(),yt.tan(this)},u.prototype.asin=function(){return this.throwIfDisposed(),yt.asin(this)},u.prototype.acos=function(){return this.throwIfDisposed(),yt.acos(this)},u.prototype.atan=function(){return this.throwIfDisposed(),yt.atan(this)},u.prototype.sinh=function(){return this.throwIfDisposed(),yt.sinh(this)},u.prototype.cosh=function(){return this.throwIfDisposed(),yt.cosh(this)},u.prototype.tanh=function(){return this.throwIfDisposed(),yt.tanh(this)},u.prototype.asinh=function(){return this.throwIfDisposed(),yt.asinh(this)},u.prototype.acosh=function(){return this.throwIfDisposed(),yt.acosh(this)},u.prototype.atanh=function(){return this.throwIfDisposed(),yt.atanh(this)},u.prototype.erf=function(){return this.throwIfDisposed(),yt.erf(this)},u.prototype.round=function(){return this.throwIfDisposed(),yt.round(this)},u.prototype.step=function(a){return a===void 0&&(a=0),this.throwIfDisposed(),yt.step(this,a)},u.prototype.softmax=function(a){return a===void 0&&(a=-1),this.throwIfDisposed(),yt.softmax(this,a)},u.prototype.logSoftmax=function(a){return a===void 0&&(a=-1),this.throwIfDisposed(),yt.logSoftmax(this,a)},u.prototype.resizeBilinear=function(a,s){return s===void 0&&(s=!1),this.throwIfDisposed(),yt.image.resizeBilinear(this,a,s)},u.prototype.resizeNearestNeighbor=function(a,s){return s===void 0&&(s=!1),this.throwIfDisposed(),yt.image.resizeNearestNeighbor(this,a,s)},u.prototype.conv1d=function(a,s,c,f,m,v){return f===void 0&&(f="NWC"),m===void 0&&(m=1),this.throwIfDisposed(),yt.conv1d(this,a,s,c,f,m,v)},u.prototype.conv2d=function(a,s,c,f,m,v){return f===void 0&&(f="NHWC"),m===void 0&&(m=[1,1]),this.throwIfDisposed(),yt.conv2d(this,a,s,c,f,m,v)},u.prototype.conv2dTranspose=function(a,s,c,f,m){return this.throwIfDisposed(),yt.conv2dTranspose(this,a,s,c,f,m)},u.prototype.depthwiseConv2D=function(a,s,c,f,m,v){return f===void 0&&(f="NHWC"),m===void 0&&(m=[1,1]),this.throwIfDisposed(),yt.depthwiseConv2d(this,a,s,c,f,m,v)},u.prototype.separableConv2d=function(a,s,c,f,m,v){return m===void 0&&(m=[1,1]),v===void 0&&(v="NHWC"),this.throwIfDisposed(),yt.separableConv2d(this,a,s,c,f,m,v)},u.prototype.avgPool=function(a,s,c,f){return this.throwIfDisposed(),yt.avgPool(this,a,s,c,f)},u.prototype.maxPool=function(a,s,c,f){return this.throwIfDisposed(),yt.maxPool(this,a,s,c,f)},u.prototype.localResponseNormalization=function(a,s,c,f){return a===void 0&&(a=5),s===void 0&&(s=1),c===void 0&&(c=1),f===void 0&&(f=.5),yt.localResponseNormalization(this,a,s,c,f)},u.prototype.pool=function(a,s,c,f,m){return this.throwIfDisposed(),yt.pool(this,a,s,c,f,m)},u.prototype.variable=function(a,s,c){return a===void 0&&(a=!0),this.throwIfDisposed(),Pn.variable(this,a,s,c)},u.prototype.unsortedSegmentSum=function(a,s){return this.throwIfDisposed(),yt.unsortedSegmentSum(this,a,s)},u.prototype.batchToSpaceND=function(a,s){return this.throwIfDisposed(),yt.batchToSpaceND(this,a,s)},u.prototype.spaceToBatchND=function(a,s){return this.throwIfDisposed(),yt.spaceToBatchND(this,a,s)},u.prototype.topk=function(a,s){return a===void 0&&(a=1),s===void 0&&(s=!0),this.throwIfDisposed(),yt.topk(this,a,s)},u.prototype.stridedSlice=function(a,s,c,f,m){return f===void 0&&(f=0),m===void 0&&(m=0),this.throwIfDisposed(),yt.stridedSlice(this,a,s,c,f,m)},u.prototype.depthToSpace=function(a,s){return this.throwIfDisposed(),yt.depthToSpace(this,a,s)},u.prototype.fft=function(){return this.throwIfDisposed(),yt.spectral.fft(this)},u.prototype.ifft=function(){return this.throwIfDisposed(),yt.spectral.ifft(this)},u}();Object.defineProperty(At,Symbol.hasInstance,{value:function(u){return!!u&&u.shape!=null&&u.dtype!=null}});var Pn=function(u){function a(s,c,f){c===void 0&&(c=!0);var m=u.call(this,s.shape,s.dtype,null,s.dataId)||this;m.trainable=c,m.name=f,m.name==null&&(m.name=sn().nextVariableId().toString());try{sn().registerVariable(m)}catch(v){throw sn().disposeTensor(m),v}return m}return o(a,u),a.variable=function(s,c,f,m){return c===void 0&&(c=!0),m!=null&&m!==s.dtype&&(s=s.asType(m)),new a(s,c,f)},a.prototype.assign=function(s){if(s.dtype!==this.dtype)throw new Error("dtype of the new value ("+s.dtype+") and previous value ("+this.dtype+") must match");if(!q(s.shape,this.shape))throw new Error("shape of the new value ("+s.shape+") and previous value ("+this.shape+") must match");sn().disposeTensor(this),this.dataId=s.dataId,sn().registerTensor(this)},a}(At);Object.defineProperty(Pn,Symbol.hasInstance,{value:function(u){return u instanceof At&&u.assign!=null&&u.assign instanceof Function}});var Hr,du,ch,lh,dh,aD=Pn.variable;function iD(u,a,s){for(var c={},f={},m=0;m<a.length;m++)c[a[m].id]=!0;for(m=0;m<u.length;m++){var v=(O=u[m]).inputs;for(var b in v){for(var w=v[b],S=!1,E=0;E<a.length;E++)if(c[w.id]){O.outputs.forEach(function(z){return c[z.id]=!0}),S=!0,f[O.id]=!0;break}if(S)break}}var R={};R[s.id]=!0;var T={};for(m=u.length-1;m>=0;m--)for(v=(O=u[m]).inputs,E=0;E<O.outputs.length;E++)if(R[O.outputs[E].id]){for(var b in v)R[v[b].id]=!0,T[O.id]=!0;break}var P=[];for(m=0;m<u.length;m++){var O;if(f[(O=u[m]).id]&&T[O.id]){var $={};for(var b in O.inputs){var B=O.inputs[b];c[B.id]&&($[b]=B)}var U=Object.assign({},O);U.inputs=$,U.outputs=O.outputs,P.push(U)}}return P}function sD(u,a){for(var s=function(f){var m=a[f],v=[];if(m.outputs.forEach(function(T){var P=u[T.id];if(P!=null)v.push(P);else{var O=At.make(T.shape,{values:St(T.size,T.dtype)},T.dtype);v.push(O)}}),m.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+m.name+".");var b=m.gradient(m.outputs.length===1?v[0]:v);for(var w in m.inputs){if(!(w in b))throw new Error("Cannot backprop through input "+w+". Available gradients found: "+Object.keys(b)+".");var S=b[w]();if(S.dtype!=="float32")throw new Error("Error in gradient for op "+m.name+". The gradient of input "+w+" must have 'float32' dtype, but has '"+S.dtype+"'");var E=m.inputs[w];if(!q(S.shape,E.shape))throw new Error("Error in gradient for op "+m.name+". The gradient of input '"+w+"' has shape '"+S.shape+"', which does not match the shape of the input '"+E.shape+"'");if(u[E.id]==null)u[E.id]=S;else{var R=u[E.id];u[E.id]=R.add(S),R.dispose()}}},c=a.length-1;c>=0;c--)s(c)}(function(u){u.R0="R0",u.R1="R1",u.R2="R2",u.R3="R3",u.R4="R4",u.R5="R5",u.R6="R6"})(Hr||(Hr={})),function(u){u.float32="float32",u.int32="int32",u.bool="int32",u.complex64="complex64"}(du||(du={})),function(u){u.float32="float32",u.int32="int32",u.bool="bool",u.complex64="complex64"}(ch||(ch={})),function(u){u.float32="float32",u.int32="float32",u.bool="float32",u.complex64="complex64"}(lh||(lh={})),function(u){u.float32="complex64",u.int32="complex64",u.bool="complex64",u.complex64="complex64"}(dh||(dh={}));var uD={float32:lh,int32:du,bool:ch,complex64:dh};function Zn(u,a){if(u==="string"||a==="string"){if(u==="string"&&a==="string")return"string";throw new Error("Can not upcast "+u+" with "+a)}return uD[u][a]}function fh(u){return Zn(u,"int32")}function tr(u,a){if(u.dtype===a.dtype)return[u,a];var s=Zn(u.dtype,a.dtype);return[u.cast(s),a.cast(s)]}function cD(u,a){D(u.dtype===a.dtype,"The dtypes of the first("+u.dtype+") and second("+a.dtype+") input must match")}function lD(u,a){for(var s=0;s<a.length;s++)if(a[s].id===u.id)return!0;return!1}function ty(u){var a=[];return ey(u,a,new Set),a}function ey(u,a,s){if(u!=null){if(u instanceof At)a.push(u);else if(dD(u)){var c=u;for(var f in c){var m=c[f];s.has(m)||(s.add(m),ey(m,a,s))}}}}function dD(u){return Array.isArray(u)||typeof u=="object"}var un,fD=function(){function u(a,s,c){this.backend=a,this.safeMode=s,this.debugMode=c,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.scopeStack=[],this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.profiler=new Ft(a),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return u.prototype.moveData=function(a){this.write(a,this.readSync(a))},u.prototype.tidy=function(a,s,c){var f=this;c===void 0&&(c=!1);var m,v=null;if(s==null){if(typeof a!="function")throw new Error("Please provide a function to tidy()");s=a}else{if(typeof a!="string"&&!(a instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof s!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");v=a}return this.scopedRun(function(){return f.startScope(v,c)},function(){return f.endScope(m,c)},function(){return(m=s())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),m})},u.prototype.scopedRun=function(a,s,c){a();try{var f=c();return s(),f}catch(m){throw s(),m}},u.prototype.nextTensorId=function(){return u.nextTensorId++},u.prototype.nextVariableId=function(){return u.nextVariableId++},u.prototype.runKernel=function(a,s,c){var f,m=this,v=[],b=function(T){return v.push(T),T},w=this.activeScope.name,S=this.numBytes,E=this.numTensors;if(this.scopedRun(function(){return m.customGradientDepth++},function(){return m.customGradientDepth--},function(){f=m.debugMode()?m.profiler.profileKernel(w,function(){return a(m.backend,b)}):a(m.backend,b)}),this.shouldRecord()){var R={id:this.nextTapeNodeId++,name:w,inputs:s,outputs:Array.isArray(f)?f:[f]};c!=null&&(R.gradient=function(T){return c(T,v)}),this.activeTape.push(R)}return this.profiling&&this.activeProfile.kernels.push({name:w,bytesAdded:this.numBytes-S,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-E,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(s).map(function(T){return s[T].shape}),outputShape:Array.isArray(f)?f.map(function(T){return T.shape}):f.shape}),f},u.prototype.registerTensor=function(a){var s=this.tensorInfo.has(a.dataId)?this.tensorInfo.get(a.dataId).refCount:0;if(this.numTensors++,a.dtype==="string"&&this.numStringTensors++,s===0){this.numDataBuffers++;var c=0;a.dtype!=="complex64"&&a.dtype!=="string"&&(c=L(a.shape)*Xt(a.dtype)),this.tensorInfo.set(a.dataId,{backend:this.backend,dtype:a.dtype,shape:a.shape,bytes:c,refCount:0}),this.numBytes+=c,this.backend.register(a.dataId,a.shape,a.dtype)}this.tensorInfo.get(a.dataId).refCount++,a instanceof Pn||this.track(a)},u.prototype.registerVariable=function(a){if(this.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");this.registeredVariables[a.name]=a},u.prototype.disposeTensor=function(a){if(this.tensorInfo.has(a.dataId)){this.keepTensors.has(a.id)&&this.keepTensors.delete(a.id),this.numTensors--,a.dtype==="string"&&this.numStringTensors--;var s=this.tensorInfo.get(a.dataId);s.refCount<=1?(a.dtype!=="complex64"&&(this.numBytes-=s.bytes),this.numDataBuffers--,s.backend.disposeData(a.dataId),this.tensorInfo.delete(a.dataId)):this.tensorInfo.get(a.dataId).refCount--}},u.prototype.disposeVariables=function(){for(var a in this.registeredVariables){var s=this.registeredVariables[a];this.disposeTensor(s),delete this.registeredVariables[a]}},u.prototype.memory=function(){var a=this.backend.memory();return a.numTensors=this.numTensors,a.numDataBuffers=this.numDataBuffers,a.numBytes=this.numBytes,this.numStringTensors>0&&(a.unreliable=!0,a.reasons==null&&(a.reasons=[]),a.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),a},u.prototype.profile=function(a){return l(this,void 0,void 0,function(){var s,c;return d(this,function(f){return this.profiling=!0,s=this.numBytes,c=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=a(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(m){return m.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-s,this.activeProfile.newTensors=this.numTensors-c,[2,this.activeProfile]})})},u.prototype.shouldRecord=function(){return this.activeTape!=null&&this.customGradientDepth===0},u.prototype.addTapeNode=function(a,s,c){var f={};a.forEach(function(v,b){f[b]=v});var m={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:f,outputs:[s],gradient:function(v){var b={};return c(v).forEach(function(w,S){b[S]=function(){return w}}),b}};this.activeTape.push(m)},u.prototype.keep=function(a){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(a.id),a},u.prototype.startScope=function(a,s){s===void 0&&(s=!1),s&&this.gradientScopeCount===0&&(this.activeTape=[]),s&&this.gradientScopeCount++;var c={track:[],name:"unnamed scope"};a&&(c.name=a),this.scopeStack.push(c),this.activeScope=c},u.prototype.endScope=function(a,s){var c=this;s===void 0&&(s=!1),s&&(this.gradientScopeCount--,this.gradientScopeCount===0&&(this.activeTape=null));var f=new Set(this.keepTensors),m=ty(a);m.forEach(function(S){return f.add(S.id)});for(var v=0;v<this.activeScope.track.length;v++){var b=this.activeScope.track[v];f.has(b.id)||(this.activeTape!=null?m.push(b):b.dispose())}var w=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?null:this.scopeStack[this.scopeStack.length-1],m.forEach(function(S){!c.keepTensors.has(S.id)&&lD(S,w.track)&&c.track(S)})},u.prototype.gradients=function(a,s,c,f){var m=this;if(f===void 0&&(f=!1),D(s.length>0,"gradients() received an empty list of xs."),c!=null&&c.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+c.dtype+"'");return this.tidy("gradients",function(){var v=a();D(v instanceof At,"The result y returned by f() must be a tensor.");var b=iD(m.activeTape,s,v);if(!f&&b.length===0&&s.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var w={};return w[v.id]=c??pD(v.shape),sD(w,b),{value:v,grads:s.map(function(S){return w[S.id]})}},!0)},u.prototype.customGrad=function(a){var s=this;return D(re(a),"The f passed in customGrad(f) must be a function."),function(){for(var c,f,m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];return D(m.every(function(b){return b instanceof At}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),s.scopedRun(function(){return s.customGradientDepth++},function(){return s.customGradientDepth--},function(){f=s.tidy(a.name,function(){var b=a.apply(void 0,m),w=b.value,S=b.gradFunc;return D(w instanceof At,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),D(re(S),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),c=S,w},!0)}),s.shouldRecord()&&s.addTapeNode(m,f,function(b){var w=c(b),S=Array.isArray(w)?w:[w];return D(S.length===m.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),D(S.every(function(E){return E instanceof At}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),S}),f}},u.prototype.write=function(a,s){var c=this.tensorInfo.get(a);if(c.dtype==="string"){var f=ce(s);this.numBytes+=f-c.bytes,c.bytes=f}this.backend!==c.backend&&(c.backend.disposeData(a),c.backend=this.backend,this.backend.register(a,c.shape,c.dtype)),this.backend.write(a,s)},u.prototype.readSync=function(a){return this.tensorInfo.get(a).backend.readSync(a)},u.prototype.read=function(a){return this.tensorInfo.get(a).backend.read(a)},u.prototype.fromPixels=function(a,s){return this.backend.fromPixels(a,s)},u.prototype.time=function(a){return l(this,void 0,void 0,function(){var s,c;return d(this,function(f){switch(f.label){case 0:return s=Dt(),[4,this.backend.time(a)];case 1:return(c=f.sent()).wallMs=Dt()-s,[2,c]}})})},u.prototype.track=function(a){if(this.scopeStack.length===1&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope!=null&&this.activeScope.track.push(a),a},u.nextTensorId=0,u.nextVariableId=0,u}();function pD(u){var a=Et(L(u),"float32");return At.make(u,{values:a})}(function(u){u[u.NUMBER=0]="NUMBER",u[u.BOOLEAN=1]="BOOLEAN",u[u.STRING=2]="STRING"})(un||(un={}));var ph,hD=[{name:"DEBUG",type:un.BOOLEAN},{name:"IS_BROWSER",type:un.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:un.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:un.BOOLEAN},{name:"WEBGL_PACK",type:un.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:un.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:un.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:un.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:un.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:un.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:un.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:un.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:un.BOOLEAN},{name:"WEBGL_VERSION",type:un.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:un.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:un.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:un.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:un.NUMBER},{name:"BACKEND",type:un.STRING},{name:"EPSILON",type:un.NUMBER},{name:"PROD",type:un.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:un.BOOLEAN}];function ny(u){try{if(g(u)!=null)return!0}catch{return!1}return!1}function mD(u){if(ph==null){var a=g(u);ph=a.getParameter(a.MAX_TEXTURE_SIZE)}return ph}function gD(u){if(u===0)return 0;var a=g(u);return os(a,"EXT_disjoint_timer_query_webgl2")&&u===2?2:os(a,"EXT_disjoint_timer_query")?1:0}function vD(u){if(u===0)return!1;var a=g(u);if(u===1){if(!os(a,"OES_texture_float"))return!1}else if(!os(a,"EXT_color_buffer_float"))return!1;return ay(a,u)}function yD(u){if(u===0)return!1;var a=g(u);if(u===1){if(!os(a,"OES_texture_float")||!os(a,"WEBGL_color_buffer_float"))return!1}else if(!os(a,"EXT_color_buffer_float"))return!1;return ay(a,u)}function bD(u){return u===2&&g(u).fenceSync!=null}function xD(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}var ry="tfjsflags";function oy(){var u={};if(typeof window>"u"||window.location===void 0||window.location.search===void 0)return u;var a=wD(window.location.search);if(ry in a){var s={};a[ry].split(",").forEach(function(c){var f=c.split(":"),m=f[0],v=f[1];s[m]=v}),hD.forEach(function(c){c.name in s&&(console.log("Setting feature override from URL "+c.name+": "+s[c.name]),c.type===un.NUMBER?u[c.name]=+s[c.name]:c.type===un.BOOLEAN?u[c.name]=s[c.name]==="true":c.type===un.STRING?u[c.name]=s[c.name]:console.warn("Unknown URL param: "+c.name+"."))})}return u}function os(u,a){return u.getExtension(a)!=null}function ay(u,a){var s=u.createFramebuffer(),c=u.createTexture();u.bindTexture(u.TEXTURE_2D,c);var f=a===2?u.RGBA32F:u.RGBA;u.texImage2D(u.TEXTURE_2D,0,f,1,1,0,u.RGBA,u.FLOAT,null),u.bindFramebuffer(u.FRAMEBUFFER,s),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c,0);var m=u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE;return u.bindTexture(u.TEXTURE_2D,null),u.bindFramebuffer(u.FRAMEBUFFER,null),u.deleteTexture(c),u.deleteFramebuffer(s),m}function wD(u){var a={};return u.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){for(var c=[],f=1;f<arguments.length;f++)c[f-1]=arguments[f];return CD(a,c[0],c[1]),c.join("=")}),a}function CD(u,a,s){u[decodeURIComponent(a)]=decodeURIComponent(s||"")}var iy=1e-4,SD=.1,sy=1e-7,_D=.001,mo=function(){function u(a){this.features={},this.registry={},a!=null&&(this.features=a),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return u.setBackend=function(a,s){if(!(a in Z.registry))throw new Error("Backend name '"+a+"' not found in registry");Z.engine.backend=Z.findBackend(a),Z.backendName=a},u.getBackend=function(){return Z.initEngine(),Z.backendName},u.disposeVariables=function(){Z.engine.disposeVariables()},u.memory=function(){return Z.engine.memory()},u.profile=function(a){return Z.engine.profile(a)},u.tidy=function(a,s){return Z.engine.tidy(a,s)},u.dispose=function(a){ty(a).forEach(function(s){return s.dispose()})},u.keep=function(a){return Z.engine.keep(a)},u.time=function(a){return Z.engine.time(a)},u.prototype.get=function(a){return a in this.features?this.features[a]:(this.features[a]=this.evaluateFeature(a),this.features[a])},u.prototype.getFeatures=function(){return this.features},u.prototype.set=function(a,s){this.features[a]=s},u.prototype.getBestBackendName=function(){var a=this;if(Object.keys(this.registry).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(s){return{name:s,entry:a.registry[s]}}).sort(function(s,c){return c.entry.priority-s.entry.priority})[0].name},u.prototype.evaluateFeature=function(a){if(a==="DEBUG")return!1;if(a==="IS_BROWSER")return typeof window<"u";if(a==="IS_NODE")return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0;if(a==="IS_CHROME")return xD();if(a==="WEBGL_CPU_FORWARD")return!0;if(a==="WEBGL_PACK")return!1;if(a==="WEBGL_PACK_BATCHNORMALIZATION")return this.get("WEBGL_PACK");if(a==="WEBGL_PACK_CLIP")return this.get("WEBGL_PACK");if(a==="WEBGL_PACK_DEPTHWISECONV")return this.get("WEBGL_PACK");if(a==="WEBGL_LAZILY_UNPACK")return this.get("WEBGL_PACK");if(a==="WEBGL_CONV_IM2COL")return this.get("WEBGL_PACK");if(a==="WEBGL_PAGING_ENABLED")return this.get("IS_BROWSER")&&!this.get("PROD");if(a==="WEBGL_MAX_TEXTURE_SIZE")return mD(this.get("WEBGL_VERSION"));if(a==="IS_TEST")return!1;if(a==="BACKEND")return this.getBestBackendName();if(a==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var s=this.get("WEBGL_VERSION");return s===0?0:gD(s)}if(a==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!x();if(a==="HAS_WEBGL")return this.get("WEBGL_VERSION")>0;if(a==="WEBGL_VERSION")return ny(2)?2:ny(1)?1:0;if(a==="WEBGL_RENDER_FLOAT32_ENABLED")return vD(this.get("WEBGL_VERSION"));if(a==="WEBGL_DOWNLOAD_FLOAT_ENABLED")return yD(this.get("WEBGL_VERSION"));if(a==="WEBGL_FENCE_API_ENABLED")return bD(this.get("WEBGL_VERSION"));if(a==="WEBGL_SIZE_UPLOAD_UNIFORM")return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if(a==="TEST_EPSILON")return this.backend.floatPrecision()===32?_D:SD;if(a==="EPSILON")return this.backend.floatPrecision()===32?sy:iy;if(a==="PROD")return!1;if(a==="TENSORLIKE_CHECK_SHAPE_CONSISTENCY")return!this.get("PROD");throw new Error("Unknown feature "+a+".")},u.prototype.setFeatures=function(a){this.features=Object.assign({},a)},u.prototype.reset=function(){this.features=oy(),this.globalEngine!=null&&(this.globalEngine=null)},Object.defineProperty(u.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),u.prototype.findBackend=function(a){return a in this.registry?this.registry[a].backend:null},u.prototype.registerBackend=function(a,s,c,f){var m=this;if(c===void 0&&(c=1),a in this.registry)return console.warn(a+" backend was already registered. Reusing existing backend"),f!=null&&f(function(){return m.engine}),!1;try{var v=s();return v.setDataMover({moveData:function(b){return m.engine.moveData(b)}}),this.registry[a]={backend:v,priority:c},!0}catch(b){return console.warn("Registration of backend "+a+" failed"),console.warn(b.stack||b.message),!1}},u.prototype.removeBackend=function(a){if(!(a in this.registry))throw new Error(a+" backend not found in registry");this.registry[a].backend.dispose(),delete this.registry[a]},Object.defineProperty(u.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),u.prototype.initEngine=function(){var a=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var s=this.findBackend(this.backendName);this.globalEngine=new fD(s,!1,function(){return a.get("DEBUG")})}},u}();function ED(){var u;if(typeof window<"u")u=window;else{if(typeof process>"u")throw new Error("Could not find a global object");u=process}return u}function kD(){var u=ED();return u.ENV==null&&(u.ENV=new mo(oy()),Vr(function(){return u.ENV.engine})),u.ENV}var Z=kD(),RD=Object.freeze({EPSILON_FLOAT16:iy,EPSILON_FLOAT32:sy,Environment:mo,ENV:Z});function TD(u){return D(re(u),"The f passed in grad(f) must be a function"),function(a,s){return D(a instanceof At,"The x passed in grad(f)(x) must be a tensor"),D(s==null||s instanceof At,"The dy passed in grad(f)(x, dy) must be a tensor"),Z.engine.tidy(function(){var c=Z.engine.gradients(function(){return u(a)},[a],s),f=c.value,m=c.grads;return s!=null&&M(f.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Sd(m),m[0]})}}function DD(u){return D(re(u),"The f passed in grads(f) must be a function"),function(a,s){return D(Array.isArray(a)&&a.every(function(c){return c instanceof At}),"The args passed in grads(f)(args) must be an array of tensors"),D(s==null||s instanceof At,"The dy passed in grads(f)(args, dy) must be a tensor"),Z.engine.tidy(function(){var c=Z.engine.gradients(function(){return u.apply(void 0,a)},a,s),f=c.value,m=c.grads;return s!=null&&M(f.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Sd(m),m})}}function AD(u){return D(re(u),"The f passed in valueAndGrad(f) must be a function"),function(a,s){D(a instanceof At,"The x passed in valueAndGrad(f)(x) must be a tensor"),D(s==null||s instanceof At,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var c=Z.engine.gradients(function(){return u(a)},[a],s),f=c.grads,m=c.value;return Sd(f),{grad:f[0],value:m}}}function ID(u){return D(re(u),"The f passed in valueAndGrads(f) must be a function"),function(a,s){D(Array.isArray(a)&&a.every(function(f){return f instanceof At}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),D(s==null||s instanceof At,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var c=Z.engine.gradients(function(){return u.apply(void 0,a)},a,s);return s!=null&&M(c.value.shape,s.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Sd(c.grads),c}}function uy(u,a){if(D(re(u),"The f passed in variableGrads(f) must be a function"),D(a==null||Array.isArray(a)&&a.every(function(w){return w instanceof Pn}),"The varList passed in variableGrads(f, varList) must be an array of variables"),a==null)for(var s in a=[],Z.engine.registeredVariables)a.push(Z.engine.registeredVariables[s]);var c=a.length;D((a=a.filter(function(w){return w.trainable})).length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+c+" variables is trainable.");var f=Z.engine.gradients(u,a,null,!0),m=f.value,v=f.grads;D(v.some(function(w){return w!=null}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),D(m.rank===0,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+m.rank+" tensor");var b={};return a.forEach(function(w,S){v[S]!=null&&(b[w.name]=v[S])}),{value:m,grads:b}}function fu(u){return Z.engine.customGrad(u)}function Sd(u){if(u.filter(function(a){return a==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var te=mo.tidy,cn=mo.keep,cy=mo.dispose,ND=mo.time,PD=mo.profile;function hh(){for(var u=[],a=0;a<arguments.length;a++)u[a]=arguments[a];Z.get("IS_TEST")||console.warn.apply(console,u)}function _d(u,a,s,c){c===void 0&&(c=!0);var f=[];if(c)(f=f.concat(a.slice(0))).push(u[0]/s),f=f.concat(u.slice(1));else{f=f.concat(u[0]);for(var m=a.length,v=0;v<m;++v)f=f.concat([u[v+1]/a[v],a[v]]);f=f.concat(u.slice(m+1))}return f}function Ed(u,a,s){s===void 0&&(s=!0);var c=[];if(s){c.push(a);for(var f=a+1;f<u;++f)f<=2*a?(c.push(f),c.push(f-(a+1))):c.push(f)}else{var m=[],v=[];for(f=1;f<u;++f)f>=2*a+1||f%2==1?v.push(f):m.push(f);c.push.apply(c,m),c.push(0),c.push.apply(c,v)}return c}function kd(u,a,s,c){c===void 0&&(c=!0);var f=[];c?f.push(u[0]/s):f.push(u[0]*s);for(var m=1;m<u.length;++m)m<=a.length?c?f.push(a[m-1]*u[m]):f.push(u[m]/a[m-1]):f.push(u[m]);return f}function ly(u,a){for(var s=[0],c=0;c<a;++c)s.push(u[c][0]);return s}function dy(u,a,s){for(var c=u.slice(0,1),f=0;f<s;++f)c.push(u[f+1]-a[f][0]-a[f][1]);return c}function fy(u,a){for(var s=0;s<u.length;++s)if(u[u.length-s-1]!==a-1-s)return!1;return!0}function MD(u,a,s){for(var c=u.length+a.length,f=[],m=0,v=0,b=0;b<c;b++)s.indexOf(b)===-1?f.push(u[m++]):f.push(a[v++]);return f}function er(u,a){for(var s=[],c=u.length,f=0;f<c;f++)a.indexOf(f)===-1&&s.push(u[f]);return[s,a.map(function(m){return u[m]})]}function go(u,a){return MD(u,a.map(function(s){return 1}),a)}function yr(u,a){var s=a.length;return D((u=u==null?a.map(function(c,f){return f}):[].concat(u)).every(function(c){return c>=-s&&c<s}),"All values in axis param must be in range [-"+s+", "+s+") but got axis "+u),D(u.every(function(c){return Q(c)}),"All values in axis param must be integers but got axis "+u),u.map(function(c){return c<0?s+c:c})}function Gr(u,a,s){D(fy(a,s),u+" supports only inner-most axes for now. Got axes "+a+" and rank-"+s+" input.")}function Yo(u,a){if(fy(u,a))return null;for(var s=[],c=0;c<a;++c)u.indexOf(c)===-1&&s.push(c);return u.forEach(function(f){return s.push(f)}),s}function mh(u){return u.map(function(a,s){return[s,a]}).sort(function(a,s){return a[1]-s[1]}).map(function(a){return a[0]})}function Qo(u,a){for(var s=[],c=a-u;c<a;++c)s.push(c);return s}function OD(u,a){var s=u[0].length;u.forEach(function(f,m){D(f.length===s,"Error in concat"+s+"D: rank of tensors["+m+"] must be the same as the rank of the rest ("+s+")")}),D(a>=0&&a<s,"Error in concat"+s+"D: axis must be between 0 and "+(s-1)+".");var c=u[0];u.forEach(function(f,m){for(var v=0;v<s;v++)D(v===a||f[v]===c[v],"Error in concat"+s+"D: Shape of tensors["+m+"] ("+f+") does not match the shape of the rest ("+c+") along the non-concatenated axis "+m+".")})}function Ic(u,a){for(var s=u[0].slice(),c=1;c<u.length;c++)s[a]+=u[c][a];return s}function py(u,a){if(u.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+u.rank+".");if(a.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+a.rank+".");if(a.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.shape[a.rank-1]>u.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+a.shape[a.rank-1]+" vs. "+u.rank);if(u.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+u.shape+".");for(var s=a.shape,c=s[s.length-1],f=1,m=0;m<s.length-1;++m)f*=s[m];var v=u.shape,b=s.slice();b.pop();var w=1;for(m=c;m<u.rank;++m)w*=v[m],b.push(v[m]);var S=Y(u.shape).map(function(E){return E/w}).concat([1]).slice(0,c);return[b,f,w,S]}var hy=30;function my(u){return u<=hy?u:_e(u,Math.floor(Math.sqrt(u)))}function FD(u,a,s){var c=a.rank>1?a.shape[a.rank-1]:1,f=a.rank>1?a.rank-1:1,m="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+s.shape+", indices.shape: "+a.shape+", shape: "+u+", sliceDim: "+c+", and batchDim: "+f+".";if(s.rank<f)throw new Error(m+" update.rank < "+f+". ");if(u.length<c+(s.rank-f))throw new Error(m+" Output shape length < "+(c+(s.rank-f)));if(s.rank!==f+u.length-c)throw new Error(m+" update.rank != "+(f+u.length-c));for(var v=0;v<f;++v)if(s.shape[v]!==a.shape[v])throw new Error(m+" updates.shape["+v+"] ("+s.shape[v]+") != indices.shape["+v+"] ("+a.shape[v]+").");for(v=0;v<s.rank-f;++v)if(s.shape[v+f]!==u[v+c])throw new Error(m+" updates.shape["+(v+f)+"] ("+s.shape[v+f]+") != shape["+(v+f)+"] ("+u[v+f]+")")}function $D(u,a,s){if(a.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+a.rank+".");if(u.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+u.rank+".");if(a.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+a.dtype);if(s.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+s);if(s.length===0){if(a.size===0)throw new Error("Indices specified for empty output. indices shape: "+a.shape);if(u.size===0)throw new Error("Updates specified for empty output. updates shape: "+u.shape)}FD(s,a,u)}function Rd(u,a,s){for(var c=a.rank>1?a.shape[a.rank-1]:1,f=s.length,m=1,v=c;v<f;++v)m*=s[v];var b=c<1?1:c,w=a.size/b,S=Y(s).concat([1]);return{sliceRank:c,numUpdates:w,sliceSize:m,strides:S.slice(S.length-c,S.length),outputSize:L(s)}}function BD(u,a){var s,c=!1;for(u<=hy?(s=u,c=!0):s=_e(u,Math.floor(Math.sqrt(u)));!c;){if(s>a||s===u){c=!0;break}s=_e(u,s+1)}return s}function LD(u,a,s){for(var c=[],f=u.length,m=0;m<f;m++)m!==a?c.push(u[m]):c.push(s);return c}function WD(u,a,s){D(u.rank===a.length,"Error in slice"+u.rank+"D: Length of begin "+a+" must match the rank of the array ("+u.rank+")."),D(u.rank===s.length,"Error in slice"+u.rank+"D: Length of size "+s+" must match the rank of the array ("+u.rank+").");for(var c=0;c<u.rank;++c)D(a[c]+s[c]<=u.shape[c],"Error in slice"+u.rank+"D: begin["+c+"] + size["+c+"] ("+(a[c]+s[c])+") would overflow input.shape["+c+"] ("+u.shape[c]+")")}function gy(u,a,s,c,f,m,v,b,w){if(f===void 0&&(f=0),m===void 0&&(m=0),v===void 0&&(v=0),b===void 0&&(b=0),w===void 0&&(w=0),v!==0)throw new Error("ellipsis mask is not yet supported");if(b!==0)throw new Error("new axis mask is not yet supported");for(var S=[],E=[],R=[],T=0;T<u.length;T++)S[T]=UD(f,a,c,u,T),E[T]=zD(m,s,c,u,T),w&1<<T&&(E[T]=S[T]+1,R.push(T));var P=new Array(u.length).fill(0);return P=P.map(function(O,$){for(var B=0,U=S[$];!(c[$]>0?U>=E[$]:U<=E[$]);U+=c[$])B+=1;return B}),[S,P,R]}function UD(u,a,s,c,f){var m=a[f];u&1<<f&&(m=s[f]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var v=c[f];return m<0&&(m+=v),m=_(0,m,v-1)}function zD(u,a,s,c,f){var m=a[f];u&1<<f&&(m=s[f]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var v=c[f];return m<0&&(m+=v),m=s[f]>0?_(0,m,v):_(-1,m,v-1)}function ui(u){var a=u;if(Zt(u))return[u.length];if(!Array.isArray(u))return[];for(var s=[];a instanceof Array||Zt(a);)s.push(a.length),a=a[0];return u instanceof Array&&Z.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&vy(u,s,[]),s}function vy(u,a,s){if(s=s||[],u instanceof Array||Zt(u)){D(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+u.length+" elements"}),D(u.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+u.length+" elements"});for(var c=a.slice(1),f=0;f<u.length;++f)vy(u[f],c,s.concat(f))}else D(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}function yy(u,a,s,c){if(u!=null&&(u!=="numeric"&&u!==a||u==="numeric"&&a==="string"))throw new Error("Argument '"+s+"' passed to '"+c+"' must be "+u+" tensor, but got "+a+" tensor")}function V(u,a,s,c){if(c===void 0&&(c="numeric"),u instanceof At)return yy(c,u.dtype,a,s),u;var f=Pe(u);if(f!=="string"&&["bool","int32","float32"].indexOf(c)>=0&&(f=c),yy(c,f,a,s),!Zt(u)&&!Array.isArray(u)&&typeof u!="number"&&typeof u!="boolean"&&typeof u!="string")throw new Error("Argument '"+a+"' passed to '"+s+"' must be a Tensor or TensorLike, but got '"+u.constructor.name+"'");var m=ui(u);Zt(u)||Array.isArray(u)||(u=[u]);var v=f!=="string"?nt(u,f,Z.get("DEBUG")):W(u);return At.make(m,{values:v},f)}function Td(u,a,s){if(!Array.isArray(u))throw new Error("Argument "+a+" passed to "+s+" must be a `Tensor[]` or `TensorLike[]`");return u.map(function(c,f){return V(c,a+"["+f+"]",s)})}function st(u){var a=Object.keys(u);if(a.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+a.length+" keys.");var s=a[0],c=u[s];s.endsWith("_")&&(s=s.substring(0,s.length-1));var f=function(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];Z.engine.startScope(s);try{var b=c.apply(void 0,m);return b instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Z.engine.endScope(b),b}catch(w){throw Z.engine.endScope(null),w}};return Object.defineProperty(f,"name",{value:s,configurable:!0}),f}function VD(u,a){a===void 0&&(a=-1);var s=V(u,"logits","softmax");if(a===-1&&(a=s.rank-1),a!==s.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+s.rank+" and dim was "+a);return fu(function(c){var f=c.logSumExp([a],!0),m=c.toFloat().sub(f).exp();return{value:m,gradFunc:function(v){var b=v.mul(m);return b.sub(b.sum([a],!0).mul(m))}}})(s)}function HD(u,a){a===void 0&&(a=-1);var s=V(u,"logits","logSoftmax");if(a===-1&&(a=s.rank-1),a!==s.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+s.rank+" and axis was "+a);return fu(function(c){var f=c.max(a,!0),m=c.sub(f),v=m.toFloat().sub(m.exp().sum(a,!0).log());return{value:v,gradFunc:function(b){var w=v.exp();return b.sub(b.sum(a,!0).mul(w))}}})(s)}var Da=st({softmax_:VD}),by=st({logSoftmax_:HD});function GD(u,a){var s=V(u,"real","complex"),c=V(a,"imag","complex");return M(s.shape,c.shape,"real and imag shapes, "+s.shape+" and "+c.shape+", must match in call to tf.complex()."),Z.engine.runKernel(function(f){return f.complex(s,c)},{$real:s,$imag:c})}function qD(u){var a=V(u,"input","real");return Z.engine.runKernel(function(s){return s.real(a)},{$input:a})}function jD(u){var a=V(u,"input","imag");return Z.engine.runKernel(function(s){return s.imag(a)},{$input:a})}var Fr=st({complex_:GD}),Jo=st({real_:qD}),ci=st({imag_:jD});function kn(u,a,s){if(s==null&&(s=Pe(u)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Zt(u)&&!Array.isArray(u)&&typeof u!="number"&&typeof u!="boolean"&&typeof u!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var c=ui(u);if(a!=null){var f=L(a),m=L(c);D(f===m,function(){return"Based on the provided shape, ["+a+"], the tensor should have "+f+" values but has "+m});for(var v=0;v<c.length;++v){var b=c[v],w=v!==c.length-1||b!==L(a.slice(v));D(c[v]===a[v]||!w,function(){return"Error creating a new Tensor. Inferred shape ("+c+") does not match the provided shape ("+a+"). "})}}return Zt(u)||Array.isArray(u)||(u=[u]),a=a||c,u=s!=="string"?nt(u,s,Z.get("DEBUG")):W(u),At.make(a,{values:u},s)}function Nt(u,a){if((Zt(u)||Array.isArray(u))&&a!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return kn(u,[],a)}function Un(u,a){F(u);var s=ui(u);if(s.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return kn(u,s,a)}function pu(u,a,s){if(F(u),a!=null&&a.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var c=ui(u);if(c.length!==2&&c.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(c.length===1&&a==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return kn(u,a=a||c,s)}function Dd(u,a,s){if(F(u),a!=null&&a.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var c=ui(u);if(c.length!==3&&c.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(c.length===1&&a==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return kn(u,a=a||c,s)}function nr(u,a,s){if(F(u),a!=null&&a.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var c=ui(u);if(c.length!==4&&c.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(c.length===1&&a==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return kn(u,a=a||c,s)}function xy(u,a,s){if(F(u),a!=null&&a.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var c=ui(u);if(c.length!==5&&c.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(c.length===1&&a==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return kn(u,a=a||c,s)}function wy(u,a,s){if(F(u),a!=null&&a.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var c=ui(u);if(c.length!==6&&c.length!==1)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(c.length===1&&a==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return kn(u,a=a||c,s)}function Aa(u,a){if(a===void 0&&(a="float32"),a==="complex64"){var s=Aa(u,"float32"),c=Aa(u,"float32");return Fr(s,c)}var f=Et(L(u),a);return At.make(u,{values:f},a)}function Rn(u,a){if(a===void 0&&(a="float32"),a==="complex64"){var s=Rn(u,"float32"),c=Rn(u,"float32");return Fr(s,c)}var f=St(L(u),a);return At.make(u,{values:f},a)}function Zo(u,a,s){var c=Tt(s=s||Pe(a),L(u));return c.fill(a),At.make(u,{values:c},s)}function KD(u){var a=V(u,"x","onesLike");return Aa(a.shape,a.dtype)}function XD(u){var a=V(u,"x","zerosLike");return Rn(a.shape,a.dtype)}function Cy(u,a,s){if(s===0)throw new Error("Cannot request zero samples");var c=(a-u)/(s-1),f=St(s,"float32");f[0]=u;for(var m=1;m<f.length;m++)f[m]=f[m-1]+c;return Un(f,"float32")}function gh(u,a,s,c){if(s===void 0&&(s=1),c===void 0&&(c="float32"),s===0)throw new Error("Cannot have a step of zero");if(u===a||u<a&&s<0||a<u&&s>1)return Rn([0],c);var f=St(Math.abs(Math.ceil((a-u)/s)),c);a<u&&s===1&&(s=-1),f[0]=u;for(var m=1;m<f.length;m++)f[m]=f[m-1]+s;return Un(f,c)}var Sy=st({onesLike_:KD}),vn=st({zerosLike_:XD}),vh=function(){function u(a){this.dataMover=a,this.data=new WeakMap}return u.prototype.get=function(a){return this.data.has(a)||this.dataMover.moveData(a),this.data.get(a)},u.prototype.set=function(a,s){this.data.set(a,s)},u.prototype.has=function(a){return this.data.has(a)},u.prototype.delete=function(a){return this.data.delete(a)},u}(),YD=function(){function u(){}return u.prototype.time=function(a){throw new Error("Not yet implemented.")},u.prototype.read=function(a){throw new Error("Not yet implemented.")},u.prototype.readSync=function(a){throw new Error("Not yet implemented.")},u.prototype.disposeData=function(a){throw new Error("Not yet implemented.")},u.prototype.write=function(a,s){throw new Error("Not yet implemented.")},u.prototype.fromPixels=function(a,s){throw new Error("Not yet implemented.")},u.prototype.register=function(a,s,c){throw new Error("Not yet implemented.")},u.prototype.memory=function(){throw new Error("Not yet implemented.")},u.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},u.prototype.batchMatMul=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.slice=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.stridedSlice=function(a,s,c,f,m,v,b,w,S){throw new Error("Not yet implemented")},u.prototype.reverse=function(a,s){throw new Error("Not yet implemented")},u.prototype.concat=function(a,s){throw new Error("Not yet implemented")},u.prototype.neg=function(a){throw new Error("Not yet implemented")},u.prototype.add=function(a,s){throw new Error("Not yet implemented")},u.prototype.addN=function(a){throw new Error("Not yet implemented")},u.prototype.subtract=function(a,s){throw new Error("Not yet implemented")},u.prototype.multiply=function(a,s){throw new Error("Not yet implemented")},u.prototype.realDivide=function(a,s){throw new Error("Not yet implemented")},u.prototype.floorDiv=function(a,s){throw new Error("Not yet implemented")},u.prototype.sum=function(a,s){throw new Error("Not yet implemented")},u.prototype.prod=function(a,s){throw new Error("Not yet implemented")},u.prototype.unsortedSegmentSum=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.argMin=function(a,s){throw new Error("Not yet implemented")},u.prototype.argMax=function(a,s){throw new Error("Not yet implemented")},u.prototype.equal=function(a,s){throw new Error("Not yet implemented")},u.prototype.notEqual=function(a,s){throw new Error("Not yet implemented")},u.prototype.less=function(a,s){throw new Error("Not yet implemented")},u.prototype.lessEqual=function(a,s){throw new Error("Not yet implemented")},u.prototype.greater=function(a,s){throw new Error("Not yet implemented")},u.prototype.greaterEqual=function(a,s){throw new Error("Not yet implemented")},u.prototype.logicalNot=function(a){throw new Error("Not yet implemented")},u.prototype.logicalAnd=function(a,s){throw new Error("Not yet implemented")},u.prototype.logicalOr=function(a,s){throw new Error("Not yet implemented")},u.prototype.where=function(a){throw new Error("Not yet implemented")},u.prototype.select=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.topk=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.min=function(a,s){throw new Error("Not yet implemented")},u.prototype.minimum=function(a,s){throw new Error("Not yet implemented")},u.prototype.mod=function(a,s){throw new Error("Not yet implemented")},u.prototype.max=function(a,s){throw new Error("Not yet implemented")},u.prototype.maximum=function(a,s){throw new Error("Not yet implemented")},u.prototype.all=function(a,s){throw new Error("Not yet implemented")},u.prototype.any=function(a,s){throw new Error("Not yet implemented")},u.prototype.squaredDifference=function(a,s){throw new Error("Not yet implemented")},u.prototype.ceil=function(a){throw new Error("Not yet implemented")},u.prototype.floor=function(a){throw new Error("Not yet implemented")},u.prototype.round=function(a){throw new Error("Not yet implemented")},u.prototype.sign=function(a){throw new Error("Not yet implemented")},u.prototype.pow=function(a,s){throw new Error("Not yet implemented")},u.prototype.exp=function(a){throw new Error("Not yet implemented")},u.prototype.expm1=function(a){throw new Error("Not yet implemented")},u.prototype.log=function(a){throw new Error("Not yet implemented")},u.prototype.log1p=function(a){throw new Error("Not yet implemented")},u.prototype.sqrt=function(a){throw new Error("Not yet implemented")},u.prototype.rsqrt=function(a){throw new Error("Not yet implemented")},u.prototype.square=function(a){throw new Error("Not yet implemented")},u.prototype.reciprocal=function(a){throw new Error("Not yet implemented")},u.prototype.relu=function(a){throw new Error("Not yet implemented")},u.prototype.elu=function(a){throw new Error("Not yet implemented")},u.prototype.eluDer=function(a,s){throw new Error("Not yet implemented")},u.prototype.selu=function(a){throw new Error("Not yet implemented")},u.prototype.int=function(a){throw new Error("Not yet implemented")},u.prototype.clip=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.abs=function(a){throw new Error("Not yet implemented")},u.prototype.complexAbs=function(a){throw new Error("Not yet implemented")},u.prototype.sigmoid=function(a){throw new Error("Not yet implemented")},u.prototype.softplus=function(a){throw new Error("Not yet implemented")},u.prototype.sin=function(a){throw new Error("Not yet implemented")},u.prototype.cos=function(a){throw new Error("Not yet implemented")},u.prototype.tan=function(a){throw new Error("Not yet implemented")},u.prototype.asin=function(a){throw new Error("Not yet implemented")},u.prototype.acos=function(a){throw new Error("Not yet implemented")},u.prototype.atan=function(a){throw new Error("Not yet implemented")},u.prototype.atan2=function(a,s){throw new Error("Not yet implemented")},u.prototype.sinh=function(a){throw new Error("Not yet implemented")},u.prototype.cosh=function(a){throw new Error("Not yet implemented")},u.prototype.tanh=function(a){throw new Error("Not yet implemented")},u.prototype.asinh=function(a){throw new Error("Not yet implemented")},u.prototype.acosh=function(a){throw new Error("Not yet implemented")},u.prototype.atanh=function(a){throw new Error("Not yet implemented")},u.prototype.erf=function(a){throw new Error("Not yet implemented")},u.prototype.step=function(a,s){throw new Error("Not yet implemented")},u.prototype.conv2d=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.conv2dDerInput=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.conv2dDerFilter=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.depthwiseConv2D=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.depthwiseConv2DDerInput=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.depthwiseConv2DDerFilter=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.conv3d=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.conv3dDerInput=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.conv3dDerFilter=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.maxPool=function(a,s){throw new Error("Not yet implemented")},u.prototype.maxPoolBackprop=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.avgPool=function(a,s){throw new Error("Not yet implemented")},u.prototype.avgPoolBackprop=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.reshape=function(a,s){throw new Error("Not yet implemented")},u.prototype.cast=function(a,s){throw new Error("Not yet implemented")},u.prototype.tile=function(a,s){throw new Error("Not yet implemented")},u.prototype.pad=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.transpose=function(a,s){throw new Error("Not yet implemented")},u.prototype.gather=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.gatherND=function(a,s){throw new Error("Not yet implemented")},u.prototype.scatterND=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.batchToSpaceND=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.spaceToBatchND=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.resizeBilinear=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.resizeBilinearBackprop=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.resizeNearestNeighbor=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.resizeNearestNeighborBackprop=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.batchNormalization=function(a,s,c,f,m,v){throw new Error("Not yet implemented")},u.prototype.localResponseNormalization4D=function(a,s,c,f,m){throw new Error("Not yet implemented")},u.prototype.LRNGrad=function(a,s,c,f,m,v,b){throw new Error("Not yet implemented")},u.prototype.multinomial=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.oneHot=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.cumsum=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.nonMaxSuppression=function(a,s,c,f,m){throw new Error("Not yet implemented")},u.prototype.fft=function(a){throw new Error("Not yet implemented")},u.prototype.ifft=function(a){throw new Error("Not yet implemented")},u.prototype.complex=function(a,s){throw new Error("Not yet implemented")},u.prototype.real=function(a){throw new Error("Not yet implemented")},u.prototype.imag=function(a){throw new Error("Not yet implemented")},u.prototype.cropAndResize=function(a,s,c,f,m,v){throw new Error("Not yet implemented")},u.prototype.depthToSpace=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.split=function(a,s,c){throw new Error("Not yet implemented")},u.prototype.sparseToDense=function(a,s,c,f){throw new Error("Not yet implemented")},u.prototype.setDataMover=function(a){throw new Error("Not yet implemented")},u.prototype.dispose=function(){throw new Error("Not yet implemented")},u}();function _y(u,a,s){if(a==="complex64"){if(u.dtype==="complex64")return u.clone();var c=Rn(u.shape),f=u.toFloat(),m=s.complex(f,c);return c.dispose(),f.dispose(),m}if(!Ut(u.dtype,a))return At.make(u.shape,{dataId:u.dataId},a);if(u.dtype==="complex64"){var v=s.real(u);return m=v.cast(a),v.dispose(),m}if(a==="int32")return s.int(u);if(a==="bool"){var b=Nt(0,u.dtype);return m=s.notEqual(u,b),b.dispose(),m}throw new Error("Error in Cast: unknown dtype argument ("+a+")")}function yh(u,a){return At.make(a,{dataId:u.dataId},u.dtype)}function Ey(u,a){if(u.length!==a.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+u.length+", imag: "+a.length+".");for(var s=new Float32Array(2*u.length),c=0;c<s.length;c+=2)s[c]=u[c/2],s[c+1]=a[c/2];return s}function QD(u){for(var a=new Float32Array(u.length/2),s=new Float32Array(u.length/2),c=0;c<u.length;c+=2)a[c/2]=u[c],s[c/2]=u[c+1];return{real:a,imag:s}}function JD(u){for(var a=Math.ceil(u.length/4),s=new Float32Array(a),c=new Float32Array(a),f=0;f<u.length;f+=4)s[Math.floor(f/4)]=u[f],c[Math.floor(f/4)]=u[f+1];return{real:s,imag:c}}function ZD(u){for(var a=Math.floor(u.length/4),s=new Float32Array(a),c=new Float32Array(a),f=2;f<u.length;f+=4)s[Math.floor(f/4)]=u[f],c[Math.floor(f/4)]=u[f+1];return{real:s,imag:c}}function ky(u,a){return{real:u[2*a],imag:u[2*a+1]}}function tA(u,a,s,c){u[2*c]=a,u[2*c+1]=s}function eA(u,a){for(var s=new Float32Array(u/2),c=new Float32Array(u/2),f=0;f<Math.ceil(u/2);f++){var m=(a?2:-2)*Math.PI*(f/u);s[f]=Math.cos(m),c[f]=Math.sin(m)}return{real:s,imag:c}}function nA(u,a,s){var c=(s?2:-2)*Math.PI*(u/a);return{real:Math.cos(c),imag:Math.sin(c)}}function bh(u,a,s,c,f){for(var m=Array.from(a).map(function(P,O){return{score:P,boxIndex:O}}).filter(function(P){return P.score>f}).sort(function(P,O){return O.score-P.score}),v=[],b=0;b<m.length;b++){var w=m[b],S=w.score,E=w.boxIndex;if(S<f)break;for(var R=!1,T=v.length-1;T>=0;--T)if(rA(u,E,v[T])>=c){R=!0;break}if(!R&&(v.push(E),v.length>=s))break}return Un(v,"int32")}function rA(u,a,s){var c=u.subarray(4*a,4*a+4),f=u.subarray(4*s,4*s+4),m=Math.min(c[0],c[2]),v=Math.min(c[1],c[3]),b=Math.max(c[0],c[2]),w=Math.max(c[1],c[3]),S=Math.min(f[0],f[2]),E=Math.min(f[1],f[3]),R=Math.max(f[0],f[2]),T=Math.max(f[1],f[3]),P=(b-m)*(w-v),O=(R-S)*(T-E);if(P<=0||O<=0)return 0;var $=Math.max(m,S),B=Math.max(v,E),U=Math.min(b,R),z=Math.min(w,T),j=Math.max(U-$,0)*Math.max(z-B,0);return j/(P+O-j)}function Ry(u,a,s){var c=Array(u.rank).fill(0),f=u.shape.slice();return a.map(function(m){f[s]=m;var v=u.slice(c,f);return c[s]+=m,v})}function Ty(u,a,s,c,f){for(var m=a[a.length-1],v=[u.length/m,m],b=v[0],w=v[1],S=ft(s,b*c),E=ft("int32",b*c),R=0;R<b;R++){for(var T=R*w,P=u.subarray(T,T+w),O=[],$=0;$<P.length;$++)O.push({value:P[$],index:$});O.sort(function(K,J){return J.value-K.value});var B=R*c,U=S.subarray(B,B+c),z=E.subarray(B,B+c);for($=0;$<c;$++)U[$]=O[$].value,z[$]=O[$].index}var j=a.slice();return j[j.length-1]=c,[kn(S,j,s),kn(E,j,"int32")]}var oA=function(){return function(u,a,s){this.variableNames=["A"];var c=u.windowSize,f=u.batchSize,m=u.inSize,v=Math.ceil(m/c);s||this.variableNames.push("bestIndicesA"),this.outputShape=[f,v];var b=a==="max"?">":"<",w=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+c+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+c+`; i++) {
          int inIdx = `+w+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+b+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}(),aA=function(){return function(u){this.variableNames=["dy"],this.outputShape=u.inShape;var a=u.filterHeight,s=u.filterWidth,c=u.strideHeight,f=u.strideWidth,m=u.dilationHeight,v=u.dilationWidth,b=u.effectiveFilterHeight,w=u.effectiveFilterWidth,S=b-1-u.padInfo.top,E=w-1-u.padInfo.left,R=1/(a*s);this.userCode=`
      const ivec2 pads = ivec2(`+S+", "+E+`);
      const float avgMultiplier = float(`+R+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+b+`;
            wR += `+m+`) {
          float dyR = float(dyRCorner + wR) / `+c+`.0;

          if (dyR < 0.0 || dyR >= `+u.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+w+`;
            wC+= `+v+`) {
            float dyC = float(dyCCorner + wC) / `+f+`.0;

            if (dyC < 0.0 || dyC >= `+u.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}();function as(u,a){for(var s=u.length,c=[],f=0;f<s;f++){var m=s-1-f,v=u[m]||1;(a[a.length-1-f]||1)>1&&v===1&&c.unshift(m)}return c}function rr(u,a){for(var s=[],c=0;c<a.length;c++){var f=u[u.length-c-1],m=a.length-c-1,v=a[m];(f==null||f===1&&v>1)&&s.unshift(m)}return s}function iA(u){for(var a=0;a<u.length;a++)if(u[a]!==a)return!1;return!0}function Ge(u,a){for(var s=[],c=Math.max(u.length,a.length),f=0;f<c;f++){var m=u[u.length-f-1];m==null&&(m=1);var v=a[a.length-f-1];if(v==null&&(v=1),m===1)s.unshift(v);else if(v===1)s.unshift(m);else{if(m!==v)throw Error("Operands could not be broadcast together with shapes "+u+" and "+a+".");s.unshift(m)}}return s}var sA=function(){return function(u,a,s,c,f,m){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],Ge(u,a),Ge(u,s);var v="0.0";c!=null&&(Ge(u,c),this.variableNames.push("offset"),v="getOffsetAtOutCoords()");var b="1.0";f!=null&&(Ge(u,f),this.variableNames.push("scale"),b="getScaleAtOutCoords()"),this.outputShape=u,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+v+`;
        float scale = `+b+`;
        float inv = scale * inversesqrt(variance + float(`+m+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),uA=function(){return function(u,a,s,c,f,m){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Ge(u,a),Ge(u,s);var v="vec4(0.0)";c!=null&&(Ge(u,c),this.variableNames.push("offset"),v="getOffsetAtOutCoords()");var b="vec4(1.0)";f!=null&&(Ge(u,f),this.variableNames.push("scale"),b="getScaleAtOutCoords()"),this.outputShape=u,this.userCode=`
      void main() {
        vec4 offset = `+v+`;
        vec4 scale = `+b+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+m+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),Dy={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Ay=function(){return function(u,a,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=Ge(a,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+u+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),xh=`
  if (isNaN(a)) return a;
  if (isNaN(b)) return b;
`,Iy="return a + b;",Ny="return a - b;",cA="return a * b;",lA=`if (a == b) return 1.0;
  return a / b;`,dA=`
  float resultSign = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  int result = ia / ib;
  int amodb = ia - ib * result;

  if (resultSign < 0.0 && amodb != 0) {
    result -= 1;
  }
  return float(result);
`,fA=`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,pA="return (a - b) * (a - b);",hA="return float(a == b);",mA="return float(a != b);",gA="return float(a < b);",vA="return float(a <= b);",yA="return float(a > b);",bA="return float(a >= b);",xA="return float(a >= 1.0 && b >= 1.0);",wA="return float(a >= 1.0 || b >= 1.0);",CA=xh+`
  return max(a, b);
`,SA=xh+`
  return min(a, b);
`,_A=`if (b == 0.0) return NAN;
  return mod(a, b);`,EA=xh+`
  return atan(a, b);
`,kA="return (b >= 1.0) ? a : a * (b + 1.0);",$n=function(){function u(a,s,c){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=Ge(s,c),this.userCode=`
      uniform float NAN;
      float binaryOperation(float a, float b) {
        `+a+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}return u.prototype.getCustomSetupFunc=function(){var a=this;return function(s,c){a.startLoc==null&&(a.startLoc=s.getUniformLocationNoThrow(c,"NAN"),a.startLoc==null)||s.gl.uniform1f(a.startLoc,NaN)}},u}(),RA=function(){return function(u,a,s){this.variableNames=["A"],this.outputShape=u,this.userCode=`
      void main() {
        float value = getAAtOutCoords();
        if (isNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, float(`+a+"), float("+s+`)));
      }
    `}}(),TA=function(){return function(u,a,s){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=u,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (hasNaN(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(`+a+"), vec4("+s+`)));
      }
    `}}(),DA=function(){return function(u){this.variableNames=["real","imag"],this.outputShape=u,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),AA=function(){return function(u,a){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=Ic([u,a],1),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        float value = 0.0;
        if (yC < `+u[1]+`) {
          value = getA(yR, yC);
        } else {
          yC -= `+u[1]+`;
          value = getB(yR, yC);
        }

        setOutput(value);
      }
    `}}(),IA=function(){return function(u){this.variableNames=["x","dy"],this.outputShape=u.filterShape;var a=u.strideHeight,s=u.strideWidth,c=u.padInfo.top,f=u.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+u.batchSize+`; b++) {
          for (int yR = 0; yR < `+u.outHeight+`; yR++) {
            int xR = wR + yR * `+a+" - "+c+`;

            if (xR < 0 || xR >= `+u.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+u.outWidth+`; yC++) {
              int xC = wC + yC * `+s+" - "+f+`;

              if (xC < 0 || xC >= `+u.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),NA=function(){return function(u){this.variableNames=["dy","W"],this.outputShape=u.inShape;var a=u.filterHeight,s=u.filterWidth,c=u.strideHeight,f=u.strideWidth,m=a-1-u.padInfo.top,v=s-1-u.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+m+", "+v+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+c+`.0;

          if (dyR < 0.0 || dyR >= `+u.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+a+` - 1 - wR;

          for (int wC = 0; wC < `+s+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+f+`.0;

            if (dyC < 0.0 || dyC >= `+u.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+s+` - 1 - wC;

            for (int d2 = 0; d2 < `+u.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),PA=function(){return function(u){this.variableNames=["x","dy"],this.outputShape=u.filterShape;var a=u.strideDepth,s=u.strideHeight,c=u.strideWidth,f=u.padInfo.front,m=u.padInfo.top,v=u.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+u.batchSize+`; b++) {
          for (int yF = 0; yF < `+u.outDepth+`; yF++) {
            int xF = wF + yF * `+a+" - "+f+`;

            if (xF < 0 || xF >= `+u.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+u.outHeight+`; yR++) {
              int xR = wR + yR * `+s+" - "+m+`;

              if (xR < 0 || xR >= `+u.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+u.outWidth+`; yC++) {
                int xC = wC + yC * `+c+" - "+v+`;

                if (xC < 0 || xC >= `+u.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),MA=function(){return function(u){this.variableNames=["dy","W"],this.outputShape=u.inShape;var a=u.filterDepth,s=u.filterHeight,c=u.filterWidth,f=u.strideDepth,m=u.strideHeight,v=u.strideWidth,b=a-1-u.padInfo.front,w=s-1-u.padInfo.top,S=c-1-u.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+b+", "+w+", "+S+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+a+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+f+`.0;

          if (dyF < 0.0 || dyF >= `+u.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+a+` - 1 - wF;

          for (int wR = 0; wR < `+s+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+m+`.0;

            if (dyR < 0.0 || dyR >= `+u.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+s+` - 1 - wR;

            for (int wC = 0; wC < `+c+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+v+`.0;

              if (dyC < 0.0 || dyC >= `+u.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+c+` - 1 - wC;

              for (int d2 = 0; d2 < `+u.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),OA=function(){return function(u){this.variableNames=["x","dy"],this.outputShape=u.filterShape;var a=u.strideHeight,s=u.strideWidth,c=u.padInfo.top,f=u.padInfo.left,m=u.outChannels/u.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+m+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+u.batchSize+`; b++) {
          for (int yR = 0; yR < `+u.outHeight+`; yR++) {
            int xR = wR + yR * `+a+" - "+c+`;

            if (xR < 0 || xR >= `+u.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+u.outWidth+`; yC++) {
              int xC = wC + yC * `+s+" - "+f+`;

              if (xC < 0 || xC >= `+u.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),FA=function(){return function(u){this.variableNames=["dy","W"],this.outputShape=u.inShape;var a=u.filterHeight,s=u.filterWidth,c=u.strideHeight,f=u.strideWidth,m=a-1-u.padInfo.top,v=s-1-u.padInfo.left,b=u.outChannels/u.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+m+", "+v+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+a+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+c+`.0;

          if (dyR < 0.0 || dyR >= `+u.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+a+` - 1 - wR;

          for (int wC = 0; wC < `+s+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+f+`.0;

            if (dyC < 0.0 || dyC >= `+u.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+s+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+b+`; dm++) {
              int d2 = d1 * `+b+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),$A=function(){return function(u){this.variableNames=["x","W"],this.outputShape=u.outShape;var a=u.padInfo.top,s=u.padInfo.left,c=u.strideHeight,f=u.strideWidth,m=u.dilationHeight,v=u.dilationWidth,b=u.filterHeight,w=u.filterWidth,S=4*Math.floor(u.inChannels/4),E=u.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+c+", "+f+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+b+`; wR++) {
          int xR = xRCorner + wR * `+m+`;

          if (xR < 0 || xR >= `+u.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC++) {
            int xC = xCCorner + wC * `+v+`;

            if (xC < 0 || xC >= `+u.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+S+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(E===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+S+`) *
                getW(wR, wC, `+S+`, d2);
            } else if (`+(E===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+S+`),
                getX(batch, xR, xC, `+S+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+S+`, d2),
                getW(wR, wC, `+S+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(E===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+S+`),
                getX(batch, xR, xC, `+S+` + 1),
                getX(batch, xR, xC, `+S+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+S+`, d2),
                getW(wR, wC, `+S+` + 1, d2),
                getW(wR, wC, `+S+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),BA=function(){return function(u){this.variableNames=["x","W"],this.outputShape=u.outShape;var a=u.padInfo.front,s=u.padInfo.top,c=u.padInfo.left,f=u.strideDepth,m=u.strideHeight,v=u.strideWidth,b=u.dilationDepth,w=u.dilationHeight,S=u.dilationWidth,E=u.filterDepth,R=u.filterHeight,T=u.filterWidth,P=4*Math.floor(u.inChannels/4),O=u.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+f+", "+m+", "+v+`);
      const ivec3 pads = ivec3(`+a+", "+s+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+E+`; wF++) {
          int xF = xFCorner + wF * `+b+`;

          if (xF < 0 || xF >= `+u.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+R+`; wR++) {
            int xR = xRCorner + wR * `+w+`;

            if (xR < 0 || xR >= `+u.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+T+`; wC++) {
              int xC = xCCorner + wC * `+S+`;

              if (xC < 0 || xC >= `+u.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+P+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(O===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+P+`) *
                  getW(wF, wR, wC, `+P+`, d2);
              } else if (`+(O===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+P+`),
                  getX(batch, xF, xR, xC, `+P+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+P+`, d2),
                  getW(wF, wR, wC, `+P+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(O===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+P+`),
                  getX(batch, xF, xR, xC, `+P+` + 1),
                  getX(batch, xF, xR, xC, `+P+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+P+`, d2),
                  getW(wF, wR, wC, `+P+` + 1, d2),
                  getW(wF, wR, wC, `+P+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),LA=function(){return function(u){this.variableNames=["x","W"],this.outputShape=u.outShape;var a=u.inHeight,s=u.inWidth,c=u.padInfo.top,f=u.padInfo.left,m=u.strideHeight,v=u.strideWidth,b=u.dilationHeight,w=u.dilationWidth,S=u.filterHeight,E=u.filterWidth,R=u.outChannels/u.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+m+", "+v+`);
      const ivec2 pads = ivec2(`+c+", "+f+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+R+`;
        int q = d2 - d1 * `+R+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+S+`; wR++) {
          int xR = xRCorner + wR * `+b+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC++) {
            int xC = xCCorner + wC * `+w+`;

            if (xC < 0 || xC >= `+s+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),WA=function(){return function(u){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=u.outShape;for(var a=u.inHeight,s=u.inWidth,c=u.padInfo.top,f=u.padInfo.left,m=u.strideHeight,v=u.strideWidth,b=u.filterHeight,w=u.filterWidth,S=Math.ceil((w+1)/2),E="int xR; int xC;",R=0;R<b;R++){for(var T=-f;T<2*S;T++)E+="vec4 "+vo(R,T)+" = vec4(0.);";for(T=0;T<w;T++)E+=`
          vec4 wR`+R+"C"+T+` = vec4(0.);
          vec4 xR`+R+"C"+T+" = vec4(0.);"}for(R=0;R<b;R++)for(T=0;T<S;T++){var P=2*T,O=2*T+f;E+=`
          xR = xRCorner + `+R+`;
          xC = xCCorner + `+O+`;

          if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+s+`) {
            `+vo(R,O)+` = getX(batch, xR, xC, d1);
          }`,f===0?P<w&&T===S-1&&(v>1&&(E+=`
                vec4 `+vo(R,O+2)+` = vec4(0.);

                if(xR >= 0 && xR < `+a+" && xC + 2 < "+s+`) {
                  `+vo(R,O+2)+` = getX(batch, xR, xC + 2, d1);
                }`),E+=`
              xR`+R+"C"+O+" = "+wh(R,O,v,f)+`;
            `):T===0&&(E+=`
            if(xR >= 0 && xR < `+a+` && xC - 2 >= 0) {
              `+vo(R,O-2)+` = getX(batch, xR, xC - 2, d1);
            }`),P>0&&(E+="xR"+R+"C"+(O-2)+` =
            `+wh(R,O-2,v,f)+";"),O-1>=0&&O-1<w&&(E+="xR"+R+"C"+(O-1)+` =
              `+wh(R,O-1,v,f)+";"),P<w&&(E+=`
            vec4 wTexel`+R+"C"+P+" = getW("+R+", "+P+`, d1, q);
            wR`+R+"C"+P+" = vec4(wTexel"+R+"C"+P+".xz, wTexel"+R+"C"+P+`.xz);
          `,P+1<w&&(E+=`
              vec4 wTexelR`+R+"C"+(P+1)+" = getW("+R+", "+(P+1)+`, d1, q);
              wR`+R+"C"+(P+1)+` =
                vec4(wTexelR`+R+"C"+(P+1)+".xz, wTexelR"+R+"C"+(P+1)+".xz);"))}for(R=0;R<b;R++)for(T=0;T<w;T++)E+="result += xR"+R+"C"+T+" * wR"+R+"C"+T+";";this.userCode=`
      const ivec2 strides = ivec2(`+m+", "+v+`);
      const ivec2 pads = ivec2(`+c+", "+f+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+E+`

        setOutput(result);
      }
    `}}();function vo(u,a){return"xTexelR"+u+"C"+(a<0?"minus"+Math.abs(a).toString():a)}function wh(u,a,s,c){return s===1?c%2==a%2?vo(u,a):"vec4("+vo(u,a-1)+".zw, "+vo(u,a+1)+".xy)":c%2==a%2?"vec4("+vo(u,a)+".xy, "+vo(u,a+2)+".xy)":"vec4("+vo(u,a-1)+".zw, "+vo(u,a+1)+".zw)"}var UA=function(){return function(u,a,s,c,f){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var m=u[0],v=u[1],b=u[2],w=u[3],S=a[0],E=s[0],R=s[1];this.outputShape=[S,E,R,w];var T=c==="bilinear"?1:0,P=[v-1+".0",b-1+".0"],O=P[0],$=P[1],B=E>1?[""+(v-1)/(E-1),"(y2-y1) * height_ratio","y1*"+O+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+O],U=B[0],z=B[1],j=B[2],K=R>1?[""+(b-1)/(R-1),"(x2-x1) * width_ratio","x1*"+$+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+$],J=K[0],dt=K[1],vt=K[2];this.userCode=`
      const float height_ratio = float(`+U+`);
      const float width_ratio = float(`+J+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+m+`) {
          return;
        }

        float height_scale = `+z+`;
        float width_scale = `+dt+`;

        float in_y = `+j+`;
        if( in_y < 0.0 || in_y > `+O+` ) {
          setOutput(float(`+f+`));
          return;
        }
        float in_x = `+vt+`;
        if( in_x < 0.0 || in_x > `+$+` ) {
          setOutput(float(`+f+`));
          return;
        }

        vec2 sourceFracIndexRC = vec2(in_y,in_x);
        if(`+T+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));

          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);
          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);
          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);
          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);

          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

          float top = topLeft + (topRight - topLeft) * fracRC.y;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          float newValue = top + (bottom - top) * fracRC.x;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestRC = ivec2(floor(
            sourceFracIndexRC + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);
          setOutput(newValue);
        }
      }
    `}}();function Nc(u,a,s){s===void 0&&(s="index");var c=Y(a);return c.map(function(f,m){return"int "+u[m]+" = "+s+" / "+f+"; "+(m===c.length-1?"int "+u[m+1]+" = "+s+" - "+u[m]+" * "+f:"index -= "+u[m]+" * "+f)+";"}).join("")}function Ad(u){return u.length===1?""+u[0]:"vec"+u.length+"("+u.join(",")+")"}function zA(u,a){if(u.length!==a.length)throw new Error("Vectors to be dotted must be of the same length -got "+u.length+" and "+a.length);for(var s=[],c=Math.floor(u.length/4),f=u.length%4,m=0;m<c;m++){var v=u.slice(4*m,4*m+4),b=a.slice(4*m,4*m+4);s.push(Ad(v)+", "+Ad(b))}return f!==0&&(v=u.slice(4*c),b=a.slice(4*c),v.length===1&&(v=v.map(function(w){return"float("+w+")"}),b=b.map(function(w){return"float("+w+")"})),s.push(Ad(v)+", "+Ad(b))),s.map(function(w,S){return"dot("+w+")"}).join("+")}function VA(u,a,s,c,f){var m=u.map(function(R){var T=L(R.shapeInfo.logicalShape);return R.shapeInfo.isUniform?"uniform float "+R.name+(T>1?"["+T+"]":"")+";":"uniform sampler2D "+R.name+";"});m=m.join(`
`);var v,b,w=u.map(function(R){return HA(R,a,c,f)}).join(`
`),S=a.texShape,E=nI;return a.isPacked?(v=GA(a.logicalShape,S),b=eI):(v=qA(a.logicalShape,S),b=tI),f&&(E+=rI),[E,ZA,b,m,v,w,s].join(`
`)}function hu(u){var a=u.shapeInfo.logicalShape;switch(a.length){case 0:return mI(u);case 1:return vI(u);case 2:return bI(u);case 3:return wI(u);case 4:return SI(u);case 5:return _I(u);case 6:return EI(u);default:throw new Error(a.length+"-D input sampling is not yet supported")}}function Py(u){var a=u.shapeInfo.logicalShape;switch(a.length){case 0:return hI(u);case 1:return gI(u);case 2:return yI(u);case 3:return xI(u);case 4:return CI(u);default:throw new Error("Packed "+a.length+"-D input sampling is not yet supported")}}function HA(u,a,s,c){c===void 0&&(c=!1);var f=kI(u);return f+=c?Py(u):hu(u),(s||q(u.shapeInfo.logicalShape,a.logicalShape))&&(f+=c?TI(u,a):DI(u,a,s)),f}function GA(u,a){switch(u.length){case 0:return My();case 1:return oI(u,a);case 2:return fI(u,a);case 3:return iI(u,a);case 4:return uI(u,a);default:throw new Error(u.length+"-D packed output coordinate fetching is not yet supported")}}function qA(u,a){switch(u.length){case 0:return My();case 1:return aI(u,a);case 2:return pI(u,a);case 3:return sI(u,a);case 4:return cI(u,a);case 5:return lI(u,a);case 6:return dI(u,a);default:throw new Error(u.length+"-D output sampling is not yet supported")}}var jA=`
vec2 UVfrom1D(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,KA=`
vec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {
  int index = row * numC + col;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,XA=`
vec2 UVfrom3D(int texNumR, int texNumC, int stride0,
    int stride1, int row, int col, int depth) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,YA=`
vec2 UVfrom4D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int row, int col, int depth,
    int depth2) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,
    int texelsInBatch, int texelsInLogicalRow, int b2, int b,
    int row, int col) {
  int index = b2 * texelsInBatch2 + b * texelsInBatch +
    (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QA=`
vec2 UVfrom5D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int row, int col, int depth,
    int depth2, int depth3) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 +
              depth * stride2 + depth2 * stride3 + depth3;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,JA=`
vec2 UVfrom6D(int texNumR, int texNumC, int stride0,
    int stride1, int stride2, int stride3, int stride4,
    int row, int col, int depth, int depth2, int depth3, int depth4) {
  // Explicitly use integer operations as dot() only works on floats.
  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *
    stride3 + depth3 * stride4 + depth4;
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ZA=`
  float sampleTexture(sampler2D textureSampler, vec2 uv) {
    return texture2D(textureSampler, uv).r;
  }
`,tI=`
  void setOutput(float val) {
    gl_FragColor = vec4(val, 0, 0, 0);
  }
`,eI=`
  void setOutput(vec4 val) {
    gl_FragColor = val;
  }
`,nI=`
  precision highp float;
  precision highp int;
  varying vec2 resultUV;
  const vec2 halfCR = vec2(0.5, 0.5);

  struct ivec5
  {
    int x;
    int y;
    int z;
    int w;
    int u;
  };

  struct ivec6
  {
    int x;
    int y;
    int z;
    int w;
    int u;
    int v;
  };

  `+(Z.get("PROD")?`
    bool isNaN(float val) {
      return false;
    }

    bool hasNaN(vec4 values) {
      return false;
    }
  `:`
    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    bool hasNaN(vec4 values) {
      return any(bvec4(
        isNaN(values.x),
        isNaN(values.y),
        isNaN(values.z),
        isNaN(values.w)
      ));
    }
  `)+`

  float getNaN(vec4 values) {
    return dot(vec4(1), values);
  }

  int round(float value) {
    return int(floor(value + 0.5));
  }

  int imod(int x, int y) {
    return x - y * (x / y);
  }

  //Based on the work of Dave Hoskins
  //https://www.shadertoy.com/view/4djSRW
  #define HASHSCALE1 443.8975
  float random(float seed){
    vec2 p = resultUV * seed;
    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
  }

  `+jA+`
  `+KA+`
  `+XA+`
  `+YA+`
  `+QA+`
  `+JA+`
`,rI=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function My(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function oI(u,a){var s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return a[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+s[1]+`.0);
      }
    `:a[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+s[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+s[0]+", "+s[1]+`));
      return resTexRC.x * `+s[1]+` + resTexRC.y;
    }
  `}function aI(u,a){return a[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+a[1]+`.0);
      }
    `:a[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+a[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+a[0]+", "+a[1]+`));
      return resTexRC.x * `+a[1]+` + resTexRC.y;
    }
  `}function iI(u,a){var s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(u[2]/2),f=c*Math.ceil(u[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+s[0]+", "+s[1]+`));
      int index = resTexRC.x * `+s[1]+` + resTexRC.y;

      int b = index / `+f+`;
      index -= b * `+f+`;

      int r = 2 * (index / `+c+`);
      int c = imod(index, `+c+`) * 2;

      return ivec3(b, r, c);
    }
  `}function sI(u,a){var s=Nc(["r","c","d"],u);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+a[0]+", "+a[1]+`));
      int index = resTexRC.x * `+a[1]+` + resTexRC.y;
      `+s+`
      return ivec3(r, c, d);
    }
  `}function uI(u,a){var s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(u[3]/2),f=c*Math.ceil(u[2]/2),m=f*u[1];return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+s[0]+", "+s[1]+`));
      int index = resTexRC.x * `+s[1]+` + resTexRC.y;

      int b2 = index / `+m+`;
      index -= b2 * `+m+`;

      int b = index / `+f+`;
      index -= b * `+f+`;

      int r = 2 * (index / `+c+`);
      int c = imod(index, `+c+`) * 2;

      return ivec4(b2, b, r, c);
    }
  `}function cI(u,a){var s=Nc(["r","c","d","d2"],u);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+a[0]+", "+a[1]+`));
      int index = resTexRC.x * `+a[1]+` + resTexRC.y;
      `+s+`
      return ivec4(r, c, d, d2);
    }
  `}function lI(u,a){var s=Nc(["r","c","d","d2","d3"],u);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+a[0]+`,
                             `+a[1]+`));

      int index = resTexRC.x * `+a[1]+` + resTexRC.y;

      `+s+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function dI(u,a){var s=Nc(["r","c","d","d2","d3","d4"],u);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+a[0]+", "+a[1]+`));
      int index = resTexRC.x * `+a[1]+` + resTexRC.y;

      `+s+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function fI(u,a){var s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(q(u,a))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+s[0]+", "+s[1]+`));
      }
    `;var c=Math.ceil(u[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+s[0]+", "+s[1]+`));

      int index = resTexRC.x * `+s[1]+` + resTexRC.y;
      int r = 2 * (index / `+c+`);
      int c = imod(index, `+c+`) * 2;

      return ivec2(r, c);
    }
  `}function pI(u,a){return q(u,a)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+a[0]+", "+a[1]+`));
      }
    `:u[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+a[0]+", "+a[1]+`));
        int index = resTexRC.x * `+a[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:u[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+a[0]+", "+a[1]+`));
        int index = resTexRC.x * `+a[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+a[0]+", "+a[1]+`));
      int index = resTexRC.x * `+a[1]+` + resTexRC.y;
      int r = index / `+u[1]+`;
      int c = index - r * `+u[1]+`;
      return ivec2(r, c);
    }
  `}function hI(u){var a=u.name;return`
    vec4 `+("get"+a.charAt(0).toUpperCase()+a.slice(1))+`() {
      return texture2D(`+a+`, halfCR);
    }
  `}function mI(u){var a=u.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1);return u.shapeInfo.isUniform?"float "+s+"() {return "+a+";}":`
    float `+s+`() {
      return sampleTexture(`+a+`, halfCR);
    }
  `}function gI(u){var a=u.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),c=u.shapeInfo.texShape,f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+f[0]+", "+f[1]+`, index);
      return texture2D(`+a+`, uv);
    }
  `}function vI(u){var a=u.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1);return`
    float `+s+`(int index) {
      return `+s+`Flat(index);
    }
  `}function yI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=u.shapeInfo.texShape,m=f[0],v=f[1];if(f!=null&&q(a,f))return`
      vec4 `+c+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+v+".0, "+m+`.0);

        return texture2D(`+s+`, uv);
      }
    `;var b=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];return`
    vec4 `+c+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+Math.ceil(a[1]/2)+", "+b[0]+", "+b[1]+`, row, col);
      return texture2D(`+s+`, uv);
    }
  `}function bI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=u.shapeInfo.texShape;if(f!=null&&q(a,f)){var m=f[0];return`
    float `+c+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+f[1]+".0, "+m+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `}var v=lt(a),b=v.newShape,w=v.keptDims,S=b;if(S.length<a.length)return`
      `+hu(mu(u,S))+`
      float `+c+`(int row, int col) {
        return `+c+"("+gu(["row","col"],w)+`);
      }
    `;if(u.shapeInfo.isUniform)return`
      float `+c+`(int row, int col) {
        float index = dot(vec2(row, col), vec2(`+a[1]+`, 1));
        return `+c+`Flat(round(index));
      }
    `;var E=f[0],R=f[1];return R===1?`
    float `+c+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+a[1]+`, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+E+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `:E===1?`
    float `+c+`(int row, int col) {
      float index = dot(vec2(row, col), vec2(`+a[1]+`, 1));
      vec2 uv = vec2((index + 0.5) / `+R+`.0, 0.5);
      return sampleTexture(`+s+`, uv);
    }
  `:`
  float `+c+`(int row, int col) {
    vec2 uv = UVfrom2D(`+E+", "+R+", "+a[1]+`, row, col);
    return sampleTexture(`+s+`, uv);
  }
`}function xI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=u.shapeInfo.texShape,m=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];if(a[0]===1)return`
        `+Py(mu(u,a.slice(1)))+`
        vec4 `+c+`(int b, int row, int col) {
          return `+c+"("+gu(["b","row","col"],[1,2])+`);
        }
      `;var v=m[0],b=m[1],w=Math.ceil(a[2]/2);return`
    vec4 `+c+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+v+", "+b+", "+w*Math.ceil(a[1]/2)+", "+w+`, b, row, col);
      return texture2D(`+s+`, uv);
    }
  `}function wI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a[1]*a[2],m=a[2],v=lt(a),b=v.newShape,w=v.keptDims,S=b;if(S.length<a.length)return`
        `+hu(mu(u,S))+`
        float `+c+`(int row, int col, int depth) {
          return `+c+"("+gu(["row","col","depth"],w)+`);
        }
      `;if(u.shapeInfo.isUniform)return`
      float `+c+`(int row, int col, int depth) {
        float index = dot(vec3(row, col, depth),
                          vec3(`+f+", "+m+`, 1));
        return `+c+`Flat(round(index));
      }
    `;var E=u.shapeInfo.texShape,R=E[0],T=E[1];return T===f?`
        float `+c+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+m+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+T+".0, "+R+`.0);
          return sampleTexture(`+s+`, uv);
        }
      `:T===m?`
    float `+c+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+a[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+T+".0, "+R+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `:`
      float `+c+`(int row, int col, int depth) {
        vec2 uv = UVfrom3D(
            `+R+", "+T+", "+f+", "+m+`, row, col, depth);
        return sampleTexture(`+s+`, uv);
      }
  `}function CI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=u.shapeInfo.texShape,m=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],v=m[0],b=m[1],w=Math.ceil(a[3]/2),S=w*Math.ceil(a[2]/2);return`
    vec4 `+c+`(int b2, int b, int row, int col) {
      vec2 uv = packedUVfrom4D(
        `+v+", "+b+", "+S*a[1]+`,
        `+S+", "+w+`, b2, b, row, col);
      return texture2D(`+s+`, uv);
    }
  `}function SI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a[3],m=a[2]*f,v=a[1]*m,b=lt(a),w=b.newShape,S=b.keptDims;if(w.length<a.length)return`
      `+hu(mu(u,w))+`
      float `+c+`(int row, int col, int depth, int depth2) {
        return `+c+"("+gu(["row","col","depth","depth2"],S)+`);
      }
    `;if(u.shapeInfo.isUniform)return`
      float `+c+`(int row, int col, int depth, int depth2) {
        float index = dot(vec4(row, col, depth, depth2),
                          vec4(`+v+", "+m+", "+f+`, 1));
        return `+c+`Flat(round(index));
      }
    `;var E=u.shapeInfo.texShape,R=E[0],T=E[1];return T===v?`
      float `+c+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2), vec3(`+m+", "+f+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+T+".0, "+R+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:T===f?`
      float `+c+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+a[1]*a[2]+", "+a[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+T+".0, "+R+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:`
    float `+c+`(int row, int col, int depth, int depth2) {
      vec2 uv = UVfrom4D(`+R+", "+T+", "+v+", "+m+`,
          `+f+`, row, col, depth, depth2);
      return sampleTexture(`+s+`, uv);
    }
  `}function _I(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a[4],m=a[3]*f,v=a[2]*m,b=a[1]*v,w=lt(a),S=w.newShape,E=w.keptDims;if(S.length<a.length)return`
      `+hu(mu(u,S))+`
      float `+c+`(int row, int col, int depth, int depth2, int depth3) {
        return `+c+"("+gu(["row","col","depth","depth2","depth3"],E)+`);
      }
    `;if(u.shapeInfo.isUniform)return`
      float `+c+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+b+", "+v+", "+m+", "+f+`)) +
          depth3;
        return `+c+`Flat(index);
      }
    `;var R=u.shapeInfo.texShape,T=R[0],P=R[1];return P===b?`
      float `+c+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+v+", "+m+", "+f+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+P+".0, "+T+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:P===f?`
      float `+c+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+a[1]*a[2]*a[3]+", "+a[2]*a[3]+`,
            `+a[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+P+".0, "+T+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:`
    float `+c+`(int row, int col, int depth, int depth2, int depth3) {
      vec2 uv = UVfrom5D(`+T+", "+P+", "+b+", "+v+`,
          `+m+", "+f+`, row, col, depth, depth2, depth3);
      return sampleTexture(`+s+`, uv);
    }
  `}function EI(u){var a=u.shapeInfo.logicalShape,s=u.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a[5],m=a[4]*f,v=a[3]*m,b=a[2]*v,w=a[1]*b,S=lt(a),E=S.newShape,R=S.keptDims;if(E.length<a.length)return`
      `+hu(mu(u,E))+`
      float `+c+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+c+"("+gu(["row","col","depth","depth2","depth3","depth4"],R)+`);
      }
    `;if(u.shapeInfo.isUniform)return`
      float `+c+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+w+", "+b+", "+v+", "+m+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+f+`, 1));
        return `+c+`Flat(index);
      }
    `;var T=u.shapeInfo.texShape,P=T[0],O=T[1];return O===w?`
      float `+c+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(
          vec4(col, depth, depth2, depth3),
          vec4(`+b+", "+v+", "+m+", "+f+`)) + depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+O+".0, "+P+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:O===f?`
      float `+c+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+a[1]*a[2]*a[3]*a[4]+`,
               `+a[2]*a[3]*a[4]+`,
               `+a[3]*a[4]+`,
               `+a[4]+`)) + depth3;
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+O+".0, "+P+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `:`
    float `+c+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      vec2 uv = UVfrom6D(`+P+", "+O+", "+w+", "+b+`,
          `+v+", "+m+", "+f+`
          ,row, col, depth, depth2, depth3, depth4);
      return sampleTexture(`+s+`, uv);
    }
  `}function kI(u){var a=u.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1)+"Flat",c=L(u.shapeInfo.logicalShape);if(u.shapeInfo.isUniform)return c===1?"float "+s+"(int index) {return "+a+";}":`
      float `+s+`(int index) {
        for (int i = 0; i < `+c+`; i++) {
          if (i == index) {
            return `+a+`[i];
          }
        }
      }
    `;var f=u.shapeInfo.texShape,m=f[0],v=f[1];return v===1&&m===1?`
      float `+s+`(int index) {
        return sampleTexture(`+a+`, halfCR);
      }
    `:v===1?`
      float `+s+`(int index) {
        vec2 uv = vec2(0.5, (float(index) + 0.5) / `+m+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `:m===1?`
      float `+s+`(int index) {
        vec2 uv = vec2((float(index) + 0.5) / `+v+`.0, 0.5);
        return sampleTexture(`+a+`, uv);
      }
    `:`
    float `+s+`(int index) {
      vec2 uv = UVfrom1D(`+m+", "+v+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}function RI(u,a,s,c){var f=u.shapeInfo.logicalShape.length,m=a.logicalShape.length,v="int";m===2?v="ivec2":m===3?v="ivec3":m===4&&(v="ivec4");var b=as(u.shapeInfo.logicalShape,a.logicalShape),w=m-f;return`
    float `+c+`() {
      `+v+` coords = getOutputCoords();
      `+(f===0?"":m<2&&b.length>=1?"coords = 0;":b.map(function(S){return"coords["+(S+w)+"] = 0;"}).join(`
`))+`
      return get`+s+"("+(m<2&&f>0?"coords":u.shapeInfo.logicalShape.map(function(S,E){return"coords["+(E+w)+"]"}).join(", "))+`);
    }
  `}function TI(u,a,s){var c=u.name,f=c.charAt(0).toUpperCase()+c.slice(1),m=u.shapeInfo.texShape,v="get"+f+"AtOutCoords",b=a.texShape,w=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],S=w[0],E=w[1],R=as(u.shapeInfo.logicalShape,a.logicalShape),T=u.shapeInfo.logicalShape.length,P=a.logicalShape.length;if(R.length)throw Error("Packed broadcast sampling is not implemented yet.");if(q(u.shapeInfo.texShape,b))return`
      vec4 `+v+`() {
        return texture2D(`+c+`, resultUV);
      }
    `;var O="return texture2D("+c+", uv)";return T===1&&P>1?O=`
      vec4 sample = texture2D(`+c+`, uv);
      return vec4(sample.xy, sample.xy);
    `:T===0&&P>0&&(O=P===1?`
        vec4 sample = texture2D(`+c+`, uv);
        return vec4(sample.x, sample.x, 0., 0.);
      `:`
        vec4 sample = texture2D(`+c+`, uv);
        return vec4(sample.x);
      `),`
    vec4 `+v+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      int texR = index / `+E+`;
      int texC = index - texR * `+E+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+E+", "+S+`);

      `+O+`;
    }
  `}function DI(u,a,s){var c=u.name,f=c.charAt(0).toUpperCase()+c.slice(1),m="get"+f+"AtOutCoords",v=as(u.shapeInfo.logicalShape,a.logicalShape),b=u.shapeInfo.logicalShape.length,w=a.logicalShape.length,S=s&&(w>b||v.length>0),E=iA(v),R=u.shapeInfo.isUniform;if(S&&!E)return RI(u,a,f,m);var T=L(u.shapeInfo.logicalShape),P="";S&&E&&(P=`
        int mainPart = index / `+T+`;
        index -= mainPart * `+T+`;
      `);var O=a.texShape;if(R)return T===1?"float "+m+"() {return "+c+";}":`
      float `+m+`() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                              vec2(`+O[0]+", "+O[1]+`));
        int index = resTexRC.x * `+O[1]+` + resTexRC.y;
        `+P+`
        return get`+f+`Flat(index);
      }
    `;var $=u.shapeInfo.texShape;return q($,O)?`
      float `+m+`() {
        return sampleTexture(`+c+`, resultUV);
      }
    `:`
    float `+m+`() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+O[0]+", "+O[1]+`));
      int index = resTexRC.x * `+O[1]+` + resTexRC.y;
      `+P+`
      int texR = index / `+$[1]+`;
      int texC = index - texR * `+$[1]+`;
      vec2 uv = (vec2(texC, texR) + halfCR) /
                 vec2(`+$[1]+".0, "+$[0]+`.0);

      return sampleTexture(`+c+`, uv);
    }
  `}function br(u){if(u<=1)return"int";if(u===2)return"ivec2";if(u===3)return"ivec3";if(u===4)return"ivec4";if(u===5)return"ivec5";if(u===6)return"ivec6";throw Error("GPU for rank "+u+" is not yet supported")}function mu(u,a){var s=JSON.parse(JSON.stringify(u));return s.shapeInfo.logicalShape=a,s}function gu(u,a){return a.map(function(s){return u[s]}).join(", ")}var AI=function(){return function(u,a,s){this.variableNames=["x"],this.outputShape=u;var c=u.length,f=u[u.length-1],m=s?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(s?"return "+f+" -i - 1;":"return i;")+`
      }

      void main() {
        `+br(c)+` coords = getOutputCoords();
        int end = `+Oy(c,"coords")+`;
        float val = 0.0;
        for (int i = `+f+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+m+` end) {
            continue;
          }
          if (idx == end && `+a+`) {
            continue;
          }
          `+Oy(c,"coords")+` = idx;
          val += getX(`+II(c,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function II(u,a){if(u===1)return""+a;if(u===2)return a+".x, "+a+".y";if(u===3)return a+".x, "+a+".y, "+a+".z";if(u===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+u+" is not yet supported")}function Oy(u,a){if(u===1)return""+a;if(u===2)return a+".y";if(u===3)return a+".z";if(u===4)return a+".w";throw Error("Cumulative sum for rank "+u+" is not yet supported")}var NI=function(){function u(a,s,c){this.variableNames=["x"],this.outputShape=[],this.outputShape=a,this.blockSize=s,this.dataFormat=c,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+s+`;
      int offset_h = imod(h, `+s+`);
      int in_w = w / `+s+`;
      int offset_w = imod(w, `+s+`);
      int offset_d = (offset_h * `+s+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return u.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},u.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},u.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},u.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},u.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},u}(),PI=function(){return function(u){this.variableNames=["A"],this.outputShape=u,this.userCode=`
      const float FLOAT_MAX = 1.70141184e38;
      const float FLOAT_MIN = 1.17549435e-38;

      lowp vec4 encode_float(highp float v) {
        if (isNaN(v)) {
          return vec4(255, 255, 255, 255);
        }

        highp float av = abs(v);

        if(av < FLOAT_MIN) {
          return vec4(0.0, 0.0, 0.0, 0.0);
        } else if(v > FLOAT_MAX) {
          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
        } else if(v < -FLOAT_MAX) {
          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
        }

        highp vec4 c = vec4(0,0,0,0);

        highp float e = floor(log2(av));
        highp float m = exp2(fract(log2(av))) - 1.0;

        c[2] = floor(128.0 * m);
        m -= c[2] / 128.0;
        c[1] = floor(32768.0 * m);
        m -= c[1] / 32768.0;
        c[0] = floor(8388608.0 * m);

        highp float ebias = e + 127.0;
        c[3] = floor(ebias / 2.0);
        ebias -= c[3] * 2.0;
        c[2] += floor(ebias) * 128.0;

        c[3] += 128.0 * step(0.0, -v);

        return c / 255.0;
      }

      void main() {
        float x = getAAtOutCoords();
        gl_FragColor = encode_float(x);
      }
    `}}(),Fy={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},$y=function(){return function(u,a,s){this.variableNames=["real","imag"];var c=a[1];this.outputShape=a;var f=s?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,m=s?c+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+f+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+u+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+c+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+c+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+m+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),MI=function(){return function(u){this.variableNames=["A"];var a=u[0],s=u[1];this.outputShape=u,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+s+".0, "+a+`.0);

        vec4 values = texture2D(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),OI=function(){return function(u,a,s){this.variableNames=["A","indices"];var c=u.slice();c[s]=a,this.outputShape=c,this.rank=c.length;var f=br(this.rank),m=FI(u,s);this.userCode=`
      void main() {
        `+f+` resRC = getOutputCoords();
        setOutput(getA(`+m+`));
      }
    `}}();function FI(u,a){var s=u.length;if(s>4)throw Error("Gather for rank "+s+" is not yet supported");if(s===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[],m=0;m<u.length;m++)m===a?f.push("int(getIndices("+c[m]+"))"):f.push(""+c[m]);return f.join()}var ta,qr,$I=function(){return function(u,a,s){this.sliceDim=u,this.strides=a,this.variableNames=["x","indices"],this.outputShape=s;var c=br(a.length),f=br(s.length),m=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+c+" strides = "+c+"("+this.strides+`);
         void main() {
          `+f+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+m+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function vu(u,a){return[a,u]}function yu(u,a){return u*a}function BI(u,a){if(u%a!=0)throw new Error("unpackedSize ("+u+") must be a multiple of "+a);return u/a}function LI(u,a,s){var c=yu(u.length,s);if(a.length<c)throw new Error("unpackedArray length ("+a.length+") must be >= "+c);for(var f=0,m=0;m<u.length;++m)a[f]=u[m],f+=s}function By(u,a,s){var c=BI(u.length,s);if(a.length<c)throw new Error("matrix length ("+a.length+") must be >= "+c);for(var f=0,m=0;m<u.length;m+=s)a[f++]=u[m]}function is(u,a){return[Math.max(1,Math.ceil(a/2)),Math.max(1,Math.ceil(u/2))]}function Id(u,a){var s=is(u,a);return s[0]*s[1]*4}function WI(u,a,s,c,f){var m=Id(s,c);if(f.length<m)throw new Error("packedRGBA length ("+f.length+`) must be >=
        `+m);for(var v=c%2==1,b=s%2==1,w=Math.floor(c/2),S=Math.floor(s/2),E=Math.ceil(c/2),R=E*Math.ceil(s/2),T=k(s)*k(c),P=0;P<a;P++){for(var O=P*s*c,$=P*T,B=v?4:0,U=c,z=$,j=0;j<S;++j){for(var K=2*j*c,J=0;J<w;++J){var dt=O+K+2*J;f[z]=u[dt],f[z+1]=u[dt+1],f[z+2]=u[dt+U],f[z+3]=u[dt+U+1],z+=4}z+=B}if(v){dt=O+c-1,z=$+4*(E-1);var vt=2*c;for(B=4*E,j=0;j<S;++j)f[z]=u[dt],f[z+2]=u[dt+c],dt+=vt,z+=B}if(b){for(dt=O+(s-1)*c,z=$+4*(R-E),J=0;J<w;++J)f[z++]=u[dt++],f[z++]=u[dt++],z+=2;v&&b&&(f[$+T-4]=u[dt])}}return f}function Ly(u,a,s,c,f){var m=s*c;if(f.length<m)throw new Error("matrix length ("+f.length+") must be >= "+m);for(var v=c%2==1,b=s%2==1,w=Math.floor(c/2),S=Math.floor(s/2),E=Math.ceil(c/2),R=E*Math.ceil(s/2),T=k(s)*k(c),P=0;P<a;P++){for(var O=P*s*c,$=P*T,B=v?4:0,U=c+(v?1:0),z=$,j=O,K=O+c,J=0;J<S;++J){for(var dt=0;dt<w;++dt)f[j++]=u[z++],f[j++]=u[z++],f[K++]=u[z++],f[K++]=u[z++];z+=B,j+=U,K+=U}if(v){z=$+4*(E-1);var vt=O+c-1;for(B=4*E,U=2*c,J=0;J<S;++J)f[vt]=u[z],f[vt+c]=u[z+2],z+=B,vt+=U}if(b){for(z=$+4*(R-E),vt=O+(s-1)*c,dt=0;dt<w;++dt)f[vt++]=u[z++],f[vt++]=u[z++],z+=2;v&&(f[O+s*c-1]=u[z])}}return f}function Qt(u,a){var s=a();return zy(u),s}(function(u){u[u.RENDER=0]="RENDER",u[u.UPLOAD=1]="UPLOAD",u[u.PIXELS=2]="PIXELS",u[u.DOWNLOAD=3]="DOWNLOAD"})(ta||(ta={})),function(u){u[u.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",u[u.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",u[u.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",u[u.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",u[u.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(qr||(qr={}));var Wy=!1;function Uy(u){Wy=u}function zy(u){if(Wy){var a=u.getError();if(a!==u.NO_ERROR)throw new Error("WebGL Error: "+Vy(u,a))}}function Vy(u,a){switch(a){case u.NO_ERROR:return"NO_ERROR";case u.INVALID_ENUM:return"INVALID_ENUM";case u.INVALID_VALUE:return"INVALID_VALUE";case u.INVALID_OPERATION:return"INVALID_OPERATION";case u.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case u.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case u.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+a}}function Pc(u,a){return Ia(u,function(){return u.getExtension(a)},'Extension "'+a+'" not supported on this browser.')}function Hy(u,a){var s=Ia(u,function(){return u.createShader(u.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Qt(u,function(){return u.shaderSource(s,a)}),Qt(u,function(){return u.compileShader(s)}),u.getShaderParameter(s,u.COMPILE_STATUS)===!1)throw console.log(u.getShaderInfoLog(s)),new Error("Failed to compile vertex shader.");return s}function Gy(u,a){var s=Ia(u,function(){return u.createShader(u.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Qt(u,function(){return u.shaderSource(s,a)}),Qt(u,function(){return u.compileShader(s)}),u.getShaderParameter(s,u.COMPILE_STATUS)===!1)throw zI(a,u.getShaderInfoLog(s)),new Error("Failed to compile fragment shader.");return s}var UI=/ERROR: [0-9]+:([0-9]+):/g;function zI(u,a){var s=UI.exec(a);if(s==null)return console.log("Couldn't parse line number in error: "+a),void console.log(u);for(var c=+s[1],f=u.split(`
`),m=f.length.toString().length+2,v=f.map(function(T,P){return gt((P+1).toString(),m)+T}),b=0,w=0;w<v.length;w++)b=Math.max(v[w].length,b);var S=v.slice(0,c-1),E=v.slice(c-1,c),R=v.slice(c);console.log(S.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+gt(E[0],b),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(R.join(`
`))}function qy(u){return Ia(u,function(){return u.createProgram()},"Unable to create WebGLProgram.")}function jy(u,a){if(Qt(u,function(){return u.linkProgram(a)}),u.getProgramParameter(a,u.LINK_STATUS)===!1)throw console.log(u.getProgramInfoLog(a)),new Error("Failed to link vertex and fragment shaders.")}function Nd(u,a){if(Qt(u,function(){return u.validateProgram(a)}),u.getProgramParameter(a,u.VALIDATE_STATUS)===!1)throw console.log(u.getProgramInfoLog(a)),new Error("Shader program validation failed.")}function Ky(u,a){var s=Ia(u,function(){return u.createBuffer()},"Unable to create WebGLBuffer");return Qt(u,function(){return u.bindBuffer(u.ARRAY_BUFFER,s)}),Qt(u,function(){return u.bufferData(u.ARRAY_BUFFER,a,u.STATIC_DRAW)}),s}function Xy(u,a){var s=Ia(u,function(){return u.createBuffer()},"Unable to create WebGLBuffer");return Qt(u,function(){return u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s)}),Qt(u,function(){return u.bufferData(u.ELEMENT_ARRAY_BUFFER,a,u.STATIC_DRAW)}),s}function Yy(){return Z.get("WEBGL_VERSION")===2?1:4}function Qy(u){return Ia(u,function(){return u.createTexture()},"Unable to create WebGLTexture.")}function Ch(u,a){var s=Z.get("WEBGL_MAX_TEXTURE_SIZE");if(u<=0||a<=0){var c="["+u+"x"+a+"]";throw new Error("Requested texture size "+c+" is invalid.")}if(u>s||a>s)throw c="["+u+"x"+a+"]",new Error("Requested texture size "+c+" greater than WebGL maximum on this browser / GPU "+("["+s+"x"+s+"]")+".")}function Jy(u){return Ia(u,function(){return u.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Sh(u,a,s,c,f,m,v){var b=u.getAttribLocation(a,s);return b!==-1&&(Qt(u,function(){return u.bindBuffer(u.ARRAY_BUFFER,c)}),Qt(u,function(){return u.vertexAttribPointer(b,f,u.FLOAT,!1,m,v)}),Qt(u,function(){return u.enableVertexAttribArray(b)}),!0)}function Zy(u,a,s){ob(u,s),Qt(u,function(){return u.activeTexture(u.TEXTURE0+s)}),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,a)})}function VI(u,a){ob(u,a),Qt(u,function(){return u.activeTexture(u.TEXTURE0+a)}),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,null)})}function tb(u,a,s){return Ia(u,function(){return u.getUniformLocation(a,s)},'uniform "'+s+'" not present in program.')}function eb(u,a,s){return u.getUniformLocation(a,s)}function nb(u,a,s,c,f){Qt(u,function(){return Zy(u,s,f)}),Qt(u,function(){return u.uniform1i(c,f)})}function HI(u){Qt(u,function(){return u.bindFramebuffer(u.FRAMEBUFFER,null)}),Qt(u,function(){return u.viewport(0,0,u.canvas.width,u.canvas.height)}),Qt(u,function(){return u.scissor(0,0,u.canvas.width,u.canvas.height)})}function Pd(u,a,s){Qt(u,function(){return u.bindFramebuffer(u.FRAMEBUFFER,s)}),Qt(u,function(){return u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0)})}function _h(u,a){Qt(u,function(){return u.bindFramebuffer(u.FRAMEBUFFER,a)}),Qt(u,function(){return u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,null,0)})}function Mc(u){var a=u.checkFramebufferStatus(u.FRAMEBUFFER);if(a!==u.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+rb(u,a))}function rb(u,a){switch(a){case u.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case u.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case u.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case u.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+a}}function Ia(u,a,s){var c=Qt(u,function(){return a()});if(c==null)throw new Error(s);return c}function ob(u,a){var s=u.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,c=a+u.TEXTURE0;if(c<u.TEXTURE0||c>s)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+s+"]")+".")}function ab(u,a){a===void 0&&(a=!1);var s=Z.get("WEBGL_MAX_TEXTURE_SIZE");if(a&&(s*=2,u=u.map(function(m,v){return v>=u.length-2?k(u[v]):u[v]})),u.length!==2){var c=lt(u);u=c.newShape}var f=L(u);return u.length<=1&&f<=s?[1,f]:u.length===2&&u[0]<=s&&u[1]<=s?u:u.length===3&&u[0]*u[1]<=s&&u[2]<=s?[u[0]*u[1],u[2]]:u.length===3&&u[0]<=s&&u[1]*u[2]<=s?[u[0],u[1]*u[2]]:u.length===4&&u[0]*u[1]*u[2]<=s&&u[3]<=s?[u[0]*u[1]*u[2],u[3]]:u.length===4&&u[0]<=s&&u[1]*u[2]*u[3]<=s?[u[0],u[1]*u[2]*u[3]]:at(f)}function bu(u){return u%2==0}function Eh(u,a){if(q(u=u.slice(-2),a=a.slice(-2))||!u.length||!a.length||u[0]===0||u[1]===0||a[0]===0||a[1]===0)return!0;if(u.length!==a.length){var s=u.slice(-1)[0],c=a.slice(-1)[0];if(s===c||bu(s)&&bu(c)&&(u[0]===1||a[0]===1))return!0}else if(bu(u[0])&&bu(a[0])&&(bu(u[1])&&bu(a[1])||u[1]===a[1]))return!0;return!1}var GI=Object.freeze({callAndCheck:Qt,enableDebugWebGLErrorChecking:Uy,checkWebGLError:zy,getWebGLErrorMessage:Vy,getExtensionOrThrow:Pc,createVertexShader:Hy,createFragmentShader:Gy,createProgram:qy,linkProgram:jy,validateProgram:Nd,createStaticVertexBuffer:Ky,createStaticIndexBuffer:Xy,getNumChannels:Yy,createTexture:Qy,validateTextureSize:Ch,createFramebuffer:Jy,bindVertexBufferToProgramAttribute:Sh,bindTextureUnit:Zy,unbindTextureUnit:VI,getProgramUniformLocationOrThrow:tb,getProgramUniformLocation:eb,bindTextureToProgramUniformSampler:nb,bindCanvasToFramebuffer:HI,bindColorTextureToFramebuffer:Pd,unbindColorTextureFromFramebuffer:_h,validateFramebuffer:Mc,getFramebufferErrorMessage:rb,getTextureShapeFromLogicalShape:ab,isReshapeFree:Eh});function ib(u){return Hy(u,`
    precision highp float;
    attribute vec3 clipSpacePos;
    attribute vec2 uv;
    varying vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function sb(u){return Ky(u,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function ub(u){return Xy(u,new Uint16Array([0,1,2,2,1,3]))}function cb(u,a){var s,c,f,m,v,b,w,S=u;return Z.get("WEBGL_VERSION")===2?(s=S.R32F,c=S.R16F,f=S.RGBA32F,m=S.RED,v=4,b=1,w=S.HALF_FLOAT):(s=u.RGBA,c=u.RGBA,f=S.RGBA,m=u.RGBA,v=4,b=4,w=a!=null?a.HALF_FLOAT_OES:null),{internalFormatFloat:s,internalFormatHalfFloat:c,internalFormatPackedFloat:f,textureFormatFloat:m,downloadTextureFormat:u.RGBA,downloadUnpackNumChannels:v,defaultNumChannels:b,textureTypeHalfFloat:w}}function Oc(u,a,s,c,f,m){Ch(a,s);var v=Qy(u),b=u.TEXTURE_2D;return Qt(u,function(){return u.bindTexture(b,v)}),Qt(u,function(){return u.texParameteri(b,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE)}),Qt(u,function(){return u.texParameteri(b,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE)}),Qt(u,function(){return u.texParameteri(b,u.TEXTURE_MIN_FILTER,u.NEAREST)}),Qt(u,function(){return u.texParameteri(b,u.TEXTURE_MAG_FILTER,u.NEAREST)}),Qt(u,function(){return u.texImage2D(b,0,c,a,s,0,f,m,null)}),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,null)}),v}function lb(u,a,s,c){var f=vu(a,s);return Oc(u,f[0],f[1],c.internalFormatFloat,c.textureFormatFloat,u.FLOAT)}function db(u,a,s,c){var f=vu(a,s);return Oc(u,f[0],f[1],c.internalFormatFloat,c.textureFormatFloat,c.textureTypeHalfFloat)}function fb(u,a,s,c){var f=vu(a,s);return Oc(u,f[0],f[1],u.RGBA,u.RGBA,u.UNSIGNED_BYTE)}function pb(u,a,s,c){var f=is(a,s);return Oc(u,f[0],f[1],c.internalFormatPackedFloat,u.RGBA,u.FLOAT)}function hb(u,a,s,c){var f=is(a,s);return Oc(u,f[0],f[1],c.internalFormatHalfFloat,u.RGBA,c.textureTypeHalfFloat)}function mb(u,a,s){return Qt(u,function(){return u.bindBuffer(u.ARRAY_BUFFER,s)}),Sh(u,a,"clipSpacePos",s,3,20,0)&&Sh(u,a,"uv",s,2,20,12)}function gb(u,a,s){Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,a)}),Qt(u,function(){return u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,s)}),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,null)})}function vb(u,a,s,c,f,m){Ch(s,c),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,a)}),Qt(u,function(){return u.texSubImage2D(u.TEXTURE_2D,0,0,0,s,c,m,u.FLOAT,f)}),Qt(u,function(){return u.bindTexture(u.TEXTURE_2D,null)})}function yb(u,a,s,c,f,m,v){var b,w=vu(s,c),S=w[0],E=w[1];v.defaultNumChannels===1?b=f:LI(f,b=new Float32Array(yu(f.length,m)),m),vb(u,a,S,E,b,v.textureFormatFloat)}function bb(u,a,s,c,f,m,v,b,w){var S=is(m,v),E=S[0],R=S[1],T=new Float32Array(s*Id(c,f));WI(b,s,c,f,T),vb(u,a,E,R,T,u.RGBA)}function xb(u,a,s,c,f){var m=a;if(Z.get("WEBGL_VERSION")===2){var v=u,b=v.createBuffer();Qt(u,function(){return u.bindBuffer(v.PIXEL_PACK_BUFFER,b)});var w=4*yu(s*c,f.downloadUnpackNumChannels);Qt(u,function(){return u.bufferData(v.PIXEL_PACK_BUFFER,w,u.STATIC_DRAW)}),Qt(u,function(){return v.readPixels(0,0,c,s,u.RGBA,u.FLOAT,0)}),Qt(u,function(){return u.bindBuffer(v.PIXEL_PACK_BUFFER,null)}),m=b}return m}function wb(u,a,s,c,f){var m=u,v=new Float32Array(yu(s*c,f.downloadUnpackNumChannels));m.bindBuffer(u.ARRAY_BUFFER,a),m.getBufferSubData(u.ARRAY_BUFFER,0,v),m.bindBuffer(u.ARRAY_BUFFER,null);var b=new Float32Array(s*c);return By(v,b,f.downloadUnpackNumChannels),b}function Cb(u,a,s,c){var f=vu(a,s),m=f[0],v=f[1],b=new Float32Array(yu(a*s,c.downloadUnpackNumChannels));Qt(u,function(){return u.readPixels(0,0,m,v,c.downloadTextureFormat,u.FLOAT,b)});var w=new Float32Array(a*s);return By(b,w,c.downloadUnpackNumChannels),w}function Sb(u,a,s,c){var f=vu(a,s),m=f[0],v=f[1],b=new Uint8Array(yu(a*s,4));return Qt(u,function(){return u.readPixels(0,0,m,v,c.downloadTextureFormat,u.UNSIGNED_BYTE,b)}),new Float32Array(b.buffer)}function _b(u,a,s,c,f,m,v,b){var w=u,S=new Float32Array(Id(m,v));w.bindBuffer(u.ARRAY_BUFFER,a),w.getBufferSubData(u.ARRAY_BUFFER,0,S),w.bindBuffer(u.ARRAY_BUFFER,null);var E=new Float32Array(L([s,c,f]));return Ly(S,s,c,f,E),E}function Eb(u,a,s,c,f,m,v){var b=is(f,m),w=b[0],S=b[1],E=new Float32Array(Id(f,m));Qt(u,function(){return u.readPixels(0,0,w,S,u.RGBA,u.FLOAT,E)});var R=new Float32Array(L([a,s,c]));return Ly(E,a,s,c,R)}var qI=Object.freeze({createVertexShader:ib,createVertexBuffer:sb,createIndexBuffer:ub,getTextureConfig:cb,createFloat32MatrixTexture:lb,createFloat16MatrixTexture:db,createUnsignedBytesMatrixTexture:fb,createPackedMatrixTexture:pb,createFloat16PackedMatrixTexture:hb,bindVertexProgramAttributeStreams:mb,uploadPixelDataToTexture:gb,uploadMatrixToTexture:yb,uploadMatrixToPackedTexture:bb,maybeCreateBufferFromOutputTexture:xb,downloadFloat32MatrixFromBuffer:wb,downloadFloat32MatrixFromOutputTexture:Cb,downloadByteEncodedFloatMatrixFromOutputTexture:Sb,downloadPackedMatrixFromBuffer:_b,downloadMatrixFromPackedOutputTexture:Eb}),kb=function(){function u(a){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=a??g(Z.get("WEBGL_VERSION")),Z.get("WEBGL_VERSION")===1?(this.textureFloatExtension=Pc(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Z.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Pc(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Pc(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=sb(this.gl),this.indexBuffer=ub(this.gl),this.framebuffer=Jy(this.gl),this.textureConfig=cb(this.gl,this.textureHalfFloatExtension)}return u.prototype.dispose=function(){var a=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var s=this.gl;Qt(s,function(){return s.finish()}),Qt(s,function(){return s.bindFramebuffer(s.FRAMEBUFFER,null)}),Qt(s,function(){return s.deleteFramebuffer(a.framebuffer)}),Qt(s,function(){return s.bindBuffer(s.ARRAY_BUFFER,null)}),Qt(s,function(){return s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}),Qt(s,function(){return s.deleteBuffer(a.indexBuffer)}),this.disposed=!0}},u.prototype.enableAutomaticDebugValidation=function(a){this.autoDebugValidate=a,Uy(a)},u.prototype.createFloat32MatrixTexture=function(a,s){return this.throwIfDisposed(),lb(this.gl,a,s,this.textureConfig)},u.prototype.createFloat16MatrixTexture=function(a,s){return this.throwIfDisposed(),db(this.gl,a,s,this.textureConfig)},u.prototype.createUnsignedBytesMatrixTexture=function(a,s){return this.throwIfDisposed(),fb(this.gl,a,s,this.textureConfig)},u.prototype.uploadPixelDataToTexture=function(a,s){this.throwIfDisposed(),gb(this.gl,a,s)},u.prototype.createFloat16PackedMatrixTexture=function(a,s){return this.throwIfDisposed(),hb(this.gl,a,s,this.textureConfig)},u.prototype.createPackedMatrixTexture=function(a,s){return this.throwIfDisposed(),pb(this.gl,a,s,this.textureConfig)},u.prototype.deleteMatrixTexture=function(a){var s=this;this.throwIfDisposed(),this.outputTexture===a&&(_h(this.gl,this.framebuffer),this.outputTexture=null),Qt(this.gl,function(){return s.gl.deleteTexture(a)})},u.prototype.uploadMatrixToTexture=function(a,s,c,f){this.throwIfDisposed();var m=Yy();return yb(this.gl,a,s,c,f,m,this.textureConfig)},u.prototype.uploadMatrixToPackedTexture=function(a,s,c,f,m,v,b){return this.throwIfDisposed(),bb(this.gl,a,s,c,f,m,v,b,this.textureConfig)},u.prototype.downloadFloat32MatrixFromOutputTexture=function(a,s,c){var f=this;return this.downloadMatrixDriver(a,function(){return Cb(f.gl,s,c,f.textureConfig)})},u.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(a,s,c){var f=this;return this.downloadMatrixDriver(a,function(){return Sb(f.gl,s,c,f.textureConfig)})},u.prototype.downloadPackedMatrixFromBuffer=function(a,s,c,f,m,v){return _b(this.gl,a,s,c,f,m,v,this.textureConfig)},u.prototype.downloadFloat32MatrixFromBuffer=function(a,s,c){return wb(this.gl,a,s,c,this.textureConfig)},u.prototype.maybeCreateBufferFromTexture=function(a,s,c){this.bindTextureToFrameBuffer(a);var f=xb(this.gl,a,s,c,this.textureConfig);return this.unbindTextureToFrameBuffer(),f},u.prototype.createAndWaitForFence=function(){var a=this.createFence(this.gl);return this.pollFence(a)},u.prototype.createFence=function(a){var s,c,f=this;if(Z.get("WEBGL_FENCE_API_ENABLED")){var m=a,v=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);a.flush(),c=function(){var b=m.clientWaitSync(v,0,0);return b===m.ALREADY_SIGNALED||b===m.CONDITION_SATISFIED},s=v}else Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(s=this.beginQuery(),this.endQuery(),c=function(){return f.isQueryAvailable(s,Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):c=function(){return!0};return{query:s,isFencePassed:c}},u.prototype.downloadMatrixFromPackedTexture=function(a,s,c,f,m,v){var b=this;return this.downloadMatrixDriver(a,function(){return Eb(b.gl,s,c,f,m,v,b.textureConfig)})},u.prototype.createProgram=function(a){this.throwIfDisposed();var s=this.gl,c=Gy(s,a),f=ib(s),m=qy(s);return Qt(s,function(){return s.attachShader(m,f)}),Qt(s,function(){return s.attachShader(m,c)}),jy(s,m),this.autoDebugValidate&&Nd(s,m),this.vertexAttrsAreBound||(this.setProgram(m),this.vertexAttrsAreBound=mb(s,this.program,this.vertexBuffer)),m},u.prototype.deleteProgram=function(a){var s=this;this.throwIfDisposed(),a===this.program&&(this.program=null),a!=null&&Qt(this.gl,function(){return s.gl.deleteProgram(a)})},u.prototype.setProgram=function(a){var s=this;this.throwIfDisposed(),this.program=a,this.program!=null&&this.autoDebugValidate&&Nd(this.gl,this.program),Qt(this.gl,function(){return s.gl.useProgram(a)})},u.prototype.getUniformLocation=function(a,s,c){return c===void 0&&(c=!0),this.throwIfDisposed(),c?tb(this.gl,a,s):eb(this.gl,a,s)},u.prototype.getAttributeLocation=function(a,s){var c=this;return this.throwIfDisposed(),Qt(this.gl,function(){return c.gl.getAttribLocation(a,s)})},u.prototype.getUniformLocationNoThrow=function(a,s){return this.throwIfDisposed(),this.gl.getUniformLocation(a,s)},u.prototype.setInputMatrixTexture=function(a,s,c){this.throwIfDisposed(),this.throwIfNoProgram(),nb(this.gl,this.program,a,s,c)},u.prototype.setOutputMatrixTexture=function(a,s,c){this.setOutputMatrixTextureDriver(a,c,s)},u.prototype.setOutputPackedMatrixTexture=function(a,s,c){this.throwIfDisposed();var f=is(s,c),m=f[0],v=f[1];this.setOutputMatrixTextureDriver(a,m,v)},u.prototype.setOutputMatrixWriteRegion=function(a,s,c,f){this.setOutputMatrixWriteRegionDriver(c,a,f,s)},u.prototype.setOutputPackedMatrixWriteRegion=function(a,s,c,f){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},u.prototype.debugValidate=function(){this.program!=null&&Nd(this.gl,this.program),Mc(this.gl)},u.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var a=this.gl;this.autoDebugValidate&&this.debugValidate(),Qt(a,function(){return a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)})},u.prototype.blockUntilAllProgramsCompleted=function(){var a=this;this.throwIfDisposed(),Qt(this.gl,function(){return a.gl.finish()})},u.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Pc(this.gl,Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},u.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},u.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},u.prototype.beginQuery=function(){if(Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var a=this.gl,s=this.getQueryTimerExtensionWebGL2(),c=a.createQuery();return a.beginQuery(s.TIME_ELAPSED_EXT,c),c}var f=this.getQueryTimerExtensionWebGL1(),m=f.createQueryEXT();return f.beginQueryEXT(f.TIME_ELAPSED_EXT,m),m},u.prototype.endQuery=function(){if(Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var a=this.getQueryTimerExtensionWebGL1();a.endQueryEXT(a.TIME_ELAPSED_EXT)}else{var s=this.gl,c=this.getQueryTimerExtensionWebGL2();s.endQuery(c.TIME_ELAPSED_EXT)}},u.prototype.waitForQueryAndGetTime=function(a){return l(this,void 0,void 0,function(){var s=this;return d(this,function(c){switch(c.label){case 0:return[4,Ct(function(){return s.disposed||s.isQueryAvailable(a,Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return c.sent(),[2,this.getQueryTime(a,Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},u.prototype.getQueryTime=function(a,s){if(s===0)return null;if(s===2){var c=this.gl;return c.getQueryParameter(a,c.QUERY_RESULT)/1e6}var f=this.getQueryTimerExtensionWebGL1();return f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6},u.prototype.isQueryAvailable=function(a,s){if(s===0)return!0;if(s===2){var c=this.gl,f=this.getQueryTimerExtensionWebGL2(),m=c.getQueryParameter(a,c.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(f.GPU_DISJOINT_EXT)),m&&!this.disjoint}return m=(f=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(a,f.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(f.GPU_DISJOINT_EXT)),m&&!this.disjoint},u.prototype.pollFence=function(a){var s=this;return new Promise(function(c){s.addItemToPoll(function(){return a.isFencePassed()},function(){return c()})})},u.prototype.pollItems=function(){for(var a=jI(this.itemsToPoll.map(function(c){return c.isDoneFn})),s=0;s<=a;++s)(0,this.itemsToPoll[s].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(a+1)},u.prototype.addItemToPoll=function(a,s){var c=this;this.itemsToPoll.push({isDoneFn:a,resolveFn:s}),this.itemsToPoll.length>1||Ct(function(){return c.pollItems(),c.itemsToPoll.length===0})},u.prototype.bindTextureToFrameBuffer=function(a){this.throwIfDisposed(),Pd(this.gl,a,this.framebuffer),this.autoDebugValidate&&Mc(this.gl)},u.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Pd(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&Mc(this.gl)):_h(this.gl,this.framebuffer)},u.prototype.downloadMatrixDriver=function(a,s){this.bindTextureToFrameBuffer(a);var c=s();return this.unbindTextureToFrameBuffer(),c},u.prototype.setOutputMatrixTextureDriver=function(a,s,c){this.throwIfDisposed();var f=this.gl;Pd(f,a,this.framebuffer),this.autoDebugValidate&&Mc(f),this.outputTexture=a,Qt(f,function(){return f.viewport(0,0,s,c)}),Qt(f,function(){return f.scissor(0,0,s,c)})},u.prototype.setOutputMatrixWriteRegionDriver=function(a,s,c,f){var m=this;this.throwIfDisposed(),Qt(this.gl,function(){return m.gl.scissor(a,s,c,f)})},u.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},u.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},u}();function jI(u){for(var a=0,s=u.length-1,c=-1;a<=s;){var f=a+s>>1;u[f]()?(c=f,a=f+1):s=f-1}return c}function KI(u,a,s,c){for(var f=a.userCode,m=s.map(function(P,O){var $={logicalShape:P.shape,texShape:P.isUniform?null:P.texData.texShape,isUniform:P.isUniform,isPacked:!P.isUniform&&P.texData.isPacked};return{name:a.variableNames[O],shapeInfo:$}}),v=m.map(function(P){return P.shapeInfo}),b={logicalShape:c.shape,texShape:c.texData.texShape,isUniform:!1,isPacked:c.texData.isPacked},w=VA(m,b,f,a.supportsBroadcasting===!0,a.usesPackedTextures),S=u.createProgram(w),E={},R=0;R<a.variableNames.length;R++){var T=a.variableNames[R];E[T]=u.getUniformLocation(S,T,!1)}return{program:a,source:w,webGLProgram:S,uniformLocations:E,gpgpu:u,inShapeInfos:v,outShapeInfo:b}}function Rb(u,a){if(u.length!==a.length)throw Error("Binary was compiled with "+u.length+" inputs, but was executed with "+a.length+" inputs");u.forEach(function(s,c){var f=s.logicalShape,m=a[c],v=m.shape;if(!q(f,v))throw Error("Binary was compiled with different shapes than the current args. Shapes "+f+" and "+v+" must match");if(!s.isUniform||!m.isUniform){var b=s.texShape,w=m.isUniform?null:m.texData.texShape;if(!q(b,w))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+b+" and "+w+" must match")}})}function XI(u,a,s,c){Rb(u.inShapeInfos,a),Rb([u.outShapeInfo],[s]);var f=s.texData.texture,m=s.texData.texShape,v=u.gpgpu;s.texData.isPacked?v.setOutputPackedMatrixTexture(f,m[0],m[1]):v.setOutputMatrixTexture(f,m[0],m[1]),v.setProgram(u.webGLProgram),a.forEach(function(b,w){var S=u.program.variableNames[w],E=u.uniformLocations[S];if(E!=null){if(b.isUniform){if(L(b.shape)===1)v.gl.uniform1f(E,b.uniformValues[0]);else{var R=b.uniformValues;R instanceof Float32Array||(R=new Float32Array(R)),v.gl.uniform1fv(E,R)}return}var T=b.texData.texture;v.setInputMatrixTexture(T,E,w)}}),c!=null&&c(v,u.webGLProgram),v.executeProgram()}function YI(u,a,s){var c="";a.concat(s).forEach(function(b){c+=b.shape+"_"+(b.isUniform?"uniform":b.texData.texShape)});var f=u.userCode,m=(u.supportsBroadcasting===!0).toString(),v=u.constructor.name;return v+="_"+m+"_"+c+"_"+f}var QI=function(){return function(u,a,s){this.variableNames=["A"],this.outputShape=u;var c=s.filterWidth,f=s.inChannels,m=s.strideWidth,v=s.strideHeight,b=s.padInfo,w=s.outWidth,S=s.dilationWidth,E=s.dilationHeight,R=b.left,T=b.top,P=f*c;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+u[1]+" || pos >= "+u[0]+`) continue;

            int offsetY = int(blockIndex / (`+w+")) * "+v+" - "+T+`;
            int d0 = offsetY + `+E+" * (pos / "+P+`);

            if(d0 >= `+a[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+w+".) * "+m+". - "+R+`.);
            int d1 = offsetX + `+S+" * (int(mod(float(pos), "+P+".) / "+f+`.));

            if(d1 >= `+a[1]+` || d1 < 0) continue;

            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), `+f+`.)));
          }
        }

        gl_FragColor = result;
      }
    `}}(),JI=function(){return function(u,a,s,c,f){this.variableNames=["x"],this.outputShape=[];var m,v=a,b=u[3]-1;this.outputShape=u;var w="float("+s+") + float("+c+") * sum";m=f===.5?"inversesqrt("+w+")":f===1?"1.0/("+w+")":"exp(log("+w+") * float(-"+f+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+v+"; j <= "+v+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+b+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+m+`;
        setOutput(val);
      }
    `}}(),ZI=function(){return function(u,a,s,c,f){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=u,this.depth=u[3],this.depthRadius=a,this.bias=s,this.alpha=c,this.beta=f,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+a+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+a+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+c+") * norm + float("+s+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+c+`)
                * float(`+f+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+f+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),tN=function(){return function(u){this.variableNames=["dy","maxPos"],this.outputShape=u.inShape;var a=u.strideHeight,s=u.strideWidth,c=u.dilationHeight,f=u.effectiveFilterHeight,m=u.effectiveFilterWidth,v=f-1-u.padInfo.top,b=m-1-u.padInfo.left,w=f*m-1;this.userCode=`
      const ivec2 pads = ivec2(`+v+", "+b+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+f+`;
          wR += `+c+`) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+u.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+m+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+u.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+w+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+m+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),eN=function(){return function(u,a,s,c){s===void 0&&(s=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"];var f=u[0],m=s?u[2]:u[1],v=c?a[1]:a[2],b=s?u[1]:u[2];this.outputShape=[f,m,v];var w=function(T,P){return s?"batch, "+P+" + "+T+", aRow":"batch, aRow, "+P+" + "+T},S=function(T,P){return c?"batch, bCol, "+P+" + "+T:"batch, "+P+" + "+T+", bCol"},E=4*Math.floor(b/4),R=b%4;this.userCode=` float dotARowBCol(int batch, int aRow, int bCol) {
      float result = 0.0;
      for (int i = 0; i < `+E+`; i += 4) {
        vec4 a = vec4(
          getMatrixA(`+w(0,"i")+`),
          getMatrixA(`+w(1,"i")+`),
          getMatrixA(`+w(2,"i")+`),
          getMatrixA(`+w(3,"i")+`)
        );
        vec4 b = vec4(
          getMatrixB(`+S(0,"i")+`),
          getMatrixB(`+S(1,"i")+`),
          getMatrixB(`+S(2,"i")+`),
          getMatrixB(`+S(3,"i")+`)
        );

        result += dot(a, b);
      }

      if (`+(R===1)+`) {
        result += getMatrixA(`+w(0,E)+`) *
          getMatrixB(`+S(0,E)+`);
      } else if (`+(R===2)+`) {
        vec2 a = vec2(
          getMatrixA(`+w(0,E)+`),
          getMatrixA(`+w(1,E)+`)
        );
        vec2 b = vec2(
          getMatrixB(`+S(0,E)+`),
          getMatrixB(`+S(1,E)+`)
        );
        result += dot(a, b);
      } else if (`+(R===3)+`) {
        vec3 a = vec3(
          getMatrixA(`+w(0,E)+`),
          getMatrixA(`+w(1,E)+`),
          getMatrixA(`+w(2,E)+`)
        );
        vec3 b = vec3(
          getMatrixB(`+S(0,E)+`),
          getMatrixB(`+S(1,E)+`),
          getMatrixB(`+S(2,E)+`)
        );
        result += dot(a, b);
      }

      return result;
    }

    void main() {
      ivec3 resBRC = getOutputCoords();
      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));
    }
    `}}(),Tb=function(){return function(u,a,s,c,f){c===void 0&&(c=!1),f===void 0&&(f=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=s;var m=c?u[0]:u[1],v=Math.ceil(m/2),b=c?"i * 2, rc.x":"rc.x, i * 2",w=f?"rc.y, i * 2":"i * 2, rc.y",S=c?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],E=f?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode=`
      const float sharedDimension = `+v+`.0;

      vec4 dot2x2ARowBCol(ivec2 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+v+`; i++) {
          vec4 a = getMatrixA(`+b+`);
          vec4 b = getMatrixB(`+w+`);

          result += (`+S[0]+" * "+E[0]+") + ("+S[1]+" * "+E[1]+`);
        }
        return result;
      }

      void main() {
        ivec2 rc = getOutputCoords();
        setOutput(dot2x2ARowBCol(rc));
      }
    `}}(),nN=function(){function u(a,s,c){this.variableNames=["probs"],this.outputShape=[a,c],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(s-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(s-1)+`));
      }
    `}return u.prototype.getCustomSetupFunc=function(a){var s=this;return function(c,f){s.seedLoc==null&&(s.seedLoc=c.getUniformLocation(f,"seed")),c.gl.uniform1f(s.seedLoc,a)}},u}(),rN=function(){return function(u,a,s,c){this.variableNames=["indices"],this.outputShape=[u,a],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+c+"), float("+s+`),
                      float(index == coords.y)));
      }
    `}}();function oN(u,a){return["x","y","z","w","u","v"].slice(0,a).map(function(s){return u+"."+s})}function Db(u,a){return a===1?[u]:oN(u,a)}function aN(u,a){if(u===1)return"rc";for(var s="",c=0;c<u;c++)s+=a[c],c<u-1&&(s+=",");return s}var iN=function(){return function(u){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=u;var a=u.length;if(a===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var s=Db("rc",a),c=br(a),f=uN(a,u,s),m=cN(a,u[u.length-1],u[u.length-2],s),v=lN(u,s);this.userCode=`
        void main() {
          `+c+` rc = getOutputCoords();

          if(`+f+`) {
            setOutput(vec4(0));
          } else {
            `+m+`

            setOutput(vec4(`+v+`));
          }
        }
      `}}}();function sN(u,a){for(var s=[],c=0;c<=1;c++)for(var f=0;f<=1;f++){for(var m=(c===0?"r":"rp1")+", "+(f===0?"c":"cp1"),v=2;v<u;v++)m=a[a.length-1-v]+","+m;s.push(m)}return s}function uN(u,a,s){if(u===1)return"rc > "+a[0];for(var c="",f=u-2;f<u;f++)c+=s[f]+" >= "+a[f],f<u-1&&(c+="||");return c}function cN(u,a,s,c){if(u===1)return"";var f=c.slice(-2);return`
    int r = `+f[0]+`;
    int c = `+f[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+a+`;
    bool rEdge = rp1 >= `+s+`;
  `}function lN(u,a){var s=u.length,c=sN(s,a);return s===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}var dN=function(){return function(u,a,s){this.variableNames=["x"],this.outputShape=a.map(function(w,S){return w[0]+u[S]+w[1]});var c=u.length,f=br(c),m=a.map(function(w){return w[0]}).join(","),v=a.map(function(w,S){return w[0]+u[S]}).join(","),b=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,c);this.userCode=c!==1?`
      `+f+" start = "+f+"("+m+`);
      `+f+" end = "+f+"("+v+`);

      void main() {
        `+f+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+s+`));
        } else {
          `+f+` coords = outC - start;
          setOutput(getX(`+b+`));
        }
      }
    `:`
        int start = `+m+`;
        int end = `+v+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+s+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),kh=function(){return function(u,a,s){if(this.variableNames=["x"],a==="avg"&&s)throw new Error("Cannot compute positions for average pool.");var c=u.filterWidth,f=u.strideHeight,m=u.strideWidth,v=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterHeight,S=u.effectiveFilterWidth,E=u.padInfo.top,R=u.padInfo.left;this.outputShape=u.outShape;var T=a==="avg",P="0.0";if(T||(P="-1.0 / 0.0"),s)this.userCode=`
        const ivec2 strides = ivec2(`+f+", "+m+`);
        const ivec2 pads = ivec2(`+E+", "+R+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+w+`;
              wR += `+v+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+u.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+S+`;
                wC += `+b+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+u.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+S+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var O=a+"("+a+"("+a+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";a==="avg"&&(O="avgValue / count");var $=4*Math.floor(c/4),B=c%4,U=`
      if (`+T+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+f+", "+m+`);
      const ivec2 pads = ivec2(`+E+", "+R+`);
      const float initializationValue = `+P+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+u.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+P+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+w+`;
            wR += `+v+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+u.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+$+`; wC += 4) {
            int xC = xCCorner + wC * `+b+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+b+`, d),
              getValue(batch, xR, xC + 2 * `+b+`, d),
              getValue(batch, xR, xC + 3 * `+b+`, d)
            );

            `+U+`
          }

          int xC = xCCorner + `+$+`;
          if (`+(B===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+U+`
          } else if (`+(B===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+b+`, d),
              initializationValue,
              initializationValue
            );

            `+U+`
          } else if (`+(B===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+b+`, d),
              getValue(batch, xR, xC + 2 * `+b+`, d),
              initializationValue
            );

            `+U+`
          }
        }
        setOutput(`+O+`);
      }
    `}}}(),fN=function(){return function(u,a){this.variableNames=["x"];var s=u.windowSize,c=u.batchSize,f=u.inSize,m=Math.ceil(f/s);this.outputShape=[c,m];var v="0.0",b="";a==="prod"?v="1.0":a==="min"?(v="1.0 / 0.0",b="min"):a==="max"&&(v="-1.0 / 0.0",b="max");var w=a+"("+a+"("+a+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";a==="sum"?w="sumValue":a==="prod"?w="prodValue":a==="all"?w="allValue":a==="any"&&(w="anyValue");var S=4*Math.floor(s/4),E=s%4,R=`
      if (`+(a==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(a==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+b+`(values, minMaxValue);
      }
    `,T="vec4";a==="all"?(v="1.0",R=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,T="bvec4"):a==="any"&&(v="0.0",R=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,T="bvec4");var P="";f%s>0&&(P=`
        if (inIdx < 0 || inIdx >= `+f+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+P+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+s+`;

        vec4 minMaxValue = vec4(`+v+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+S+`; i += 4) {
          int inIdx = inOffset + i;
          `+T+" values = "+T+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+R+`
        }

        int inIdx = inOffset + `+S+`;
        if (`+(E===1)+`) {
          `+T+" values = "+T+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+R+`
        } else if (`+(E===2)+`) {
          `+T+" values = "+T+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+R+`
        } else if (`+(E===3)+`) {
          `+T+" values = "+T+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+R+`
        }
        setOutput(`+w+`);
      }
    `}}(),pN=function(){return function(u,a){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=u;for(var s="",c=0;c<4;c++){var f="thisRC = rc;";c%2==1&&(f+="thisRC.z += 1;"),c>1&&(f+="thisRC.y += 1;"),s+=`
        `+f+`
        `+(c>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+c+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(c>0?"}":"")+`
      `}this.userCode=`
      `+mN(a)+`
      `+hN(u)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+u[1]+`;
        int cols = `+u[2]+`;

        `+s+`

        setOutput(result);
      }
    `}}();function hN(u){return`
    int getFlatIndex(ivec3 coords) {
      return round(`+zA(["coords.x","coords.y","coords.z"],Y(u).map(function(a){return a.toString()}).concat(["1."]))+`);
    }
  `}function mN(u){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Nc(["r","c","d"],u)+`
      return ivec3(r, c, d);
    }
  `}var gN=function(){return function(u,a,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=a.shape;var c=a.shape,f=c[1],m=c[2],v=u.shape,b=v[1],w=v[2],S=[s&&b>1?f-1:f,s&&w>1?m-1:m],E=[s&&b>1?b-1:b,s&&w>1?w-1:w],R=S[0]/E[0],T=S[1]/E[1],P=1/R,O=1/T,$=2*Math.ceil(P)+2,B=2*Math.ceil(O)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+R+`);
        const float widthScale = float(`+T+`);

        const float invHeightScale = float(`+P+`);
        const float invWidthScale = float(`+O+`);

        const int winHeight = int(`+$+`);
        const int winWidth = int(`+B+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+b+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+w+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(f-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(m-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),vN=function(){return function(u,a,s,c){this.variableNames=["A"],this.outputShape=[];var f=u[0],m=u[1],v=u[2],b=u[3];this.outputShape=[f,a,s,b];var w=[c&&a>1?m-1:m,c&&s>1?v-1:v],S=[c&&a>1?a-1:a,c&&s>1?s-1:s];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+w[0]/S[0]+`,
          `+w[1]/S[1]+`);
      const vec2 inputShapeRC = vec2(`+m+".0, "+v+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),yN=function(){return function(u,a,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=a.shape;var c=a.shape,f=c[1],m=c[2],v=u.shape,b=v[1],w=v[2],S=[s&&b>1?f-1:f,s&&w>1?m-1:m],E=[s&&b>1?b-1:b,s&&w>1?w-1:w],R=S[0]/E[0],T=S[1]/E[1],P=1/R,O=1/T,$=2*Math.ceil(P)+2,B=2*Math.ceil(O)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+R+`);
        const float widthScale = float(`+T+`);

        const float invHeightScale = float(`+P+`);
        const float invWidthScale = float(`+O+`);

        const int winHeight = int(`+$+`);
        const int winWidth = int(`+B+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+b+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+w+`) {
              continue;
            }

            float sourceFracRow =
              float(`+S[0]+`) *
                (float(dyR) / float(`+E[0]+`));

            float sourceFracCol =
                float(`+S[1]+`) *
                  (float(dyC) / float(`+E[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+f+`) - 1),
                `+s+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+m+`) - 1),
                `+s+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),bN=function(){return function(u,a,s,c){this.variableNames=["A"],this.outputShape=[];var f=u[0],m=u[1],v=u[2],b=u[3];this.outputShape=[f,a,s,b];var w=[c&&a>1?m-1:m,c&&s>1?v-1:v],S=[c&&a>1?a-1:a,c&&s>1?s-1:s],E=c?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+w[0]/S[0]+`,
          `+w[1]/S[1]+`);
      const vec2 inputShapeRC = vec2(`+m+".0, "+v+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+E+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),xN=function(){return function(u,a){this.variableNames=["x"];var s=u.length;if(s>4)throw new Error("WebGL backend: Reverse of rank-"+s+" tensor is not yet supported");if(this.outputShape=u,s!==1){var c=u.map(function(m,v){return function(b){return a.indexOf(b)!==-1&&u[b]!==1?u[b]+" - coords["+b+"] - 1":"coords["+b+"]"}(v)}).join(","),f=br(s);this.userCode=`
      void main() {
        `+f+` coords = getOutputCoords();
        setOutput(getX(`+c+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+u[0]+` - coord - 1));
        }
      `}}(),Ab=function(){return function(u,a,s,c,f,m,v){this.variableNames=["updates","indices","defaultValue"],this.outputShape=m;var b=br(f.length),w=br(m.length),S="";s===1?S="i":s===2&&(S="i, j");var E="getIndices("+S+")",R="";c===1?R="i":c===2&&(R="i, coords[1]");var T="getUpdates("+R+")",P=a>1?"strides[j]":"strides";this.userCode=`
        `+b+" strides = "+b+"("+f+`);

        void main() {
          `+w+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+u+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+a+`; j++) {
              int index = round(`+E+`);
              flattenedIndex += index * `+P+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+T+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),wN=function(){return function(u,a){this.variableNames=["x","segmentIds"];var s=u.windowSize,c=u.batchSize,f=u.inSize,m=u.numSegments,v=m*Math.ceil(f/s);this.outputShape=[c,v];var b=4*Math.floor(s/4),w=s%4,S=`
        sumValue += dot(values, filter);
    `,E="";f%s>0&&(E=`
        if (inIdx < 0 || inIdx >= `+f+`) {
          return initializationValue;
        }
      `);var R="";f%s>0&&(R=`
        if (inIdx < 0 || inIdx >= `+f+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+E+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+R+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+m+")) * float("+s+`));
        int currentSeg = int(mod(float(outIdx), float(`+m+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+b+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+S+`
        }

        int inIdx = inOffset + `+b+`;
        if (`+(w===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+S+`
        } else if (`+(w===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+S+`
        } else if (`+(w===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 filter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+S+`
        }
        setOutput(sumValue);
      }
    `}}(),CN=function(){return function(u,a,s){var c,f;if(this.variableNames=["c","a","b"],this.outputShape=a,s>4)throw Error("Where for rank "+s+" is not yet supported");if(s===1)f="resRC",c="resRC";else{for(var m=["resRC.x","resRC.y","resRC.z","resRC.w"],v=[],b=[],w=0;w<a.length;w++)b.push(""+m[w]),w<u&&v.push(""+m[w]);c=v.join(),f=b.join()}var S=br(s);this.userCode=`
      void main() {
        `+S+` resRC = getOutputCoords();
        float cVal = getC(`+c+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+f+`));
        } else {
          setOutput(getB(`+f+`));
        }
      }
    `}}(),SN=function(){function u(a){this.variableNames=["source"],this.outputShape=a,this.rank=a.length;var s=br(this.rank),c=_N(this.rank);this.userCode=`
      uniform `+s+` start;

      void main() {
        `+s+` sourceLoc = start + getOutputCoords();
        setOutput(getSource(`+c+`));
      }
    `}return u.prototype.getCustomSetupFunc=function(a){var s=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(c,f){if(s.startLoc!=null||(s.startLoc=c.getUniformLocationNoThrow(f,"start"),s.startLoc!=null))if(s.rank===1)c.gl.uniform1i(s.startLoc,a[0]);else if(s.rank===2)c.gl.uniform2i(s.startLoc,a[0],a[1]);else if(s.rank===3)c.gl.uniform3i(s.startLoc,a[0],a[1],a[2]);else{if(s.rank!==4)throw Error("Slicing for rank "+s.rank+" is not yet supported");c.gl.uniform4i(s.startLoc,a[0],a[1],a[2],a[3])}}},u}();function _N(u){if(u===1)return"sourceLoc";if(u===2)return"sourceLoc.x, sourceLoc.y";if(u===3)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(u===4)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+u+" is not yet supported")}var EN=function(){return function(u,a,s,c){this.variableNames=["x"];var f=s.filter(function(E,R){return c.indexOf(R)===-1});this.outputShape=f;var m=s.length,v=br(s.length),b=br(f.length),w="";if(m===1)w="coords * strides + begin";else{var S=0;w=s.map(function(E,R){return c.indexOf(R)===-1?(S++,f.length===1?"coords * strides["+R+"] + begin["+R+"]":"coords["+(S-1)+"] * strides["+R+"] + begin["+R+"]"):"begin["+R+"]"}).join(",")}this.userCode=`
      `+v+" begin = "+v+"("+u+`);
      `+v+" strides = "+v+"("+a+`);

      void main() {
        `+b+` coords = getOutputCoords();
        setOutput(getX(`+w+`));
      }
    `}}(),kN=function(){function u(a){this.gpgpu=a,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return u.prototype.acquireTexture=function(a,s,c){var f,m=Ib(s,c),v=Nb(a,m,c);if(v in this.freeTextures||(this.freeTextures[v]=[]),v in this.usedTextures||(this.usedTextures[v]=[]),this.freeTextures[v].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var b=this.freeTextures[v].shift();return this.usedTextures[v].push(b),b}return this.numUsedTextures++,this.log(),m===qr.PACKED_2X2_FLOAT32?f=this.gpgpu.createPackedMatrixTexture(a[0],a[1]):m===qr.PACKED_2X2_FLOAT16?f=this.gpgpu.createFloat16PackedMatrixTexture(a[0],a[1]):m===qr.UNPACKED_FLOAT32?f=this.gpgpu.createFloat32MatrixTexture(a[0],a[1]):m===qr.UNPACKED_FLOAT16?f=this.gpgpu.createFloat16MatrixTexture(a[0],a[1]):m===qr.PACKED_4X1_UNSIGNED_BYTE&&(f=this.gpgpu.createUnsignedBytesMatrixTexture(a[0],a[1])),this.usedTextures[v].push(f),f},u.prototype.releaseTexture=function(a,s,c,f){if(this.freeTextures!=null){var m=Nb(s,Ib(c,f),f);m in this.freeTextures||(this.freeTextures[m]=[]),this.freeTextures[m].push(a),this.numFreeTextures++,this.numUsedTextures--;var v=this.usedTextures[m],b=v.indexOf(a);if(b<0)throw new Error("Cannot release a texture that was never provided by this texture manager");v.splice(b,1),this.log()}},u.prototype.log=function(){if(this.logEnabled){var a=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+a+")")}},u.prototype.getNumUsedTextures=function(){return this.numUsedTextures},u.prototype.getNumFreeTextures=function(){return this.numFreeTextures},u.prototype.dispose=function(){var a=this;if(this.freeTextures!=null){for(var s in this.freeTextures)this.freeTextures[s].forEach(function(c){a.gpgpu.deleteMatrixTexture(c)});for(var s in this.usedTextures)this.usedTextures[s].forEach(function(f){a.gpgpu.deleteMatrixTexture(f)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},u}();function Ib(u,a){if(u===ta.UPLOAD)return a?qr.PACKED_2X2_FLOAT32:qr.UNPACKED_FLOAT32;if(u===ta.RENDER||u==null)return a?Z.get("WEBGL_RENDER_FLOAT32_ENABLED")?qr.PACKED_2X2_FLOAT32:qr.PACKED_2X2_FLOAT16:Z.get("WEBGL_RENDER_FLOAT32_ENABLED")?qr.UNPACKED_FLOAT32:qr.UNPACKED_FLOAT16;if(u===ta.DOWNLOAD||u===ta.PIXELS)return qr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+u)}function Nb(u,a,s){return u[0]+"_"+u[1]+"_"+a+"_"+s}var RN=function(){return function(u,a){this.variableNames=["A"];for(var s=new Array(u.length),c=0;c<s.length;c++)s[c]=u[c]*a[c];this.outputShape=s,this.rank=s.length;var f=br(this.rank),m=TN(u);this.userCode=`
      void main() {
        `+f+` resRC = getOutputCoords();
        setOutput(getA(`+m+`));
      }
    `}}();function TN(u){var a=u.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+u[0]+")";for(var s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],f=0;f<u.length;f++)c.push("imod("+s[f]+", "+u[f]+")");return c.join()}var DN=function(){return function(u,a){this.variableNames=["A"];for(var s=new Array(u.length),c=0;c<s.length;c++)s[c]=u[a[c]];this.outputShape=s,this.rank=s.length;var f=br(this.rank),m=AN(a);this.userCode=`
    void main() {
      `+f+` resRC = getOutputCoords();
      setOutput(getA(`+m+`));
    }
    `}}();function AN(u){var a=u.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),f=0;f<u.length;f++)c[u[f]]=s[f];return c.join()}var Pb=.3275911,Mb=.254829592,Ob=-.284496736,Fb=1.421413741,$b=-1.453152027,Bb=1.061405429,Rh=1.7580993408473768,Th=1.0507009873554805,Be=function(){function u(a,s){this.variableNames=["A"],this.outputShape=a,this.userCode=`
      uniform float NAN;
      float unaryOperation(float x) {
        `+s+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}return u.prototype.getCustomSetupFunc=function(){var a=this;return function(s,c){a.startLoc==null&&(a.startLoc=s.getUniformLocationNoThrow(c,"NAN"),a.startLoc==null)||s.gl.uniform1f(a.startLoc,NaN)}},u}(),ss="if (isNaN(x)) return x;",IN="return abs(x);",NN=ss+`
  return (x < 0.0) ? 0.0 : x;
`,PN="return (x >= 0.0) ? x : (exp(x) - 1.0);",MN=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Rh+`;
  float scale = `+Th+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`;function ON(u){return u===void 0&&(u=0),ss+`
    return x > 0.0 ? 1.0 : float(`+u+`);
  `}var FN="return -x;",$N="return ceil(x);",BN="return floor(x);",LN=`
  if (isNaN(x)) { return 0.0; }
  return sign(x);
`,WN=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,UN="return exp(x);",zN="return exp(x) - 1.0;",VN=`if (x < 0.0) return NAN;
  return log(x);`,HN="return log(1.0 + x);",GN="return sqrt(x);",qN="return inversesqrt(x);",jN="return 1.0 / (1.0 + exp(-1.0 * x));",KN=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,XN=ss+`
  return sin(x);
`,YN=ss+`
  return cos(x);
`,QN="return tan(x);",JN="return asin(x);",ZN="return acos(x);",t3=ss+`
  return atan(x);
`,e3=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,n3=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,r3=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,o3="return log(x + sqrt(x * x + 1.0));",a3=ss+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,i3=ss+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,s3=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+Pb+`;
  float a1 = `+Mb+`;
  float a2 = `+Ob+`;
  float a3 = `+Fb+`;
  float a4 = `+$b+`;
  float a5 = `+Bb+`;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`,u3="return x * x;",c3="return 1.0 / x;",l3="return float(!(x >= 1.0));",d3="return float(int(x));",Lb=function(){return function(u){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=u;var a=u.length,s=Db("rc",a),c=br(a),f=aN(a,s),m=s.slice(-2),v=a<=1?"rc":"vec2("+m.join(",")+")";this.userCode=`
      void main() {
        `+c+` rc = getOutputCoords();
        vec4 packedInput = getA(`+f+`);

        setOutput(getChannel(packedInput, `+v+`));
      }
    `}}();function f3(u){return or(u,0)}function p3(u,a){return or(u,a)}function h3(u,a){return or(u,a)}function m3(u,a){return or(u,a)}function g3(u,a){a===void 0&&(a=0),D(u.length>=1,"Pass at least one tensor to concat");var s=Td(u,"tensors","concat");a=yr(a,s[0].shape)[0];var c=Ic(s.map(function(v){return v.shape}),a);if(L(c)===0)return kn([],c);if((s=s.filter(function(v){return v.size>0})).length===1)return s[0];var f=s.map(function(v){return v.shape});OD(f,a);var m=s;return Z.engine.runKernel(function(v){return v.concat(s,a)},m,function(v){var b=f.map(function(w){return w[a]});return Md(v,b,a).map(function(w){return function(){return w}})})}function v3(u,a,s){s===void 0&&(s=0);var c,f=V(u,"x","split");return s=yr(s,f.shape)[0],typeof a=="number"?(D(f.shape[s]%a==0,"Number of splits must evenly divide the axis."),c=Array(a).fill(f.shape[s]/a)):(D(f.shape[s]===a.reduce(function(m,v){return m+v}),"The sum of sizes must match the size of the axis dimension."),c=a),Z.engine.runKernel(function(m){return m.split(f,c,s)},{$x:f},function(m){return{$x:function(){return or(m,s)}}})}var or=st({concat_:g3}),Wb=st({concat1d_:f3}),Ub=st({concat2d_:p3}),zb=st({concat3d_:h3}),Vb=st({concat4d_:m3}),Md=st({split_:v3});function us(u,a){return u(a={exports:{}},a.exports),a.exports}var y3=us(function(u){(function(a,s,c){function f(v,b){return b.c=v.c,b.s0=v.s0,b.s1=v.s1,b.s2=v.s2,b}function m(v,b){var w=new function(R){var T,P=this,O=(T=4022871197,function($){$=$.toString();for(var B=0;B<$.length;B++){var U=.02519603282416938*(T+=$.charCodeAt(B));U-=T=U>>>0,T=(U*=T)>>>0,T+=4294967296*(U-=T)}return 23283064365386963e-26*(T>>>0)});P.next=function(){var $=2091639*P.s0+23283064365386963e-26*P.c;return P.s0=P.s1,P.s1=P.s2,P.s2=$-(P.c=0|$)},P.c=1,P.s0=O(" "),P.s1=O(" "),P.s2=O(" "),P.s0-=O(R),P.s0<0&&(P.s0+=1),P.s1-=O(R),P.s1<0&&(P.s1+=1),P.s2-=O(R),P.s2<0&&(P.s2+=1),O=null}(v),S=b&&b.state,E=w.next;return E.int32=function(){return 4294967296*w.next()|0},E.double=function(){return E()+11102230246251565e-32*(2097152*E()|0)},E.quick=E,S&&(typeof S=="object"&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.alea=m})(0,u)}),b3=us(function(u){(function(a,s,c){function f(v,b){return b.x=v.x,b.y=v.y,b.z=v.z,b.w=v.w,b}function m(v,b){var w=new function(R){var T=this,P="";T.x=0,T.y=0,T.z=0,T.w=0,T.next=function(){var $=T.x^T.x<<11;return T.x=T.y,T.y=T.z,T.z=T.w,T.w^=T.w>>>19^$^$>>>8},R===(0|R)?T.x=R:P+=R;for(var O=0;O<P.length+64;O++)T.x^=0|P.charCodeAt(O),T.next()}(v),S=b&&b.state,E=function(){return(w.next()>>>0)/4294967296};return E.double=function(){do var R=((w.next()>>>11)+(w.next()>>>0)/4294967296)/2097152;while(R===0);return R},E.int32=w.next,E.quick=E,S&&(typeof S=="object"&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.xor128=m})(0,u)}),x3=us(function(u){(function(a,s,c){function f(v,b){return b.x=v.x,b.y=v.y,b.z=v.z,b.w=v.w,b.v=v.v,b.d=v.d,b}function m(v,b){var w=new function(R){var T=this,P="";T.next=function(){var $=T.x^T.x>>>2;return T.x=T.y,T.y=T.z,T.z=T.w,T.w=T.v,(T.d=T.d+362437|0)+(T.v=T.v^T.v<<4^$^$<<1)|0},T.x=0,T.y=0,T.z=0,T.w=0,T.v=0,R===(0|R)?T.x=R:P+=R;for(var O=0;O<P.length+64;O++)T.x^=0|P.charCodeAt(O),O==P.length&&(T.d=T.x<<10^T.x>>>4),T.next()}(v),S=b&&b.state,E=function(){return(w.next()>>>0)/4294967296};return E.double=function(){do var R=((w.next()>>>11)+(w.next()>>>0)/4294967296)/2097152;while(R===0);return R},E.int32=w.next,E.quick=E,S&&(typeof S=="object"&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.xorwow=m})(0,u)}),w3=us(function(u){(function(a,s,c){function f(v,b){return b.x=v.x.slice(),b.i=v.i,b}function m(v,b){v==null&&(v=+new Date);var w=new function(R){var T=this;T.next=function(){var P,O,$=T.x,B=T.i;return P=$[B],O=(P^=P>>>7)^P<<24,O^=(P=$[B+1&7])^P>>>10,O^=(P=$[B+3&7])^P>>>3,O^=(P=$[B+4&7])^P<<7,P=$[B+7&7],O^=(P^=P<<13)^P<<9,$[B]=O,T.i=B+1&7,O},function(P,O){var $,B=[];if(O===(0|O))B[0]=O;else for(O=""+O,$=0;$<O.length;++$)B[7&$]=B[7&$]<<15^O.charCodeAt($)+B[$+1&7]<<13;for(;B.length<8;)B.push(0);for($=0;$<8&&B[$]===0;++$);for($==8?B[7]=-1:B[$],P.x=B,P.i=0,$=256;$>0;--$)P.next()}(T,R)}(v),S=b&&b.state,E=function(){return(w.next()>>>0)/4294967296};return E.double=function(){do var R=((w.next()>>>11)+(w.next()>>>0)/4294967296)/2097152;while(R===0);return R},E.int32=w.next,E.quick=E,S&&(S.x&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.xorshift7=m})(0,u)}),C3=us(function(u){(function(a,s,c){function f(v,b){return b.i=v.i,b.w=v.w,b.X=v.X.slice(),b}function m(v,b){v==null&&(v=+new Date);var w=new function(R){var T=this;T.next=function(){var P,O,$=T.w,B=T.X,U=T.i;return T.w=$=$+1640531527|0,O=B[U+34&127],P=B[U=U+1&127],O^=O<<13,P^=P<<17,O^=O>>>15,P^=P>>>12,O=B[U]=O^P,T.i=U,O+($^$>>>16)|0},function(P,O){var $,B,U,z,j,K=[],J=128;for(O===(0|O)?(B=O,O=null):(O+="\0",B=0,J=Math.max(J,O.length)),U=0,z=-32;z<J;++z)O&&(B^=O.charCodeAt((z+32)%O.length)),z===0&&(j=B),B^=B<<10,B^=B>>>15,B^=B<<4,B^=B>>>13,z>=0&&(j=j+1640531527|0,U=($=K[127&z]^=B+j)==0?U+1:0);for(U>=128&&(K[127&(O&&O.length||0)]=-1),U=127,z=512;z>0;--z)B=K[U+34&127],$=K[U=U+1&127],B^=B<<13,$^=$<<17,B^=B>>>15,$^=$>>>12,K[U]=B^$;P.w=j,P.X=K,P.i=U}(T,R)}(v),S=b&&b.state,E=function(){return(w.next()>>>0)/4294967296};return E.double=function(){do var R=((w.next()>>>11)+(w.next()>>>0)/4294967296)/2097152;while(R===0);return R},E.int32=w.next,E.quick=E,S&&(S.X&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.xor4096=m})(0,u)}),S3=us(function(u){(function(a,s,c){function f(v,b){return b.a=v.a,b.b=v.b,b.c=v.c,b.d=v.d,b}function m(v,b){var w=new function(R){var T=this,P="";T.next=function(){var $=T.b,B=T.c,U=T.d,z=T.a;return $=$<<25^$>>>7^B,B=B-U|0,U=U<<24^U>>>8^z,z=z-$|0,T.b=$=$<<20^$>>>12^B,T.c=B=B-U|0,T.d=U<<16^B>>>16^z,T.a=z-$|0},T.a=0,T.b=0,T.c=-1640531527,T.d=1367130551,R===Math.floor(R)?(T.a=R/4294967296|0,T.b=0|R):P+=R;for(var O=0;O<P.length+20;O++)T.b^=0|P.charCodeAt(O),T.next()}(v),S=b&&b.state,E=function(){return(w.next()>>>0)/4294967296};return E.double=function(){do var R=((w.next()>>>11)+(w.next()>>>0)/4294967296)/2097152;while(R===0);return R},E.int32=w.next,E.quick=E,S&&(typeof S=="object"&&f(S,w),E.state=function(){return f(w,{})}),E}s&&s.exports?s.exports=m:this.tychei=m})(0,u)}),cs=us(function(u){(function(a,s){var c,f=this,m=256,v=6,b="random",w=s.pow(m,v),S=s.pow(2,52),E=2*S,R=m-1;function T(B,U,z){var j=[],K=O(function vt(bt,kt){var _t,Mt=[],Vt=typeof bt;if(kt&&Vt=="object")for(_t in bt)try{Mt.push(vt(bt[_t],kt-1))}catch{}return Mt.length?Mt:Vt=="string"?bt:bt+"\0"}((U=U==1?{entropy:!0}:U||{}).entropy?[B,$(a)]:B??function(){try{var vt;return c&&(vt=c.randomBytes)?vt=vt(m):(vt=new Uint8Array(m),(f.crypto||f.msCrypto).getRandomValues(vt)),$(vt)}catch{var bt=f.navigator,kt=bt&&bt.plugins;return[+new Date,f,kt,f.screen,$(a)]}}(),3),j),J=new function(vt){var bt,kt=vt.length,_t=this,Mt=0,Vt=_t.i=_t.j=0,Jt=_t.S=[];for(kt||(vt=[kt++]);Mt<m;)Jt[Mt]=Mt++;for(Mt=0;Mt<m;Mt++)Jt[Mt]=Jt[Vt=R&Vt+vt[Mt%kt]+(bt=Jt[Mt])],Jt[Vt]=bt;(_t.g=function(ee){for(var le,Gt=0,qt=_t.i,ne=_t.j,be=_t.S;ee--;)le=be[qt=R&qt+1],Gt=Gt*m+be[R&(be[qt]=be[ne=R&ne+le])+(be[ne]=le)];return _t.i=qt,_t.j=ne,Gt})(m)}(j),dt=function(){for(var vt=J.g(v),bt=w,kt=0;vt<S;)vt=(vt+kt)*m,bt*=m,kt=J.g(1);for(;vt>=E;)vt/=2,bt/=2,kt>>>=1;return(vt+kt)/bt};return dt.int32=function(){return 0|J.g(4)},dt.quick=function(){return J.g(4)/4294967296},dt.double=dt,O($(J.S),a),(U.pass||z||function(vt,bt,kt,_t){return _t&&(_t.S&&P(_t,J),vt.state=function(){return P(J,{})}),kt?(s[b]=vt,bt):vt})(dt,K,"global"in U?U.global:this==s,U.state)}function P(B,U){return U.i=B.i,U.j=B.j,U.S=B.S.slice(),U}function O(B,U){for(var z,j=B+"",K=0;K<j.length;)U[R&K]=R&(z^=19*U[R&K])+j.charCodeAt(K++);return $(U)}function $(B){return String.fromCharCode.apply(0,B)}if(s["seed"+b]=T,O(s.random(),a),u.exports){u.exports=T;try{c=KS}catch{}}})([],Math)});cs.alea=y3,cs.xor128=b3,cs.xorwow=x3,cs.xorshift7=w3,cs.xor4096=C3,cs.tychei=S3;var _3=cs,Hb=_3.alea,Gb=function(){function u(a,s,c,f,m){this.mean=a,this.stdDev=s,this.dtype=c,this.nextVal=NaN,this.truncated=f,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var v=m||Math.random();this.random=Hb(v.toString())}return u.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var a=this.nextVal;return this.nextVal=NaN,a}for(var s,c,f=!1;!f;){var m=void 0,v=void 0,b=void 0;do b=(m=2*this.random()-1)*m+(v=2*this.random()-1)*v;while(b>=1||b===0);var w=Math.sqrt(-2*Math.log(b)/b);s=this.mean+this.stdDev*m*w,c=this.mean+this.stdDev*v*w,this.truncated&&!this.isValidTruncated(s)||(f=!0)}return this.truncated&&!this.isValidTruncated(c)||(this.nextVal=this.convertValue(c)),this.convertValue(s)},u.prototype.convertValue=function(a){return this.dtype==null||this.dtype==="float32"?a:Math.round(a)},u.prototype.isValidTruncated=function(a){return a<=this.upper&&a>=this.lower},u}();function E3(u){var a=V(u,"x","clone",null);return Z.engine.runKernel(function(s){return At.make(a.shape,{dataId:a.dataId},a.dtype)},{$x:a},function(s){return{$x:function(){return s.toFloat()}}})}function k3(u,a,s,c){c===void 0&&(c="float32"),a==null&&(a=u);for(var f=Ae([u,a],c),m=u<=a?u:a,v=0;v<m;++v)f.set(1,v,v);var b=f.toTensor().as2D(u,a);if(s==null)return b;if(s.length===1)return ls(ao(b,0),[s[0],1,1]);if(s.length===2)return ls(ao(ao(b,0),0),[s[0],s[1],1,1]);if(s.length===3)return ls(ao(ao(ao(b,0),0),0),[s[0],s[1],s[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+s.length+"D.")}function R3(u,a,s,c,f){if(a===void 0&&(a=0),s===void 0&&(s=1),c!=null&&c==="bool")throw new Error("Unsupported data type "+c);for(var m=new Gb(a,s,c,!1,f),v=Ae(u,c),b=0;b<v.values.length;b++)v.values[b]=m.nextValue();return v.toTensor()}function T3(u,a,s,c,f){if(a===void 0&&(a=0),s===void 0&&(s=1),c!=null&&c==="bool")throw new Error("Unsupported data type "+c);for(var m=new Gb(a,s,c,!0,f),v=Ae(u,c),b=0;b<v.values.length;b++)v.values[b]=m.nextValue();return v.toTensor()}function D3(u,a,s,c){a===void 0&&(a=0),s===void 0&&(s=1),c===void 0&&(c="float32");for(var f=Ae(u,c),m=0;m<f.values.length;m++)f.values[m]=I(a,s);return f.toTensor()}function A3(u,a,s){var c=L(u),f=null;if(s==null||s==="float32")f=new Float32Array(c);else if(s==="int32")f=new Int32Array(c);else{if(s!=="bool")throw new Error("Unknown data type "+s);f=new Uint8Array(c)}for(var m=0;m<c;m++)f[m]=a();return At.make(u,{values:f},s)}function I3(u,a,s,c){c===void 0&&(c=!1);var f=V(u,"logits","multinomial"),m=f.size,v=f.rank;if(m<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+m+".");if(v>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+v);s=s||Math.random();var b=v===1?f.as2D(1,-1):f,w=Z.engine.runKernel(function(S){return S.multinomial(b,c,a,s)},{logits2D:b});return v===1?w.as1D():w}function N3(u,a,s,c){s===void 0&&(s=1),c===void 0&&(c=0);var f=V(u,"indices","oneHot","int32");if(a<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+a);return Z.engine.runKernel(function(m){return m.oneHot(f,a,s,c)},{$indices:f},function(m){return{$indices:function(){return Rn(f.shape,"float32")}}})}function P3(u,a){if(a===void 0&&(a=3),a>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Z.engine.fromPixels(u,a)}function Dh(u,a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b,w,S,E,R,T,P,O,$,B,U,z,j,K,J;return d(this,function(dt){switch(dt.label){case 0:if(s=V(u,"img","toPixels"),u instanceof At||(s=s.toInt()),s.rank!==2&&s.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+s.rank+".");if(c=s.shape.slice(0,2),f=c[0],m=c[1],(v=s.rank===2?1:s.shape[2])>4||v===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+v);return b=s.min(),w=s.max(),[4,b.data()];case 1:return S=dt.sent()[0],[4,w.data()];case 2:if(E=dt.sent()[0],b.dispose(),w.dispose(),s.dtype==="float32"){if(S<0||E>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+S+" - "+E+"].")}else{if(s.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+s.dtype+". Please use float32 or int32 tensors.");if(S<0||E>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+S+" - "+E+"].")}return[4,s.data()];case 3:for(R=dt.sent(),T=s.dtype==="float32"?255:1,P=new Uint8ClampedArray(m*f*4),O=0;O<f*m;++O)$=void 0,B=void 0,U=void 0,z=void 0,v===1?($=R[O]*T,B=R[O]*T,U=R[O]*T,z=255):v===3?($=R[3*O]*T,B=R[3*O+1]*T,U=R[3*O+2]*T,z=255):v===4&&($=R[4*O]*T,B=R[4*O+1]*T,U=R[4*O+2]*T,z=R[4*O+3]*T),P[(j=4*O)+0]=Math.round($),P[j+1]=Math.round(B),P[j+2]=Math.round(U),P[j+3]=Math.round(z);return a!=null&&(a.width=m,a.height=f,K=a.getContext("2d"),J=new ImageData(P,m,f),K.putImageData(J,0,0)),s!==u&&s.dispose(),[2,P]}})})}function M3(u,a){var s=V(u,"x","reshape",null);return a=pt(a,s.size),D(s.size===L(a),"new shape and old shape must have the same number of elements."),Z.engine.runKernel(function(c){return c.reshape(s,a)},{$x:s},function(c){return{$x:function(){return c.reshape(s.shape)}}})}function O3(u,a){var s=V(u,"x","squeeze");return yo(s,lt(s.shape,a).newShape)}function F3(u,a){var s=V(u,"x","cast");return Z.engine.runKernel(function(c){return c.cast(s,a)},{$x:s},function(c){return{$x:function(){return c.clone()}}})}function $3(u,a){var s=V(u,"x","tile");return D(s.rank===a.length,"Error in transpose: rank of input "+s.rank+" must match length of reps "+a+"."),Z.engine.runKernel(function(c){return c.tile(s,a)},{$x:s},function(c){return{$x:function(){var f=vn(s);if(s.rank===1)for(var m=0;m<a[0];++m)f=f.add(c.slice([m*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(m=0;m<a[0];++m)for(var v=0;v<a[1];++v)f=f.add(c.slice([m*s.shape[0],v*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(m=0;m<a[0];++m)for(v=0;v<a[1];++v)for(var b=0;b<a[2];++b)f=f.add(c.slice([m*s.shape[0],v*s.shape[1],b*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(m=0;m<a[0];++m)for(v=0;v<a[1];++v)for(b=0;b<a[2];++b)for(var w=0;w<a[3];++w)f=f.add(c.slice([m*s.shape[0],v*s.shape[1],b*s.shape[2],w*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return f}}})}function B3(u,a,s){return s===void 0&&(s=0),D(a.length===2,"Invalid number of paddings. Must be length of 2."),li(u,[a],s)}function L3(u,a,s){return s===void 0&&(s=0),D(a.length===2&&a[0].length===2&&a[1].length===2,"Invalid number of paddings. Must be length of 2 each."),li(u,a,s)}function W3(u,a,s){return s===void 0&&(s=0),D(a.length===3&&a[0].length===2&&a[1].length===2&&a[2].length===2,"Invalid number of paddings. Must be length of 2 each."),li(u,a,s)}function U3(u,a,s){return s===void 0&&(s=0),D(a.length===4&&a[0].length===2&&a[1].length===2&&a[2].length===2&&a[3].length===2,"Invalid number of paddings. Must be length of 2 each."),li(u,a,s)}function z3(u,a,s){s===void 0&&(s=0);var c=V(u,"x","pad");if(c.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var f=a.map(function(m){return m[0]});return Z.engine.runKernel(function(m){return m.pad(c,a,s)},{$x:c},function(m){return{$x:function(){return m.slice(f,c.shape)}}})}function V3(u,a){a===void 0&&(a=0);var s=Td(u,"tensors","stack");if(D(s.length>=1,"Pass at least one tensor to tf.stack"),s.length===1)return s[0].expandDims(a);var c=s[0].rank,f=s[0].shape,m=s[0].dtype;D(a<=c,"Axis must be <= rank of the tensor"),s.forEach(function(b){M(f,b.shape,"All tensors passed to stack must have matching shapes")}),s.forEach(function(b){D(m===b.dtype,"All tensors passed to stack must have matching dtypes")});var v=s.map(function(b){return b.expandDims(a)});return or(v,a)}function H3(u,a,s){var c=V(u,"x","batchToSpaceND"),f=a.reduce(function(m,v){return m*v});return D(c.rank>=1+a.length,"input rank is "+c.rank+" but should be > than blockShape.length "+a.length),D(s.length===a.length,"crops.length is "+s.length+" but should be equal to blockShape.length  "+a.length),D(c.shape[0]%f==0,"input tensor batch is "+c.shape[0]+" but is not divisible by the product of the elements of blockShape "+a.join(" * ")+" === "+f),Z.engine.runKernel(function(m){return m.batchToSpaceND(c,a,s)},{$x:c},function(m){return{$x:function(){return m.spaceToBatchND(a,s)}}})}function G3(u,a,s){var c=V(u,"x","spaceToBatchND");return D(c.rank>=1+a.length,"input rank "+c.rank+" should be > than [blockShape] "+a.length),D(s.length===a.length,"paddings.shape[0] "+s.length+" must be equal to [blockShape] "+a.length),D(c.shape.reduce(function(f,m,v){return v>0&&v<=a.length?f&&(m+s[v-1][0]+s[v-1][1])%a[v-1]==0:f},!0),"input spatial dimensions "+c.shape.slice(1)+" with paddings "+s.toString()+" must be divisible by blockShapes "+a.toString()),Z.engine.runKernel(function(f){return f.spaceToBatchND(c,a,s)},{$x:c},function(f){return{$x:function(){return f.batchToSpaceND(a,s)}}})}function q3(u,a){a===void 0&&(a=0);for(var s,c=V(u,"x","unstack"),f=c.shape[a],m=Array(c.rank-1).fill(0),v=0,b=0;b<c.rank;b++)b!==a&&(m[v]=c.shape[b],v++);s=Array(f).fill(1);var w=Array(c.rank).fill(0),S=c.shape.slice();return s.map(function(E){S[a]=E;var R=c.slice(w,S);return w[a]+=E,R.reshape(m)})}function j3(u,a,s,c){a===void 0&&(a=0),s===void 0&&(s=!1),c===void 0&&(c=!1);var f=V(u,"x","cumsum"),m=Yo([a|=0],f.rank),v=f;m!=null&&(v=f.transpose(m));var b=Qo(1,f.rank)[0],w=Z.engine.runKernel(function(S){return S.cumsum(v,b,s,c)},{permutedX:v},function(S){return{permutedX:function(){return S.cumsum(a,s,!c)}}});return m!=null&&(w=w.transpose(m)),w}function K3(u,a){a===void 0&&(a=0);var s=V(u,"x","expandDims");D(a<=s.rank,"Axis must be <= rank of the tensor");var c=s.shape.slice();return a<0&&(D(-(s.rank+1)<=a,"Axis must be in the interval ["+-(s.rank+1)+", "+s.rank+"]"),a=s.rank+a+1),c.splice(a,0,1),yo(s,c)}function X3(u,a,s){s===void 0&&(s="NHWC");var c=V(u,"x","depthToSpace"),f=s==="NHWC"?c.shape[1]:c.shape[2],m=s==="NHWC"?c.shape[2]:c.shape[3],v=s==="NHWC"?c.shape[3]:c.shape[1];return D(f*a>=0,`Negative dimension size caused by overflow when multiplying
      `+f+" and "+a+`  for depthToSpace with input shape
      `+c.shape),D(m*a>=0,`Negative dimension size caused by overflow when multiplying
      `+m+" and "+a+` for depthToSpace with input shape
          `+c.shape),D(v%(a*a)==0,"Dimension size must be evenly divisible by "+a*a+" but is "+v+" for depthToSpace with input shape "+c.shape),Z.engine.runKernel(function(b){return b.depthToSpace(c,a,s)},{$x:c})}function Y3(u,a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b,w,S,E,R;return d(this,function(T){switch(T.label){case 0:return s=V(u,"x","setdiff1d"),c=V(a,"y","setdiff1d"),D(s.dtype===c.dtype,"x and y should have the same dtype, but got x ("+s.dtype+") and y ("+c.dtype+")."),D(s.rank===1,"x should be 1D tensor, but got x ("+s.shape+")."),D(c.rank===1,"y should be 1D tensor, but got y ("+c.shape+")."),[4,s.data()];case 1:return f=T.sent(),[4,c.data()];case 2:for(m=T.sent(),v=new Set(m),b=0,E=0;E<f.length;E++)v.has(f[E])||b++;for(w=new Wn([b],s.dtype),S=new Wn([b],"int32"),E=0,R=0;E<f.length;E++)v.has(f[E])||(w.values[R]=f[E],S.values[R]=E,R++);return[2,[w.toTensor(),S.toTensor()]]}})})}function Ae(u,a,s){return a===void 0&&(a="float32"),new Wn(u,a=a||"float32",s)}function qb(u,a){a===void 0&&(a=!1),console.log(u.toString(a))}var Ah=st({batchToSpaceND_:H3}),jb=st({cast_:F3}),Kb=st({clone_:E3}),Xb=st({cumsum_:j3}),Yb=st({depthToSpace_:X3}),ao=st({expandDims_:K3}),Ih=st({eye_:k3}),Od=st({fromPixels_:P3}),Qb=st({multinomial_:I3}),Fd=st({oneHot_:N3}),li=st({pad_:z3}),Jb=st({pad1d_:B3}),Zb=st({pad2d_:L3}),t1=st({pad3d_:W3}),e1=st({pad4d_:U3}),n1=st({rand_:A3}),r1=st({randomNormal_:R3}),o1=st({randomUniform_:D3}),yo=st({reshape_:M3}),Nh=st({spaceToBatchND_:G3}),Ph=st({squeeze_:O3}),bo=st({stack_:V3}),ls=st({tile_:$3}),a1=st({truncatedNormal_:T3}),ar=st({unstack_:q3}),i1=Y3;function Mh(u,a){for(var s=[],c=0;c<a.length;c++)a[c]&&s.push(c);var f=Ae(u,"int32"),m=Ae([s.length,u.length],"int32");for(c=0;c<s.length;c++){var v=f.indexToLoc(s[c]),b=c*u.length;m.values.set(v,b)}return m.toTensor()}var Q3=10,J3=300,Z3=1e3,s1=function(){function u(a,s){if(s===void 0&&(s=!0),this.gpgpu=a,this.delayedStorage=s,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,Z.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(a==null){var c=g(Z.get("WEBGL_VERSION"));this.gpgpu=new kb(c),this.canvas=c.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=a.gl.canvas;Z.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*J3),this.textureManager=new kN(this.gpgpu)}return u.prototype.register=function(a,s,c){if(this.texData.has(a))throw new Error("Data buffer is already registered");this.texData.set(a,{shape:s,dtype:c})},u.prototype.setDataMover=function(a){this.texData=new vh(a)},u.prototype.fromPixels=function(a,s){if(a==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var c=[a.height,a.width],f=[a.height,a.width,s];if(!(a instanceof HTMLVideoElement||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+a.constructor.name);if(a instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(!Z.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=a.width,this.fromPixels2DContext.canvas.height=a.height,this.fromPixels2DContext.drawImage(a,0,0,a.width,a.height),a=this.fromPixels2DContext.canvas}var m=this.makeTensorHandle(c,"int32");this.texData.get(m.dataId).usage=ta.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(m.dataId),a);var v=new MI(f),b=this.compileAndRun(v,[m]);return this.disposeData(m.dataId),b},u.prototype.makeTensorHandle=function(a,s){var c={};return this.register(c,a,s),{dataId:c,shape:a,dtype:s}},u.prototype.write=function(a,s){if(s==null)throw new Error("MathBackendWebGL.write(): values can not be null");var c=this.texData.get(a),f=c.texture,m=c.texShape,v=c.usage,b=c.dtype,w=c.isPacked;if(b==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");f!=null&&(this.releaseTexture(a,f,m,v,w),c.texture=null,c.texShape=null),c.usage=ta.UPLOAD,c.values=s,this.delayedStorage||this.uploadToGPU(a)},u.prototype.readSync=function(a){var s=this.texData.get(a),c=s.values,f=s.dtype,m=s.complexTensors;if(c!=null)return this.convertAndCacheOnCPU(a);if(f==="string")return c;var v,b,w=this.activeTimers!=null;return w&&(v=performance.now()),f==="complex64"?b=Ey(m.real.dataSync(),m.imag.dataSync()):b=this.getValuesFromTexture(a),w&&(this.downloadWaitMs+=performance.now()-v),this.convertAndCacheOnCPU(a,b)},u.prototype.read=function(a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b,w,S,E,R,T,P,O,$,B,U,z,j;return d(this,function(K){switch(K.label){case 0:if(this.pendingRead.has(a))return f=this.pendingRead.get(a),[2,new Promise(function(J){return f.push(J)})];if(m=this.texData.get(a),v=m.texture,b=m.values,w=m.texShape,S=m.isPacked,E=m.shape,b!=null)return[2,this.convertAndCacheOnCPU(a)];if(this.pendingRead.set(a,[]),!Z.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Z.get("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return R=w[1],T=w[0],S&&(s=is(w[0],w[1]),R=s[0],T=s[1]),P=this.gpgpu.maybeCreateBufferFromTexture(v,T,R),[4,this.gpgpu.createAndWaitForFence()];case 1:return K.sent(),P instanceof WebGLTexture?O=this.getValuesFromTexture(a):S?($=this.getBatchDim(E),B=1,U=1,E.length&&(c=this.getRowsCols(E),B=c[0],U=c[1]),O=this.gpgpu.downloadPackedMatrixFromBuffer(P,$,B,U,w[0],w[1])):O=this.gpgpu.downloadFloat32MatrixFromBuffer(P,w[0],w[1]),z=this.convertAndCacheOnCPU(a,O),j=this.pendingRead.get(a),this.pendingRead.delete(a),j.forEach(function(J){return J(z)}),this.pendingDisposal.has(a)&&(this.pendingDisposal.delete(a),this.disposeData(a)),[2,z]}})})},u.prototype.getValuesFromTexture=function(a){var s,c=this.texData.get(a),f=c.shape,m=c.dtype,v=c.texture,b=c.texShape;if(Z.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(a).isPacked){var w=this.getBatchDim(f),S=1,E=1;return f.length&&(S=(s=this.getRowsCols(f))[0],E=s[1]),this.gpgpu.downloadMatrixFromPackedTexture(v,w,S,E,b[0],b[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(v,b[0],b[1])}var R=this.makeTensorHandle(f,"float32");R.size=L(f),this.texData.get(R.dataId).usage=ta.DOWNLOAD;var T=new PI(f);this.compileAndRun(T,[{shape:f,dtype:m,dataId:a}],R,null,!1);var P=this.texData.get(R.dataId),O=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(P.texture,P.texShape[0],P.texShape[1]);return this.disposeData(R.dataId),O},u.prototype.time=function(a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b,w;return d(this,function(S){switch(S.label){case 0:return s=this.activeTimers,c=[],f=!1,this.programTimersStack==null?(this.programTimersStack=c,f=!0):this.activeTimers.push(c),this.activeTimers=c,a(),m=W(this.activeTimers.map(function(E){return E.query})).filter(function(E){return E!=null}),v=W(this.activeTimers.map(function(E){return E.name})).filter(function(E){return E!=null}),this.activeTimers=s,f&&(this.programTimersStack=null),[4,Promise.all(m)];case 1:return b=S.sent(),w={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:A(b),getExtraProfileInfo:function(){return b.map(function(E,R){return{name:v[R],ms:E}}).map(function(E){return E.name+": "+E.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,w]}})})},u.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},u.prototype.startTimer=function(){return Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},u.prototype.endTimer=function(a){return Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),a):(a.endMs=performance.now(),a)},u.prototype.getQueryTime=function(a){return l(this,void 0,void 0,function(){var s;return d(this,function(c){return Z.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(s=a).endMs-s.startMs]})})},u.prototype.disposeData=function(a){if(!this.pendingDisposal.has(a)){if(this.pendingRead.has(a))this.pendingDisposal.add(a);else if(this.texData.has(a)){var s=this.texData.get(a),c=s.texture,f=s.texShape,m=s.usage,v=s.complexTensors,b=s.isPacked;c!=null&&this.releaseTexture(a,c,f,m,b),v!=null&&(v.real.dispose(),v.imag.dispose()),this.texData.delete(a)}}},u.prototype.getTexture=function(a){return this.uploadToGPU(a),this.texData.get(a).texture},u.prototype.getCPUBackend=function(){return Z.get("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Z.findBackend("cpu")),this.cpuBackend):null},u.prototype.shouldExecuteOnCPU=function(a,s){var c=this;return s===void 0&&(s=Q3),this.getCPUBackend()!=null&&a.every(function(f){return c.texData.get(f.dataId).texture==null&&f.size<s})},u.prototype.getGPGPUContext=function(){return this.gpgpu},u.prototype.getCanvas=function(){return this.canvas},u.prototype.complex=function(a,s){var c=this.makeOutputArray(a.shape,"complex64");return this.texData.get(c.dataId).complexTensors={real:Z.engine.keep(a.clone()),imag:Z.engine.keep(s.clone())},c},u.prototype.real=function(a){return this.texData.get(a.dataId).complexTensors.real.clone()},u.prototype.imag=function(a){return this.texData.get(a.dataId).complexTensors.imag.clone()},u.prototype.slice=function(a,s,c){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.slice(a,s,c);var f=new SN(c),m=f.getCustomSetupFunc(s);return this.compileAndRun(f,[a],null,m)},u.prototype.stridedSlice=function(a,s,c,f,m,v,b,w,S){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.stridedSlice(a,s,c,f,m,v,b,w,S);var E=gy(a.shape,s,c,f,m,v,b,w,S),R=E[0],T=E[1],P=E[2],O=T.filter(function(B,U){return P.indexOf(U)===-1});if(O.some(function(B){return B===0}))return kn([],O);var $=new EN(R,f,T,P);return this.compileAndRun($,[a])},u.prototype.reverse=function(a,s){var c=new xN(a.shape,s);return this.compileAndRun(c,[a])},u.prototype.concat2Tensors=function(a,s,c){var f=Ic([a.shape,s.shape],c),m=a.as2D(-1,L(a.shape.slice(c))),v=s.as2D(-1,L(s.shape.slice(c))),b=new AA(m.shape,v.shape);return this.compileAndRun(b,[m,v]).reshape(f)},u.prototype.concat=function(a,s){if(this.shouldExecuteOnCPU(a))return this.cpuBackend.concat(a,s);if(a.length===1)return a[0];for(var c=a[0],f=1;f<a.length;++f)c=this.concat2Tensors(c,a[f],s);return c},u.prototype.neg=function(a){var s=new Be(a.shape,FN);return this.compileAndRun(s,[a])},u.prototype.batchMatMul=function(a,s,c,f){var m=c?a.shape[2]:a.shape[1],v=f?s.shape[1]:s.shape[2],b=c?a.shape[1]:a.shape[2],w=a.shape[0];if((m===1||v===1)&&b>Z3){c&&(a=a.transpose([0,2,1])),f&&(s=s.transpose([0,2,1]));var S=v===1?a:a.as3D(w,b,1),E=v===1?2:1,R=v===1?s.as3D(w,1,b):s;return this.multiply(S,R).sum(E,!0)}var T=Zn(a.dtype,s.dtype);if(w===1){var P=a.as2D(a.shape[1],a.shape[2]),O=s.as2D(s.shape[1],s.shape[2]),$=new Tb(P.shape,O.shape,[m,v],c,f),B=this.makePackedTensor($.outputShape,T),U=this.compileAndRun($,[P,O],B);return U.reshape([1,U.shape[0],U.shape[1]])}return $=new eN(a.shape,s.shape,c,f),B=this.makeOutputArray($.outputShape,T),this.compileAndRun($,[a,s],B)},u.prototype.multiply=function(a,s){if(a.dtype==="complex64"){var c=this.texData.get(a.dataId),f=this.texData.get(s.dataId),m=new Ay(Dy.REAL,a.shape,s.shape),v=new Ay(Dy.IMAG,a.shape,s.shape),b=[this.makeComplexComponentTensorHandle(a,c.complexTensors.real),this.makeComplexComponentTensorHandle(a,c.complexTensors.imag),this.makeComplexComponentTensorHandle(s,f.complexTensors.real),this.makeComplexComponentTensorHandle(s,f.complexTensors.imag)],w=this.compileAndRun(m,b),S=this.compileAndRun(v,b),E=this.complex(w,S);return w.dispose(),S.dispose(),E}if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.multiply(a,s);var R=new $n(cA,a.shape,s.shape),T=this.makeOutputArray(R.outputShape,a.dtype);return this.compileAndRun(R,[a,s],T)},u.prototype.batchNormalization=function(a,s,c,f,m,v){var b=[a,s,c],w=null;v!=null&&(w=v.shape,b.push(v));var S=null;if(m!=null&&(S=m.shape,b.push(m)),Z.get("WEBGL_PACK_BATCHNORMALIZATION")){var E=new uA(a.shape,s.shape,c.shape,w,S,f);return this.compileAndRun(E,b)}var R=new sA(a.shape,s.shape,c.shape,w,S,f);return this.compileAndRun(R,b)},u.prototype.localResponseNormalization4D=function(a,s,c,f,m){var v=new JI(a.shape,s,c,f,m);return this.compileAndRun(v,[a])},u.prototype.LRNGrad=function(a,s,c,f,m,v,b){var w=new ZI(s.shape,f,m,v,b);return this.compileAndRun(w,[s,c,a])},u.prototype.tile=function(a,s){var c=new RN(a.shape,s);return this.compileAndRun(c,[a])},u.prototype.pad=function(a,s,c){var f=new dN(a.shape,s,c);return this.compileAndRun(f,[a])},u.prototype.transpose=function(a,s){var c=new DN(a.shape,s);return this.compileAndRun(c,[a])},u.prototype.gather=function(a,s,c){var f=new OI(a.shape,s.size,c);return this.compileAndRun(f,[a,s])},u.prototype.batchToSpaceND=function(a,s,c){D(a.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var f=s.reduce(function(E,R){return E*R}),m=_d(a.shape,s,f),v=Ed(m.length,s.length),b=kd(a.shape,s,f),w=ly(c,s.length),S=dy(b,c,s.length);return a.reshape(m).transpose(v).reshape(b).slice(w,S)},u.prototype.spaceToBatchND=function(a,s,c){D(a.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var f=s.reduce(function(R,T){return R*T}),m=[[0,0]];m.push.apply(m,c);for(var v=1+s.length;v<a.shape.length;++v)m.push([0,0]);var b=a.pad(m),w=_d(b.shape,s,f,!1),S=Ed(w.length,s.length,!1),E=kd(b.shape,s,f,!1);return b.reshape(w).transpose(S).reshape(E)},u.prototype.reduce=function(a,s,c){var f=a.shape[0],m=a.shape[1],v=my(m),b=new fN({windowSize:v,inSize:m,batchSize:f},s),w=b.outputShape,S=w[0],E=w[1],R=this.makeOutputArray([S,E],c);return this.compileAndRun(b,[a],R),R.shape[1]===1?R:this.reduce(R,s,c)},u.prototype.argReduce=function(a,s,c){c===void 0&&(c=null);var f=a.shape[0],m=a.shape[1];c!=null&&(f=c.shape[0],m=c.shape[1]);var v=my(m),b=new oA({windowSize:v,inSize:m,batchSize:f},s,c==null),w=b.outputShape,S=w[0],E=w[1],R=this.makeOutputArray([S,E],"int32"),T=[a];return c!=null&&T.push(c),this.compileAndRun(b,T,R),R.shape[1]===1?R:this.argReduce(a,s,R)},u.prototype.sum=function(a,s){Gr("sum",s,a.rank);var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m),b=fh(a.dtype);return this.reduce(v,"sum",b).reshape(f)},u.prototype.prod=function(a,s){var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m),b=fh(a.dtype);return this.reduce(v,"prod",b).reshape(f)},u.prototype.unsortedSegmentSum=function(a,s,c){var f=0,m=Yo([f],a.rank),v=a;m!=null&&(v=a.transpose(m),f=Qo(1,a.rank)[0]);var b=LD(v.shape,f,c),w=L([v.shape[f]]),S=v.as2D(-1,w),E=fh(a.dtype),R=this.segOpCompute(S,"unsortedSegmentSum",s,E,c).reshape(b);return m!=null&&(R=R.transpose(mh(m))),R},u.prototype.segOpCompute=function(a,s,c,f,m){var v=a.shape[0],b=a.shape[1],w=BD(b,m),S=new wN({windowSize:w,inSize:b,batchSize:v,numSegments:m},s),E=S.outputShape,R=E[0],T=E[1],P=this.makeOutputArray([R,T],f);return this.compileAndRun(S,[a,c],P),P.shape[1]===m?P:(c=gh(0,m).tile([b/w]),this.segOpCompute(P,s,c,f,m))},u.prototype.argMin=function(a,s){var c=[s];Gr("argMin",c,a.rank);var f=er(a.shape,c),m=f[0],v=L(f[1]),b=a.as2D(-1,v);return this.argReduce(b,"min").reshape(m)},u.prototype.argMax=function(a,s){var c=[s];Gr("argMax",c,a.rank);var f=er(a.shape,c),m=f[0],v=L(f[1]),b=a.as2D(-1,v);return this.argReduce(b,"max").reshape(m)},u.prototype.cumsum=function(a,s,c,f){if(s!==a.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+s);var m=new AI(a.shape,c,f);return this.compileAndRun(m,[a])},u.prototype.equal=function(a,s){var c=new $n(hA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.notEqual=function(a,s){var c=new $n(mA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.less=function(a,s){if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.less(a,s);var c=new $n(gA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.lessEqual=function(a,s){var c=new $n(vA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.greater=function(a,s){if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.greater(a,s);var c=new $n(yA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.greaterEqual=function(a,s){var c=new $n(bA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.logicalNot=function(a){var s=new Be(a.shape,l3);return this.compileAndRun(s,[a])},u.prototype.logicalAnd=function(a,s){var c=new $n(xA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.logicalOr=function(a,s){var c=new $n(wA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"bool");return this.compileAndRun(c,[a,s],f)},u.prototype.select=function(a,s,c){var f=new CN(a.rank,s.shape,s.rank),m=this.makeOutputArray(f.outputShape,Zn(s.dtype,c.dtype));return this.compileAndRun(f,[a,s,c],m)},u.prototype.where=function(a){hh("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var s=a.dataSync();return Mh(a.shape,s)},u.prototype.topk=function(a,s,c){return Ty(a.dataSync(),a.shape,a.dtype,s)},u.prototype.min=function(a,s){Gr("min",s,a.rank);var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m);return this.reduce(v,"min",v.dtype).reshape(f)},u.prototype.minimum=function(a,s){if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.minimum(a,s);var c=new $n(SA,a.shape,s.shape);return this.compileAndRun(c,[a,s])},u.prototype.mod=function(a,s){var c=new $n(_A,a.shape,s.shape),f=c.getCustomSetupFunc();return this.compileAndRun(c,[a,s],null,f)},u.prototype.max=function(a,s){Gr("max",s,a.rank);var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m);return this.reduce(v,"max",v.dtype).reshape(f)},u.prototype.maximum=function(a,s){if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.maximum(a,s);var c=new $n(CA,a.shape,s.shape);return this.compileAndRun(c,[a,s])},u.prototype.all=function(a,s){Gr("all",s,a.rank);var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m);return this.reduce(v,"all",v.dtype).reshape(f)},u.prototype.any=function(a,s){Gr("any",s,a.rank);var c=er(a.shape,s),f=c[0],m=L(c[1]),v=a.as2D(-1,m);return this.reduce(v,"any",v.dtype).reshape(f)},u.prototype.squaredDifference=function(a,s){var c=new $n(pA,a.shape,s.shape);return this.compileAndRun(c,[a,s])},u.prototype.realDivide=function(a,s){var c=new $n(lA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"float32");return this.compileAndRun(c,[a,s],f)},u.prototype.floorDiv=function(a,s){var c=new $n(dA,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,"int32");return this.compileAndRun(c,[a,s],f)},u.prototype.add=function(a,s){if(a.dtype==="complex64"&&s.dtype==="complex64")return this.complexSeparableBinaryOp(a,s,Iy);var c=new $n(Iy,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,Zn(a.dtype,s.dtype));return this.compileAndRun(c,[a,s],f)},u.prototype.complexSeparableBinaryOp=function(a,s,c){var f=this,m=this.texData.get(a.dataId),v=this.texData.get(s.dataId),b=[[m.complexTensors.real,v.complexTensors.real],[m.complexTensors.imag,v.complexTensors.imag]].map(function(R){var T=R[0],P=R[1],O=new $n(c,a.shape,s.shape),$=f.makeOutputArray(O.outputShape,Zn(T.dtype,P.dtype)),B=f.makeComplexComponentTensorHandle(a,T),U=f.makeComplexComponentTensorHandle(s,P);return f.compileAndRun(O,[B,U],$)}),w=b[0],S=b[1],E=this.complex(w,S);return w.dispose(),S.dispose(),E},u.prototype.makeComplexComponentTensorHandle=function(a,s){return{dataId:s.dataId,dtype:s.dtype,shape:a.shape}},u.prototype.addN=function(a){for(var s=a[0],c=1;c<a.length;c++)s=this.add(s,a[c]);return s},u.prototype.subtract=function(a,s){if(a.dtype==="complex64"&&s.dtype==="complex64")return this.complexSeparableBinaryOp(a,s,Ny);if(this.shouldExecuteOnCPU([a,s]))return this.cpuBackend.subtract(a,s);var c=new $n(Ny,a.shape,s.shape),f=this.makeOutputArray(c.outputShape,Zn(a.dtype,s.dtype));return this.compileAndRun(c,[a,s],f)},u.prototype.pow=function(a,s){var c=new $n(fA,a.shape,s.shape),f=c.getCustomSetupFunc(),m=this.makeOutputArray(c.outputShape,Zn(a.dtype,s.dtype));return this.compileAndRun(c,[a,s],m,f)},u.prototype.ceil=function(a){var s=new Be(a.shape,$N);return this.compileAndRun(s,[a])},u.prototype.floor=function(a){var s=new Be(a.shape,BN);return this.compileAndRun(s,[a])},u.prototype.sign=function(a){var s=new Be(a.shape,LN);return this.compileAndRun(s,[a])},u.prototype.round=function(a){var s=new Be(a.shape,WN);return this.compileAndRun(s,[a])},u.prototype.exp=function(a){var s=new Be(a.shape,UN);return this.compileAndRun(s,[a])},u.prototype.expm1=function(a){var s=new Be(a.shape,zN);return this.compileAndRun(s,[a])},u.prototype.log=function(a){var s=new Be(a.shape,VN),c=s.getCustomSetupFunc();return this.compileAndRun(s,[a],null,c)},u.prototype.log1p=function(a){var s=new Be(a.shape,HN);return this.compileAndRun(s,[a])},u.prototype.sqrt=function(a){var s=new Be(a.shape,GN);return this.compileAndRun(s,[a])},u.prototype.rsqrt=function(a){var s=new Be(a.shape,qN);return this.compileAndRun(s,[a])},u.prototype.square=function(a){var s=new Be(a.shape,u3);return this.compileAndRun(s,[a])},u.prototype.reciprocal=function(a){var s=new Be(a.shape,c3);return this.compileAndRun(s,[a])},u.prototype.relu=function(a){var s=new Be(a.shape,NN);return this.compileAndRun(s,[a])},u.prototype.elu=function(a){var s=new Be(a.shape,PN);return this.compileAndRun(s,[a])},u.prototype.eluDer=function(a,s){var c=new $n(kA,a.shape,s.shape);return this.compileAndRun(c,[a,s])},u.prototype.selu=function(a){var s=new Be(a.shape,MN);return this.compileAndRun(s,[a])},u.prototype.int=function(a){var s=new Be(a.shape,d3),c=this.makeOutputArray(s.outputShape,"int32");return this.compileAndRun(s,[a],c)},u.prototype.clip=function(a,s,c){var f;return f=Z.get("WEBGL_PACK_CLIP")?new TA(a.shape,s,c):new RA(a.shape,s,c),this.compileAndRun(f,[a])},u.prototype.abs=function(a){var s=new Be(a.shape,IN);return this.compileAndRun(s,[a])},u.prototype.complexAbs=function(a){var s=this.texData.get(a.dataId),c=new DA(a.shape),f=[this.makeComplexComponentTensorHandle(a,s.complexTensors.real),this.makeComplexComponentTensorHandle(a,s.complexTensors.imag)];return this.compileAndRun(c,f)},u.prototype.sigmoid=function(a){var s=new Be(a.shape,jN);return this.compileAndRun(s,[a])},u.prototype.softplus=function(a){var s=new Be(a.shape,KN);return this.compileAndRun(s,[a])},u.prototype.sin=function(a){var s=new Be(a.shape,XN);return this.compileAndRun(s,[a])},u.prototype.cos=function(a){var s=new Be(a.shape,YN);return this.compileAndRun(s,[a])},u.prototype.tan=function(a){var s=new Be(a.shape,QN);return this.compileAndRun(s,[a])},u.prototype.asin=function(a){var s=new Be(a.shape,JN);return this.compileAndRun(s,[a])},u.prototype.acos=function(a){var s=new Be(a.shape,ZN);return this.compileAndRun(s,[a])},u.prototype.atan=function(a){var s=new Be(a.shape,t3);return this.compileAndRun(s,[a])},u.prototype.atan2=function(a,s){var c=new $n(EA,a.shape,s.shape);return this.compileAndRun(c,[a,s])},u.prototype.sinh=function(a){var s=new Be(a.shape,e3);return this.compileAndRun(s,[a])},u.prototype.cosh=function(a){var s=new Be(a.shape,n3);return this.compileAndRun(s,[a])},u.prototype.tanh=function(a){var s=new Be(a.shape,r3);return this.compileAndRun(s,[a])},u.prototype.asinh=function(a){var s=new Be(a.shape,o3);return this.compileAndRun(s,[a])},u.prototype.acosh=function(a){var s=new Be(a.shape,a3),c=s.getCustomSetupFunc();return this.compileAndRun(s,[a],null,c)},u.prototype.atanh=function(a){var s=new Be(a.shape,i3),c=s.getCustomSetupFunc();return this.compileAndRun(s,[a],null,c)},u.prototype.erf=function(a){var s=new Be(a.shape,s3);return this.compileAndRun(s,[a])},u.prototype.step=function(a,s){var c=new Be(a.shape,ON(s));return this.compileAndRun(c,[a])},u.prototype.conv2dWithIm2Row=function(a,s,c){var f=c.filterWidth,m=c.filterHeight,v=c.inChannels,b=c.outWidth,w=c.outHeight,S=f*m*v,E=w*b,R=[S,E],T=a.squeeze([0]),P=s.reshape([S,-1]),O=new QI(R,T.shape,c),$=this.compileAndRun(O,[T]),B=new Tb($.shape,P.shape,[E,c.outChannels],!0,!1);return this.compileAndRun(B,[$,P]).reshape([1,w,b,c.outChannels])},u.prototype.conv2d=function(a,s,c){if(Z.get("WEBGL_CONV_IM2COL")&&a.shape[0]===1)return this.conv2dWithIm2Row(a,s,c);var f=new $A(c);return this.compileAndRun(f,[a,s])},u.prototype.conv2dDerInput=function(a,s,c){var f=new NA(c);return this.compileAndRun(f,[a,s])},u.prototype.conv2dDerFilter=function(a,s,c){var f=new IA(c);return this.compileAndRun(f,[a,s])},u.prototype.depthwiseConv2D=function(a,s,c){var f;return Z.get("WEBGL_PACK_DEPTHWISECONV")&&c.dilationWidth===1&&c.dilationHeight===1&&c.padInfo.left<=1&&c.strideWidth<=2&&c.outChannels/c.inChannels==1?(f=new WA(c),this.compileAndRun(f,[a,s],this.makePackedTensor(c.outShape,a.dtype))):(f=new LA(c),this.compileAndRun(f,[a,s]))},u.prototype.depthwiseConv2DDerInput=function(a,s,c){var f=new FA(c);return this.compileAndRun(f,[a,s])},u.prototype.depthwiseConv2DDerFilter=function(a,s,c){var f=new OA(c);return this.compileAndRun(f,[a,s])},u.prototype.conv3d=function(a,s,c){var f=new BA(c);return this.compileAndRun(f,[a,s])},u.prototype.conv3dDerInput=function(a,s,c){var f=new MA(c);return this.compileAndRun(f,[a,s])},u.prototype.conv3dDerFilter=function(a,s,c){var f=new PA(c);return this.compileAndRun(f,[a,s])},u.prototype.maxPool=function(a,s){var c=new kh(s,"max",!1),f=this.makeOutputArray(c.outputShape,a.dtype);return this.compileAndRun(c,[a],f)},u.prototype.avgPool=function(a,s){var c=new kh(s,"avg",!1),f=this.makeOutputArray(c.outputShape,"float32");return this.compileAndRun(c,[a],f)},u.prototype.maxPoolBackprop=function(a,s,c,f){var m=new kh(f,"max",!0),v=this.compileAndRun(m,[s]),b=new tN(f),w=this.makeOutputArray(b.outputShape,s.dtype),S=this.compileAndRun(b,[a,v],w);return v.dispose(),S},u.prototype.avgPoolBackprop=function(a,s,c){var f=new aA(c),m=this.makeOutputArray(f.outputShape,s.dtype);return this.compileAndRun(f,[a],m)},u.prototype.cast=function(a,s){return _y(a,s,this)},u.prototype.reshape=function(a,s){return this.texData.get(a.dataId).isPacked&&!Eh(a.shape,s)?this.packedReshape(a,s):yh(a,s)},u.prototype.resizeBilinear=function(a,s,c,f){var m=new vN(a.shape,s,c,f);return this.compileAndRun(m,[a])},u.prototype.resizeBilinearBackprop=function(a,s,c){var f=new gN(a,s,c);return this.compileAndRun(f,[a])},u.prototype.resizeNearestNeighbor=function(a,s,c,f){var m=new bN(a.shape,s,c,f);return this.compileAndRun(m,[a])},u.prototype.resizeNearestNeighborBackprop=function(a,s,c){var f=new yN(a,s,c);return this.compileAndRun(f,[a])},u.prototype.multinomial=function(a,s,c,f){var m=s?a:Da(a),v=m.shape[0],b=m.shape[1],w=new nN(v,b,c),S=this.makeOutputArray(w.outputShape,"int32"),E=w.getCustomSetupFunc(f);return this.compileAndRun(w,[m],S,E)},u.prototype.oneHot=function(a,s,c,f){var m=new rN(a.size,s,c,f);return this.compileAndRun(m,[a])},u.prototype.nonMaxSuppression=function(a,s,c,f,m){return hh("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),bh(a.dataSync(),s.dataSync(),c,f,m)},u.prototype.cropAndResize=function(a,s,c,f,m,v){var b=new UA(a.shape,s.shape,f,m,v);return this.compileAndRun(b,[a,s,c])},u.prototype.depthToSpace=function(a,s,c){D(s>1,"blockSize should be > 1 for depthToSpace, but was: "+s);var f=a.shape[0],m=(c==="NHWC"?a.shape[1]:a.shape[2])*s,v=(c==="NHWC"?a.shape[2]:a.shape[3])*s,b=(c==="NHWC"?a.shape[3]:a.shape[1])/(s*s),w=new NI(c==="NHWC"?[f,m,v,b]:[f,b,m,v],s,c);return this.compileAndRun(w,[a])},u.prototype.split=function(a,s,c){return Ry(a,s,c)},u.prototype.scatterND=function(a,s,c){var f=Rd(s,a,c),m=f.sliceRank,v=f.numUpdates,b=f.sliceSize,w=f.strides,S=f.outputSize,E=[S/b,b],R=a.reshape([v,m]),T=s.reshape([v,b]);if(S===0)return yh(kn([]),c);var P=Nt(0),O=new Ab(v,m,R.rank,T.rank,w,E);return this.compileAndRun(O,[T,R,P]).reshape(c)},u.prototype.sparseToDense=function(a,s,c,f){var m=Rd(s,a,c),v=m.sliceRank,b=m.numUpdates,w=m.strides,S=m.outputSize,E=new Ab(b,v,a.rank,s.rank,w,[S,1],!1);return this.compileAndRun(E,[s,a,f]).reshape(c)},u.prototype.fft=function(a){return this.fftImpl(a,!1)},u.prototype.ifft=function(a){return this.fftImpl(a,!0)},u.prototype.fftImpl=function(a,s){var c=this.texData.get(a.dataId),f=new $y(Fy.REAL,a.shape,s),m=new $y(Fy.IMAG,a.shape,s),v=[this.makeComplexComponentTensorHandle(a,c.complexTensors.real),this.makeComplexComponentTensorHandle(a,c.complexTensors.imag)],b=this.compileAndRun(f,v),w=this.compileAndRun(m,v),S=this.complex(b,w).as2D(a.shape[0],a.shape[1]);return b.dispose(),w.dispose(),S},u.prototype.gatherND=function(a,s){var c=s.shape,f=c[c.length-1],m=py(a,s),v=m[0],b=m[1],w=m[2],S=m[3],E=s.reshape([b,f]),R=a.reshape([a.size/w,w]),T=new $I(f,S,[b,w]);return this.compileAndRun(T,[R,E]).reshape(v)},u.prototype.makeOutputArray=function(a,s){return At.make(a,{},s)},u.prototype.makePackedTensor=function(a,s){var c=At.make(a,{},s);return this.texData.get(c.dataId).isPacked=!0,c},u.prototype.unpackTensor=function(a){var s=new Lb(a.shape);return this.compileAndRun(s,[a],At.make(s.outputShape,{},a.dtype))},u.prototype.getBatchDim=function(a,s){return s===void 0&&(s=2),L(a.slice(0,a.length-s))},u.prototype.getRowsCols=function(a){if(a.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[a.length>1?a[a.length-2]:1,a[a.length-1]]},u.prototype.packedReshape=function(a,s){var c=a.reshape([this.getBatchDim(a.shape)].concat(this.getRowsCols(a.shape))),f=[this.getBatchDim(s)].concat(this.getRowsCols(s)),m=new pN(f,c.shape);return this.compileAndRun(m,[c]).reshape(s)},u.prototype.compileAndRun=function(a,s,c,f,m){var v=this;if(m===void 0&&(m=!0),c==null&&(c=a.usesPackedTextures?this.makePackedTensor(a.outputShape,s[0].dtype):this.makeOutputArray(a.outputShape,s[0].dtype)),c.size===0)return this.texData.get(c.dataId).values=ft(c.dtype,0),c;var b=s.map(function(z){if(z.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var j=v.texData.get(z.dataId);if(j.texture==null){if(!a.usesPackedTextures&&L(z.shape)<=Z.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:z.shape,texData:null,isUniform:!0,uniformValues:v.readSync(z.dataId)};a.usesPackedTextures&&(j.isPacked=!0,j.shape=z.shape)}else if(!!j.isPacked!=!!a.usesPackedTextures){var K=void 0,J=void 0;j.isPacked?(K=new Lb(z.shape),J=v.compileAndRun(K,[z],At.make(K.outputShape,{},z.dtype))):(K=new iN(z.shape),J=v.compileAndRun(K,[z],v.makePackedTensor(z.shape,z.dtype))),j=v.texData.get(J.dataId),z=J}else if(j.isPacked&&!Eh(j.shape,z.shape)){v.delayedStorage=!1;var dt=z.dataSync();v.delayedStorage=!0,z=At.make(z.shape,{values:dt},z.dtype),(j=v.texData.get(z.dataId)).isPacked=!0}return v.uploadToGPU(z.dataId),{shape:z.shape,texData:j,isUniform:!1}});this.uploadToGPU(c.dataId);var w,S={shape:c.shape,texData:this.texData.get(c.dataId),isUniform:!1},E=YI(a,b,S),R=this.getAndSaveBinary(E,function(){return KI(v.gpgpu,a,b,S)}),T=this.activeTimers!=null;if(T&&(w=this.startTimer()),XI(R,b,S,f),Z.get("WEBGL_PAGING_ENABLED")&&m&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var P=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;P>0&&this.lruDataGPU.length>0;){var O=this.lruDataGPU.shift(),$=this.texData.get(O),B=$.shape,U=$.dtype;P-=this.computeBytes(B,U),this.read(O)}return T&&(w=this.endTimer(w),this.activeTimers.push({name:a.constructor.name,query:this.getQueryTime(w)})),Z.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(c.dataId).isPacked||a.isPackShader?c:this.unpackTensor(c)},u.prototype.getAndSaveBinary=function(a,s){return a in this.binaryCache||(this.binaryCache[a]=s()),this.binaryCache[a]},u.prototype.getTextureManager=function(){return this.textureManager},u.prototype.dispose=function(){if(!this.disposed){for(var a in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[a].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},u.prototype.floatPrecision=function(){var a=this;return te(function(){return a.abs(Nt(1e-8)).get()>0?32:16})},u.prototype.uploadToGPU=function(a){var s,c=this.texData.get(a),f=c.shape,m=c.values,v=c.texture,b=c.usage,w=c.isPacked;if(v==null){var S,E=this.activeTimers!=null;E&&(S=performance.now());var R=ab(f,w);c.texShape=R;var T=this.acquireTexture(a,R,b,w);if(c.texture=T,m!=null){if(w){var P=this.getBatchDim(f),O=1,$=1;f.length&&(O=(s=this.getRowsCols(f))[0],$=s[1]),this.gpgpu.uploadMatrixToPackedTexture(T,P,O,$,R[0],R[1],u1(m))}else this.gpgpu.uploadMatrixToTexture(T,R[0],R[1],u1(m));c.values=null,E&&(this.uploadWaitMs+=performance.now()-S)}}else Z.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.indexOf(a)>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(a),1),this.lruDataGPU.push(a))},u.prototype.convertAndCacheOnCPU=function(a,s){var c=this.delayedStorage,f=this.texData.get(a),m=f.texture,v=f.texShape,b=f.dtype,w=f.usage,S=f.isPacked;return c&&m!=null&&(this.releaseTexture(a,m,v,w,S),f.texture=null,f.texShape=null),f.usage=ta.UPLOAD,s!=null&&(f.values=tP(s,b)),f.values},u.prototype.releaseTexture=function(a,s,c,f,m){var v=this.texData.get(a),b=v.shape,w=v.dtype;if(Z.get("WEBGL_PAGING_ENABLED")){var S=this.lruDataGPU.indexOf(a);S>=0&&this.lruDataGPU.splice(S,1)}this.numBytesInGPU-=this.computeBytes(b,w),this.textureManager.releaseTexture(s,c,f,m)},u.prototype.acquireTexture=function(a,s,c,f){var m=this.texData.get(a),v=m.shape,b=m.dtype;return Z.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(a),this.numBytesInGPU+=this.computeBytes(v,b),this.textureManager.acquireTexture(s,c,f)},u.prototype.computeBytes=function(a,s){return L(a)*Xt(s)},u}();function tP(u,a){if(a==="float32"||a==="complex64")return u;if(a==="int32"||a==="bool"){for(var s=a==="int32"?new Int32Array(u.length):new Uint8Array(u.length),c=0;c<s.length;++c)s[c]=Math.round(u[c]);return s}throw new Error("Unknown dtype "+a)}function u1(u){return u instanceof Float32Array?u:new Float32Array(u)}function eP(u){var a=V(u,"x","neg");return Z.engine.runKernel(function(s){return s.neg(a)},{$x:a},function(s){return{$x:function(){return s.neg()}}})}function nP(u){var a=V(u,"x","ceil");return Z.engine.runKernel(function(s){return s.ceil(a)},{$x:a},function(s){return{$x:function(){return vn(s)}}})}function rP(u){var a=V(u,"x","floor");return Z.engine.runKernel(function(s){return s.floor(a)},{$x:a},function(s){return{$x:function(){return vn(s)}}})}function oP(u){var a=V(u,"x","sign");return Z.engine.runKernel(function(s){return s.sign(a)},{$x:a},function(s){return{$x:function(){return vn(s)}}})}function aP(u){var a=V(u,"x","round");return Z.engine.runKernel(function(s){return s.round(a)},{$x:a},function(s){return{$x:function(){return vn(s)}}})}function iP(u){var a=V(u,"x","exp");return Z.engine.runKernel(function(s,c){return c(s.exp(a))},{$x:a},function(s,c){var f=c[0];return{$x:function(){return s.mulStrict(f)}}})}function sP(u){var a=V(u,"x","expm1");return Z.engine.runKernel(function(s){return s.expm1(a)},{$x:a},function(s){return{$x:function(){return s.mulStrict(a.exp())}}})}function uP(u){var a=V(u,"x","log");return Z.engine.runKernel(function(s){return s.log(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(a.toFloat())}}})}function cP(u){var a=V(u,"x","log1p");return Z.engine.runKernel(function(s){return s.log1p(a)},{$x:a},function(s){return{$x:function(){return s.div(a.add(1))}}})}function lP(u){var a=V(u,"x","sqrt");return Z.engine.runKernel(function(s){return s.sqrt(a)},{$x:a},function(s){return{$x:function(){return s.div(a.toFloat().sqrt().mul(2))}}})}function dP(u){var a=V(u,"x","rsqrt");return Z.engine.runKernel(function(s){return s.rsqrt(a)},{$x:a},function(s){return{$x:function(){return s.div(a.pow(1.5).mul(2)).neg()}}})}function fP(u){var a=V(u,"x","square");return Z.engine.runKernel(function(s){return s.square(a)},{$x:a},function(s){return{$x:function(){return s.mul(a.toFloat().mul(2))}}})}function pP(u){var a=V(u,"x","reciprocal");return Z.engine.runKernel(function(s){return s.reciprocal(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(a.square().neg())}}})}function hP(u){var a=V(u,"x","abs");return a.dtype==="complex64"?Z.engine.runKernel(function(s){return s.complexAbs(a)},{$x:a}):Z.engine.runKernel(function(s){return s.abs(a)},{$x:a},function(s){return{$x:function(){return s.mulStrict(a.toFloat().step(-1))}}})}function mP(u,a,s){var c=V(u,"x","clipByValue");return D(a<=s,"Error in clip: min ("+a+") must be less than or equal to max ("+s+")."),Z.engine.runKernel(function(f){return f.clip(c,a,s)},{$x:c},function(f){return{$x:function(){return f.where(c.greaterEqual(a).logicalAnd(c.lessEqual(s)),vn(f))}}})}function gP(u){var a=V(u,"x","sigmoid");return Z.engine.runKernel(function(s,c){return c(s.sigmoid(a))},{$x:a},function(s,c){var f=c[0];return{$x:function(){return s.mul(f.mul(Nt(1).sub(f)))}}})}function vP(u){var a=V(u,"x","logSigmoid");return Z.engine.runKernel(function(s){return s.softplus(a.neg()).neg()},{$x:a},function(s){return{$x:function(){return s.mulStrict(a.neg().sigmoid())}}})}function yP(u){var a=V(u,"x","softplus");return Z.engine.runKernel(function(s){return s.softplus(a)},{$x:a},function(s){return{$x:function(){return s.mulStrict(a.sigmoid())}}})}function bP(u){var a=V(u,"x","sin");return Z.engine.runKernel(function(s){return s.sin(a)},{$x:a},function(s){return{$x:function(){return a.toFloat().cos().mulStrict(s)}}})}function xP(u){var a=V(u,"x","cos");return Z.engine.runKernel(function(s){return s.cos(a)},{$x:a},function(s){return{$x:function(){return a.toFloat().sin().neg().mulStrict(s)}}})}function wP(u){var a=V(u,"x","tan");return Z.engine.runKernel(function(s){return s.tan(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(a.cos().square())}}})}function CP(u){var a=V(u,"x","asin");return Z.engine.runKernel(function(s){return s.asin(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(Nt(1).sub(a.toFloat().square()).sqrt())}}})}function SP(u){var a=V(u,"x","acos");return Z.engine.runKernel(function(s){return s.acos(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(Nt(1).sub(a.toFloat().square()).sqrt()).neg()}}})}function _P(u){var a=V(u,"x","atan");return Z.engine.runKernel(function(s){return s.atan(a)},{$x:a},function(s){return{$x:function(){return s.div(a.toFloat().square().add(1))}}})}function EP(u){var a=V(u,"x","sinh");return Z.engine.runKernel(function(s){return s.sinh(a)},{$x:a},function(s){return{$x:function(){return a.toFloat().cosh().mulStrict(s)}}})}function kP(u){var a=V(u,"x","cosh");return Z.engine.runKernel(function(s){return s.cosh(a)},{$x:a},function(s){return{$x:function(){return a.toFloat().sinh().mulStrict(s)}}})}function RP(u){var a=V(u,"x","tanh");return Z.engine.runKernel(function(s,c){return c(s.tanh(a))},{$x:a},function(s,c){var f=c[0];return{$x:function(){return Nt(1).sub(f.square()).mulStrict(s)}}})}function TP(u){var a=V(u,"x","asinh");return Z.engine.runKernel(function(s){return s.asinh(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(Nt(1).add(a.toFloat().square()).sqrt())}}})}function DP(u){var a=V(u,"x","acosh");return Z.engine.runKernel(function(s){return s.acosh(a)},{$x:a},function(s){return{$x:function(){return s.divStrict(a.toFloat().square().sub(1).sqrt())}}})}function AP(u){var a=V(u,"x","atanh");return Z.engine.runKernel(function(s){return s.atanh(a)},{$x:a},function(s){return{$x:function(){return s.div(Nt(1).sub(a.toFloat().square()))}}})}function IP(u){var a=V(u,"x","erf");return D(a.dtype==="int32"||a.dtype==="float32","Input dtype must be `int32` or `float32`."),a.dtype==="int32"&&(a=a.toFloat()),Z.engine.runKernel(function(s){return s.erf(a)},{$x:a},function(s){return{$x:function(){return s.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}function NP(u,a){a===void 0&&(a=0);var s=V(u,"x","step");return Z.engine.runKernel(function(c){return c.step(s,a)},{$x:s},function(c){return{$x:function(){return vn(c)}}})}Z.get("IS_BROWSER")&&Z.registerBackend("webgl",function(){return new s1},2,Vr);var c1=st({abs_:hP}),l1=st({acos_:SP}),d1=st({acosh_:DP}),f1=st({asin_:CP}),p1=st({asinh_:TP}),h1=st({atan_:_P}),m1=st({atanh_:AP}),g1=st({ceil_:nP}),$d=st({clipByValue_:mP}),v1=st({cos_:xP}),y1=st({cosh_:kP}),b1=st({erf_:IP}),Bd=st({exp_:iP}),x1=st({expm1_:sP}),w1=st({floor_:rP}),C1=st({log_:uP}),S1=st({log1p_:cP}),_1=st({logSigmoid_:vP}),Fc=st({neg_:eP}),E1=st({reciprocal_:pP}),k1=st({round_:aP}),Oh=st({rsqrt_:dP}),Fh=st({sigmoid_:gP}),R1=st({sign_:oP}),T1=st({sin_:bP}),D1=st({sinh_:EP}),A1=st({softplus_:yP}),I1=st({sqrt_:lP}),N1=st({square_:fP}),P1=st({step_:NP}),M1=st({tan_:wP}),O1=st({tanh_:RP});function PP(u,a,s,c,f,m){c===void 0&&(c=.001);var v,b,w=V(u,"x","batchNormalization"),S=V(a,"mean","batchNormalization"),E=V(s,"variance","batchNormalization");return f!=null&&(v=V(f,"scale","batchNormalization")),m!=null&&(b=V(m,"offset","batchNormalization")),D(w.rank===2,"Error in batchNormalization3D: x must be rank 3 but got rank "+w.rank+"."),D(S.rank===2||S.rank===1,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+S.rank+"."),D(E.rank===2||E.rank===1,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+E.rank+"."),v!=null&&D(v.rank===2||v.rank===1,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+v.rank+"."),b!=null&&D(b.rank===2||b.rank===1,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+b.rank+"."),xu(w,S,E,c,v,b)}function MP(u,a,s,c,f,m){c===void 0&&(c=.001);var v,b,w=V(u,"x","batchNormalization"),S=V(a,"mean","batchNormalization"),E=V(s,"variance","batchNormalization");return f!=null&&(v=V(f,"scale","batchNormalization")),m!=null&&(b=V(m,"offset","batchNormalization")),D(w.rank===3,"Error in batchNormalization3D: x must be rank 3 but got rank "+w.rank+"."),D(S.rank===3||S.rank===1,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+S.rank+"."),D(E.rank===3||E.rank===1,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+E.rank+"."),v!=null&&D(v.rank===3||v.rank===1,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+v.rank+"."),b!=null&&D(b.rank===3||b.rank===1,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+b.rank+"."),xu(w,S,E,c,v,b)}function OP(u,a,s,c,f,m){c===void 0&&(c=.001);var v,b,w=V(u,"x","batchNormalization"),S=V(a,"mean","batchNormalization"),E=V(s,"variance","batchNormalization");return f!=null&&(v=V(f,"scale","batchNormalization")),m!=null&&(b=V(m,"offset","batchNormalization")),D(w.rank===4,"Error in batchNormalization4D: x must be rank 4 but got rank "+w.rank+"."),D(S.rank===4||S.rank===1,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+S.rank+"."),D(E.rank===4||E.rank===1,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+E.rank+"."),v!=null&&D(v.rank===4||v.rank===1,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+v.rank+"."),b!=null&&D(b.rank===4||b.rank===1,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+b.rank+"."),xu(w,S,E,c,v,b)}function FP(u,a,s,c,f,m){c===void 0&&(c=.001);var v,b,w,S=V(u,"x","batchNormalization"),E=V(a,"mean","batchNormalization"),R=V(s,"variance","batchNormalization");return f!=null&&(v=V(f,"scale","batchNormalization")),m!=null&&(b=V(m,"offset","batchNormalization")),D(E.rank===R.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),D(b==null||E.rank===b.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),D(v==null||E.rank===v.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),w=S.rank===0||S.rank===1?S.as4D(1,1,1,S.size):S.rank===2?S.as4D(1,1,S.shape[0],S.shape[1]):S.rank===3?S.as4D(1,S.shape[0],S.shape[1],S.shape[2]):S,Z.engine.runKernel(function(T){return T.batchNormalization(w,Ld(E),Ld(R),c,Ld(v),Ld(b))},{$x:S,$mean:E,$variance:R,$scale:v,$offset:b},function(T){var P=v??Nt(1),O=rr(E.shape,w.shape),$=[];if(E.rank===1){for(var B=0;B<w.shape.length-1;++B)$.push(w.shape[B]);$.push(1)}var U=S.sub(E),z=T.mul(P),j=Oh(R.add(Nt(c))),K=j.mul(j).mul(j).mul(Nt(-.5));return{$x:function(){return E.rank===1?T.mul(ls(j.as4D(1,1,1,E.shape[0]),$)).mul(P).reshape(S.shape):T.mul(j).mul(P).reshape(S.shape)},$mean:function(){var J=j.mul(Nt(-1)).mul(z);return E.rank===1&&(J=J.sum(O)),J.reshape(E.shape)},$variance:function(){var J=K.mul(U).mul(z);return E.rank===1&&(J=J.sum(O)),J.reshape(E.shape)},$scale:function(){var J=U.mul(j),dt=T.mul(J);return E.rank===1&&(dt=dt.sum(O)),dt.reshape(E.shape)},$offset:function(){var J=T;return E.rank===1&&(J=J.sum(O)),J.reshape(E.shape)}}}).reshape(S.shape)}function Ld(u){return u==null?null:u.rank===0?u.as1D():u.rank===1?u:u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u}var F1=st({batchNormalization2d_:PP}),$1=st({batchNormalization3d_:MP}),B1=st({batchNormalization4d_:OP}),xu=st({batchNormalization_:FP});function $c(u,a,s,c,f,m,v){v===void 0&&(v="channelsLast");var b,w=Wd(a),S=w[0],E=w[1];if(v==="channelsLast")b=[S,E,u[3],u[3]];else{if(v!=="channelsFirst")throw new Error("Unknown dataFormat "+v);b=[S,E,u[1],u[1]]}return Bc(u,b,s,c,f,m,!1,v)}function Bc(u,a,s,c,f,m,v,b){v===void 0&&(v=!1),b===void 0&&(b="channelsLast");var w=[-1,-1,-1,-1],S=w[0],E=w[1],R=w[2],T=w[3];if(b==="channelsLast")S=u[0],E=u[1],R=u[2],T=u[3];else{if(b!=="channelsFirst")throw new Error("Unknown dataFormat "+b);S=u[0],T=u[1],E=u[2],R=u[3]}var P,O=a[0],$=a[1],B=a[3],U=Wd(s),z=U[0],j=U[1],K=Wd(c),J=K[0],dt=K[1],vt=wu(O,J),bt=wu($,dt),kt=LP(f,E,R,z,j,vt,bt,m),_t=kt.padInfo,Mt=kt.outHeight,Vt=kt.outWidth,Jt=v?B*T:B;return b==="channelsFirst"?P=[S,Jt,Mt,Vt]:b==="channelsLast"&&(P=[S,Mt,Vt,Jt]),{batchSize:S,dataFormat:b,inHeight:E,inWidth:R,inChannels:T,outHeight:Mt,outWidth:Vt,outChannels:Jt,padInfo:_t,strideHeight:z,strideWidth:j,filterHeight:O,filterWidth:$,effectiveFilterHeight:vt,effectiveFilterWidth:bt,dilationHeight:J,dilationWidth:dt,inShape:u,outShape:P,filterShape:a}}function $h(u,a,s,c,f,m,v){m===void 0&&(m=!1),v===void 0&&(v="channelsLast");var b=[-1,-1,-1,-1,-1],w=b[0],S=b[1],E=b[2],R=b[3],T=b[4];if(v==="channelsLast")w=u[0],S=u[1],E=u[2],R=u[3],T=u[4];else{if(v!=="channelsFirst")throw new Error("Unknown dataFormat "+v);w=u[0],T=u[1],S=u[2],E=u[3],R=u[4]}var P,O=a[0],$=a[1],B=a[2],U=a[4],z=L1(s),j=z[0],K=z[1],J=z[2],dt=L1(c),vt=dt[0],bt=dt[1],kt=dt[2],_t=WP(f,S,E,R,j,K,J,wu(O,vt),wu($,bt),wu(B,kt)),Mt=_t.padInfo,Vt=_t.outDepth,Jt=_t.outHeight,ee=_t.outWidth,le=m?U*T:U;return v==="channelsFirst"?P=[w,le,Vt,Jt,ee]:v==="channelsLast"&&(P=[w,Vt,Jt,ee,le]),{batchSize:w,dataFormat:v,inDepth:S,inHeight:E,inWidth:R,inChannels:T,outDepth:Vt,outHeight:Jt,outWidth:ee,outChannels:le,padInfo:Mt,strideDepth:j,strideHeight:K,strideWidth:J,filterDepth:O,filterHeight:$,filterWidth:B,dilationDepth:vt,dilationHeight:bt,dilationWidth:kt,inShape:u,outShape:P,filterShape:a}}function $P(u,a,s,c,f,m){f==null&&(f=BP(u,a,c));var v=u[0],b=u[1],w=W1((v-a+2*f)/c+1,m);D(Q(w),"The output # of rows ("+w+") must be an integer. Change the stride and/or zero pad parameters");var S=W1((b-a+2*f)/c+1,m);return D(Q(S),"The output # of columns ("+S+") must be an integer. Change the stride and/or zero pad parameters"),[w,S,s]}function BP(u,a,s,c){c===void 0&&(c=1);var f=wu(a,c);return Math.floor((u[0]*(s-1)-s+f)/2)}function Wd(u){return typeof u=="number"?[u,u]:u}function L1(u){return typeof u=="number"?[u,u,u]:u}function wu(u,a){return a<=1?u:u+(u-1)*(a-1)}function LP(u,a,s,c,f,m,v,b){var w,S,E;if(typeof u=="number"){w={top:u,bottom:u,left:u,right:u,type:u===0?"VALID":"NUMBER"};var R=$P([a,s,1],m,1,c,u,b);S=R[0],E=R[1]}else if(u==="same"){var T=((S=Math.ceil(a/c))-1)*c+m-a,P=((E=Math.ceil(s/f))-1)*f+v-s,O=Math.floor(T/2),$=T-O,B=Math.floor(P/2);w={top:O,bottom:$,left:B,right:P-B,type:"SAME"}}else{if(u!=="valid")throw Error("Unknown padding parameter: "+u);w={top:0,bottom:0,left:0,right:0,type:"VALID"},S=Math.ceil((a-m+1)/c),E=Math.ceil((s-v+1)/f)}return{padInfo:w,outHeight:S,outWidth:E}}function WP(u,a,s,c,f,m,v,b,w,S){var E,R,T,P;if(u==="same"){var O=((R=Math.ceil(a/f))-1)*f+b-a,$=((T=Math.ceil(s/m))-1)*m+w-s,B=((P=Math.ceil(c/v))-1)*v+S-c,U=Math.floor(O/2),z=O-U,j=Math.floor($/2),K=$-j,J=Math.floor(B/2);E={top:j,bottom:K,left:J,right:B-J,front:U,back:z,type:"SAME"}}else{if(u!=="valid")throw Error("Unknown padding parameter: "+u);E={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},R=Math.ceil((a-b+1)/f),T=Math.ceil((s-w+1)/m),P=Math.ceil((c-S+1)/v)}return{padInfo:E,outDepth:R,outHeight:T,outWidth:P}}function W1(u,a){if(!a)return u;switch(a){case"round":return Math.round(u);case"ceil":return Math.ceil(u);case"floor":return Math.floor(u);default:throw new Error("Unknown roundingMode "+a)}}function Ud(u){var a=Wd(u),s=a[0],c=a[1];return s===1&&c===1}function di(u,a){return Ud(u)||Ud(a)}function UP(u,a,s,c){var f;s===void 0&&(s=!1),c===void 0&&(c=!1);var m=V(u,"a","matMul"),v=V(a,"b","matMul");m=(f=tr(m,v))[0],v=f[1];var b=s?m.shape[m.rank-2]:m.shape[m.rank-1],w=c?v.shape[v.rank-1]:v.shape[v.rank-2],S=s?m.shape[m.rank-1]:m.shape[m.rank-2],E=c?v.shape[v.rank-2]:v.shape[v.rank-1],R=m.shape.slice(0,-2),T=v.shape.slice(0,-2),P=L(R),O=L(T);D(m.rank>=2&&v.rank>=2&&m.rank===v.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+m.rank+" and "+v.rank+"."),D(q(R,T),"Error in matMul: outer dimensions ("+R+") and ("+T+") of Tensors with shapes "+m.shape+" and "+v.shape+" must match."),D(b===w,"Error in matMul: inner shapes ("+b+") and ("+w+") of Tensors with shapes "+m.shape+" and "+v.shape+" and transposeA="+s+" and transposeB="+c+" must match.");var $=m.shape.slice(0,-2).concat([S,E]),B=s?m.as3D(P,b,S):m.as3D(P,S,b),U=c?v.as3D(O,E,w):v.as3D(O,w,E);return Z.engine.runKernel(function(z){return z.batchMatMul(B,U,s,c)},{$a:B,$b:U},function(z){return s||c?!s&&c?{$a:function(){return z.matMul(U,!1,!1)},$b:function(){return z.matMul(B,!0,!1)}}:s&&!c?{$a:function(){return U.matMul(z,!1,!0)},$b:function(){return B.matMul(z,!1,!1)}}:{$a:function(){return U.matMul(z,!0,!0)},$b:function(){return z.matMul(B,!0,!0)}}:{$a:function(){return z.matMul(U,!1,!0)},$b:function(){return B.matMul(z,!0,!1)}}}).reshape($)}function zP(u,a){var s=V(u,"v1","outerProduct"),c=V(a,"v2","outerProduct");return D(s.rank===1&&c.rank===1,"Error in outerProduct: inputs must be rank 1, but got ranks "+s.rank+" and "+c.rank+"."),s.as2D(-1,1).matMul(c.as2D(1,-1))}function VP(u,a){var s=V(u,"t1","dot"),c=V(a,"t2","dot");D(!(s.rank!==1&&s.rank!==2||c.rank!==1&&c.rank!==2),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+s.rank+" and "+c.rank+".");var f=s.rank===1?s.size:s.shape[1],m=c.rank===1?c.size:c.shape[0];return D(f===m,"Error in dot: inner dimensions of inputs must match, but got "+f+" and "+m+"."),s.rank===1&&c.rank===1?s.as2D(1,-1).matMul(c.as2D(-1,1)).asScalar():s.rank===1&&c.rank===2?s.as2D(1,-1).matMul(c.as2D(c.shape[0],c.shape[1])).as1D():s.rank===2&&c.rank===1?s.matMul(c.as2D(-1,1)).as1D():s.matMul(c.as2D(c.shape[0],c.shape[1]))}var Lc=st({matMul_:UP}),U1=st({dot_:VP}),z1=st({outerProduct_:zP});function HP(u,a,s,c,f,m,v){f===void 0&&(f="NWC"),m===void 0&&(m=1);var b=V(u,"x","conv1d"),w=V(a,"filter","conv1d"),S=b,E=!1;b.rank===2&&(E=!0,S=b.as3D(1,b.shape[0],b.shape[1])),D(S.rank===3,"Error in conv1d: input must be rank 3, but got rank "+S.rank+"."),D(w.rank===3,"Error in conv1d: filter must be rank 3, but got rank "+w.rank+"."),v!=null&&D(Q(c),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+v+" but got pad "+c+"."),D(S.shape[2]===w.shape[1],"Error in conv1d: depth of input ("+S.shape[2]+") must match input depth for filter "+w.shape[1]+"."),D(di(s,m),"Error in conv1D: Either stride or dilation must be 1. Got stride "+s+" and dilation '"+m+"'"),D(f==="NWC","Error in conv1d: got dataFormat of "+f+" but only NWC is currently supported.");var R=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),T=S.as4D(S.shape[0],1,S.shape[1],S.shape[2]),P=Bo(T,R,[1,s],c,"NHWC",[1,m],v);return E?P.as2D(P.shape[2],P.shape[3]):P.as3D(P.shape[0],P.shape[2],P.shape[3])}function GP(u,a,s,c,f,m,v){f===void 0&&(f="NHWC"),m===void 0&&(m=[1,1]);var b=V(u,"x","conv2d"),w=V(a,"filter","conv2d"),S=b,E=!1;b.rank===3&&(E=!0,S=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),D(S.rank===4,"Error in conv2d: input must be rank 4, but got rank "+S.rank+"."),D(w.rank===4,"Error in conv2d: filter must be rank 4, but got rank "+w.rank+"."),v!=null&&D(Q(c),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+v+" but got pad "+c+"."),D(S.shape[3]===w.shape[2],"Error in conv2d: depth of input ("+S.shape[3]+") must match input depth for filter "+w.shape[2]+"."),D(di(s,m),"Error in conv2D: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+m+"'"),D(f==="NHWC","Error in conv2d: got dataFormat of "+f+" but only NHWC is currently supported.");var R,T=Bc(S.shape,w.shape,s,m,c,v);if(T.filterHeight!==1||T.filterWidth!==1||T.dilationHeight!==1||T.dilationWidth!==1||T.strideHeight!==1||T.strideWidth!==1||T.padInfo.type!=="SAME"&&T.padInfo.type!=="VALID")R=Z.engine.runKernel(function($){return $.conv2d(S,w,T)},{x:S,$filter:w},function($){return D(Ud(m),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+m+"'"),{x:function(){return V1(S.shape,$,w,s,c)},$filter:function(){return H1(S,$,w.shape,s,c)}}});else{var P=S.reshape([-1,T.inChannels]),O=w.reshape([T.inChannels,T.outChannels]);R=Lc(P,O).reshape(T.outShape)}return E?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}function V1(u,a,s,c,f,m){D(u.length===a.rank,"Length of inShape ("+u.length+") and rank of dy ("+a.rank+") must match");var v=u,b=a,w=!1;a.rank===3&&(w=!0,b=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]),v=[1,u[0],u[1],u[2]]);var S=v[3],E=b.shape[3];D(v.length===4,"Error in conv2dDerInput: inShape must be length 4, but got length "+v.length+"."),D(b.rank===4,"Error in conv2dDerInput: dy must be rank 4, but got rank "+b.rank),D(s.rank===4,"Error in conv2dDerInput: filter must be rank 4, but got rank "+s.rank),D(S===s.shape[2],"Error in conv2dDerInput: depth of input ("+S+") must match input depth for filter "+s.shape[2]+"."),D(E===s.shape[3],"Error in conv2dDerInput: depth of output ("+E+") must match output depth for filter "+s.shape[3]+"."),m!=null&&D(Q(f),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+m+" but got pad "+f+".");var R=Bc(v,s.shape,c,1,f,m),T=Z.engine.runKernel(function(P){return P.conv2dDerInput(b,s,R)},{dy4D:b,filter:s},function(P){return{dy4D:function(){return Bo(P,s,c,f,"NHWC",1,m)},filter:function(){return Lh(P,b,s.shape,c,f,m)}}});return w?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}function H1(u,a,s,c,f,m){var v=u;u.rank===3&&(v=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]));var b=a;b.rank===3&&(b=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(v.rank===4,"Error in conv2dDerFilter: input must be rank 4, but got shape "+v.shape+"."),D(b.rank===4,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+b.shape+"."),D(s.length===4,"Error in conv2dDerFilter: filterShape must be length 4, but got "+s+"."),D(v.shape[3]===s[2],"Error in conv2dDerFilter: depth of input "+v.shape[3]+") must match input depth in filter ("+s[2]+"."),D(b.shape[3]===s[3],"Error in conv2dDerFilter: depth of dy ("+b.shape[3]+") must match output depth for filter ("+s[3]+")."),m!=null&&D(Q(f),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+m+" but got pad "+f+".");var w=Bc(v.shape,s,c,1,f,m);return Z.engine.runKernel(function(S){return S.conv2dDerFilter(v,b,w)},{x4D:v,dy4D:b})}function qP(u,a,s,c,f,m){return V1(s,V(u,"x","conv2dTranspose"),V(a,"filter","conv2dTranspose"),c,f,m)}function jP(u,a,s,c,f,m,v){m===void 0&&(m=[1,1]);var b=V(u,"x","depthwiseConv2d"),w=V(a,"filter","depthwiseConv2d"),S=b,E=!1;b.rank===3&&(E=!0,S=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),D(S.rank===4,"Error in depthwiseConv2d: input must be rank 4, but got rank "+S.rank+"."),D(w.rank===4,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+w.rank+"."),D(S.shape[3]===w.shape[2],"Error in depthwiseConv2d: number of input channels ("+S.shape[3]+") must match the inChannels dimension in filter "+w.shape[2]+"."),m==null&&(m=[1,1]),D(di(s,m),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+m+"'"),v!=null&&D(Q(c),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+v+" but got pad "+c+".");var R=Bc(S.shape,w.shape,s,m,c,v,!0),T=Z.engine.runKernel(function(P){return P.depthwiseConv2D(S,w,R)},{x:S,$filter:w},function(P){return D(Ud(m),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+m+"'"),{x:function(){return QP(S.shape,P,w,R)},$filter:function(){return JP(S,P,w.shape,R)}}});return E?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}function KP(u,a,s,c,f,m,v){m===void 0&&(m=[1,1]),v===void 0&&(v="NHWC");var b=V(u,"x","separableConv2d"),w=V(a,"depthwiseFilter","separableConv2d"),S=V(s,"pointwiseFilter","separableConv2d"),E=b,R=!1;if(b.rank===3&&(R=!0,E=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),v==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(E.rank===4,"Error in separableConv2d: input must be rank 4, but got rank "+E.rank+"."),D(w.rank===4,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+w.rank+"."),D(S.rank===4,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+w.rank+"."),D(S.shape[0]===1,"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+S.shape[0]+"."),D(S.shape[1]===1,"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+S.shape[1]+".");var T=w.shape[2],P=w.shape[3];D(S.shape[2]===T*P,"Error in separableConv2d: the third dimension of pointwise filter must be "+T*P+", but got "+S.shape[2]+".");var O=zd(E,w,c,f,v,m),$=Bo(O,S,1,"valid",v);return R?$.as3D($.shape[1],$.shape[2],$.shape[3]):$}function XP(u){return typeof u=="number"?[u,u,u]:u.length===2?[u[0],u[1],1]:u}function Bh(u){var a=XP(u),s=a[0],c=a[1],f=a[2];return s===1&&c===1&&f===1}function YP(u,a){return Bh(u)||Bh(a)}function QP(u,a,s,c){var f=a,m=!1;a.rank===3&&(m=!0,f=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var v=Z.engine.runKernel(function(b){return b.depthwiseConv2DDerInput(f,s,c)},{dy4D:f});return m?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function JP(u,a,s,c){var f=u;u.rank===3&&(f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]));var m=a;return m.rank===3&&(m=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Z.engine.runKernel(function(v){return v.depthwiseConv2DDerFilter(f,m,c)},{x4D:f,dy4D:m})}function ZP(u,a,s,c,f,m){f===void 0&&(f="NHWC"),m===void 0&&(m=[1,1,1]);var v=V(u,"x","conv3d"),b=V(a,"filter","conv3d"),w=v,S=!1;v.rank===4&&(S=!0,w=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),D(w.rank===5,"Error in conv3d: input must be rank 5, but got rank "+w.rank+"."),D(b.rank===5,"Error in conv3d: filter must be rank 5, but got rank "+b.rank+"."),D(w.shape[4]===b.shape[3],"Error in conv3d: depth of input ("+w.shape[4]+") must match input depth for filter "+b.shape[3]+"."),D(YP(s,m),"Error in conv3D: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+m+"'"),D(f==="NHWC","Error in conv3d: got dataFormat of "+f+" but only NHWC is currently supported.");var E=$h(w.shape,b.shape,s,m,c),R=Z.engine.runKernel(function(T){return T.conv3d(w,b,E)},{x:w,$filter:b},function(T){return D(Bh(m),"Error in gradient of conv3D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+m+"'"),{x:function(){return tM(w.shape,T,b,s,c)},$filter:function(){return eM(w,T,b.shape,s,c)}}});return S?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R}function tM(u,a,s,c,f){D(u.length===a.rank,"Length of inShape ("+u.length+") and rank of dy ("+a.rank+") must match");var m=u,v=a,b=!1;a.rank===4&&(b=!0,v=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]),m=[1,u[0],u[1],u[2],u[3]]);var w=m[4],S=v.shape[4];D(m.length===5,"Error in conv3dDerInput: inShape must be length 5, but got length "+m.length+"."),D(v.rank===5,"Error in conv3dDerInput: dy must be rank 5, but got rank "+v.rank),D(s.rank===5,"Error in conv3dDerInput: filter must be rank 5, but got rank "+s.rank),D(w===s.shape[3],"Error in conv3dDerInput: depth of input ("+w+") must match input depth for filter "+s.shape[3]+"."),D(S===s.shape[4],"Error in conv3dDerInput: depth of output ("+S+") must match output depth for filter "+s.shape[4]+".");var E=$h(m,s.shape,c,1,f),R=Z.engine.runKernel(function(T){return T.conv3dDerInput(v,s,E)},{dy5D:v});return b?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R}function eM(u,a,s,c,f){var m=u;u.rank===4&&(m=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]));var v=a;v.rank===4&&(v=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),D(m.rank===5,"Error in conv3dDerFilter: input must be rank 5, but got shape "+m.shape+"."),D(v.rank===5,"Error in conv3dDerFilter: dy must be rank 5, but got shape "+v.shape+"."),D(s.length===5,"Error in conv3dDerFilter: filterShape must be length 5, but got "+s+"."),D(m.shape[4]===s[3],"Error in conv3dDerFilter: depth of input "+m.shape[4]+") must match input depth in filter ("+s[3]+"."),D(v.shape[4]===s[4],"Error in conv3dDerFilter: depth of dy ("+v.shape[4]+") must match output depth for filter ("+s[4]+").");var b=$h(m.shape,s,c,1,f);return Z.engine.runKernel(function(w){return w.conv3dDerFilter(m,v,b)},{x5D:m,dy5D:v})}var G1=st({conv1d_:HP}),Bo=st({conv2d_:GP}),q1=st({conv3d_:ZP}),Lh=st({conv2dDerFilter_:H1}),zd=st({depthwiseConv2d_:jP}),Vd=st({separableConv2d_:KP}),j1=st({conv2dTranspose_:qP});function nM(u){var a=V(u,"x","reverse");return D(a.rank===1,`Error in reverse1D: x must be rank 1 but got
             rank `+a.rank+"."),Cu(a,0)}function rM(u,a){var s=V(u,"x","reverse");return D(s.rank===2,`Error in reverse2D: x must be rank 2 but got
             rank `+s.rank+"."),Cu(s,a)}function oM(u,a){var s=V(u,"x","reverse");return D(s.rank===3,`Error in reverse3D: x must be rank 3 but got
             rank `+s.rank+"."),Cu(s,a)}function aM(u,a){var s=V(u,"x","reverse");return D(s.rank===4,`Error in reverse4D: x must be rank 4 but got
             rank `+s.rank+"."),Cu(s,a)}function iM(u,a){var s=V(u,"x","reverse");if(s.rank===0)return s.clone();var c=yr(a,s.shape);return Z.engine.runKernel(function(f){return f.reverse(s,c)},{$x:s},function(f){return{$x:function(){return f.reverse(c)}}}).reshapeAs(s)}var Cu=st({reverse_:iM}),K1=st({reverse1d_:nM}),X1=st({reverse2d_:rM}),Y1=st({reverse3d_:oM}),Q1=st({reverse4d_:aM});function J1(u,a,s,c,f,m){var v=V(u,"x","maxPool"),b=v,w=!1;v.rank===3&&(w=!0,b=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),D(b.rank===4,"Error in maxPool: input must be rank 4 but got rank "+b.rank+"."),D(di(s,c),"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+c+"'"),m!=null&&D(Q(f),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+m+" but got pad "+f+".");var S=$c(b.shape,a,s,c,f,m),E=Z.engine.runKernel(function(R,T){return T(R.maxPool(b,S))},{x:b},function(R,T){var P=T[0];return{x:function(){return lM(R,b,P,a,s,c,f)}}});return w?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}function sM(u,a,s,c,f){return J1(u,a,s,1,c,f)}function Z1(u,a,s,c,f,m){var v=V(u,"x","avgPool","float32");D(di(s,c),"Error in avgPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+c+"'");var b=v,w=!1;v.rank===3&&(w=!0,b=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),D(b.rank===4,"Error in avgPool: x must be rank 4 but got rank "+b.rank+"."),m!=null&&D(Q(f),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+m+" but got pad "+f+".");var S=$c(b.shape,a,s,c,f),E=Z.engine.runKernel(function(R){return R.avgPool(b,S)},{x:b},function(R){return{x:function(){return dM(R,b,a,s,c,f)}}});return E=E.cast(v.dtype),w?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}function uM(u,a,s,c,f){return Z1(u,a,s,1,c,f)}function cM(u,a,s,c,f,m){f==null&&(f=[1,1]),m==null&&(m=1),c===0&&(c="valid");var v=V(u,"x","maxPool"),b=v,w=!1;v.rank===3&&(w=!0,b=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),D(di(m,f),"Error in pool: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+f+"'");var S,E=$c(b.shape,a,m,f,c),R=[E.dilationHeight,E.dilationWidth];S=c==="same"?pM([E.filterHeight,E.filterWidth],R):[[0,0],[0,0]];var T=R[0]===1&&R[1]===1,P=fM([E.inHeight,E.inWidth],R,S),O=P[0],$=P[1],B=T?c:"valid",U=T?b:Nh(b,R,O),z=(s==="avg"?function(){return Z1(U,a,m,1,B)}:function(){return J1(U,a,m,1,B)})(),j=T?z:Ah(z,R,$);return w?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}function lM(u,a,s,c,f,m,v,b){var w=V(u,"dy","maxPoolBackprop"),S=V(a,"input","maxPoolBackprop"),E=V(s,"output","maxPoolBackprop");D(S.rank===w.rank,"Rank of input ("+S.rank+") does not match rank of dy ("+w.rank+")"),D(di(f,m),"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+f+" and dilations '"+m+"'"),D(w.rank===4,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."),D(S.rank===4,"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+".");var R=$c(S.shape,c,f,m,v,b);return Z.engine.runKernel(function(T){return T.maxPoolBackprop(w,S,E,R)},{$dy:w,$input:S})}function dM(u,a,s,c,f,m){var v=V(u,"dy","avgPoolBackprop"),b=V(a,"input","avgPoolBackprop");D(b.rank===v.rank,"Rank of input ("+b.rank+") does not match rank of dy ("+v.rank+")"),D(di(c,f),"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'");var w=b,S=v,E=!1;b.rank===3&&(E=!0,w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),S=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),D(S.rank===4,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."),D(w.rank===4,"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+".");var R=$c(w.shape,s,c,f,m),T=Z.engine.runKernel(function(P){return P.avgPoolBackprop(S,w,R)},{dy4D:S,input4D:w});return E?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}function fM(u,a,s){var c=s.map(function(w){return w[0]}),f=s.map(function(w){return w[1]}),m=u.concat(c,f),v=a.map(function(w,S){return(w-m[S]%w)%w}),b=f.map(function(w,S){return w+v[S]});return[a.map(function(w,S){return[c[S],b[S]]}),a.map(function(w,S){return[0,v[S]]})]}function pM(u,a){var s=u.map(function(m,v){return m+(m-1)*(a[v]-1)}).map(function(m){return m-1}),c=s.map(function(m){return Math.floor(m/2)}),f=s.map(function(m,v){return m-c[v]});return s.map(function(m,v){return[c[v],f[v]]})}var Xn=st({maxPool_:sM}),Wc=st({avgPool_:uM}),tx=st({pool_:cM});function hM(u,a,s){var c=V(u,"x","slice1d");return D(c.rank===1,"slice1d expects a rank-1 tensor, but got a rank-"+c.rank+" tensor"),fi(c,[a],[s])}function mM(u,a,s){var c=V(u,"x","slice2d");return D(c.rank===2,"slice2d expects a rank-2 tensor, but got a rank-"+c.rank+" tensor"),fi(c,a,s)}function gM(u,a,s){var c=V(u,"x","slice3d");return D(c.rank===3,"slice3d expects a rank-3 tensor, but got a rank-"+c.rank+" tensor"),fi(c,a,s)}function vM(u,a,s){var c=V(u,"x","slice4d");return D(c.rank===4,"slice4d expects a rank-4 tensor, but got a rank-"+c.rank+" tensor"),fi(c,a,s)}function yM(u,a,s){var c,f,m=V(u,"x","slice");if(m.rank===0)throw new Error("Slicing scalar is not possible");c=typeof a=="number"?[a].concat(new Array(m.rank-1).fill(0)):a.length<m.rank?a.concat(new Array(m.rank-a.length).fill(0)):a.slice(),f=(f=s==null?new Array(m.rank).fill(-1):typeof s=="number"?[s].concat(new Array(m.rank-1).fill(-1)):s.length<m.rank?s.concat(new Array(m.rank-s.length).fill(-1)):s).map(function(b,w){return b>=0?b:(D(b===-1,"Bad value in size"),m.shape[w]-c[w])}),WD(m,c,f);var v=m.shape;return Z.engine.runKernel(function(b){return b.slice(m,c,f)},{$x:m},function(b){for(var w=[],S=0;S<b.rank;S++)w.push([c[S],v[S]-c[S]-f[S]]);return{$x:function(){return b.pad(w)}}})}var fi=st({slice_:yM}),ex=st({slice1d_:hM}),nx=st({slice2d_:mM}),Wh=st({slice3d_:gM}),rx=st({slice4d_:vM});function bM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","logSumExp"),f=yr(a,c.shape),m=c.max(f,!0),v=c.sub(m).exp().sum(f).log(),b=m.reshape(v.shape).add(v);if(s){var w=go(b.shape,f);return b.reshape(w)}return b}function xM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","sum");c.dtype==="bool"&&(c=c.toInt());var f=yr(a,c.shape);return fu(function(m){var v=Yo(f,m.rank),b=f,w=m;v!=null&&(w=m.transpose(v),b=Qo(b.length,m.rank));var S=Z.engine.runKernel(function(R){return R.sum(w,b)},{permutedX:w});if(s){var E=go(S.shape,f);S=S.reshape(E)}return{value:S,gradFunc:function(R){var T=m.shape.slice();return f.forEach(function(P){T[P]=1}),R.reshape(T).mul(Aa(m.shape,"float32"))}}})(c)}function wM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","prod");c.dtype==="bool"&&(c=c.toInt());var f=yr(a,c.shape),m=Yo(f,c.rank),v=f,b=c;m!=null&&(b=c.transpose(m),v=Qo(v.length,c.rank));var w=Z.engine.runKernel(function(E){return E.prod(b,v)},{permutedX:b});if(s){var S=go(w.shape,f);w=w.reshape(S)}return w}function CM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","mean"),f=yr(a,c.shape),m=L(er(c.shape,f)[1]);return fu(function(v){var b=Nt(m);return{value:(b.dtype===v.dtype?v:v.cast(b.dtype)).div(b).sum(a,s),gradFunc:function(w){var S=v.shape.slice();return f.forEach(function(E){S[E]=1}),w.reshape(S).mul(Aa(v.shape,"float32")).div(b)}}})(c)}function ox(u,a,s,c,f){var m=a[0];return m.rank<s.rank&&(m=m.reshape(go(m.shape,c))),u.rank<s.rank&&(u=u.reshape(go(u.shape,c))),{$x:function(){var v=u.mul(s.equal(m).cast(u.dtype));return f==null?v:v.transpose(f)}}}function SM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","min"),f=c,m=yr(a,c.shape),v=m,b=Yo(v,c.rank);b!=null&&(c=c.transpose(b),v=Qo(v.length,c.rank));var w=Z.engine.runKernel(function(E,R){return R(E.min(c,v))},{$x:c},function(E,R){return ox(E,R,f,m,b)});if(s){var S=go(w.shape,m);w=w.reshape(S)}return w}function _M(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","max"),f=c,m=yr(a,c.shape),v=m,b=Yo(v,c.rank);b!=null&&(c=c.transpose(b),v=Qo(v.length,c.rank));var w=Z.engine.runKernel(function(E,R){return R(E.max(c,v))},{$x:c},function(E,R){return ox(E,R,f,m,b)});if(s){var S=go(w.shape,m);w=w.reshape(S)}return w}function EM(u,a){a===void 0&&(a=0);var s=V(u,"x","argMin");a==null&&(a=0);var c=yr(a,s.shape),f=Yo(c,s.rank);return f!=null&&(s=s.transpose(f),c=Qo(c.length,s.rank)),Z.engine.runKernel(function(m){return m.argMin(s,c[0])},{$x:s},function(m){return{$x:function(){return vn(s)}}})}function kM(u,a){a===void 0&&(a=0);var s=V(u,"x","argMax");a==null&&(a=0);var c=yr(a,s.shape),f=Yo(c,s.rank);return f!=null&&(s=s.transpose(f),c=Qo(c.length,s.rank)),Z.engine.runKernel(function(m){return m.argMax(s,c[0])},{$x:s},function(m){return{$x:function(){return vn(s)}}})}function RM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","all","bool"),f=yr(a,c.shape),m=f,v=Yo(m,c.rank);v!=null&&(c=c.transpose(v),m=Qo(m.length,c.rank));var b=Z.engine.runKernel(function(S){return S.all(c,m)},{$x:c});if(s){var w=go(b.shape,f);return b.reshape(w)}return b}function TM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=V(u,"x","any","bool"),f=yr(a,c.shape),m=f,v=Yo(m,c.rank);v!=null&&(c=c.transpose(v),m=Qo(m.length,c.rank));var b=Z.engine.runKernel(function(S){return S.any(c,m)},{$x:c});if(s){var w=go(b.shape,f);return b.reshape(w)}return b}function DM(u,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var c=yr(a,(u=V(u,"x","moments")).shape),f=u.mean(c,s),m=f.shape;return s||(m=go(f.shape,c)),{mean:f,variance:u.toFloat().sub(f.reshape(m)).square().mean(c,s)}}var ax=st({all_:RM}),ix=st({any_:TM}),sx=st({argMax_:kM}),ux=st({argMin_:EM}),cx=st({logSumExp_:bM}),Uc=st({max_:_M}),lx=st({mean_:CM}),dx=st({min_:SM}),fx=st({moments_:DM}),Uh=st({sum_:xM}),px=st({prod_:wM});function AM(u,a){var s,c=V(u,"a","notEqual"),f=V(a,"b","notEqual");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.notEqual(c,f)},{$a:c,$b:f})}function IM(u,a){var s=V(u,"a","notEqualStrict"),c=V(a,"b","notEqualStrict");return M(s.shape,c.shape,"Error in notEqualStrict: "),s.notEqual(c)}function NM(u,a){var s,c=V(u,"a","less"),f=V(a,"b","less");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.less(c,f)},{$a:c,$b:f})}function PM(u,a){var s=V(u,"a","lessStrict"),c=V(a,"b","lessStrict");return M(s.shape,c.shape,"Error in lessStrict: "),s.less(c)}function MM(u,a){var s,c=V(u,"a","equal"),f=V(a,"b","equal");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.equal(c,f)},{$a:c,$b:f})}function OM(u,a){var s=V(u,"a","equalStrict"),c=V(a,"b","equalStrict");return M(s.shape,c.shape,"Error in equalStrict: "),s.equal(c)}function FM(u,a){var s,c=V(u,"a","lessEqual"),f=V(a,"b","lessEqual");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.lessEqual(c,f)},{$a:c,$b:f})}function $M(u,a){var s=V(u,"a","lessEqualStrict"),c=V(a,"b","lessEqualStrict");return M(s.shape,c.shape,"Error in lessEqualStrict: "),s.lessEqual(c)}function BM(u,a){var s,c=V(u,"a","greater"),f=V(a,"b","greater");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.greater(c,f)},{$a:c,$b:f})}function LM(u,a){var s=V(u,"a","greaterStrict"),c=V(a,"b","greaterStrict");return M(s.shape,c.shape,"Error in greaterStrict: "),s.greater(c)}function WM(u,a){var s,c=V(u,"a","greaterEqual"),f=V(a,"b","greaterEqual");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.greaterEqual(c,f)},{$a:c,$b:f},function(m){return{$a:function(){return vn(c)},$b:function(){return vn(f)}}})}function UM(u,a){var s=V(u,"a","greaterEqualStrict"),c=V(a,"b","greaterEqualStrict");return M(s.shape,c.shape,"Error in greaterEqualStrict: "),s.greaterEqual(c)}var zh=st({equal_:MM}),hx=st({equalStrict_:OM}),mx=st({greater_:BM}),Vh=st({greaterEqual_:WM}),gx=st({greaterEqualStrict_:UM}),vx=st({greaterStrict_:LM}),yx=st({less_:NM}),bx=st({lessEqual_:FM}),xx=st({lessEqualStrict_:$M}),wx=st({lessStrict_:PM}),Cx=st({notEqual_:AM}),Sx=st({notEqualStrict_:IM});function zM(u,a){var s,c=V(u,"a","add"),f=V(a,"b","add");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.add(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=v,w=rr(c.shape,m);return w.length>0&&(b=b.sum(w)),b.reshape(c.shape)},$b:function(){var b=v,w=rr(f.shape,m);return w.length>0&&(b=b.sum(w)),b.reshape(f.shape)}}})}function VM(u){D(Array.isArray(u),function(){return"The argument passed to tf.addN() must be a list of tensors"}),D(u.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+u.length});var a=u.map(function(f,m){return V(f,"tensors"+m,"addN")}),s=a[0];a.forEach(function(f){if(f.dtype!==s.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),a.forEach(function(f){if(!q(f.shape,s.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var c=a;return Z.engine.runKernel(function(f){return f.addN(a)},c,function(f){var m={};return a.forEach(function(v,b){m[b]=function(){return f.clone()}}),m})}function HM(u,a){var s=V(u,"a","addStrict"),c=V(a,"b","addStrict");return M(s.shape,c.shape,"Error in addStrict: "),s.add(c)}function GM(u,a){var s,c=V(u,"a","sub"),f=V(a,"b","sub");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.subtract(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=v,w=rr(c.shape,m);return w.length>0&&(b=b.sum(w)),b.reshape(c.shape)},$b:function(){var b=v,w=rr(f.shape,m);return w.length>0&&(b=b.sum(w)),b.neg().reshape(f.shape)}}})}function qM(u,a){var s=V(u,"a","subStrict"),c=V(a,"b","subStrict");return M(s.shape,c.shape,"Error in subStrict: "),s.sub(c)}function jM(u,a){var s=V(u,"base","pow"),c=V(a,"exp","pow"),f=Ge(s.shape,c.shape);return u=s.cast(Zn(s.dtype,c.dtype)),a=c.cast(Zn(s.dtype,c.dtype)),Z.engine.runKernel(function(m,v){return v(m.pow(s,c))},{$base:s,$exp:c},function(m,v){var b=v[0];return{$base:function(){var w=c.toFloat(),S=m.mul(w.mul(s.pow(w.sub(Nt(1))))),E=rr(s.shape,f);return E.length>0&&(S=S.sum(E)),S.reshape(s.shape)},$exp:function(){var w=m.mul(b.mul(s.log()).toFloat()),S=rr(c.shape,f);return S.length>0&&(w=w.sum(S)),w.reshape(c.shape)}}})}function KM(u,a){return M(u.shape,a.shape,"Error in powStrict: "),u.pow(a)}function XM(u,a){var s,c=V(u,"a","mul"),f=V(a,"b","mul");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.multiply(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=v.mul(f.toFloat()),w=rr(c.shape,m);return w.length>0?b.sum(w).reshape(c.shape):b},$b:function(){var b=v.mul(c.toFloat()),w=rr(f.shape,m);return w.length>0?b.sum(w).reshape(f.shape):b}}})}function YM(u,a){var s=V(u,"a","mul"),c=V(a,"b","mul");return M(s.shape,c.shape,"Error in multiplyStrict: "),s.mul(c)}function QM(u,a){var s,c,f=V(u,"a","div"),m=V(a,"b","div");if(s=tr(f,m),f=s[0],m=s[1],f.dtype==="int32"&&m.dtype==="int32")return Hh(f,m);c=function(b){return b.realDivide(f,m)};var v=Ge(f.shape,m.shape);return Z.engine.runKernel(c,{$a:f,$b:m},function(b){return{$a:function(){var w=b.div(m.toFloat()),S=rr(f.shape,v);return S.length>0?w.sum(S).reshape(f.shape):w},$b:function(){var w=b.mul(f.toFloat()),S=rr(m.shape,v);S.length>0&&(w=w.sum(S).reshape(m.shape));var E=m.square();return w.div(E.toFloat()).neg()}}})}function JM(u,a){var s,c=V(u,"a","floorDiv"),f=V(a,"b","floorDiv");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.floorDiv(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=v.div(f.toFloat()),w=rr(c.shape,m);return w.length>0?b.sum(w).reshape(c.shape):b},$b:function(){var b=v.mul(c.toFloat()),w=rr(f.shape,m);w.length>0&&(b=b.sum(w).reshape(f.shape));var S=f.square();return b.div(S.toFloat()).neg()}}})}function ZM(u,a){var s=V(u,"a","div"),c=V(a,"b","div");return M(s.shape,c.shape,"Error in divideStrict: "),s.div(c)}function t4(u,a){var s,c=V(u,"a","mod"),f=V(a,"b","mod");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.mod(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=rr(c.shape,m);return b.length>0?v.sum(b).reshape(c.shape):v},$b:function(){var b=v.mul(c.div(f).floor().neg()),w=rr(f.shape,m);return w.length>0?b.sum(w).reshape(f.shape):b}}})}function e4(u,a){var s=V(u,"a","modStrict"),c=V(a,"b","modStrict");return M(s.shape,c.shape,"Error in modStrict: "),s.mod(c)}function n4(u,a){var s,c=V(u,"a","minimum"),f=V(a,"b","minimum");return s=tr(c,f),c=s[0],f=s[1],c.dtype==="bool"&&(c=c.toInt(),f=f.toInt()),Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.minimum(c,f)},{$a:c,$b:f},function(m){return{$a:function(){return m.mul(c.lessEqual(f).toFloat())},$b:function(){return m.mul(c.greater(f).toFloat())}}})}function r4(u,a){var s=V(u,"a","minimumStrict"),c=V(a,"b","minimumStrict");return M(s.shape,c.shape,"Error in minimumStrict: "),s.minimum(c)}function o4(u,a){var s,c=V(u,"a","maximum"),f=V(a,"b","maximum");return s=tr(c,f),c=s[0],f=s[1],c.dtype==="bool"&&(c=c.toInt(),f=f.toInt()),Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.maximum(c,f)},{$a:c,$b:f},function(m){return{$a:function(){return m.mul(c.greaterEqual(f).toFloat())},$b:function(){return m.mul(c.less(f).toFloat())}}})}function a4(u,a){var s=V(u,"a","maximumStrict"),c=V(a,"b","maximumStrict");return M(s.shape,c.shape,"Error in maximumStrict: "),s.maximum(c)}function i4(u,a){var s,c=V(u,"a","squaredDifference"),f=V(a,"b","squaredDifference");return s=tr(c,f),c=s[0],f=s[1],Ge(c.shape,f.shape),Z.engine.runKernel(function(m){return m.squaredDifference(c,f)},{$a:c,$b:f},function(m){var v=Nt(2);return{$a:function(){return m.mul(c.sub(f).mul(v))},$b:function(){return m.mul(f.sub(c).mul(v))}}})}function s4(u,a){var s=V(u,"a","squaredDifferenceStrict"),c=V(a,"b","squaredDifferenceStrict");return M(s.shape,c.shape,"Error in squaredDifferenceStrict: "),s.squaredDifference(c)}function u4(u,a){var s,c=V(u,"a","atan2"),f=V(a,"b","atan2");s=tr(c,f),c=s[0],f=s[1];var m=Ge(c.shape,f.shape);return Z.engine.runKernel(function(v){return v.atan2(c,f)},{$a:c,$b:f},function(v){return{$a:function(){var b=Ue(c.square(),f.square()),w=v.mul(f.div(b)),S=rr(c.shape,m);return S.length>0&&(w=w.sum(S)),w.reshape(c.shape)},$b:function(){var b=Ue(c.square(),f.square()),w=Fc(v.mul(c.div(b))),S=rr(f.shape,m);return S.length>0&&(w=w.sum(S)),w.reshape(f.shape)}}})}var Ue=st({add_:zM}),_x=st({addN_:VM}),Ex=st({addStrict_:HM}),kx=st({atan2_:u4}),ea=st({div_:QM}),Rx=st({divStrict_:ZM}),Hh=st({floorDiv_:JM}),zc=st({maximum_:o4}),Tx=st({maximumStrict_:a4}),Hd=st({minimum_:n4}),Dx=st({minimumStrict_:r4}),Ax=st({mod_:t4}),Ix=st({modStrict_:e4}),xo=st({mul_:XM}),Nx=st({mulStrict_:YM}),Gh=st({pow_:jM}),Px=st({powStrict_:KM}),Mx=st({squaredDifference_:i4}),Ox=st({squaredDifferenceStrict_:s4}),jr=st({sub_:GM}),Fx=st({subStrict_:qM});function c4(u){var a=V(u,"x","logicalNot","bool");return Z.engine.runKernel(function(s){return s.logicalNot(a)},{$x:a})}function l4(u,a){var s=V(u,"a","logicalAnd","bool"),c=V(a,"b","logicalAnd","bool");return Ge(s.shape,c.shape),Z.engine.runKernel(function(f){return f.logicalAnd(s,c)},{$a:s,$b:c})}function d4(u,a){var s=V(u,"a","logicalOr","bool"),c=V(a,"b","logicalOr","bool");return Ge(s.shape,c.shape),Z.engine.runKernel(function(f){return f.logicalOr(s,c)},{$a:s,$b:c})}function f4(u,a){var s=V(u,"a","logicalXor","bool"),c=V(a,"b","logicalXor","bool");return Ge(s.shape,c.shape),qh(u,a).logicalAnd(Gd(u,a).logicalNot())}function p4(u,a,s){var c=V(a,"a","where"),f=V(s,"b","where"),m=V(u,"condition","where","bool");return M(c.shape,f.shape,"Error in where: "),m.rank===1?D(m.shape[0]===c.shape[0],"The first dimension of `a` must match the size of `condition`."):M(m.shape,f.shape,"Error in where: "),Z.engine.runKernel(function(v){return v.select(m,c,f)},{$condition:m,$a:c,$b:f},function(v){return{$condition:function(){return vn(m).toFloat()},$a:function(){return v.mul(m.cast(v.dtype))},$b:function(){return v.mul(m.logicalNot().cast(v.dtype))}}})}function h4(u){return l(this,void 0,void 0,function(){var a,s,c;return d(this,function(f){switch(f.label){case 0:return[4,(a=V(u,"condition","whereAsync","bool")).data()];case 1:return s=f.sent(),c=Mh(a.shape,s),u!==a&&a.dispose(),[2,c]}})})}var Gd=st({logicalAnd_:l4}),$x=st({logicalNot_:c4}),qh=st({logicalOr_:d4}),Bx=st({logicalXor_:f4}),qd=st({where_:p4}),Lx=h4;function m4(u){var a=V(u,"x","relu");return a.dtype==="bool"?a.toInt():Z.engine.runKernel(function(s){return s.relu(a)},{$x:a},function(s){var c=a.step();return{$x:function(){return s.mulStrict(c.toFloat())}}})}function g4(u){var a=V(u,"x","elu");return Z.engine.runKernel(function(s,c){return c(s.elu(a))},{$x:a},function(s,c){var f=c[0];return{$x:function(){return Z.engine.runKernel(function(m){return m.eluDer(s,f)},{dy:s,y:f})}}})}function v4(u){var a=V(u,"x","selu");return Z.engine.runKernel(function(s){return s.selu(a)},{$x:a},function(s){return{$x:function(){var c=a.greater(Nt(0)),f=Nt(Rh),m=Nt(Th),v=s.mul(m),b=s.mul(f).mul(a.toFloat().exp());return qd(c,v,b)}}})}function y4(u,a){a===void 0&&(a=.2);var s=V(u,"x","leakyRelu");return zc(Nt(a).mul(s),s)}function b4(u,a){var s=V(u,"x","prelu"),c=V(a,"alpha","prelu"),f=Nt(0);return zc(f,s).add(c.mul(Hd(f,s)))}var Wx=st({elu_:g4}),Ux=st({leakyRelu_:y4}),zx=st({prelu_:b4}),xr=st({relu_:m4}),Vx=st({selu_:v4});function x4(u,a){var s=V(u,"x","transpose");return a==null&&(a=s.shape.map(function(c,f){return f}).reverse()),D(s.rank===a.length,"Error in transpose: rank of input "+s.rank+" must match length of perm "+a+"."),a.forEach(function(c){D(c>=0&&c<s.rank,"All entries in 'perm' must be between 0 and "+(s.rank-1)+" but got "+a)}),s.rank<=1?s.clone():Z.engine.runKernel(function(c){return c.transpose(s,a)},{$x:s},function(c){var f=mh(a);return{$x:function(){return c.transpose(f)}}})}var Na=st({transpose_:x4});function w4(u,a,s,c,f){a===void 0&&(a=5),s===void 0&&(s=1),c===void 0&&(c=1),f===void 0&&(f=.5);var m=V(u,"x","localResponseNormalization");D(m.rank===4||m.rank===3,`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+m.rank+"."),D(Q(a),`Error in localResponseNormalization: depthRadius must be an integer
                     but got depthRadius `+a+".");var v=m,b=!1;m.rank===3&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var w=Z.engine.runKernel(function(S,E){return E(S.localResponseNormalization4D(v,a,s,c,f))},{x4D:v},function(S,E){var R=E[0];return{x4D:function(){return Z.engine.runKernel(function(T){return T.LRNGrad(S,v,R,a,s,c,f)},{})}}});return b?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}var Hx=st({localResponseNormalization_:w4});function C4(u,a,s,c){a===void 0&&(a="euclidean"),s===void 0&&(s=null),c===void 0&&(c=!1);var f=Gx(u=V(u,"x","norm"),a,s),m=f.shape;if(c){var v=yr(s,u.shape);m=go(f.shape,v)}return f.reshape(m)}function Gx(u,a,s){if(s===void 0&&(s=null),u.rank===0)return u.abs();if(u.rank!==1&&s===null)return Gx(u.reshape([-1]),a,s);if(u.rank===1||typeof s=="number"||s instanceof Array&&s.length===1){if(a===1)return u.abs().sum(s);if(a===1/0)return u.abs().max(s);if(a===-1/0)return u.abs().min(s);if(a==="euclidean"||a===2)return u.abs().pow(Nt(2,"int32")).sum(s).sqrt();throw new Error("Error in norm: invalid ord value: "+a)}if(s instanceof Array&&s.length===2){if(a===1)return u.abs().sum(s[0]).max(s[1]-1);if(a===1/0)return u.abs().sum(s[1]).max(s[0]);if(a===-1/0)return u.abs().sum(s[1]).min(s[0]);if(a==="fro"||a==="euclidean")return u.square().sum(s).sqrt();throw new Error("Error in norm: invalid ord value: "+a)}throw new Error("Error in norm: invalid axis: "+s)}var jh=st({norm_:C4});function S4(u,a,s){var c=V(u,"x","unsortedSegmentSum"),f=V(a,"segmentIds","unsortedSegmentSum","int32");return D(Q(s),"numSegments must be of dtype int"),Z.engine.runKernel(function(m){return m.unsortedSegmentSum(c,f,s)},{$x:c},function(m){return{$x:function(){return E4(m,f)}}})}function _4(u,a,s){s===void 0&&(s=0);var c=V(u,"x","gather"),f=V(a,"indices","gather","int32");return s=yr(s,c.shape)[0],Z.engine.runKernel(function(m){return m.gather(c,f,s)},{$x:c},function(m){return{$x:function(){if(s===0)return jd(m,f,c.shape[s]);var v=c.shape,b=f.size,w=v.slice(0,s),S=w.length,E=v.slice(s,v.length).slice(1),R=E.length,T=qx(0,S),P=qx(S+1,S+1+R),O=jx([w,[b],E]),$=m.reshape(O),B=f.reshape([b]),U=jx([[S],T,P]),z=$.transpose(U),j=jd(z,B,c.shape[s]),K=mh(U);return j=j.transpose(K)}}})}function qx(u,a){for(var s=[],c=u;c<a;++c)s.push(c);return s}function jx(u){for(var a=[],s=0;s<u.length;++s)for(var c=0;c<u[s].length;++c)a.push(u[s][c]);return a}function E4(u,a){for(var s=zc(a,vn(a)),c=Kh(u,s),f=Vh(a,Nt(0,"int32")),m=c.rank-f.rank,v=0;v<m;++v)f=ao(f,v+1);f=Gd(f,Aa(c.shape,"bool"));var b=vn(c);return qd(f,c,b)}var Kh=st({gather_:_4}),jd=st({unsortedSegmentSum_:S4});function k4(u,a,s,c){for(var f=V(a,"data","multiRNNCell"),m=Td(s,"c","multiRNNCell"),v=Td(c,"h","multiRNNCell"),b=f,w=[],S=0;S<u.length;S++){var E=u[S](b,m[S],v[S]);w.push(E[0]),w.push(E[1]),b=E[1]}var R=[],T=[];for(S=0;S<w.length;S+=2)R.push(w[S]),T.push(w[S+1]);return[R,T]}function R4(u,a,s,c,f,m){var v=V(u,"forgetBias","basicLSTMCell"),b=V(a,"lstmKernel","basicLSTMCell"),w=V(s,"lstmBias","basicLSTMCell"),S=V(c,"data","basicLSTMCell"),E=V(f,"c","basicLSTMCell"),R=V(m,"h","basicLSTMCell"),T=S.concat(R,1).matMul(b).add(w),P=T.shape[0],O=T.shape[1]/4,$=[P,O],B=T.slice([0,0],$),U=T.slice([0,O],$),z=T.slice([0,2*O],$),j=T.slice([0,3*O],$),K=B.sigmoid().mulStrict(U.tanh()).addStrict(E.mulStrict(v.add(z).sigmoid()));return[K,K.tanh().mulStrict(j.sigmoid())]}var Kx=st({basicLSTMCell_:R4}),Xx=st({multiRNNCell_:k4});function T4(u,a,s,c,f){f===void 0&&(f=!0);var m=V(u,"v","movingAverage"),v=V(a,"x","movingAverage"),b=V(s,"decay","movingAverage");cD(m,v),D(q(m.shape,v.shape),"Shape mismatch in v and x");var w=Nt(1),S=w.sub(b),E=v.sub(m).mul(S);if(f){D(c!=null,"When using zeroDebias: true, step is required.");var R=V(c,"step","movingAverage");E=E.div(w.sub(Gh(b,R)))}return m.add(E)}var Yx=st({movingAverage_:T4});function D4(u,a,s,c,f,m,v,b,w){if(f===void 0&&(f=0),m===void 0&&(m=0),v===void 0&&(v=0),b===void 0&&(b=0),w===void 0&&(w=0),v!==0)throw new Error("ellipsis mask is not yet supported");if(b!==0)throw new Error("new axis mask is not yet supported");var S=V(u,"x","stridedSlice");return Z.engine.runKernel(function(E){return E.stridedSlice(S,a,s,c,f,m,v,b,w)},{$x:S})}var Qx=st({stridedSlice_:D4});function A4(u,a,s){a===void 0&&(a=1),s===void 0&&(s=!0);var c=V(u,"x","topk");if(c.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var f=c.shape[c.shape.length-1];if(a>f)throw new Error("'k' passed to topk() must be <= the last dimension ("+f+") but got "+a);var m=Z.engine.runKernel(function(v){return v.topk(c,a,s)},{$x:c});return{values:m[0],indices:m[1]}}var Jx=st({topk_:A4});function I4(u,a,s){var c=V(u,"indices","scatterND","int32"),f=V(a,"updates","scatterND");return $D(f,c,s),Z.engine.runKernel(function(m){return m.scatterND(c,f,s)},{$indices:c,$updates:f})}var Zx=st({scatterND_:I4});function N4(u){D(u.dtype==="complex64","The dtype for tf.spectral.fft() must be complex64 but got "+u.dtype+".");var a=u.shape[u.shape.length-1],s=u.size/a,c=u.as2D(s,a);return Z.engine.runKernel(function(f){return f.fft(c)},{input:u}).reshape(u.shape)}function P4(u){D(u.dtype==="complex64","The dtype for tf.spectral.ifft() must be complex64 but got "+u.dtype+".");var a=u.shape[u.shape.length-1],s=u.size/a,c=u.as2D(s,a);return Z.engine.runKernel(function(f){return f.ifft(c)},{input:u}).reshape(u.shape)}function M4(u){D(u.dtype==="float32",`The dtype for rfft() must be real value but
    got `+u.dtype);var a=u.shape[u.shape.length-1],s=u.size/a,c=u.zerosLike(),f=Fr(u,c).as2D(s,a),m=Kd(f),v=Math.floor(a/2)+1,b=Jo(m),w=ci(m),S=b.split([v,a-v],b.shape.length-1),E=w.split([v,a-v],w.shape.length-1),R=u.shape.slice();return R[u.shape.length-1]=v,Fr(S[0],E[0]).reshape(R)}function O4(u){var a=u.shape[u.shape.length-1],s=u.size/a;if(a<=2){var c=u.as2D(s,a),f=Vc(c);return Jo(f)}var m=[s,2*(a-1)],v=Jo(u).as2D(s,a),b=ci(u).as2D(s,a),w=v.slice([0,1],[s,a-2]).reverse(1),S=b.slice([0,1],[s,a-2]).reverse(1).mul(Nt(-1)),E=v.concat(w,1),R=b.concat(S,1);return c=Fr(E,R).as2D(m[0],m[1]),f=Vc(c),Jo(f)}var Kd=st({fft_:N4}),Vc=st({ifft_:P4}),Xh=st({rfft_:M4}),Yh=st({irfft_:O4}),tw=Object.freeze({fft:Kd,ifft:Vc,rfft:Xh,irfft:Yh});function F4(u,a,s,c){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var f=u.rank>0?u.shape[0]:1,m=u.rank>1?u.shape[1]:1;if(s.length!==m)throw new Error("outputShape has incorrect number of elements:, "+s.length+", should be: "+m+".");var v=a.size;if(a.rank!==0&&(a.rank!==1||v!==f))throw new Error("sparseValues has incorrect shape "+a.shape+", should be [] or ["+f+"]");if(a.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function $4(u,a,s,c){var f=V(u,"sparseIndices","sparseToDense","int32"),m=V(a,"sparseValues","sparseToDense"),v=V(c,"defaultValue","sparseToDense",m.dtype);return F4(f,m,s,v),Z.engine.runKernel(function(b){return b.sparseToDense(f,m,s,v)},{$sparseIndices:f,$sparseValues:m,$defaultValue:v})}var ew=st({sparseToDense_:$4});function B4(u,a){var s=V(a,"indices","gatherND","int32"),c=V(u,"x","gatherND");return Z.engine.runKernel(function(f){return f.gatherND(c,s)},{$x:c,$indices:s})}var ir,nw=st({gatherND_:B4});function L4(u,a,s){s===void 0&&(s=ir.SUM_BY_NONZERO_WEIGHTS);var c=V(u,"losses","computeWeightedLoss"),f=null;a!=null&&(f=V(a,"weights","computeWeightedLoss"));var m=f==null?c:c.mul(f);if(s===ir.NONE)return m;if(s===ir.SUM)return m.sum();if(s===ir.MEAN){if(f==null)return m.mean();var v=L(c.shape)/L(f.shape),b=m.sum().div(f.sum());return v>1?b.div(Nt(v)):b}if(s===ir.SUM_BY_NONZERO_WEIGHTS){if(f==null)return m.sum().div(Nt(c.size));var w=f.mul(Aa(c.shape)).notEqual(Nt(0)).sum().toFloat();return m.sum().div(w)}throw Error("Unknown reduction: "+s)}function W4(u,a,s,c){c===void 0&&(c=ir.SUM_BY_NONZERO_WEIGHTS);var f=V(u,"labels","absoluteDifference"),m=V(a,"predictions","absoluteDifference"),v=null;s!=null&&(v=V(s,"weights","absoluteDifference")),M(f.shape,m.shape,"Error in absoluteDifference: ");var b=f.sub(m).abs();return Pa(b,v,c)}function U4(u,a,s,c){c===void 0&&(c=ir.SUM_BY_NONZERO_WEIGHTS);var f=V(u,"labels","meanSquaredError"),m=V(a,"predictions","meanSquaredError"),v=null;s!=null&&(v=V(s,"weights","meanSquaredError")),M(f.shape,m.shape,"Error in meanSquaredError: ");var b=f.squaredDifference(m);return Pa(b,v,c)}function z4(u,a,s,c,f){f===void 0&&(f=ir.SUM_BY_NONZERO_WEIGHTS);var m=V(u,"labels","cosineDistance"),v=V(a,"predictions","cosineDistance"),b=null;c!=null&&(b=V(c,"weights","cosineDistance")),M(m.shape,v.shape,"Error in cosineDistance: ");var w=Nt(1).sub(m.mul(v).sum(s,!0));return Pa(w,b,f)}function V4(u,a,s,c){c===void 0&&(c=ir.SUM_BY_NONZERO_WEIGHTS);var f=V(u,"labels","hingeLoss"),m=V(a,"predictions","hingeLoss"),v=null;s!=null&&(v=V(s,"weights","hingeLoss")),M(f.shape,m.shape,"Error in hingeLoss: ");var b=Nt(1);f=Nt(2).mul(f).sub(b);var w=b.sub(f.mul(m)).relu();return Pa(w,v,c)}function H4(u,a,s,c,f){c===void 0&&(c=1e-7),f===void 0&&(f=ir.SUM_BY_NONZERO_WEIGHTS);var m=V(u,"labels","logLoss"),v=V(a,"predictions","logLoss"),b=null;s!=null&&(b=V(s,"weights","logLoss")),M(m.shape,v.shape,"Error in logLoss: ");var w=Nt(1),S=Nt(c),E=m.mul(v.add(S).log()).neg().sub(w.sub(m).mul(w.sub(v).add(S).log()));return Pa(E,b,f)}function G4(u,a){var s=V(u,"labels","sigmoidCrossEntropyWithLogits"),c=V(a,"logits","sigmoidCrossEntropyWithLogits");M(s.shape,c.shape,"Error in sigmoidCrossEntropyWithLogits: ");var f=c.relu(),m=c.mul(s),v=c.abs().neg().exp().log1p();return f.sub(m).add(v)}function q4(u,a,s,c,f){c===void 0&&(c=0),f===void 0&&(f=ir.SUM_BY_NONZERO_WEIGHTS);var m=V(u,"multiClassLabels","sigmoidCrossEntropy"),v=V(a,"logits","sigmoidCrossEntropy"),b=null;if(s!=null&&(b=V(s,"weights","sigmoidCrossEntropy")),M(m.shape,v.shape,"Error in sigmoidCrossEntropy: "),c>0){var w=Nt(c),S=Nt(1),E=Nt(.5);m=m.mul(S.sub(w)).add(E.mul(w))}var R=G4(m,v);return Pa(R,b,f)}function j4(u,a,s,c,f){c===void 0&&(c=1),f===void 0&&(f=ir.SUM_BY_NONZERO_WEIGHTS);var m=V(u,"labels","huberLoss"),v=V(a,"predictions","huberLoss"),b=null;s!=null&&(b=V(s,"weights","huberLoss")),M(m.shape,v.shape,"Error in huberLoss: ");var w=Nt(c),S=v.sub(m).abs(),E=Hd(S,w),R=S.sub(E),T=Nt(.5).mul(E.square()).add(w.mul(R));return Pa(T,b,f)}function K4(u,a,s){if(s===void 0&&(s=-1),s===-1&&(s=a.rank-1),s!==a.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+a.rank+" and dim was "+s);return fu(function(c,f){var m=f.logSumExp([s],!0),v=f.toFloat().sub(m);return{value:v.mul(c).neg().sum([s]),gradFunc:function(b){var w=go(b.shape,[s]);return[b.reshape(w).mul(c.toFloat().sub(v.exp())),b.reshape(w).mul(v.exp().sub(c.toFloat()))]}}})(u,a)}function X4(u,a,s,c,f){c===void 0&&(c=0),f===void 0&&(f=ir.SUM_BY_NONZERO_WEIGHTS);var m=V(u,"onehotLabels","softmaxCrossEntropy"),v=V(a,"logits","softmaxCrossEntropy"),b=null;if(s!=null&&(b=V(s,"weights","softmaxCrossEntropy")),M(m.shape,v.shape,"Error in softmaxCrossEntropy: "),c>0){var w=Nt(c),S=Nt(1),E=Nt(m.shape[1]);m=m.mul(S.sub(w)).add(w.div(E))}var R=K4(m,v);return Pa(R,b,f)}(function(u){u[u.NONE=0]="NONE",u[u.MEAN=1]="MEAN",u[u.SUM=2]="SUM",u[u.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ir||(ir={}));var Y4=st({absoluteDifference_:W4}),Pa=st({computeWeightedLoss_:L4}),Q4=st({cosineDistance_:z4}),J4=st({hingeLoss_:V4}),Z4=st({huberLoss_:j4}),tO=st({logLoss_:H4}),eO=st({meanSquaredError_:U4}),nO=st({sigmoidCrossEntropy_:q4}),rO=st({softmaxCrossEntropy_:X4}),rw=Object.freeze({get Reduction(){return ir},absoluteDifference:Y4,computeWeightedLoss:Pa,cosineDistance:Q4,hingeLoss:J4,huberLoss:Z4,logLoss:tO,meanSquaredError:eO,sigmoidCrossEntropy:nO,softmaxCrossEntropy:rO});function oO(u){var a;if(Array.isArray(u)){a=!1,D(u!=null&&u.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var s=u[0].shape[0],c=1;c<u.length;++c)D(u[c].shape[0]===s,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+u[c].shape[0]+" vs. "+s+")")}else a=!0,u=Md(u,u.shape[0],0).map(function(b){return Ph(b,[0])});D(u.length<=u[0].shape[0],"Gram-Schmidt: Number of vectors ("+u.length+") exceeds number of dimensions ("+u[0].shape[0]+").");var f=[],m=u,v=function(b){f.push(Z.engine.tidy(function(){var w=m[b];if(b>0)for(var S=0;S<b;++S){var E=Uh(f[S].mulStrict(w)).mul(f[S]);w=w.sub(E)}return w.div(jh(w,"euclidean"))}))};for(c=0;c<u.length;++c)v(c);return a?bo(f,0):f}function aO(u,a){if(a===void 0&&(a=!1),u.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+u.rank);if(u.rank===2)return ow(u,a);var s=u.shape.slice(0,u.shape.length-2).reduce(function(m,v){return m*v}),c=[],f=[];return ar(u.reshape([s,u.shape[u.shape.length-2],u.shape[u.shape.length-1]]),0).forEach(function(m){var v=ow(m,a),b=v[0],w=v[1];c.push(b),f.push(w)}),[bo(c,0).reshape(u.shape),bo(f,0).reshape(u.shape)]}function ow(u,a){return a===void 0&&(a=!1),Z.engine.tidy(function(){if(u.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+u.shape.length+"D Tensor.");for(var s=u.shape[0],c=u.shape[1],f=Ih(s),m=u.clone(),v=pu([[1]],[1,1]),b=v.clone(),w=s>=c?c:s,S=function(R){var T,P=m,O=b,$=f;T=Z.engine.tidy(function(){var B=m.slice([R,R],[s-R,1]),U=B.norm(),z=m.slice([R,R],[1,1]),j=z.sign().neg(),K=z.sub(j.mul(U)),J=B.div(K);b=J.shape[0]===1?v.clone():v.concat(J.slice([1,0],[J.shape[0]-1,J.shape[1]]),0);var dt=j.matMul(K).div(U).neg(),vt=m.slice([R,0],[s-R,c]),bt=dt.mul(b);m=R===0?vt.sub(bt.matMul(b.transpose().matMul(vt))):m.slice([0,0],[R,c]).concat(vt.sub(bt.matMul(b.transpose().matMul(vt))),0);var kt=f.slice([0,R],[s,f.shape[1]-R]);return f=R===0?kt.sub(kt.matMul(b).matMul(bt.transpose())):f.slice([0,0],[s,R]).concat(kt.sub(kt.matMul(b).matMul(bt.transpose())),1),[b,m,f]}),b=T[0],m=T[1],f=T[2],cy([P,O,$])},E=0;E<w;++E)S(E);return!a&&s>c&&(f=f.slice([0,0],[s,c]),m=m.slice([0,0],[c,c])),[f,m]})}var iO=st({gramSchmidt_:oO}),sO=st({qr_:aO}),aw=Object.freeze({gramSchmidt:iO,qr:sO});function uO(u,a,s){s===void 0&&(s=!1);var c=V(u,"images","resizeBilinear");D(c.rank===3||c.rank===4,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+c.rank+"."),D(a.length===2,"Error in resizeBilinear: new shape must 2D, but got shape "+a+".");var f=c,m=!1;c.rank===3&&(m=!0,f=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var v=a[0],b=a[1],w=Z.engine.runKernel(function(S,E){return S.resizeBilinear(f,v,b,s)},{batchImages:f},function(S,E){return{batchImages:function(){return Z.engine.runKernel(function(R){return R.resizeBilinearBackprop(S,f,s)},{})}}});return m?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}function cO(u,a,s){s===void 0&&(s=!1);var c=V(u,"images","resizeNearestNeighbor");D(c.rank===3||c.rank===4,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+c.rank+"."),D(a.length===2,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+a+"."),D(c.dtype==="float32"||c.dtype==="int32","`images` must have `int32` or `float32` as dtype");var f=c,m=!1;c.rank===3&&(m=!0,f=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]));var v=a[0],b=a[1],w=Z.engine.runKernel(function(S,E){return S.resizeNearestNeighbor(f,v,b,s)},{batchImages:f},function(S,E){return{batchImages:function(){return Z.engine.runKernel(function(R){return R.resizeNearestNeighborBackprop(S,f,s)},{})}}});return m?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}function lO(u,a,s,c,f){c===void 0&&(c=.5),f===void 0&&(f=Number.NEGATIVE_INFINITY);var m=V(u,"boxes","nonMaxSuppression"),v=V(a,"scores","nonMaxSuppression"),b=iw(m,v,s,c,f);return s=b.maxOutputSize,c=b.iouThreshold,f=b.scoreThreshold,Z.engine.runKernel(function(w){return w.nonMaxSuppression(m,v,s,c,f)},{$boxes:m})}function dO(u,a,s,c,f){return c===void 0&&(c=.5),f===void 0&&(f=Number.NEGATIVE_INFINITY),l(this,void 0,void 0,function(){var m,v,b,w,S,E;return d(this,function(R){switch(R.label){case 0:return m=V(u,"boxes","nonMaxSuppressionAsync"),v=V(a,"scores","nonMaxSuppressionAsync"),b=iw(m,v,s,c,f),s=b.maxOutputSize,c=b.iouThreshold,f=b.scoreThreshold,[4,m.data()];case 1:return w=R.sent(),[4,v.data()];case 2:return S=R.sent(),E=bh(w,S,s,c,f),m!==u&&m.dispose(),v!==a&&v.dispose(),[2,E]}})})}function iw(u,a,s,c,f){c==null&&(c=.5),f==null&&(f=Number.NEGATIVE_INFINITY);var m=u.shape[0];return s=Math.min(s,m),D(0<=c&&c<=1,"iouThreshold must be in [0, 1], but was '"+c+"'"),D(u.rank===2,"boxes must be a 2D tensor, but was of rank '"+u.rank+"'"),D(u.shape[1]===4,"boxes must have 4 columns, but 2nd dimension was "+u.shape[1]),D(a.rank===1,"scores must be a 1D tensor"),D(a.shape[0]===m,"scores has incompatible shape with boxes. Expected "+m+", but was "+a.shape[0]),{maxOutputSize:s,iouThreshold:c,scoreThreshold:f}}function fO(u,a,s,c,f,m){var v=V(u,"image","cropAndResize","float32"),b=V(a,"boxes","cropAndResize","float32"),w=V(s,"boxInd","cropAndResize","int32");f=f||"bilinear",m=m||0;var S=b.shape[0];return D(v.rank===4,"Error in cropAndResize: image must be rank 4,but got rank "+v.rank+"."),D(b.rank===2&&b.shape[1]===4,"Error in cropAndResize: boxes must be have size ["+S+",4] but had shape "+b.shape+"."),D(w.rank===1&&w.shape[0]===S,"Error in cropAndResize: boxInd must be have size ["+S+"] but had shape "+b.shape+"."),D(c.length===2,"Error in cropAndResize: cropSize must be of length 2, but got length "+c.length+"."),D(c[0]>=1&&c[1]>=1,"cropSize must be atleast [1,1], but was "+c),D(f==="bilinear"||f==="nearest","method must be bilinear or nearest, but was "+f),Z.engine.runKernel(function(E,R){return E.cropAndResize(v,b,w,c,f,m)},{$image:v,$boxes:b})}var pO=st({resizeBilinear_:uO}),hO=st({resizeNearestNeighbor_:cO}),mO=st({nonMaxSuppression_:lO}),gO=dO,vO=fO,Xd=Object.freeze({resizeBilinear:pO,resizeNearestNeighbor:hO,nonMaxSuppression:mO,nonMaxSuppressionAsync:gO,cropAndResize:vO}),yO=Object.freeze({image:Xd,linalg:aw,losses:rw,spectral:tw,op:st,batchNormalization2d:F1,batchNormalization3d:$1,batchNormalization4d:B1,batchNormalization:xu,complex:Fr,real:Jo,imag:ci,concat:or,concat1d:Wb,concat2d:Ub,concat3d:zb,concat4d:Vb,split:Md,conv1d:G1,conv2d:Bo,conv3d:q1,conv2dDerFilter:Lh,depthwiseConv2d:zd,separableConv2d:Vd,conv2dTranspose:j1,matMul:Lc,dot:U1,outerProduct:z1,reverse:Cu,reverse1d:K1,reverse2d:X1,reverse3d:Y1,reverse4d:Q1,maxPool:Xn,avgPool:Wc,pool:tx,slice:fi,slice1d:ex,slice2d:nx,slice3d:Wh,slice4d:rx,abs:c1,acos:l1,acosh:d1,asin:f1,asinh:p1,atan:h1,atanh:m1,ceil:g1,clipByValue:$d,cos:v1,cosh:y1,erf:b1,exp:Bd,expm1:x1,floor:w1,log:C1,log1p:S1,logSigmoid:_1,neg:Fc,reciprocal:E1,round:k1,rsqrt:Oh,sigmoid:Fh,sign:R1,sin:T1,sinh:D1,softplus:A1,sqrt:I1,square:N1,step:P1,tan:M1,tanh:O1,all:ax,any:ix,argMax:sx,argMin:ux,logSumExp:cx,max:Uc,mean:lx,min:dx,moments:fx,sum:Uh,prod:px,equal:zh,equalStrict:hx,greater:mx,greaterEqual:Vh,greaterEqualStrict:gx,greaterStrict:vx,less:yx,lessEqual:bx,lessEqualStrict:xx,lessStrict:wx,notEqual:Cx,notEqualStrict:Sx,add:Ue,addN:_x,addStrict:Ex,atan2:kx,div:ea,divStrict:Rx,floorDiv:Hh,maximum:zc,maximumStrict:Tx,minimum:Hd,minimumStrict:Dx,mod:Ax,modStrict:Ix,mul:xo,mulStrict:Nx,pow:Gh,powStrict:Px,squaredDifference:Mx,squaredDifferenceStrict:Ox,sub:jr,subStrict:Fx,elu:Wx,leakyRelu:Ux,prelu:zx,relu:xr,selu:Vx,logicalAnd:Gd,logicalNot:$x,logicalOr:qh,logicalXor:Bx,where:qd,whereAsync:Lx,buffer:Ae,toPixels:Dh,print:qb,batchToSpaceND:Ah,cast:jb,clone:Kb,cumsum:Xb,depthToSpace:Yb,expandDims:ao,eye:Ih,fromPixels:Od,multinomial:Qb,oneHot:Fd,pad:li,pad1d:Jb,pad2d:Zb,pad3d:t1,pad4d:e1,rand:n1,randomNormal:r1,randomUniform:o1,reshape:yo,spaceToBatchND:Nh,squeeze:Ph,stack:bo,tile:ls,truncatedNormal:a1,unstack:ar,setdiff1dAsync:i1,fill:Zo,linspace:Cy,ones:Aa,range:gh,scalar:Nt,tensor:kn,tensor1d:Un,tensor2d:pu,tensor3d:Dd,tensor4d:nr,tensor5d:xy,tensor6d:wy,zeros:Rn,onesLike:Sy,zerosLike:vn,transpose:Na,softmax:Da,logSoftmax:by,localResponseNormalization:Hx,norm:jh,gather:Kh,unsortedSegmentSum:jd,basicLSTMCell:Kx,multiRNNCell:Xx,movingAverage:Yx,stridedSlice:Qx,topk:Jx,scatterND:Zx,fft:Kd,ifft:Vc,rfft:Xh,irfft:Yh,sparseToDense:ew,gatherND:nw}),bO=function(){function u(){this.blockSize=48,this.firstUse=!0,Z.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return u.prototype.setDataMover=function(a){this.data=new vh(a)},u.prototype.register=function(a,s,c){if(this.firstUse&&(this.firstUse=!1,Z.get("IS_NODE")&&hh(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(a))throw new Error("Data buffer is already registered");this.data.set(a,{dtype:c})},u.prototype.write=function(a,s){if(s==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(a).values=s},u.prototype.fromPixels=function(a,s){if(a==null)throw new Error("pixels passed to tf.fromPixels() can not be null");var c,f;if(Z.get("IS_NODE")&&a.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(a.getContext!=null)c=a.getContext("2d").getImageData(0,0,a.width,a.height).data;else if(a instanceof ImageData)c=a.data;else{if(!(a instanceof HTMLImageElement||a instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+a.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=a.width,this.fromPixels2DContext.canvas.height=a.height,this.fromPixels2DContext.drawImage(a,0,0,a.width,a.height),c=this.fromPixels2DContext.getImageData(0,0,a.width,a.height).data}if(s===4)f=new Int32Array(c);else{var m=a.width*a.height;f=new Int32Array(m*s);for(var v=0;v<m;v++)for(var b=0;b<s;++b)f[v*s+b]=c[4*v+b]}return Dd(f,[a.height,a.width,s],"int32")},u.prototype.read=function(a){return l(this,void 0,void 0,function(){return d(this,function(s){return[2,this.readSync(a)]})})},u.prototype.readSync=function(a){var s=this.data.get(a),c=s.dtype,f=s.complexTensors;return c==="complex64"?Ey(f.real.dataSync(),f.imag.dataSync()):this.data.get(a).values},u.prototype.disposeData=function(a){if(this.data.has(a)){var s=this.data.get(a).complexTensors;s!=null&&(s.real.dispose(),s.imag.dispose()),this.data.delete(a)}},u.prototype.time=function(a){return l(this,void 0,void 0,function(){var s;return d(this,function(c){return s=Dt(),a(),[2,{kernelMs:Dt()-s}]})})},u.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},u.prototype.complex=function(a,s){var c=At.make(a.shape,{},"complex64");return this.data.get(c.dataId).complexTensors={real:Z.engine.keep(a.clone()),imag:Z.engine.keep(s.clone())},c},u.prototype.real=function(a){return this.data.get(a.dataId).complexTensors.real.clone()},u.prototype.imag=function(a){return this.data.get(a.dataId).complexTensors.imag.clone()},u.prototype.assertNotComplex=function(a,s){Array.isArray(a)||(a=[a]),a.forEach(function(c){c!=null&&D(c.dtype!=="complex64",s+" does not support complex64 tensors.")})},u.prototype.slice=function(a,s,c){this.assertNotComplex(a,"slice");for(var f=Ae(c,a.dtype),m=0;m<f.size;++m){var v=f.indexToLoc(m),b=v.map(function(w,S){return w+s[S]});f.set.apply(f,[a.get.apply(a,b)].concat(v))}return f.toTensor()},u.prototype.stridedSlice=function(a,s,c,f,m,v,b,w,S){this.assertNotComplex(a,"stridedSlice");var E=gy(a.shape,s,c,f,m,v,b,w,S),R=E[0],T=E[1],P=E[2],O=T.filter(function(K,J){return P.indexOf(J)===-1});if(O.some(function(K){return K===0}))return kn([],O);for(var $=Ae(T,a.dtype),B=0;B<$.size;B++){for(var U=$.indexToLoc(B),z=new Array(U.length),j=0;j<z.length;j++)z[j]=U[j]*f[j]+R[j];$.set.apply($,[a.get.apply(a,z)].concat(U))}return $.toTensor().reshape(O)},u.prototype.reverse=function(a,s){this.assertNotComplex(a,"reverse");for(var c=Ae(a.shape,a.dtype),f=a.buffer(),m=function(b){var w=c.indexToLoc(b),S=w.slice();s.forEach(function(E){return S[E]=a.shape[E]-1-S[E]}),c.set.apply(c,[f.get.apply(f,S)].concat(w))},v=0;v<c.size;v++)m(v);return c.toTensor()},u.prototype.concat=function(a,s){this.assertNotComplex(a,"concat");var c=a.map(function(S){var E=L(S.shape.slice(s));return S.as2D(-1,E)}),f=Ic(c.map(function(S){return S.shape}),1),m=Ae(f,a[0].dtype).values;if(c[0].shape[0]===1){var v=0;c.forEach(function(S){m.set(S.dataSync(),v),v+=S.size})}else{var b=0;c.forEach(function(S){for(var E=S.dataSync(),R=0,T=0;T<S.shape[0];++T)for(var P=T*f[1]+b,O=0;O<S.shape[1];++O)m[P+O]=E[R++];b+=S.shape[1]})}var w=Ic(a.map(function(S){return S.shape}),s);return kn(m,w,a[0].dtype)},u.prototype.neg=function(a){return this.assertNotComplex(a,"neg"),this.multiply(Nt(-1),a)},u.prototype.add=function(a,s){return a.dtype==="complex64"||s.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),s.cast("complex64"),function(c,f,m,v){return{real:c+m,imag:f+v}}):this.broadcastedBinaryOp(a,s,Zn(a.dtype,s.dtype),function(c,f){return c+f})},u.prototype.addN=function(a){this.assertNotComplex(a,"addN");for(var s=a.map(function(w){return w.dataSync()}),c=Ae(a[0].shape,a[0].dtype),f=c.values,m=0;m<a.length;m++)for(var v=s[m],b=0;b<f.length;b++)f[b]+=v[b];return c.toTensor()},u.prototype.subtract=function(a,s){return a.dtype==="complex64"||s.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),s.cast("complex64"),function(c,f,m,v){return{real:c-m,imag:f-v}}):this.broadcastedBinaryOp(a,s,Zn(a.dtype,s.dtype),function(c,f){return c-f})},u.prototype.pow=function(a,s){return this.assertNotComplex([a,s],"pow"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){return Math.pow(c,f)})},u.prototype.batchMatMul=function(a,s,c,f){this.assertNotComplex([a,s],"matMul");for(var m=c?a.shape[1]:a.shape[2],v=c?a.shape[2]:a.shape[1],b=f?s.shape[1]:s.shape[2],w=a.shape[0],S=a.dataSync(),E=s.dataSync(),R=c?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],T=R[0],P=R[1],O=R[2],$=f?[1,s.strides[1],s.strides[0]]:[s.strides[1],1,s.strides[0]],B=$[0],U=$[1],z=$[2],j=v*b,K=Ae([w,v,b],a.dtype),J=K.values,dt=this.blockSize,vt=0;vt<w;vt++)for(var bt=0;bt<v;bt+=dt)for(var kt=0;kt<b;kt+=dt)for(var _t=0;_t<m;_t+=dt)for(var Mt=Math.min(bt+dt,v),Vt=Math.min(kt+dt,b),Jt=Math.min(_t+dt,m),ee=bt;ee<Mt;ee++)for(var le=kt;le<Vt;le++){for(var Gt=0,qt=_t;qt<Jt;qt++)Gt+=S[vt*T+ee*P+qt*O]*E[qt*B+le*U+vt*z];J[vt*j+(ee*b+le)]+=Gt}return K.toTensor()},u.prototype.multiply=function(a,s){return a.dtype==="complex64"||s.dtype==="complex64"?this.broadcastedBinaryComplexOp(a.cast("complex64"),s.cast("complex64"),function(c,f,m,v){return{real:c*m-f*v,imag:c*v+f*m}}):this.broadcastedBinaryOp(a,s,Zn(a.dtype,s.dtype),function(c,f){return c*f})},u.prototype.realDivide=function(a,s){return this.assertNotComplex([a,s],"realDivide"),this.broadcastedBinaryOp(a,s,"float32",function(c,f){return c/f})},u.prototype.floorDiv=function(a,s){return this.assertNotComplex([a,s],"floorDiv"),this.broadcastedBinaryOp(a,s,"int32",function(c,f){return Math.floor(c/f)})},u.prototype.sum=function(a,s){this.assertNotComplex(a,"sum"),Gr("sum",s,a.rank);for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,Zn(a.dtype,"int32")),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=0,P=0;P<b;++P)T+=S[R+P];w[E]=T}return v},u.prototype.prod=function(a,s){this.assertNotComplex(a,"sum");for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,Zn(a.dtype,"int32")),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=1,P=0;P<b;++P)T*=S[R+P];w[E]=T}return v},u.prototype.unsortedSegmentSum=function(a,s,c){this.assertNotComplex(a,"unsortedSegmentSum");for(var f=[],m=a.rank-s.rank,v=0;v<m;++v)s=s.expandDims(v+1);for(v=0;v<c;++v){var b=Nt(v,"int32"),w=zh(b,s).asType("float32").mul(a).sum(0);f.push(w)}return bo(f)},u.prototype.argMin=function(a,s){this.assertNotComplex(a,"argMin");var c=[s];Gr("argMin",c,a.rank);for(var f=er(a.shape,c),m=f[0],v=f[1],b=Rn(m,"int32"),w=L(v),S=b.dataSync(),E=a.dataSync(),R=0;R<S.length;++R){for(var T=R*w,P=E[T],O=0,$=0;$<w;++$){var B=E[T+$];B<P&&(P=B,O=$)}S[R]=O}return b},u.prototype.argMax=function(a,s){this.assertNotComplex(a,"argMax");var c=[s];Gr("argMax",c,a.rank);for(var f=er(a.shape,c),m=f[0],v=f[1],b=Rn(m,"int32"),w=L(v),S=b.dataSync(),E=a.dataSync(),R=0;R<S.length;++R){for(var T=R*w,P=E[T],O=0,$=0;$<w;++$){var B=E[T+$];B>P&&(P=B,O=$)}S[R]=O}return b},u.prototype.cumsum=function(a,s,c,f){if(this.assertNotComplex(a,"cumsum"),s!==a.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(a.rank-1)+" but got axis="+s);for(var m=Zn(a.dtype,"int32"),v=Rn(a.shape,m),b=v.dataSync(),w=a.dataSync(),S=a.shape[a.rank-1],E=f?function($,B){return $+S-B-1}:function($,B){return $+B},R=0;R<w.length;R+=S)for(var T=0;T<S;T++){var P=E(R,T);if(T===0)b[P]=c?0:w[P];else{var O=E(R,T-1);b[P]=c?w[O]+b[O]:w[P]+b[O]}}return v},u.prototype.equal=function(a,s){return this.assertNotComplex([a,s],"equal"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c===f?1:0})},u.prototype.notEqual=function(a,s){return this.assertNotComplex([a,s],"notEqual"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c!==f?1:0})},u.prototype.less=function(a,s){return this.assertNotComplex([a,s],"less"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c<f?1:0})},u.prototype.lessEqual=function(a,s){return this.assertNotComplex([a,s],"lessEqual"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c<=f?1:0})},u.prototype.greater=function(a,s){return this.assertNotComplex([a,s],"greater"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c>f?1:0})},u.prototype.greaterEqual=function(a,s){return this.assertNotComplex([a,s],"greaterEqual"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c>=f?1:0})},u.prototype.logicalNot=function(a){this.assertNotComplex(a,"logicalNot");for(var s=a.dataSync(),c=new Uint8Array(s.length),f=0;f<s.length;++f)c[f]=s[f]?0:1;return At.make(a.shape,{values:c},"bool")},u.prototype.logicalAnd=function(a,s){return this.assertNotComplex([a,s],"logicalAnd"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c&&f})},u.prototype.logicalOr=function(a,s){return this.assertNotComplex([a,s],"logicalOr"),this.broadcastedBinaryOp(a,s,"bool",function(c,f){return c||f})},u.prototype.select=function(a,s,c){this.assertNotComplex([a,s,c],"select");for(var f=a.dataSync(),m=s.dataSync(),v=c.dataSync(),b=Rn(s.shape,Zn(s.dtype,c.dtype)),w=b.dataSync(),S=0,E=a.rank===0||a.rank>1||s.rank===1?1:s.shape[1],R=0;R<f.length;R++)for(var T=0;T<E;T++)f[R]===1?w[S++]=m[R]:w[S++]=v[R];return b},u.prototype.where=function(a){this.assertNotComplex([a],"where");var s=a.dataSync();return Mh(a.shape,s)},u.prototype.topk=function(a,s,c){return this.assertNotComplex(a,"topk"),Ty(a.dataSync(),a.shape,a.dtype,s)},u.prototype.min=function(a,s){this.assertNotComplex(a,"min"),Gr("min",s,a.rank);for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,a.dtype),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=S[R],P=0;P<b;++P){var O=S[R+P];O<T&&(T=O)}w[E]=T}return v},u.prototype.minimum=function(a,s){return this.assertNotComplex([a,s],"minimum"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){return Math.min(c,f)})},u.prototype.mod=function(a,s){return this.assertNotComplex([a,s],"mod"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){var m=c%f;return c<0&&f<0||c>=0&&f>=0?m:(m+f)%f})},u.prototype.max=function(a,s){this.assertNotComplex(a,"max"),Gr("max",s,a.rank);for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,a.dtype),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=S[R],P=0;P<b;++P){var O=S[R+P];O>T&&(T=O)}w[E]=T}return v},u.prototype.maximum=function(a,s){return this.assertNotComplex([a,s],"maximum"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){return Math.max(c,f)})},u.prototype.all=function(a,s){this.assertNotComplex(a,"all"),Gr("all",s,a.rank);for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,a.dtype),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=S[R],P=0;P<b;++P){var O=S[R+P];T=T&&O}w[E]=T}return v},u.prototype.any=function(a,s){this.assertNotComplex(a,"any"),Gr("any",s,a.rank);for(var c=er(a.shape,s),f=c[0],m=c[1],v=Rn(f,a.dtype),b=L(m),w=v.dataSync(),S=a.dataSync(),E=0;E<w.length;++E){for(var R=E*b,T=S[R],P=0;P<b;++P){var O=S[R+P];T=T||O}w[E]=T}return v},u.prototype.squaredDifference=function(a,s){return this.assertNotComplex([a,s],"squaredDifference"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){var m=c-f;return m*m})},u.prototype.ceil=function(a){this.assertNotComplex(a,"ceil");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)c[f]=Math.ceil(s[f]);return At.make(a.shape,{values:c})},u.prototype.floor=function(a){this.assertNotComplex(a,"floor");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)c[f]=Math.floor(s[f]);return At.make(a.shape,{values:c})},u.prototype.sign=function(a){this.assertNotComplex(a,"x");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)s[f]<0?c[f]=-1:s[f]>0?c[f]=1:c[f]=0;return At.make(a.shape,{values:c})},u.prototype.round=function(a){this.assertNotComplex(a,"round");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=Math.floor(s[f]);s[f]-m<.5?c[f]=Math.floor(s[f]):s[f]-m>.5?c[f]=Math.ceil(s[f]):c[f]=m%2==0?m:m+1}return At.make(a.shape,{values:c})},u.prototype.exp=function(a){this.assertNotComplex(a,"exp");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)c[f]=Math.exp(s[f]);return At.make(a.shape,{values:c})},u.prototype.expm1=function(a){this.assertNotComplex(a,"expm1");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)c[f]=Math.expm1(s[f]);return At.make(a.shape,{values:c})},u.prototype.log=function(a){this.assertNotComplex(a,"log");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=s[f];c[f]=Math.log(m)}return At.make(a.shape,{values:c})},u.prototype.log1p=function(a){this.assertNotComplex(a,"log1p");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=s[f];c[f]=Math.log1p(m)}return At.make(a.shape,{values:c})},u.prototype.sqrt=function(a){this.assertNotComplex(a,"sqrt");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=s[f];c[f]=Math.sqrt(m)}return At.make(a.shape,{values:c})},u.prototype.rsqrt=function(a){this.assertNotComplex(a,"rsqrt");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=s[f];c[f]=1/Math.sqrt(m)}return At.make(a.shape,{values:c})},u.prototype.square=function(a){this.assertNotComplex(a,"square");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f){var m=s[f];c[f]=m*m}return At.make(a.shape,{values:c})},u.prototype.reciprocal=function(a){this.assertNotComplex(a,"reciprocal");for(var s=a.dataSync(),c=new Float32Array(s.length),f=0;f<s.length;++f)c[f]=1/s[f];return At.make(a.shape,{values:c})},u.prototype.relu=function(a){this.assertNotComplex(a,"relu");for(var s=Rn(a.shape,a.dtype),c=s.dataSync(),f=a.dataSync(),m=0;m<f.length;++m)c[m]=Math.max(0,f[m]);return s},u.prototype.elu=function(a){this.assertNotComplex(a,"elu");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f){var m=c[f];s[f]=m>=0?m:Math.exp(m)-1}return At.make(a.shape,{values:s})},u.prototype.eluDer=function(a,s){this.assertNotComplex([a,s],"eluDer");for(var c=new Float32Array(s.size),f=s.dataSync(),m=a.dataSync(),v=0;v<f.length;++v){var b=f[v];c[v]=b>=1?m[v]:m[v]*(b+1)}return At.make(s.shape,{values:c})},u.prototype.selu=function(a){this.assertNotComplex(a,"selu");for(var s=Rh,c=Th,f=new Float32Array(a.size),m=a.dataSync(),v=0;v<m.length;++v){var b=m[v];f[v]=b>=0?c*b:s*(Math.exp(b)-1)}return At.make(a.shape,{values:f})},u.prototype.clip=function(a,s,c){this.assertNotComplex(a,"clip");for(var f=new Float32Array(a.size),m=a.dataSync(),v=0;v<m.length;++v){var b=m[v];f[v]=b>c?c:b<s?s:b}return At.make(a.shape,{values:f})},u.prototype.abs=function(a){for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.abs(c[f]);return At.make(a.shape,{values:s})},u.prototype.complexAbs=function(a){for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<a.size;++f){var m=c[2*f],v=c[2*f+1];s[f]=Math.hypot(m,v)}return At.make(a.shape,{values:s})},u.prototype.int=function(a){this.assertNotComplex(a,"int");for(var s=new Int32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=c[f];return At.make(a.shape,{values:s},"int32")},u.prototype.sigmoid=function(a){this.assertNotComplex(a,"sigmoid");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=1/(1+Math.exp(-c[f]));return At.make(a.shape,{values:s})},u.prototype.softplus=function(a){this.assertNotComplex(a,"softplus");for(var s=Math.log(11920928955078125e-23)+2,c=new Float32Array(a.size),f=a.dataSync(),m=0;m<f.length;++m){var v=f[m]>-s,b=f[m]<s,w=Math.exp(f[m]),S=void 0;S=b?w:v?f[m]:Math.log(1+w),c[m]=S}return At.make(a.shape,{values:c})},u.prototype.sin=function(a){this.assertNotComplex(a,"sin");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.sin(c[f]);return At.make(a.shape,{values:s})},u.prototype.cos=function(a){this.assertNotComplex(a,"cos");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.cos(c[f]);return At.make(a.shape,{values:s})},u.prototype.tan=function(a){this.assertNotComplex(a,"tan");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.tan(c[f]);return At.make(a.shape,{values:s})},u.prototype.asin=function(a){this.assertNotComplex(a,"asin");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.asin(c[f]);return At.make(a.shape,{values:s})},u.prototype.acos=function(a){this.assertNotComplex(a,"acos");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.acos(c[f]);return At.make(a.shape,{values:s})},u.prototype.atan=function(a){this.assertNotComplex(a,"atan");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.atan(c[f]);return At.make(a.shape,{values:s})},u.prototype.atan2=function(a,s){return this.assertNotComplex([a,s],"atan2"),this.broadcastedBinaryOp(a,s,a.dtype,function(c,f){return Math.atan2(c,f)})},u.prototype.sinh=function(a){this.assertNotComplex(a,"sinh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.sinh(c[f]);return At.make(a.shape,{values:s})},u.prototype.cosh=function(a){this.assertNotComplex(a,"cosh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.cosh(c[f]);return At.make(a.shape,{values:s})},u.prototype.tanh=function(a){this.assertNotComplex(a,"tanh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=it(c[f]);return At.make(a.shape,{values:s})},u.prototype.asinh=function(a){this.assertNotComplex(a,"asinh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.asinh(c[f]);return At.make(a.shape,{values:s})},u.prototype.acosh=function(a){this.assertNotComplex(a,"acosh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.acosh(c[f]);return At.make(a.shape,{values:s})},u.prototype.atanh=function(a){this.assertNotComplex(a,"atanh");for(var s=new Float32Array(a.size),c=a.dataSync(),f=0;f<c.length;++f)s[f]=Math.atanh(c[f]);return At.make(a.shape,{values:s})},u.prototype.erf=function(a){this.assertNotComplex(a,"erf");for(var s=new Float32Array(a.size),c=a.dataSync(),f=Pb,m=Mb,v=Ob,b=Fb,w=$b,S=Bb,E=0;E<c.length;++E){var R=c[E],T=1/(1+f*R);s[E]=1-((((S*T+w)*T+b)*T+v)*T+m)*T*Math.exp(-R*R)}return At.make(a.shape,{values:s})},u.prototype.step=function(a,s){s===void 0&&(s=0),this.assertNotComplex(a,"step");for(var c=new Float32Array(a.size),f=a.dataSync(),m=0;m<f.length;++m){var v=f[m];isNaN(v)?c[m]=NaN:c[m]=v>0?1:s}return At.make(a.shape,{values:c})},u.prototype.conv2d=function(a,s,c){this.assertNotComplex([a,s],"conv2d");for(var f=c.filterHeight,m=c.filterWidth,v=c.dilationHeight,b=c.dilationWidth,w=c.padInfo.left,S=c.padInfo.top,E=Ae(c.outShape,a.dtype),R=a.dataSync(),T=s.dataSync(),P=E.values,O=0;O<c.batchSize;++O)for(var $=O*a.strides[0],B=O*E.strides[0],U=0;U<c.outHeight;++U)for(var z=B+U*E.strides[1],j=U*c.strideHeight-w,K=0;K<f;K++){var J=j+K*v;if(!(J<0||J>=c.inHeight))for(var dt=K*s.strides[0],vt=$+J*a.strides[1],bt=0;bt<c.outWidth;++bt)for(var kt=z+bt*c.outChannels,_t=bt*c.strideWidth-S,Mt=0;Mt<m;Mt++){var Vt=_t+Mt*b;if(!(Vt<0||Vt>=c.inWidth))for(var Jt=dt+Mt*s.strides[1],ee=vt+Vt*c.inChannels,le=Jt,Gt=0;Gt<c.inChannels;++Gt){for(var qt=R[ee+Gt],ne=0;ne<c.outChannels;++ne)P[kt+ne]+=qt*T[le+ne];le+=c.outChannels}}}return E.toTensor()},u.prototype.conv3d=function(a,s,c){for(var f=c.filterDepth,m=c.filterHeight,v=c.filterWidth,b=c.dilationDepth,w=c.dilationHeight,S=c.dilationWidth,E=c.padInfo.front,R=c.padInfo.left,T=c.padInfo.top,P=Ae(c.outShape,a.dtype),O=a.dataSync(),$=s.dataSync(),B=P.values,U=0;U<c.batchSize;++U)for(var z=U*a.strides[0],j=U*P.strides[0],K=0;K<c.outDepth;++K)for(var J=j+K*P.strides[1],dt=K*c.strideDepth-E,vt=0;vt<f;vt++){var bt=dt+vt*b;if(!(bt<0||bt>=c.inDepth))for(var kt=vt*s.strides[0],_t=z+bt*a.strides[1],Mt=0;Mt<c.outHeight;++Mt)for(var Vt=J+Mt*P.strides[2],Jt=Mt*c.strideHeight-T,ee=0;ee<m;ee++){var le=Jt+ee*w;if(!(le<0||le>=c.inHeight))for(var Gt=kt+ee*s.strides[1],qt=_t+le*a.strides[2],ne=0;ne<c.outWidth;++ne)for(var be=Vt+ne*c.outChannels,De=ne*c.strideWidth-R,Xe=0;Xe<v;Xe++){var dn=De+Xe*S;if(!(dn<0||dn>=c.inWidth))for(var Mn=Gt+Xe*s.strides[2],yn=qt+dn*c.inChannels,Tn=Mn,Yn=0;Yn<c.inChannels;++Yn){for(var Dn=O[yn+Yn],Qe=0;Qe<c.outChannels;++Qe)B[be+Qe]+=Dn*$[Tn+Qe];Tn+=c.outChannels}}}}return P.toTensor()},u.prototype.conv2dDerInput=function(a,s,c){this.assertNotComplex([a,s],"conv2dDerInput");for(var f=Ae(c.inShape,"float32"),m=f.values,v=f.strides,b=v[0],w=v[1],S=v[2],E=a.dataSync(),R=a.strides,T=R[0],P=R[1],O=R[2],$=s.dataSync(),B=s.strides,U=B[0],z=B[1],j=B[2],K=c.batchSize,J=c.filterHeight,dt=c.filterWidth,vt=c.inChannels,bt=c.inHeight,kt=c.inWidth,_t=c.outChannels,Mt=c.outHeight,Vt=c.outWidth,Jt=c.strideHeight,ee=c.strideWidth,le=J-1-c.padInfo.top,Gt=dt-1-c.padInfo.left,qt=0;qt<K;++qt)for(var ne=0;ne<vt;++ne)for(var be=0;be<bt;++be)for(var De=be-le,Xe=Math.max(0,Math.ceil(De/Jt)),dn=Math.min(Mt,(J+De)/Jt),Mn=0;Mn<kt;++Mn){for(var yn=Mn-Gt,Tn=Math.max(0,Math.ceil(yn/ee)),Yn=Math.min(Vt,(dt+yn)/ee),Dn=0,Qe=Xe;Qe<dn;++Qe)for(var Co=Qe*Jt-De,On=Tn;On<Yn;++On)for(var Cr=T*qt+P*Qe+O*On,Kr=U*(J-1-Co)+z*(dt-1-(On*ee-yn))+j*ne,So=0;So<_t;++So)Dn+=E[Cr+So]*$[Kr+So];m[b*qt+w*be+S*Mn+ne]=Dn}return f.toTensor()},u.prototype.conv3dDerInput=function(a,s,c){for(var f=Ae(c.inShape,"float32"),m=f.values,v=f.strides,b=v[0],w=v[1],S=v[2],E=v[3],R=a.dataSync(),T=a.strides,P=T[0],O=T[1],$=T[2],B=T[3],U=s.dataSync(),z=s.strides,j=z[0],K=z[1],J=z[2],dt=z[3],vt=c.batchSize,bt=c.filterDepth,kt=c.filterHeight,_t=c.filterWidth,Mt=c.inChannels,Vt=c.inDepth,Jt=c.inHeight,ee=c.inWidth,le=c.outChannels,Gt=c.outDepth,qt=c.outHeight,ne=c.outWidth,be=c.strideDepth,De=c.strideHeight,Xe=c.strideWidth,dn=bt-1-c.padInfo.front,Mn=kt-1-c.padInfo.top,yn=_t-1-c.padInfo.left,Tn=0;Tn<vt;++Tn)for(var Yn=0;Yn<Mt;++Yn)for(var Dn=0;Dn<Vt;++Dn)for(var Qe=Dn-dn,Co=Math.max(0,Math.ceil(Qe/be)),On=Math.min(Gt,(bt+Qe)/be),Cr=0;Cr<Jt;++Cr)for(var Kr=Cr-Mn,So=Math.max(0,Math.ceil(Kr/De)),aa=Math.min(qt,(kt+Kr)/De),Fa=0;Fa<ee;++Fa){for(var rl=Fa-yn,Xm=Math.max(0,Math.ceil(rl/Xe)),Nu=Math.min(ne,(_t+rl)/Xe),vf=0,Pu=Co;Pu<On;++Pu)for(var Mu=Pu*be-Qe,Ou=So;Ou<aa;++Ou)for(var yB=Ou*De-Kr,yf=Xm;yf<Nu;++yf)for(var bB=P*Tn+O*Pu+$*Ou+B*yf,xB=j*(bt-1-Mu)+K*(kt-1-yB)+J*(_t-1-(yf*Xe-rl))+dt*Yn,bf=0;bf<le;++bf)vf+=R[bB+bf]*U[xB+bf];m[b*Tn+w*Dn+S*Cr+E*Fa+Yn]=vf}return f.toTensor()},u.prototype.conv2dDerFilter=function(a,s,c){this.assertNotComplex([a,s],"conv2dDerFilter");for(var f=c.strideHeight,m=c.strideWidth,v=c.filterHeight,b=c.filterWidth,w=Ae(c.filterShape,"float32"),S=c.padInfo.left,E=c.padInfo.top,R=0;R<v;++R)for(var T=Math.max(0,Math.ceil((E-R)/f)),P=Math.min(c.outHeight,(c.inHeight+E-R)/f),O=0;O<b;++O)for(var $=Math.max(0,Math.ceil((S-O)/m)),B=Math.min(c.outWidth,(c.inWidth+S-O)/m),U=0;U<c.inChannels;++U)for(var z=0;z<c.outChannels;++z){for(var j=0,K=0;K<c.batchSize;++K)for(var J=T;J<P;++J)for(var dt=R+J*f-E,vt=$;vt<B;++vt){var bt=O+vt*m-S;j+=a.get(K,dt,bt,U)*s.get(K,J,vt,z)}w.set(j,R,O,U,z)}return w.toTensor()},u.prototype.conv3dDerFilter=function(a,s,c){for(var f=c.strideDepth,m=c.strideHeight,v=c.strideWidth,b=c.filterDepth,w=c.filterHeight,S=c.filterWidth,E=Ae(c.filterShape,"float32"),R=E.values,T=E.strides,P=T[0],O=T[1],$=T[2],B=T[3],U=s.dataSync(),z=s.strides,j=z[0],K=z[1],J=z[2],dt=z[3],vt=a.dataSync(),bt=a.strides,kt=bt[0],_t=bt[1],Mt=bt[2],Vt=bt[3],Jt=c.padInfo.front,ee=c.padInfo.left,le=c.padInfo.top,Gt=0;Gt<b;++Gt)for(var qt=Math.max(0,Math.ceil((Jt-Gt)/f)),ne=Math.min(c.outDepth,(c.inDepth+Jt-Gt)/f),be=Gt*P,De=0;De<w;++De)for(var Xe=Math.max(0,Math.ceil((le-De)/m)),dn=Math.min(c.outHeight,(c.inHeight+le-De)/m),Mn=De*O+be,yn=0;yn<S;++yn)for(var Tn=Math.max(0,Math.ceil((ee-yn)/v)),Yn=Math.min(c.outWidth,(c.inWidth+ee-yn)/v),Dn=yn*$+Mn,Qe=0;Qe<c.inChannels;++Qe)for(var Co=Qe*B+Dn,On=0;On<c.outChannels;++On){for(var Cr=0,Kr=0;Kr<c.batchSize;++Kr)for(var So=Kr*kt,aa=Kr*j,Fa=qt;Fa<ne;++Fa)for(var rl=(Gt+Fa*f-Jt)*_t+So,Xm=Fa*K+aa,Nu=Xe;Nu<dn;++Nu)for(var vf=(De+Nu*m-le)*Mt+rl,Pu=Nu*J+Xm,Mu=Tn;Mu<Yn;++Mu){var Ou=Mu*dt+Pu;Cr+=vt[(yn+Mu*v-ee)*Vt+vf+Qe]*U[Ou+On]}R[Co+On]=Cr}return E.toTensor()},u.prototype.depthwiseConv2D=function(a,s,c){this.assertNotComplex([a,s],"depthwiseConv2D");for(var f=c.filterHeight,m=c.filterWidth,v=c.dilationHeight,b=c.dilationWidth,w=c.padInfo.left,S=c.padInfo.top,E=c.outChannels/c.inChannels,R=Ae(c.outShape,a.dtype),T=a.dataSync(),P=s.dataSync(),O=R.values,$=0;$<c.batchSize;++$)for(var B=$*a.strides[0],U=$*R.strides[0],z=0;z<c.outHeight;++z)for(var j=U+z*R.strides[1],K=z*c.strideHeight-w,J=0;J<f;++J){var dt=K+J*v;if(!(dt<0||dt>=c.inHeight))for(var vt=J*s.strides[0],bt=B+dt*a.strides[1],kt=0;kt<c.outWidth;++kt)for(var _t=j+kt*R.strides[2],Mt=kt*c.strideWidth-S,Vt=0;Vt<m;++Vt){var Jt=Mt+Vt*b;if(!(Jt<0||Jt>=c.inWidth))for(var ee=vt+Vt*s.strides[1],le=bt+Jt*c.inChannels,Gt=_t,qt=ee,ne=0;ne<c.inChannels;++ne){for(var be=T[le+ne],De=0;De<E;++De)O[Gt+De]+=be*P[qt+De];Gt+=E,qt+=E}}}return R.toTensor()},u.prototype.depthwiseConv2DDerInput=function(a,s,c){this.assertNotComplex([a,s],"depthwiseConv2DDerInput");for(var f=Ae(c.inShape,"float32"),m=f.values,v=f.strides,b=v[0],w=v[1],S=v[2],E=a.dataSync(),R=a.strides,T=R[0],P=R[1],O=R[2],$=s.dataSync(),B=s.strides,U=B[0],z=B[1],j=B[2],K=c.batchSize,J=c.filterHeight,dt=c.filterWidth,vt=c.inChannels,bt=c.inHeight,kt=c.inWidth,_t=c.outChannels,Mt=c.outHeight,Vt=c.outWidth,Jt=c.strideHeight,ee=c.strideWidth,le=J-1-c.padInfo.top,Gt=dt-1-c.padInfo.left,qt=_t/vt,ne=0;ne<K;++ne)for(var be=0;be<vt;++be)for(var De=0;De<bt;++De)for(var Xe=De-le,dn=Math.max(0,Math.ceil(Xe/Jt)),Mn=Math.min(Mt,(J+Xe)/Jt),yn=0;yn<kt;++yn){for(var Tn=yn-Gt,Yn=Math.max(0,Math.ceil(Tn/ee)),Dn=Math.min(Vt,(dt+Tn)/ee),Qe=0,Co=dn;Co<Mn;++Co)for(var On=Co*Jt-Xe,Cr=Yn;Cr<Dn;++Cr)for(var Kr=T*ne+P*Co+O*Cr,So=U*(J-1-On)+z*(dt-1-(Cr*ee-Tn))+j*be,aa=0;aa<qt;++aa)Qe+=E[Kr+(be*qt+aa)]*$[So+aa];m[b*ne+w*De+S*yn+be]=Qe}return f.toTensor()},u.prototype.depthwiseConv2DDerFilter=function(a,s,c){this.assertNotComplex([a,s],"depthwiseConv2DDerFilter");for(var f=c.strideHeight,m=c.strideWidth,v=c.filterHeight,b=c.filterWidth,w=Ae(c.filterShape,"float32"),S=c.padInfo.left,E=c.padInfo.top,R=c.outChannels/c.inChannels,T=0;T<v;++T)for(var P=Math.max(0,Math.ceil((E-T)/f)),O=Math.min(c.outHeight,(c.inHeight+E-T)/f),$=0;$<b;++$)for(var B=Math.max(0,Math.ceil((S-$)/m)),U=Math.min(c.outWidth,(c.inWidth+S-$)/m),z=0;z<c.outChannels;++z){for(var j=Math.trunc(z/R),K=z%R,J=0,dt=0;dt<c.batchSize;++dt)for(var vt=P;vt<O;++vt)for(var bt=T+vt*f-E,kt=B;kt<U;++kt){var _t=$+kt*m-S;J+=a.get(dt,bt,_t,j)*s.get(dt,vt,kt,z)}w.set(J,T,$,j,K)}return w.toTensor()},u.prototype.tile=function(a,s){this.assertNotComplex(a,"tile");for(var c=new Array(a.rank),f=0;f<c.length;f++)c[f]=a.shape[f]*s[f];var m=Ae(c,a.dtype),v=a.buffer();for(f=0;f<m.values.length;++f){for(var b=m.indexToLoc(f),w=new Array(a.rank),S=0;S<w.length;S++)w[S]=b[S]%a.shape[S];var E=v.locToIndex(w);m.values[f]=v.values[E]}return m.toTensor()},u.prototype.pad=function(a,s,c){this.assertNotComplex(a,"pad");var f=s.map(function(R,T){return R[0]+a.shape[T]+R[1]}),m=s.map(function(R){return R[0]}),v=a.buffer(),b=Ae(f,a.dtype);c!==0&&b.values.fill(c);for(var w=0;w<a.size;w++){var S=v.indexToLoc(w),E=S.map(function(R,T){return R+m[T]});b.set.apply(b,[a.get.apply(a,S)].concat(E))}return b.toTensor()},u.prototype.transpose=function(a,s){this.assertNotComplex(a,"transpose");for(var c=new Array(a.rank),f=0;f<c.length;f++)c[f]=a.shape[s[f]];var m=a.dataSync(),v=Ae(c,a.dtype),b=a.buffer();for(f=0;f<a.size;++f){for(var w=b.indexToLoc(f),S=new Array(w.length),E=0;E<S.length;E++)S[E]=w[s[E]];var R=v.locToIndex(S);v.values[R]=m[f]}return v.toTensor()},u.prototype.gather=function(a,s,c){this.assertNotComplex([a,s],"gather");var f=a.shape.slice(),m=s.dataSync();f[c]=m.length;for(var v=Ae(f,a.dtype),b=a.buffer(),w=0;w<v.size;++w){var S=v.indexToLoc(w),E=S.slice();E[c]=m[S[c]];var R=b.locToIndex(E);v.values[w]=b.values[R]}return v.toTensor()},u.prototype.batchToSpaceND=function(a,s,c){this.assertNotComplex([a],"batchToSpaceND");var f=s.reduce(function(E,R){return E*R}),m=_d(a.shape,s,f),v=Ed(m.length,s.length),b=kd(a.shape,s,f),w=ly(c,s.length),S=dy(b,c,s.length);return a.reshape(m).transpose(v).reshape(b).slice(w,S)},u.prototype.spaceToBatchND=function(a,s,c){this.assertNotComplex([a],"spaceToBatchND");var f=s.reduce(function(R,T){return R*T}),m=[[0,0]];m.push.apply(m,c);for(var v=1+s.length;v<a.shape.length;++v)m.push([0,0]);var b=a.pad(m),w=_d(b.shape,s,f,!1),S=Ed(w.length,s.length,!1),E=kd(b.shape,s,f,!1);return b.reshape(w).transpose(S).reshape(E)},u.prototype.pool=function(a,s,c){this.assertNotComplex(a,"pool");for(var f=s.strideHeight,m=s.strideWidth,v=s.dilationHeight,b=s.dilationWidth,w=s.effectiveFilterHeight,S=s.effectiveFilterWidth,E=s.padInfo.top,R=s.padInfo.left,T=c==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,P=a.dataSync(),O=Ae(s.outShape,a.dtype),$=O.values,B=s.outShape[1]*s.outShape[2]*s.outShape[3],U=s.outShape[2]*s.outShape[3],z=s.outShape[3],j=0;j<s.batchSize;++j)for(var K=j*B,J=j*a.strides[0],dt=0;dt<s.inChannels;++dt)for(var vt=0;vt<s.outHeight;++vt)for(var bt=vt*f-E,kt=Math.max(0,bt),_t=Math.min(s.inHeight,w+bt),Mt=K+vt*U,Vt=0;Vt<s.outWidth;++Vt){for(var Jt=Vt*m-R,ee=Math.max(0,Jt),le=Math.min(s.inWidth,S+Jt),Gt=T,qt=0,ne=0,be=kt;be<_t;be+=v){for(var De=J+be*a.strides[1],Xe=ee;Xe<le;Xe+=b){var dn=P[De+Xe*a.strides[2]+dt];c==="max"&&dn>Gt?Gt=dn:c==="avg"&&(qt+=dn,ne++)}if(isNaN(Gt))break}$[Mt+Vt*z+dt]=c==="avg"?qt/ne:Gt}return O.toTensor()},u.prototype.maxPool=function(a,s){return this.pool(a,s,"max")},u.prototype.maxPoolPositions=function(a,s){for(var c=Ae(s.outShape,"int32"),f=s.strideHeight,m=s.strideWidth,v=s.dilationHeight,b=s.dilationWidth,w=s.effectiveFilterHeight,S=s.effectiveFilterWidth,E=s.padInfo.top,R=s.padInfo.left,T=0;T<s.batchSize;++T)for(var P=0;P<s.inChannels;++P)for(var O=0;O<s.outHeight;++O){for(var $=O*f-E,B=$;B<0;)B+=v;for(var U=Math.min(s.inHeight,w+$),z=0;z<s.outWidth;++z){for(var j=z*m-R,K=j;K<0;)K+=b;for(var J=Math.min(s.inWidth,S+j),dt=Number.NEGATIVE_INFINITY,vt=-1,bt=B;bt<U;bt+=v)for(var kt=bt-$,_t=K;_t<J;_t+=b){var Mt=_t-j,Vt=a.get(T,bt,_t,P);Vt>dt&&(dt=Vt,vt=kt*S+Mt)}c.set(vt,T,O,z,P)}}return c.toTensor()},u.prototype.maxPoolBackprop=function(a,s,c,f){this.assertNotComplex([s,c],"maxPoolBackprop");for(var m=this.maxPoolPositions(s,f),v=f.strideHeight,b=f.strideWidth,w=f.dilationHeight,S=f.dilationWidth,E=f.effectiveFilterHeight,R=f.effectiveFilterWidth,T=R-1-f.padInfo.left,P=E-1-f.padInfo.top,O=Ae(s.shape,"float32"),$=0;$<f.batchSize;++$)for(var B=0;B<f.inChannels;++B)for(var U=0;U<f.inHeight;++U)for(var z=0;z<f.inWidth;++z){for(var j=U-P,K=z-T,J=0,dt=0;dt<E;dt+=w){var vt=(j+dt)/v;if(!(vt<0||vt>=f.outHeight||Math.floor(vt)!==vt))for(var bt=0;bt<R;bt+=S){var kt=(K+bt)/b;if(!(kt<0||kt>=f.outWidth||Math.floor(kt)!==kt)){var _t=E*R-1-m.get($,vt,kt,B)===dt*R+bt?1:0;_t!==0&&(J+=a.get($,vt,kt,B)*_t)}}}O.set(J,$,U,z,B)}return O.toTensor()},u.prototype.avgPoolBackprop=function(a,s,c){this.assertNotComplex([a,s],"avgPoolBackprop");for(var f=c.strideHeight,m=c.strideWidth,v=c.filterHeight,b=c.filterWidth,w=c.dilationHeight,S=c.dilationWidth,E=c.effectiveFilterHeight,R=c.effectiveFilterWidth,T=R-1-c.padInfo.left,P=E-1-c.padInfo.top,O=Ae(s.shape,"float32"),$=1/(v*b),B=0;B<c.batchSize;++B)for(var U=0;U<c.inChannels;++U)for(var z=0;z<c.inHeight;++z)for(var j=0;j<c.inWidth;++j){for(var K=z-P,J=j-T,dt=0,vt=0;vt<E;vt+=w){var bt=(K+vt)/f;if(!(bt<0||bt>=c.outHeight||Math.floor(bt)!==bt))for(var kt=0;kt<R;kt+=S){var _t=(J+kt)/m;_t<0||_t>=c.outWidth||Math.floor(_t)!==_t||(dt+=a.get(B,bt,_t,U))}}O.set(dt*$,B,z,j,U)}return O.toTensor()},u.prototype.cast=function(a,s){return _y(a,s,this)},u.prototype.reshape=function(a,s){return yh(a,s)},u.prototype.avgPool=function(a,s){return this.assertNotComplex(a,"avgPool"),this.pool(a,s,"avg").toFloat()},u.prototype.resizeBilinear=function(a,s,c,f){this.assertNotComplex(a,"resizeBilinear");for(var m=a.shape,v=m[0],b=m[1],w=m[2],S=m[3],E=a.dataSync(),R=new Float32Array(L([v,s,c,S])),T=[f&&s>1?b-1:b,f&&c>1?w-1:w],P=[f&&s>1?s-1:s,f&&c>1?c-1:c],O=0,$=T[0]/P[0],B=T[1]/P[1],U=0;U<v;U++)for(var z=0;z<s;z++)for(var j=$*z,K=Math.floor(j),J=j-K,dt=Math.min(b-1,Math.ceil(j)),vt=U*a.strides[0]+K*a.strides[1],bt=U*a.strides[0]+dt*a.strides[1],kt=0;kt<c;kt++)for(var _t=B*kt,Mt=Math.floor(_t),Vt=_t-Mt,Jt=Math.min(w-1,Math.ceil(_t)),ee=vt+Mt*a.strides[2],le=bt+Mt*a.strides[2],Gt=vt+ +Jt*a.strides[2],qt=bt+Jt*a.strides[2],ne=0;ne<S;ne++){var be=E[ee+ne],De=E[le+ne],Xe=be+(E[Gt+ne]-be)*Vt,dn=Xe+(De+(E[qt+ne]-De)*Vt-Xe)*J;R[O++]=dn}return kn(R,[v,s,c,S])},u.prototype.resizeBilinearBackprop=function(a,s,c){this.assertNotComplex([a,s],"resizeBilinearBackprop");for(var f=s.shape,m=f[0],v=f[1],b=f[2],w=f[3],S=a.shape,E=S[1],R=S[2],T=new Float32Array(m*v*b*w),P=[c&&E>1?v-1:v,c&&R>1?b-1:b],O=[c&&E>1?E-1:E,c&&R>1?R-1:R],$=P[0]/O[0],B=P[1]/O[1],U=a.dataSync(),z=0,j=0;j<m;j++)for(var K=j*s.strides[0],J=0;J<E;J++)for(var dt=J*$,vt=Math.floor(dt),bt=Math.min(Math.ceil(dt),v-1),kt=K+vt*s.strides[1],_t=K+bt*s.strides[1],Mt=dt-vt,Vt=1-Mt,Jt=0;Jt<R;Jt++)for(var ee=Jt*B,le=Math.floor(ee),Gt=Math.min(Math.ceil(ee),b-1),qt=ee-le,ne=1-qt,be=kt+le*s.strides[2],De=kt+Gt*s.strides[2],Xe=_t+le*s.strides[2],dn=_t+Gt*s.strides[2],Mn=Vt*ne,yn=Vt*qt,Tn=Mt*ne,Yn=Mt*qt,Dn=0;Dn<w;Dn++){var Qe=U[z++];T[be+Dn]+=Qe*Mn,T[De+Dn]+=Qe*yn,T[Xe+Dn]+=Qe*Tn,T[dn+Dn]+=Qe*Yn}return nr(T,[m,b,v,w],s.dtype)},u.prototype.resizeNearestNeighbor=function(a,s,c,f){this.assertNotComplex(a,"resizeNearestNeighbor");for(var m=a.shape,v=m[0],b=m[1],w=m[2],S=m[3],E=a.dataSync(),R=new Float32Array(v*s*c*S),T=[f&&s>1?b-1:b,f&&c>1?w-1:w],P=[f&&s>1?s-1:s,f&&c>1?c-1:c],O=T[0]/P[0],$=T[1]/P[1],B=0,U=0;U<v;U++)for(var z=U*a.strides[0],j=0;j<s;j++)for(var K=O*j,J=z+Math.min(b-1,f?Math.round(K):Math.floor(K))*a.strides[1],dt=0;dt<c;dt++)for(var vt=$*dt,bt=J+Math.min(w-1,f?Math.round(vt):Math.floor(vt))*a.strides[2],kt=0;kt<S;kt++){var _t=E[bt+kt];R[B++]=_t}return kn(R,[v,s,c,S],a.dtype)},u.prototype.resizeNearestNeighborBackprop=function(a,s,c){this.assertNotComplex([a,s],"resizeNearestNeighborBackprop");for(var f=s.shape,m=f[0],v=f[1],b=f[2],w=f[3],S=a.shape,E=S[1],R=S[2],T=new Float32Array(m*v*b*w),P=a.dataSync(),O=[c&&E>1?v-1:v,c&&R>1?b-1:b],$=[c&&E>1?E-1:E,c&&R>1?R-1:R],B=O[0]/$[0],U=O[1]/$[1],z=1/B,j=1/U,K=2*Math.ceil(z)+2,J=2*Math.ceil(j)+2,dt=0;dt<m;dt++)for(var vt=dt*s.strides[0],bt=0;bt<v;bt++)for(var kt=vt+bt*s.strides[1],_t=Math.floor(bt*z),Mt=Math.floor(_t-K/2),Vt=0;Vt<b;Vt++)for(var Jt=kt+Vt*s.strides[2],ee=Math.floor(Vt*j),le=Math.floor(ee-J/2),Gt=0;Gt<w;Gt++){for(var qt=0,ne=0;ne<K;ne++){var be=ne+Mt;if(!(be<0||be>=E)){var De=vt+be*a.strides[1],Xe=be*B;if(bt===Math.min(v-1,c?Math.round(Xe):Math.floor(Xe)))for(var dn=0;dn<J;dn++){var Mn=dn+le;if(!(Mn<0||Mn>=R)){var yn=De+Mn*a.strides[2],Tn=Mn*U;Vt===Math.min(b-1,c?Math.round(Tn):Math.floor(Tn))&&(qt+=P[yn+Gt])}}}}T[Jt+Gt]=qt}return nr(T,s.shape,s.dtype)},u.prototype.batchNormalization=function(a,s,c,f,m,v){this.assertNotComplex([a,s,c,m,v],"batchNormalization");for(var b=a.dataSync(),w=s.dataSync(),S=c.dataSync(),E=m?m.dataSync():new Float32Array([1]),R=v?v.dataSync():new Float32Array([0]),T=new Float32Array(b.length),P=R.length,O=E.length,$=S.length,B=w.length,U=0,z=0,j=0,K=0,J=0;J<b.length;++J)T[J]=R[U++]+(b[J]-w[z++])*E[j++]/Math.sqrt(S[K++]+f),U>=P&&(U=0),z>=B&&(z=0),j>=O&&(j=0),K>=$&&(K=0);return nr(T,a.shape)},u.prototype.localResponseNormalization4D=function(a,s,c,f,m){this.assertNotComplex(a,"localResponseNormalization4D");var v=a.shape[3],b=v-1,w=a.dataSync(),S=L(a.shape),E=new Float32Array(S);function R($){for(var B=$%v,U=$-B+Math.max(0,B-s),z=$-B+Math.min(B+s,b),j=0;U<=z;U++){var K=w[U];j+=K*K}return j}for(var T=0;T<S;T++){var P=R(T),O=w[T]*Math.pow(c+f*P,-m);E[T]=O}return nr(E,a.shape)},u.prototype.LRNGrad=function(a,s,c,f,m,v,b){this.assertNotComplex(a,"LRNGrad");for(var w=a.shape[3],S=a.dataSync(),E=s.dataSync(),R=c.dataSync(),T=new Float32Array(L(a.shape)),P=L(a.shape),O=0;O<P;O++){for(var $=O%w,B=O-$+Math.max(0,$-f),U=O-$+Math.min(w,$+f+1),z=0,j=B;j<U;j++)z+=Math.pow(E[j],2);for(z=v*z+m,j=B;j<U;j++){var K=-2*v*b*E[j]*R[O]/z;O===j&&(K+=Math.pow(z,-b)),K*=S[O],T[j]+=K}}return nr(T,a.shape)},u.prototype.multinomial=function(a,s,c,f){this.assertNotComplex(a,"multinomial");for(var m=s?a:Da(a),v=m.shape[0],b=m.shape[1],w=Rn([v,c],"int32"),S=w.dataSync(),E=m.dataSync(),R=0;R<v;++R){var T=R*b,P=new Float32Array(b-1);P[0]=E[T];for(var O=1;O<P.length;++O)P[O]=P[O-1]+E[T+O];for(var $=Hb(f.toString()),B=R*c,U=0;U<c;++U){var z=$();S[B+U]=P.length;for(var j=0;j<P.length;j++)if(z<P[j]){S[B+U]=j;break}}}return w},u.prototype.oneHot=function(a,s,c,f){this.assertNotComplex(a,"oneHot");var m=new Float32Array(a.size*s);m.fill(f);for(var v=0;v<a.size;++v)a.get(v)>=0&&a.get(v)<s&&(m[v*s+a.get(v)]=c);return pu(m,[a.size,s],"int32")},u.prototype.nonMaxSuppression=function(a,s,c,f,m){return this.assertNotComplex(a,"nonMaxSuppression"),bh(a.dataSync(),s.dataSync(),c,f,m)},u.prototype.fft=function(a){return this.fftBatch(a,!1)},u.prototype.ifft=function(a){return this.fftBatch(a,!0)},u.prototype.fftBatch=function(a,s){for(var c=a.shape[0],f=a.shape[1],m=Ae(a.shape,"float32"),v=Ae(a.shape,"float32"),b=Jo(a).as2D(c,f),w=ci(a).as2D(c,f),S=0;S<c;S++)for(var E=b.slice([S,0],[1,f]),R=w.slice([S,0],[1,f]),T=Fr(E,R),P=this.fftImpl(T,s).dataSync(),O=0;O<f;O++){var $=ky(P,O);m.values[S*f+O]=$.real,v.values[S*f+O]=$.imag}return Fr(m.toTensor(),v.toTensor()).as2D(c,f)},u.prototype.fftImpl=function(a,s){var c=a.as1D(),f=c.size;if(this.isExponentOf2(f)){var m=this.fftRadix2(c,f,s).as2D(a.shape[0],a.shape[1]);return s&&(m=Fr(Jo(m).div(Nt(f)),ci(m).div(Nt(f)))),m}var v=a.dataSync(),b=QD(this.fourierTransformByMatmul(v,f,s));return Fr(b.real,b.imag).as2D(a.shape[0],a.shape[1])},u.prototype.isExponentOf2=function(a){return(a&a-1)==0},u.prototype.fftRadix2=function(a,s,c){if(s===1)return a;var f=a.dataSync(),m=s/2,v=JD(f),b=Fr(v.real,v.imag).as1D(),w=ZD(f),S=Fr(w.real,w.imag).as1D();b=this.fftRadix2(b,m,c),S=this.fftRadix2(S,m,c);var E=eA(s,c),R=Fr(E.real,E.imag).mul(S),T=b.add(R),P=b.sub(R),O=Jo(T).concat(Jo(P)),$=ci(T).concat(ci(P));return Fr(O,$).as1D()},u.prototype.fourierTransformByMatmul=function(a,s,c){for(var f=new Float32Array(2*s),m=0;m<s;m++){for(var v=0,b=0,w=0;w<s;w++){var S=nA(m*w,s,c),E=ky(a,w);v+=E.real*S.real-E.imag*S.imag,b+=E.real*S.imag+E.imag*S.real}c&&(v/=s,b/=s),tA(f,v,b,m)}return f},u.prototype.depthToSpace=function(a,s,c){D(c==="NHWC","Only NHWC dataFormat supported on CPU for depthToSpace. Got "+c),D(s>1,"blockSize should be > 1 for depthToSpace, but was: "+s);for(var f=a.shape[0],m=a.shape[1],v=a.shape[2],b=a.shape[3],w=m*s,S=v*s,E=b/(s*s),R=a.dataSync(),T=new Float32Array(f*w*S*E),P=0,O=0;O<f;++O)for(var $=0;$<w;++$)for(var B=Math.floor($/s),U=$%s,z=0;z<S;++z)for(var j=Math.floor(z/s),K=(U*s+z%s)*E,J=0;J<E;++J){var dt=J+K+b*(j+v*(B+m*O));T[P++]=R[dt]}return nr(T,[f,w,S,E])},u.prototype.broadcastedBinaryOp=function(a,s,c,f){var m=Ge(a.shape,s.shape),v=Ae(m,c),b=a.dataSync(),w=s.dataSync(),S=as(a.shape,m),E=as(s.shape,m),R=v.values;if(S.length+E.length===0)for(var T=0;T<R.length;++T)R[T]=f(b[T%b.length],w[T%w.length]);else{var P=a.buffer(),O=s.buffer(),$=function(B){var U=v.indexToLoc(B),z=U.slice(-a.rank);S.forEach(function(dt){return z[dt]=0});var j=P.locToIndex(z),K=U.slice(-s.rank);E.forEach(function(dt){return K[dt]=0});var J=O.locToIndex(K);R[B]=f(b[j],w[J])};for(T=0;T<R.length;++T)$(T)}return v.toTensor()},u.prototype.broadcastedBinaryComplexOp=function(a,s,c){var f=Ge(a.shape,s.shape),m=Ae(f,"float32"),v=Ae(f,"float32"),b=a.dataSync(),w=s.dataSync(),S=as(a.shape,f),E=as(s.shape,f),R=m.values,T=v.values;if(S.length+E.length===0)for(var P=0;P<R.length;P++){var O=P%b.length,$=P%w.length,B=c(b[2*O],b[2*O+1],w[2*$],w[2*$+1]);R[P]=B.real,T[P]=B.imag}else{var U=this.data.get(a.dataId).complexTensors.real.buffer(),z=this.data.get(s.dataId).complexTensors.real.buffer(),j=function(K){var J=m.indexToLoc(K),dt=J.slice(-a.rank);S.forEach(function(Mt){return dt[Mt]=0});var vt=U.locToIndex(dt),bt=J.slice(-s.rank);E.forEach(function(Mt){return bt[Mt]=0});var kt=z.locToIndex(bt),_t=c(b[2*vt],b[2*vt+1],w[2*kt],w[2*kt+1]);R[K]=_t.real,T[K]=_t.imag};for(P=0;P<R.length;P++)j(P)}return this.complex(m.toTensor(),v.toTensor())},u.prototype.split=function(a,s,c){return Ry(a,s,c)},u.prototype.dispose=function(){},u.prototype.floatPrecision=function(){return 32},u.prototype.cropAndResize=function(a,s,c,f,m,v){for(var b=a.shape,w=b[0],S=b[1],E=b[2],R=b[3],T=s.shape[0],P=f[0],O=f[1],$=Ae([T,P,O,R],a.dtype),B=s.dataSync(),U=c.dataSync(),z=a.dataSync(),j=a.strides,K=$.strides,J=0;J<T;J++){var dt=4*J,vt=B[dt],bt=B[dt+1],kt=B[dt+2],_t=B[dt+3],Mt=U[J];if(!(Mt>=w))for(var Vt=P>1?(kt-vt)*(S-1)/(P-1):0,Jt=O>1?(_t-bt)*(E-1)/(O-1):0,ee=0;ee<P;ee++){var le=P>1?vt*(S-1)+ee*Vt:.5*(vt+kt)*(S-1);if(le<0||le>S-1)for(var Gt=0;Gt<O;Gt++)for(var qt=0;qt<R;qt++){var ne=qt+Gt*K[2]+ee*K[1]+J*K[0];$.values[ne]=v}else if(m==="bilinear"){var be=Math.floor(le),De=Math.ceil(le),Xe=le-be;for(Gt=0;Gt<O;Gt++)if((On=O>1?bt*(E-1)+Gt*Jt:.5*(bt+_t)*(E-1))<0||On>E-1)for(qt=0;qt<R;qt++)ne=qt+Gt*K[2]+ee*K[1]+J*K[0],$.values[ne]=v;else{var dn=Math.floor(On),Mn=Math.ceil(On),yn=On-dn;for(qt=0;qt<R;qt++){var Tn=z[ne=qt+dn*j[2]+be*j[1]+Mt*j[0]],Yn=z[ne=qt+Mn*j[2]+be*j[1]+Mt*j[0]],Dn=z[ne=qt+dn*j[2]+De*j[1]+Mt*j[0]],Qe=Tn+(Yn-Tn)*yn,Co=Dn+(z[ne=qt+Mn*j[2]+De*j[1]+Mt*j[0]]-Dn)*yn;ne=qt+Gt*K[2]+ee*K[1]+J*K[0],$.values[ne]=Qe+(Co-Qe)*Xe}}}else for(Gt=0;Gt<O;++Gt){var On;if((On=O>1?bt*(E-1)+Gt*Jt:.5*(bt+_t)*(E-1))<0||On>E-1)for(qt=0;qt<R;qt++)ne=qt+Gt*K[2]+ee*K[1]+J*K[0],$.values[ne]=v;else{var Cr=Math.round(On),Kr=Math.round(le);for(qt=0;qt<R;qt++){var So=qt+Cr*j[2]+Kr*j[1]+Mt*j[0],aa=qt+Gt*K[2]+ee*K[1]+J*K[0];$.values[aa]=z[So]}}}}}return $.toTensor()},u.prototype.sparseToDense=function(a,s,c,f){var m=Rd(s,a,c),v=m.sliceRank,b=m.numUpdates,w=m.sliceSize,S=m.strides,E=m.outputSize;return this.scatter(a,s,c,E,w,b,v,S,f,!1)},u.prototype.gatherND=function(a,s){var c=s.shape,f=c[c.length-1],m=py(a,s),v=m[0],b=m[1],w=m[2],S=m[3];if(b===0)return kn([],v,a.dtype);for(var E=new Wn([b,w],a.dtype),R=s.dataSync(),T=a.dataSync(),P=0;P<b;P++){for(var O=[],$=0,B=0;B<f;B++){var U=R[P*f+B];$+=U*S[B],O.push(U)}if($<0||$>=a.size/w)throw new Error("Invalid indices: "+O+" does not index into "+a.shape);for(var z=0;z<w;z++)E.values[P*w+z]=T[$*w+z]}return E.toTensor().reshape(v)},u.prototype.scatterND=function(a,s,c){var f=Rd(s,a,c),m=f.sliceRank,v=f.numUpdates,b=f.sliceSize,w=f.strides,S=f.outputSize,E=Nt(0);return this.scatter(a,s,c,S,b,v,m,w,E,!0)},u.prototype.scatter=function(a,s,c,f,m,v,b,w,S,E){var R=[f/m,m],T=a.dataSync(),P=s.dataSync();if(f===0)return kn([],c,s.dtype);var O=new Wn(R,s.dtype);O.values.fill(S.dataSync()[0]);for(var $=0;$<v;$++){for(var B=[],U=0,z=0;z<b;z++){var j=T[$*b+z];B.push(j),U+=j*w[z]}if(U<0||U>=f/m)throw new Error("Invalid indices: "+B+" does not index into "+c);for(var K=0;K<m;K++)E?O.values[U*m+K]+=P[$*m+K]:O.values[U*m+K]=s.rank===0?P[0]:P[$*m+K]}return O.toTensor().reshape(c)},u}();Z.registerBackend("cpu",function(){return new bO},1,Vr);var xO=typeof requestAnimationFrame<"u"?requestAnimationFrame:setImmediate;function wO(){return new Promise(function(u){return xO(function(){return u()})})}var Qh={float32:4,int32:4,uint16:2,uint8:1,bool:1};function CO(u){return l(this,void 0,void 0,function(){var a,s,c,f;return d(this,function(m){switch(m.label){case 0:for(c in a=[],s=[],u){if((f=u[c]).dtype!=="float32"&&f.dtype!=="int32"&&f.dtype!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+f.dtype);a.push({name:c,shape:f.shape,dtype:f.dtype}),s.push(f.data())}return[4,Promise.all(s)];case 1:return[2,{data:SO(m.sent()),specs:a}]}})})}function sw(u,a){for(var s={},c=0,f=function(b){var w=b.name,S=b.dtype,E=b.shape,R=L(E),T=void 0;if("quantization"in b){var P=b.quantization;if(P.dtype!=="uint8"&&P.dtype!=="uint16")throw new Error("Weight "+b.name+" has unknown quantization dtype "+P.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var O=Qh[P.dtype],$=u.slice(c,c+R*O),B=P.dtype==="uint8"?new Uint8Array($):new Uint16Array($);if(S==="float32")T=Float32Array.from(B,function(j){return j*P.scale+P.min});else{if(S!=="int32")throw new Error("Unsupported dtype in weight '"+w+"': "+S);T=Int32Array.from(B,function(j){return Math.round(j*P.scale+P.min)})}c+=R*O}else{var U=Qh[S];if($=u.slice(c,c+R*U),S==="float32")T=new Float32Array($);else if(S==="int32")T=new Int32Array($);else{if(S!=="bool")throw new Error("Unsupported dtype in weight '"+w+"': "+S);T=new Uint8Array($)}c+=R*U}var z=void 0;if(S==="float32")z=kn(T,E,"float32");else if(S==="int32")z=kn(T,E,"int32");else{if(S!=="bool")throw new Error("Unsupported dtype in weight '"+w+"': "+S);z=kn(T,E,"bool")}s[w]=z},m=0,v=a;m<v.length;m++)f(v[m]);return s}function SO(u){if(u===null)throw new Error("Invalid input value: "+JSON.stringify(u));var a=0,s=[];u.forEach(function(m){if(a+=m.byteLength,s.push(m.byteLength===m.buffer.byteLength?m:new m.constructor(m)),!(m instanceof Float32Array||m instanceof Int32Array||m instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+m.constructor.name)});var c=new Uint8Array(a),f=0;return s.forEach(function(m){c.set(new Uint8Array(m.buffer),f),f+=m.byteLength}),c.buffer}var Jh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function uw(u){return Jh?Buffer.byteLength(u):new Blob([u]).size}function _O(u){return Jh?Buffer.from(u).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(u)))}function EO(u){if(Jh){var a=Buffer.from(u,"base64");return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}for(var s=atob(u),c=new Uint8Array(s.length),f=0;f<s.length;++f)c.set([s.charCodeAt(f)],f);return c.buffer}function Zh(u){var a=0;u.forEach(function(f){a+=f.byteLength});var s=new Uint8Array(a),c=0;return u.forEach(function(f){s.set(new Uint8Array(f),c),c+=f.byteLength}),s.buffer}function cw(u){for(u=u.trim();u.endsWith("/");)u=u.slice(0,u.length-1);var a=u.split("/");return a[a.length-1]}function Hc(u){if(u.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:u.modelTopology==null?0:uw(JSON.stringify(u.modelTopology)),weightSpecsBytes:u.weightSpecs==null?0:uw(JSON.stringify(u.weightSpecs)),weightDataBytes:u.weightData==null?0:u.weightData.byteLength}}var io=function(){function u(){this.saveRouters=[],this.loadRouters=[]}return u.getInstance=function(){return u.instance==null&&(u.instance=new u),u.instance},u.registerSaveRouter=function(a){u.getInstance().saveRouters.push(a)},u.registerLoadRouter=function(a){u.getInstance().loadRouters.push(a)},u.getSaveHandlers=function(a){return u.getHandlers(a,"save")},u.getLoadHandlers=function(a){return u.getHandlers(a,"load")},u.getHandlers=function(a,s){var c=[];return(s==="load"?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(f){var m=f(a);m!==null&&c.push(m)}),c},u}(),Su="://",pi=function(){function u(){this.managers={}}return u.getInstance=function(){return u.instance==null&&(u.instance=new u),u.instance},u.registerManager=function(a,s){D(a!=null,"scheme must not be undefined or null."),a.endsWith(Su)&&(a=a.slice(0,a.indexOf(Su))),D(a.length>0,"scheme must not be an empty string.");var c=u.getInstance();D(c.managers[a]==null,"A model store manager is already registered for scheme '"+a+"'."),c.managers[a]=s},u.getManager=function(a){var s=this.getInstance().managers[a];if(s==null)throw new Error("Cannot find model manager for scheme '"+a+"'");return s},u.getSchemes=function(){return Object.keys(this.getInstance().managers)},u}();function Yd(u){if(u.indexOf(Su)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+pi.getSchemes().join(","));return{scheme:u.split(Su)[0],path:u.split(Su)[1]}}function lw(u,a,s){return s===void 0&&(s=!1),l(this,void 0,void 0,function(){var c,f,m,v,b,w,S,E,R;return d(this,function(T){switch(T.label){case 0:return D(u!==a,"Old path and new path are the same: '"+u+"'"),D((c=io.getLoadHandlers(u)).length>0,"Copying failed because no load handler is found for source URL "+u+"."),D(c.length<2,"Copying failed because more than one ("+c.length+") load handlers for source URL "+u+"."),f=c[0],D((m=io.getSaveHandlers(a)).length>0,"Copying failed because no save handler is found for destination URL "+a+"."),D(m.length<2,"Copying failed because more than one ("+c.length+") save handlers for destination URL "+a+"."),v=m[0],b=Yd(u).scheme,w=Yd(u).path,S=b===Yd(u).scheme,[4,f.load()];case 1:return E=T.sent(),s&&S?[4,pi.getManager(b).removeModel(w)]:[3,3];case 2:T.sent(),T.label=3;case 3:return[4,v.save(E)];case 4:return R=T.sent(),!s||S?[3,6]:[4,pi.getManager(b).removeModel(w)];case 5:T.sent(),T.label=6;case 6:return[2,R.modelArtifactsInfo]}})})}function kO(){return l(this,void 0,void 0,function(){var u,a,s,c,f,m,v;return d(this,function(b){switch(b.label){case 0:u=pi.getSchemes(),a={},s=0,c=u,b.label=1;case 1:return s<c.length?(f=c[s],[4,pi.getManager(f).listModels()]):[3,4];case 2:for(v in m=b.sent())a[f+Su+v]=m[v];b.label=3;case 3:return s++,[3,1];case 4:return[2,a]}})})}function RO(u){return l(this,void 0,void 0,function(){var a;return d(this,function(s){switch(s.label){case 0:return a=Yd(u),[4,pi.getManager(a.scheme).removeModel(a.path)];case 1:return[2,s.sent()]}})})}function TO(u,a){return l(this,void 0,void 0,function(){return d(this,function(s){switch(s.label){case 0:return[4,lw(u,a,!1)];case 1:return[2,s.sent()]}})})}function DO(u,a){return l(this,void 0,void 0,function(){return d(this,function(s){switch(s.label){case 0:return[4,lw(u,a,!0)];case 1:return[2,s.sent()]}})})}var tm="tensorflowjs",em=1,ds="models_store",hi="model_info_store";function dw(){if(!Z.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var u=window,a=u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB||u.shimIndexedDB;if(a==null)throw new Error("The current browser does not appear to support IndexedDB.");return a}function nm(u){var a=u.result;a.createObjectStore(ds,{keyPath:"modelPath"}),a.createObjectStore(hi,{keyPath:"modelPath"})}var _u=function(){function u(a){if(this.indexedDB=dw(),a==null||!a)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=a}return u.prototype.save=function(a){return l(this,void 0,void 0,function(){return d(this,function(s){if(a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,a)]})})},u.prototype.load=function(){return l(this,void 0,void 0,function(){return d(this,function(a){return[2,this.databaseAction(this.modelPath)]})})},u.prototype.databaseAction=function(a,s){var c=this;return new Promise(function(f,m){var v=c.indexedDB.open(tm,em);v.onupgradeneeded=function(){return nm(v)},v.onsuccess=function(){var b=v.result;if(s==null){var w=b.transaction(ds,"readonly"),S=w.objectStore(ds).get(c.modelPath);S.onsuccess=function(){if(S.result==null)return b.close(),m(new Error("Cannot find model with path '"+c.modelPath+"' in IndexedDB."));f(S.result.modelArtifacts)},S.onerror=function($){return b.close(),m(S.error)},w.oncomplete=function(){return b.close()}}else{var E,R=Hc(s),T=b.transaction(hi,"readwrite"),P=T.objectStore(hi),O=P.put({modelPath:c.modelPath,modelArtifactsInfo:R});O.onsuccess=function(){var $=(E=b.transaction(ds,"readwrite")).objectStore(ds).put({modelPath:c.modelPath,modelArtifacts:s,modelArtifactsInfo:R});$.onsuccess=function(){return f({modelArtifactsInfo:R})},$.onerror=function(B){var U=(P=T.objectStore(hi)).delete(c.modelPath);U.onsuccess=function(){return b.close(),m($.error)},U.onerror=function(z){return b.close(),m($.error)}}},O.onerror=function($){return b.close(),m(O.error)},T.oncomplete=function(){E==null?b.close():E.oncomplete=function(){return b.close()}}}},v.onerror=function(b){return m(v.error)}})},u.URL_SCHEME="indexeddb://",u}(),fw=function(u){return Z.get("IS_BROWSER")&&!Array.isArray(u)&&u.startsWith(_u.URL_SCHEME)?AO(u.slice(_u.URL_SCHEME.length)):null};function AO(u){return new _u(u)}function IO(u){return u.startsWith(_u.URL_SCHEME)?u.slice(_u.URL_SCHEME.length):u}io.registerSaveRouter(fw),io.registerLoadRouter(fw);var NO=function(){function u(){this.indexedDB=dw()}return u.prototype.listModels=function(){return l(this,void 0,void 0,function(){var a=this;return d(this,function(s){return[2,new Promise(function(c,f){var m=a.indexedDB.open(tm,em);m.onupgradeneeded=function(){return nm(m)},m.onsuccess=function(){var v=m.result,b=v.transaction(hi,"readonly"),w=b.objectStore(hi).getAll();w.onsuccess=function(){for(var S={},E=0,R=w.result;E<R.length;E++){var T=R[E];S[T.modelPath]=T.modelArtifactsInfo}c(S)},w.onerror=function(S){return v.close(),f(w.error)},b.oncomplete=function(){return v.close()}},m.onerror=function(v){return f(m.error)}})]})})},u.prototype.removeModel=function(a){return l(this,void 0,void 0,function(){var s=this;return d(this,function(c){return a=IO(a),[2,new Promise(function(f,m){var v=s.indexedDB.open(tm,em);v.onupgradeneeded=function(){return nm(v)},v.onsuccess=function(){var b,w=v.result,S=w.transaction(hi,"readwrite"),E=S.objectStore(hi),R=E.get(a);R.onsuccess=function(){if(R.result==null)return w.close(),m(new Error("Cannot find model with path '"+a+"' in IndexedDB."));var T=E.delete(a),P=function(){var O=(b=w.transaction(ds,"readwrite")).objectStore(ds).delete(a);O.onsuccess=function(){return f(R.result.modelArtifactsInfo)},O.onerror=function($){return m(R.error)}};T.onsuccess=P,T.onerror=function(O){return P(),w.close(),m(R.error)}},R.onerror=function(T){return w.close(),m(R.error)},S.oncomplete=function(){b==null?w.close():b.oncomplete=function(){return w.close()}}},v.onerror=function(b){return m(v.error)}})]})})},u}();if(Z.get("IS_BROWSER"))try{pi.registerManager(_u.URL_SCHEME,new NO)}catch{}var mi="/",Gc="tensorflowjs_models",pw="info",PO="model_topology",MO="weight_specs",OO="weight_data";function hw(u){return{info:[Gc,u,pw].join(mi),topology:[Gc,u,PO].join(mi),weightSpecs:[Gc,u,MO].join(mi),weightData:[Gc,u,OO].join(mi)}}function FO(u){var a=u.split(mi);if(a.length<3)throw new Error("Invalid key format: "+u);return a.slice(1,a.length-1).join(mi)}function $O(u){return u.startsWith(Eu.URL_SCHEME)?u.slice(Eu.URL_SCHEME.length):u}var Eu=function(){function u(a){if(!Z.get("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,a==null||!a)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=a,this.keys=hw(this.modelPath)}return u.prototype.save=function(a){return l(this,void 0,void 0,function(){var s,c,f,m;return d(this,function(v){if(a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");s=JSON.stringify(a.modelTopology),c=JSON.stringify(a.weightSpecs),f=Hc(a);try{return this.LS.setItem(this.keys.info,JSON.stringify(f)),this.LS.setItem(this.keys.topology,s),this.LS.setItem(this.keys.weightSpecs,c),this.LS.setItem(this.keys.weightData,_O(a.weightData)),[2,{modelArtifactsInfo:f}]}catch{for(m in this.keys)this.LS.removeItem(this.keys[m]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+f.modelTopologyBytes+", weightSpecsBytes="+f.weightSpecsBytes+", weightDataBytes="+f.weightDataBytes+".")}return[2]})})},u.prototype.load=function(){return l(this,void 0,void 0,function(){var a,s,c,f,m;return d(this,function(v){if((a=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(a.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(s={},(c=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(s.modelTopology=c,(f=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(s.weightSpecs=f,(m=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return s.weightData=EO(m),[2,s]})})},u.URL_SCHEME="localstorage://",u}(),mw=function(u){return Z.get("IS_BROWSER")&&!Array.isArray(u)&&u.startsWith(Eu.URL_SCHEME)?BO(u.slice(Eu.URL_SCHEME.length)):null};function BO(u){return new Eu(u)}io.registerSaveRouter(mw),io.registerLoadRouter(mw);var LO=function(){function u(){D(Z.get("IS_BROWSER"),"Current environment is not a web browser"),D(window.localStorage!==void 0,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return u.prototype.listModels=function(){return l(this,void 0,void 0,function(){var a,s,c,f,m,v;return d(this,function(b){for(a={},s=Gc+mi,c=mi+pw,f=0;f<this.LS.length;++f)(m=this.LS.key(f)).startsWith(s)&&m.endsWith(c)&&(v=FO(m),a[v]=JSON.parse(this.LS.getItem(m)));return[2,a]})})},u.prototype.removeModel=function(a){return l(this,void 0,void 0,function(){var s,c;return d(this,function(f){if(a=$O(a),s=hw(a),this.LS.getItem(s.info)==null)throw new Error("Cannot find model at path '"+a+"'");return c=JSON.parse(this.LS.getItem(s.info)),this.LS.removeItem(s.info),this.LS.removeItem(s.topology),this.LS.removeItem(s.weightSpecs),this.LS.removeItem(s.weightData),[2,c]})})},u}();if(Z.get("IS_BROWSER"))try{pi.registerManager(Eu.URL_SCHEME,new LO)}catch{}var WO="model",UO=".json",zO=".weights.bin",rm=function(){function u(a){if(!Z.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");a.startsWith(u.URL_SCHEME)&&(a=a.slice(u.URL_SCHEME.length)),a!=null&&a.length!==0||(a=WO),this.modelTopologyFileName=a+UO,this.weightDataFileName=a+zO}return u.prototype.save=function(a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b;return d(this,function(w){if(s=window.URL.createObjectURL(new Blob([a.weightData],{type:"application/octet-stream"})),a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return c=[{paths:["./"+this.weightDataFileName],weights:a.weightSpecs}],f={modelTopology:a.modelTopology,weightsManifest:c},m=window.URL.createObjectURL(new Blob([JSON.stringify(f)],{type:"application/json"})),(v=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,v.href=m,v.click(),a.weightData!=null&&((b=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,b.href=s,b.click()),[2,{modelArtifactsInfo:Hc(a)}]})})},u.URL_SCHEME="downloads://",u}(),VO=function(){function u(a){if(a==null||a.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+a);this.files=a}return u.prototype.load=function(){return l(this,void 0,void 0,function(){var a,s,c=this;return d(this,function(f){return a=this.files[0],s=this.files.slice(1),[2,new Promise(function(m,v){var b=new FileReader;b.onload=function(w){var S=JSON.parse(w.target.result),E=S.modelTopology;if(E!=null){s.length===0&&m({modelTopology:E});var R=S.weightsManifest;if(R!=null){var T;try{T=c.checkManifestAndWeightFiles(R,s)}catch(B){return void v(B)}var P=[],O=[],$=[];R.forEach(function(B){B.paths.forEach(function(U){O.push(U),$.push(null)}),P.push.apply(P,B.weights)}),R.forEach(function(B){B.paths.forEach(function(U){var z=new FileReader;z.onload=function(j){var K=j.target.result,J=O.indexOf(U);$[J]=K,$.indexOf(null)===-1&&m({modelTopology:E,weightSpecs:P,weightData:Zh($)})},z.onerror=function(j){return v("Failed to weights data from file of path '"+U+"'.")},z.readAsArrayBuffer(T[U])})})}else v(new Error("weightManifest field is missing from file "+a.name))}else v(new Error("modelTopology field is missing from file "+a.name))},b.onerror=function(w){return v("Failed to read model topology and weights manifest JSON from file '"+a.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},b.readAsText(a)})]})})},u.prototype.checkManifestAndWeightFiles=function(a,s){for(var c=[],f=s.map(function(w){return cw(w.name)}),m={},v=0,b=a;v<b.length;v++)b[v].paths.forEach(function(w){var S=cw(w);if(c.indexOf(S)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+S+"'");if(c.push(S),f.indexOf(S)===-1)throw new Error("Weight file with basename '"+S+"' is not provided.");m[w]=s[f.indexOf(S)]});if(c.length!==s.length)throw new Error("Mismatch in the number of files in weights manifest ("+c.length+") and the number of weight files provided ("+s.length+").");return m},u}(),HO=function(u){return Z.get("IS_BROWSER")&&!Array.isArray(u)&&u.startsWith(rm.URL_SCHEME)?GO(u.slice(rm.URL_SCHEME.length)):null};function GO(u){return u===void 0&&(u="model"),new rm(u)}function qO(u){return new VO(u)}function gw(u,a,s){return l(this,void 0,void 0,function(){var c,f;return d(this,function(m){switch(m.label){case 0:return s==null&&(s=fetch),c=u.map(function(v){return s(v,a)}),[4,Promise.all(c)];case 1:return f=m.sent(),[4,Promise.all(f.map(function(v){return v.arrayBuffer()}))];case 2:return[2,m.sent()]}})})}function jO(u,a,s,c){return a===void 0&&(a=""),l(this,void 0,void 0,function(){return d(this,function(f){return[2,vw(function(m){return gw(m,c)})(u,a,s)]})})}function vw(u){var a=this;return function(s,c,f){return c===void 0&&(c=""),l(a,void 0,void 0,function(){var m,v,b,w,S,E,R,T,P,O;return d(this,function($){switch($.label){case 0:if(m=s.map(function(){return!1}),v={},b=f!=null?f.map(function(){return!1}):[],w=[],s.forEach(function(B,U){var z=0;B.weights.forEach(function(j){var K="quantization"in j?j.quantization.dtype:j.dtype,J=Qh[K]*L(j.shape),dt=function(){m[U]=!0,v[U]==null&&(v[U]=[]),v[U].push({manifestEntry:j,groupOffset:z,sizeBytes:J})};f!=null?f.forEach(function(vt,bt){vt===j.name&&(dt(),b[bt]=!0)}):dt(),w.push(j.name),z+=J})}),!b.every(function(B){return B}))throw S=f.filter(function(B,U){return!b[U]}),new Error("Could not find weights in manifest with names: "+S.join(", ")+`. 
Manifest JSON has weights with names: `+w.join(", ")+".");return E=m.reduce(function(B,U,z){return U&&B.push(z),B},[]),R=[],E.forEach(function(B){s[B].paths.forEach(function(U){var z=c+(c.endsWith("/")?"":"/")+U;R.push(z)})}),[4,u(R)];case 1:return T=$.sent(),P={},O=0,E.forEach(function(B){for(var U=s[B].paths.length,z=0,j=0;j<U;j++)z+=T[O+j].byteLength;for(var K=new ArrayBuffer(z),J=new Uint8Array(K),dt=0,vt=0;vt<U;vt++){var bt=new Uint8Array(T[O+vt]);J.set(bt,dt),dt+=bt.byteLength}v[B].forEach(function(kt){var _t=sw(K.slice(kt.groupOffset,kt.groupOffset+kt.sizeBytes),[kt.manifestEntry]);for(var Mt in _t)P[Mt]=_t[Mt]}),O+=U}),[2,P]}})})}}io.registerSaveRouter(HO);var yw=function(){function u(a,s,c,f){if(this.weightPathPrefix=c,this.DEFAULT_METHOD="POST",f==null){if(typeof fetch>"u")throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");this.fetchFunc=fetch.bind(typeof window>"u"?null:window)}else D(typeof f=="function","Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetchFunc=f;if(D(a!=null&&a.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(a)&&D(a.length===2,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+a.length+")."),this.path=a,s!=null&&s.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=s||{}}return u.prototype.save=function(a){return l(this,void 0,void 0,function(){var s,c,f,m;return d(this,function(v){switch(v.label){case 0:if(a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(s=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,c=[{paths:["./model.weights.bin"],weights:a.weightSpecs}],f={modelTopology:a.modelTopology,weightsManifest:c},s.body.append("model.json",new Blob([JSON.stringify(f)],{type:"application/json"}),"model.json"),a.weightData!=null&&s.body.append("model.weights.bin",new Blob([a.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,s)];case 1:if((m=v.sent()).ok)return[2,{modelArtifactsInfo:Hc(a),responses:[m]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+m.status+".")}})})},u.prototype.load=function(){return l(this,void 0,void 0,function(){return d(this,function(a){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},u.prototype.loadBinaryTopology=function(){return l(this,void 0,void 0,function(){var a,s;return d(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),[4,this.getFetchFunc()(this.path[0],this.requestInit)];case 1:if(!(a=c.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+a.statusText);return[4,a.arrayBuffer()];case 2:return[2,c.sent()];case 3:throw s=c.sent(),new Error(this.path[0]+" not found. "+s);case 4:return[2]}})})},u.prototype.loadBinaryModel=function(){return l(this,void 0,void 0,function(){var a,s,c,f,m,v,b,w;return d(this,function(S){switch(S.label){case 0:return a=this.loadBinaryTopology(),[4,this.getFetchFunc()(this.path[1],this.requestInit)];case 1:if(!(s=S.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+s.statusText);return[4,Promise.all([a,s])];case 2:return c=S.sent(),f=c[0],[4,c[1].json()];case 3:return(m=S.sent())==null?[3,5]:[4,this.loadWeights(m)];case 4:w=S.sent(),v=w[0],b=w[1],S.label=5;case 5:return[2,{modelTopology:f,weightSpecs:v,weightData:b}]}})})},u.prototype.loadJSONModel=function(){return l(this,void 0,void 0,function(){var a,s,c,f,m,v,b,w;return d(this,function(S){switch(S.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(a=S.sent()).ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+a.statusText);return[4,a.json()];case 2:if(s=S.sent(),c=s.modelTopology,f=s.weightsManifest,c==null&&f==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return f==null?[3,4]:(b=s.weightsManifest,[4,this.loadWeights(b)]);case 3:w=S.sent(),m=w[0],v=w[1],S.label=4;case 4:return[2,{modelTopology:c,weightSpecs:m,weightData:v}]}})})},u.prototype.loadWeights=function(a){return l(this,void 0,void 0,function(){var s,c,f,m,v,b,w,S,E,R,T,P;return d(this,function(O){switch(O.label){case 0:for(s=Array.isArray(this.path)?this.path[1]:this.path,c=KO(s),f=c[0],m=c[1],v=this.weightPathPrefix||f,b=[],w=0,S=a;w<S.length;w++)E=S[w],b.push.apply(b,E.weights);return R=[],a.forEach(function($){$.paths.forEach(function(B){R.push(v+B+m)})}),T=[b],P=Zh,[4,gw(R,this.requestInit,this.getFetchFunc())];case 1:return[2,T.concat([P.apply(void 0,[O.sent()])])]}})})},u.prototype.getFetchFunc=function(){return this.fetchFunc},u.URL_SCHEME_REGEX=/^https?:\/\//,u}();function KO(u){var a=u.lastIndexOf("/"),s=u.lastIndexOf("?");return[u.substring(0,a)+"/",s>a?u.substring(s):""]}function om(u){return u.match(yw.URL_SCHEME_REGEX)!=null}var bw=function(u){return typeof fetch>"u"?null:(Array.isArray(u)?u.every(function(a){return om(a)}):om(u))?xw(u):null};function xw(u,a,s,c){return new yw(u,a,s,c)}io.registerSaveRouter(bw),io.registerLoadRouter(bw);var XO=function(){function u(a,s,c){this.modelTopology=a,this.weightSpecs=s,this.weightData=c}return u.prototype.load=function(){return l(this,void 0,void 0,function(){var a;return d(this,function(s){return a={},this.modelTopology!=null&&(a=i({modelTopology:this.modelTopology},a)),this.weightSpecs!=null&&this.weightSpecs.length>0&&(a=i({weightSpecs:this.weightSpecs},a)),this.weightData!=null&&this.weightData.byteLength>0&&(a=i({weightData:this.weightData},a)),[2,a]})})},u}(),YO=function(){function u(a){this.saveHandler=a}return u.prototype.save=function(a){return l(this,void 0,void 0,function(){return d(this,function(s){return[2,this.saveHandler(a)]})})},u}();function QO(u,a,s){return new XO(u,a,s)}function JO(u){return new YO(u)}var ZO=io.registerSaveRouter,tF=io.registerLoadRouter,eF=io.getSaveHandlers,nF=io.getLoadHandlers,am=Object.freeze({browserFiles:qO,browserHTTPRequest:xw,concatenateArrayBuffers:Zh,decodeWeights:sw,encodeWeights:CO,fromMemory:QO,getLoadHandlers:nF,getModelArtifactsInfoForJSON:Hc,getSaveHandlers:eF,isHTTPScheme:om,loadWeights:jO,registerLoadRouter:tF,registerSaveRouter:ZO,weightsLoaderFactory:vw,withSaveHandler:JO,copyModel:TO,listModels:kO,moveModel:DO,removeModel:RO});function rF(u,a,s){var c=V(u,"labels","confusionMatrix"),f=V(a,"predictions","confusionMatrix");D(s==null||s>0&&Number.isInteger(s),"If provided, numClasses must be a positive integer, but got "+s),D(c.rank===1,"Expected the rank of labels to be 1, but got "+c.rank),D(f.rank===1,"Expected the rank of predictions to be 1, but got "+f.rank),D(c.shape[0]===f.shape[0],"Mismatch in the number of examples: "+c.shape[0]+" vs. "+f.shape[0]+". Labels and predictions should have the same number of elements."),D(s>0&&Number.isInteger(s),"numClasses is required to be a positive integer, but got "+s);var m=Fd(c.asType("int32"),s),v=Fd(f.asType("int32"),s);return m.transpose().matMul(v).asType("int32")}var oF=st({confusionMatrix_:rF}),aF=Object.freeze({confusionMatrix:oF}),ww=function(){function u(){}return u.prototype.getClassName=function(){return this.constructor.className},u.fromConfig=function(a,s){return new a(s)},u}(),Cw=function(){function u(){this.classNameMap={}}return u.getMap=function(){return u.instance==null&&(u.instance=new u),u.instance},u.register=function(a){u.getMap().classNameMap[a.className]=[a,a.fromConfig]},u}();function gi(u){D(u.className!=null,"Class being registered does not have the static className property defined."),D(typeof u.className=="string","className is required to be a string, but got type "+typeof u.className),D(u.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),Cw.register(u)}var iF=Object.freeze({Serializable:ww,SerializationMap:Cw,registerClass:gi}),sF={HAS_WEBGL:!0},uF={IS_NODE:!0},cF={IS_CHROME:!0},lF={IS_BROWSER:!0},dF={HAS_WEBGL:!1},fF={};function Sw(u,a,s){return s==null&&(s=Z.get("TEST_EPSILON")),_w(u,a,function(c,f){return Ew(c,Number(f),s)})}function _w(u,a,s){if(u instanceof At||a instanceof At){if(u instanceof At&&a instanceof At){if(u.dtype!==a.dtype)throw new Error("Arrays are of different type actual: "+u.dtype+" vs expected: "+a.dtype+".");if(!q(u.shape,a.shape))throw new Error("Arrays are of different shape actual: "+u.shape+" vs expected: "+a.shape+".")}}else{var c=u.constructor.name,f=a.constructor.name;if(c!==f)throw new Error("Arrays are of different type actual: "+c+" vs expected: "+f)}var m,v;if(m=u instanceof At?u.dataSync():u,v=a instanceof At?a.dataSync():a,m.length!==v.length)throw new Error("Arrays have different lengths actual: "+m.length+" vs expected: "+v.length+`.
Actual:   `+m+`.
Expected: `+v+".");for(var b=0;b<v.length;++b){var w=m[b],S=v[b];if(!s(w,S))throw new Error("Arrays differ: actual["+b+"] = "+w+", expected["+b+"] = "+S+`.
Actual:   `+m+`.
Expected: `+v+".")}}function pF(u,a){u().then(function(){return a.fail()},function(){return a()})}function hF(u,a){return u instanceof At&&u.dtype==="string"||a instanceof At&&a.dtype==="string"||u instanceof Array&&fe(u[0])||a instanceof Array&&fe(a[0])?_w(u,a,function(s,c){return s==c}):Sw(u,a,0)}function mF(u,a,s){if(s==null&&(s=Z.get("TEST_EPSILON")),!Ew(u,a,s))throw new Error("Numbers differ: actual === "+u+", expected === "+a)}function Ew(u,a,s){return!(!isNaN(u)||!isNaN(a))||!(isNaN(u)||isNaN(a)||Math.abs(u-a)>s)}function gF(u,a,s){var c;c=u instanceof At?u.dataSync():u;for(var f=0;f<c.length;f++)if(c[f]<a||c[f]>s)throw new Error("Value out of range:"+c[f]+" low: "+a+", high: "+s)}function vF(u,a){expect(new Float32Array(u)).toEqual(new Float32Array(a))}var yF=Object.freeze({WEBGL_ENVS:sF,NODE_ENVS:uF,CHROME_ENVS:cF,BROWSER_ENVS:lF,CPU_ENVS:dF,ALL_ENVS:fF,expectArraysClose:Sw,expectPromiseToFail:pF,expectArraysEqual:hF,expectNumbersClose:mF,expectValuesInRange:gF,expectArrayBuffersEqual:vF}),bF="0.14.2",xF=Object.freeze({gpgpu_util:qI,webgl_util:GI,MathBackendWebGL:s1,GPGPUContext:kb}),fs=function(u){function a(){return u!==null&&u.apply(this,arguments)||this}return o(a,u),a.prototype.minimize=function(s,c,f){c===void 0&&(c=!1);var m=this.computeGradients(s,f),v=m.value,b=m.grads;return this.applyGradients(b),Object.keys(b).forEach(function(w){return b[w].dispose()}),c?v:(v.dispose(),null)},a.prototype.computeGradients=function(s,c){return uy(s,c)},a}(ww),im=function(u){function a(s,c,f){f===void 0&&(f=null);var m=u.call(this)||this;return m.learningRate=s,m.rho=c,m.epsilon=f,m.accumulatedGrads={},m.accumulatedUpdates={},m.c=cn(Nt(-s)),m.rhoScalar=cn(Nt(c)),m.oneMinusRho=cn(Nt(1-c)),f===null&&(f=Z.get("EPSILON")),m.epsilonScalar=cn(Nt(f)),m}return o(a,u),a.prototype.applyGradients=function(s){var c=this,f=function(b){var w=Z.engine.registeredVariables[b];m.accumulatedGrads[b]==null&&te(function(){c.accumulatedGrads[b]=vn(w).variable(!1)}),m.accumulatedUpdates[b]==null&&te(function(){c.accumulatedUpdates[b]=vn(w).variable(!1)});var S=s[b],E=m.accumulatedGrads[b],R=m.accumulatedUpdates[b];te(function(){var T=c.rhoScalar.mul(E).add(c.oneMinusRho.mul(S.square())),P=R.add(c.epsilonScalar).sqrt().div(E.add(c.epsilonScalar).sqrt()).mul(S),O=c.rhoScalar.mul(R).add(c.oneMinusRho.mul(P.square()));c.accumulatedGrads[b].assign(T),c.accumulatedUpdates[b].assign(O);var $=c.c.mul(P).add(w);w.assign($)})},m=this;for(var v in s)f(v)},a.prototype.dispose=function(){var s=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),this.accumulatedUpdates!=null&&(Object.keys(this.accumulatedUpdates).forEach(function(c){return s.accumulatedUpdates[c].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(c){return s.accumulatedGrads[c].dispose()}))},a.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},a.fromConfig=function(s,c){return new s(c.learningRate,c.rho,c.epsilon)},a.className="AdadeltaOptimizer",a}(fs);gi(im);var sm=function(u){function a(s,c){c===void 0&&(c=.1);var f=u.call(this)||this;return f.learningRate=s,f.initialAccumulatorValue=c,f.accumulatedGrads={},f.c=cn(Nt(-s)),f.epsilon=cn(Nt(Z.get("EPSILON"))),f}return o(a,u),a.prototype.applyGradients=function(s){var c=this,f=function(b){var w=Z.engine.registeredVariables[b];m.accumulatedGrads[b]==null&&te(function(){c.accumulatedGrads[b]=Zo(w.shape,c.initialAccumulatorValue).variable(!1)});var S=s[b],E=m.accumulatedGrads[b];te(function(){var R=E.add(S.square());c.accumulatedGrads[b].assign(R);var T=c.c.mul(S.div(R.add(c.epsilon).sqrt())).add(w);w.assign(T)})},m=this;for(var v in s)f(v)},a.prototype.dispose=function(){var s=this;this.epsilon.dispose(),this.c.dispose(),this.accumulatedGrads!=null&&Object.keys(this.accumulatedGrads).forEach(function(c){return s.accumulatedGrads[c].dispose()})},a.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},a.fromConfig=function(s,c){return new s(c.learningRate,c.initialAccumulatorValue)},a.className="AdagradOptimizer",a}(fs);gi(sm);var um=function(u){function a(s,c,f,m){m===void 0&&(m=null);var v=u.call(this)||this;return v.learningRate=s,v.beta1=c,v.beta2=f,v.epsilon=m,v.accumulatedFirstMoment={},v.accumulatedSecondMoment={},v.c=cn(Nt(-s)),v.beta1Scalar=cn(Nt(c)),v.beta2Scalar=cn(Nt(f)),te(function(){v.accBeta1=Nt(c).variable(),v.accBeta2=Nt(f).variable()}),v.oneMinusBeta1=cn(Nt(1-c)),v.oneMinusBeta2=cn(Nt(1-f)),v.one=cn(Nt(1)),m===null&&(m=Z.get("EPSILON")),v.epsScalar=cn(Nt(m)),v}return o(a,u),a.prototype.applyGradients=function(s){var c=this;te(function(){var f=c.one.sub(c.accBeta1),m=c.one.sub(c.accBeta2);for(var v in s){var b=Z.engine.registeredVariables[v];if(c.accumulatedFirstMoment[v]==null){var w=!1;c.accumulatedFirstMoment[v]=vn(b).variable(w)}c.accumulatedSecondMoment[v]==null&&(w=!1,c.accumulatedSecondMoment[v]=vn(b).variable(w));var S=s[v],E=c.accumulatedFirstMoment[v],R=c.accumulatedSecondMoment[v],T=c.beta1Scalar.mul(E).add(c.oneMinusBeta1.mul(S)),P=c.beta2Scalar.mul(R).add(c.oneMinusBeta2.mul(S.square())),O=T.div(f),$=P.div(m);c.accumulatedFirstMoment[v].assign(T),c.accumulatedSecondMoment[v].assign(P);var B=c.c.mul(O.div(c.epsScalar.add($.sqrt()))).add(b);b.assign(B)}c.accBeta1.assign(c.accBeta1.mul(c.beta1Scalar)),c.accBeta2.assign(c.accBeta2.mul(c.beta2Scalar))})},a.prototype.dispose=function(){var s=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(c){return s.accumulatedFirstMoment[c].dispose()}),this.accumulatedSecondMoment!=null&&Object.keys(this.accumulatedSecondMoment).forEach(function(c){return s.accumulatedSecondMoment[c].dispose()})},a.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},a.fromConfig=function(s,c){return new s(c.learningRate,c.beta1,c.beta2,c.epsilon)},a.className="AdamOptimizer",a}(fs);gi(um);var cm=function(u){function a(s,c,f,m,v){m===void 0&&(m=null),v===void 0&&(v=0);var b=u.call(this)||this;return b.learningRate=s,b.beta1=c,b.beta2=f,b.epsilon=m,b.decay=v,b.accumulatedFirstMoment={},b.accumulatedWeightedInfNorm={},b.c=cn(Nt(-s)),b.beta1Scalar=cn(Nt(c)),b.beta2Scalar=cn(Nt(f)),b.decayScalar=cn(Nt(v)),te(function(){b.iteration=Nt(0).variable(),b.accBeta1=Nt(c).variable()}),b.oneMinusBeta1=cn(Nt(1-c)),b.one=cn(Nt(1)),m===null&&(m=Z.get("EPSILON")),b.epsScalar=cn(Nt(m)),b}return o(a,u),a.prototype.applyGradients=function(s){var c=this;te(function(){var f=c.one.sub(c.accBeta1),m=c.c.div(c.one.add(c.decayScalar.mul(c.iteration)));for(var v in s){var b=Z.engine.registeredVariables[v];if(c.accumulatedFirstMoment[v]==null){var w=!1;c.accumulatedFirstMoment[v]=vn(b).variable(w)}c.accumulatedWeightedInfNorm[v]==null&&(w=!1,c.accumulatedWeightedInfNorm[v]=vn(b).variable(w));var S=s[v],E=c.accumulatedFirstMoment[v],R=c.accumulatedWeightedInfNorm[v],T=c.beta1Scalar.mul(E).add(c.oneMinusBeta1.mul(S)),P=c.beta2Scalar.mul(R),O=S.abs(),$=P.maximum(O);c.accumulatedFirstMoment[v].assign(T),c.accumulatedWeightedInfNorm[v].assign($);var B=m.div(f).mul(T.div(c.epsScalar.add($))).add(b);b.assign(B)}c.iteration.assign(c.iteration.add(c.one)),c.accBeta1.assign(c.accBeta1.mul(c.beta1Scalar))})},a.prototype.dispose=function(){var s=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),this.accumulatedFirstMoment!=null&&Object.keys(this.accumulatedFirstMoment).forEach(function(c){return s.accumulatedFirstMoment[c].dispose()}),this.accumulatedWeightedInfNorm!=null&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(c){return s.accumulatedWeightedInfNorm[c].dispose()})},a.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},a.fromConfig=function(s,c){return new s(c.learningRate,c.beta1,c.beta2,c.epsilon,c.decay)},a.className="AdamaxOptimizer",a}(fs);gi(cm);var Qd=function(u){function a(s){var c=u.call(this)||this;return c.learningRate=s,c.setLearningRate(s),c}return o(a,u),a.prototype.applyGradients=function(s){var c=this;Object.keys(s).forEach(function(f){var m=s[f],v=Z.engine.registeredVariables[f];te(function(){var b=c.c.mul(m).add(v);v.assign(b)})})},a.prototype.setLearningRate=function(s){this.learningRate=s,this.c!=null&&this.c.dispose(),this.c=cn(Nt(-s))},a.prototype.dispose=function(){this.c.dispose()},a.prototype.getConfig=function(){return{learningRate:this.learningRate}},a.fromConfig=function(s,c){return new s(c.learningRate)},a.className="SGDOptimizer",a}(fs);gi(Qd);var lm=function(u){function a(s,c,f){f===void 0&&(f=!1);var m=u.call(this,s)||this;return m.learningRate=s,m.momentum=c,m.useNesterov=f,m.m=Nt(m.momentum),m.accumulations={},m}return o(a,u),a.prototype.applyGradients=function(s){var c=this,f=function(b){var w=Z.engine.registeredVariables[b];m.accumulations[b]==null&&te(function(){c.accumulations[b]=vn(w).variable(!1)});var S=m.accumulations[b],E=s[b];te(function(){var R,T=c.m.mul(S).add(E);R=c.useNesterov?c.c.mul(E.add(T.mul(c.m))).add(w):c.c.mul(T).add(w),c.accumulations[b].assign(T),w.assign(R)})},m=this;for(var v in s)f(v)},a.prototype.dispose=function(){if(u.prototype.dispose.call(this),this.m.dispose(),this.accumulations!=null)for(var s in this.accumulations)this.accumulations[s].dispose()},a.prototype.setMomentum=function(s){this.momentum=s},a.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},a.fromConfig=function(s,c){return new s(c.learningRate,c.momentum,c.useNesterov)},a.className="MomentumOptimizer",a}(Qd);gi(lm);var dm=function(u){function a(s,c,f,m,v){c===void 0&&(c=.9),f===void 0&&(f=0),m===void 0&&(m=null),v===void 0&&(v=!1);var b=u.call(this)||this;return b.learningRate=s,b.decay=c,b.momentum=f,b.epsilon=m,b.accumulatedMeanSquares={},b.accumulatedMeanGrads={},b.accumulatedMoments={},b.c=cn(Nt(s)),b.decayScalar=cn(Nt(c)),b.momentumScalar=cn(Nt(f)),b.oneMinusDecay=cn(Nt(1-c)),b.centered=v,m===null&&(m=Z.get("EPSILON")),b.epsilonScalar=cn(Nt(m)),b}return o(a,u),a.prototype.applyGradients=function(s){var c=this,f=function(b){var w=Z.engine.registeredVariables[b];m.accumulatedMeanSquares[b]==null&&te(function(){c.accumulatedMeanSquares[b]=vn(w).variable(!1)}),m.accumulatedMeanGrads[b]==null&&m.centered&&te(function(){c.accumulatedMeanGrads[b]=vn(w).variable(!1)}),m.accumulatedMoments[b]==null&&te(function(){c.accumulatedMoments[b]=vn(w).variable(!1)});var S=m.accumulatedMeanSquares[b],E=m.accumulatedMeanGrads[b],R=m.accumulatedMoments[b],T=s[b];te(function(){var P=c.decayScalar.mul(S).add(c.oneMinusDecay.mul(T.square()));if(c.centered){var O=c.decayScalar.mul(E).add(c.oneMinusDecay.mul(T)),$=c.momentumScalar.mul(R).add(c.c.mul(T).div(P.sub(O.square().add(c.epsilonScalar)).sqrt()));c.accumulatedMeanSquares[b].assign(P),c.accumulatedMeanGrads[b].assign(O),c.accumulatedMoments[b].assign($);var B=w.sub($);w.assign(B)}else{var U=c.decayScalar.mul(S).add(c.oneMinusDecay.mul(T.square()));$=c.momentumScalar.mul(R).add(c.c.mul(T).div(U.add(c.epsilonScalar).sqrt())),c.accumulatedMeanSquares[b].assign(U),c.accumulatedMoments[b].assign($),B=w.sub($),w.assign(B)}})},m=this;for(var v in s)f(v)},a.prototype.dispose=function(){var s=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),this.accumulatedMeanSquares!=null&&Object.keys(this.accumulatedMeanSquares).forEach(function(c){return s.accumulatedMeanSquares[c].dispose()}),this.accumulatedMeanGrads!=null&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(c){return s.accumulatedMeanGrads[c].dispose()}),this.accumulatedMoments!=null&&Object.keys(this.accumulatedMoments).forEach(function(c){return s.accumulatedMoments[c].dispose()})},a.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},a.fromConfig=function(s,c){return new s(c.learningRate,c.decay,c.momentum,c.epsilon,c.centered)},a.className="RMSPropOptimizer",a}(fs);gi(dm);var ps=function(){function u(){}return u.sgd=function(a){return new Qd(a)},u.momentum=function(a,s,c){return c===void 0&&(c=!1),new lm(a,s,c)},u.rmsprop=function(a,s,c,f,m){return s===void 0&&(s=.9),c===void 0&&(c=0),f===void 0&&(f=null),m===void 0&&(m=!1),new dm(a,s,c,f,m)},u.adam=function(a,s,c,f){return a===void 0&&(a=.001),s===void 0&&(s=.9),c===void 0&&(c=.999),f===void 0&&(f=null),new um(a,s,c,f)},u.adadelta=function(a,s,c){return a===void 0&&(a=.001),s===void 0&&(s=.95),c===void 0&&(c=null),new im(a,s,c)},u.adamax=function(a,s,c,f,m){return a===void 0&&(a=.002),s===void 0&&(s=.9),c===void 0&&(c=.999),f===void 0&&(f=null),m===void 0&&(m=0),new cm(a,s,c,f,m)},u.adagrad=function(a,s){return s===void 0&&(s=.1),new sm(a,s)},u}(),wF={sgd:ps.sgd,momentum:ps.momentum,adadelta:ps.adadelta,adagrad:ps.adagrad,rmsprop:ps.rmsprop,adamax:ps.adamax,adam:ps.adam},CF=mo.setBackend,SF=mo.getBackend,_F=mo.disposeVariables,EF=mo.memory;rs(yO);var kF=Object.freeze({setBackend:CF,getBackend:SF,disposeVariables:_F,memory:EF,version_core:bF,nextFrame:wO,environment:RD,io:am,math:aF,serialization:iF,test_util:yF,util:$t,webgl:xF,AdadeltaOptimizer:im,AdagradOptimizer:sm,AdamOptimizer:um,AdamaxOptimizer:cm,MomentumOptimizer:lm,Optimizer:fs,RMSPropOptimizer:dm,SGDOptimizer:Qd,Tensor:At,TensorBuffer:Wn,variable:aD,Variable:Pn,get Rank(){return Hr},get Reduction(){return ir},ENV:Z,Environment:mo,KernelBackend:YD,DataStorage:vh,image:Xd,linalg:aw,losses:rw,spectral:tw,op:st,batchNormalization2d:F1,batchNormalization3d:$1,batchNormalization4d:B1,batchNormalization:xu,complex:Fr,real:Jo,imag:ci,concat:or,concat1d:Wb,concat2d:Ub,concat3d:zb,concat4d:Vb,split:Md,conv1d:G1,conv2d:Bo,conv3d:q1,conv2dDerFilter:Lh,depthwiseConv2d:zd,separableConv2d:Vd,conv2dTranspose:j1,matMul:Lc,dot:U1,outerProduct:z1,reverse:Cu,reverse1d:K1,reverse2d:X1,reverse3d:Y1,reverse4d:Q1,maxPool:Xn,avgPool:Wc,pool:tx,slice:fi,slice1d:ex,slice2d:nx,slice3d:Wh,slice4d:rx,abs:c1,acos:l1,acosh:d1,asin:f1,asinh:p1,atan:h1,atanh:m1,ceil:g1,clipByValue:$d,cos:v1,cosh:y1,erf:b1,exp:Bd,expm1:x1,floor:w1,log:C1,log1p:S1,logSigmoid:_1,neg:Fc,reciprocal:E1,round:k1,rsqrt:Oh,sigmoid:Fh,sign:R1,sin:T1,sinh:D1,softplus:A1,sqrt:I1,square:N1,step:P1,tan:M1,tanh:O1,all:ax,any:ix,argMax:sx,argMin:ux,logSumExp:cx,max:Uc,mean:lx,min:dx,moments:fx,sum:Uh,prod:px,equal:zh,equalStrict:hx,greater:mx,greaterEqual:Vh,greaterEqualStrict:gx,greaterStrict:vx,less:yx,lessEqual:bx,lessEqualStrict:xx,lessStrict:wx,notEqual:Cx,notEqualStrict:Sx,add:Ue,addN:_x,addStrict:Ex,atan2:kx,div:ea,divStrict:Rx,floorDiv:Hh,maximum:zc,maximumStrict:Tx,minimum:Hd,minimumStrict:Dx,mod:Ax,modStrict:Ix,mul:xo,mulStrict:Nx,pow:Gh,powStrict:Px,squaredDifference:Mx,squaredDifferenceStrict:Ox,sub:jr,subStrict:Fx,elu:Wx,leakyRelu:Ux,prelu:zx,relu:xr,selu:Vx,logicalAnd:Gd,logicalNot:$x,logicalOr:qh,logicalXor:Bx,where:qd,whereAsync:Lx,buffer:Ae,toPixels:Dh,print:qb,batchToSpaceND:Ah,cast:jb,clone:Kb,cumsum:Xb,depthToSpace:Yb,expandDims:ao,eye:Ih,fromPixels:Od,multinomial:Qb,oneHot:Fd,pad:li,pad1d:Jb,pad2d:Zb,pad3d:t1,pad4d:e1,rand:n1,randomNormal:r1,randomUniform:o1,reshape:yo,spaceToBatchND:Nh,squeeze:Ph,stack:bo,tile:ls,truncatedNormal:a1,unstack:ar,setdiff1dAsync:i1,fill:Zo,linspace:Cy,ones:Aa,range:gh,scalar:Nt,tensor:kn,tensor1d:Un,tensor2d:pu,tensor3d:Dd,tensor4d:nr,tensor5d:xy,tensor6d:wy,zeros:Rn,onesLike:Sy,zerosLike:vn,transpose:Na,softmax:Da,logSoftmax:by,localResponseNormalization:Hx,norm:jh,gather:Kh,unsortedSegmentSum:jd,basicLSTMCell:Kx,multiRNNCell:Xx,movingAverage:Yx,stridedSlice:Qx,topk:Jx,scatterND:Zx,fft:Kd,ifft:Vc,rfft:Xh,irfft:Yh,sparseToDense:ew,gatherND:nw,train:wF,tidy:te,keep:cn,dispose:cy,time:ND,profile:PD,customGrad:fu,grad:TD,grads:DD,valueAndGrad:AD,valueAndGrads:ID,variableGrads:uy});function wo(u,a,s,c){return s===void 0&&(s="same"),c===void 0&&(c=!1),te(function(){var f=Ue(Bo(u,a.filters,[1,1],s),a.bias);return c?xr(f):f})}function vi(u,a){Object.keys(u).forEach(function(s){a.some(function(c){return c.originalPath===s})||u[s].dispose()})}function Jd(u,a){return function(s,c,f,m){var v=nr(u(s*c*f*f),[f,f,s,c]),b=Un(u(c));return a.push({paramPath:m+"/filters"},{paramPath:m+"/bias"}),{filters:v,bias:b}}}function fm(u,a){return function(s,c,f){var m=pu(u(s*c),[s,c]),v=Un(u(c));return a.push({paramPath:f+"/weights"},{paramPath:f+"/bias"}),{weights:m,bias:v}}}var qc=function(){function u(a,s,c){this.depthwise_filter=a,this.pointwise_filter=s,this.bias=c}return u}();function kw(u,a){return function(s,c,f){var m=nr(u(9*s),[3,3,s,1]),v=nr(u(s*c),[1,1,s,c]),b=Un(u(c));return a.push({paramPath:f+"/depthwise_filter"},{paramPath:f+"/pointwise_filter"},{paramPath:f+"/bias"}),new qc(m,v,b)}}function Rw(u){return function(a){var s=u(a+"/depthwise_filter",4),c=u(a+"/pointwise_filter",4),f=u(a+"/bias",1);return new qc(s,c,f)}}var hs=function(){function u(a,s){if(!yi(a)||!yi(s))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:a,height:s}));this._width=a,this._height=s}return Object.defineProperty(u.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),u.prototype.reverse=function(){return new u(1/this.width,1/this.height)},u}(),tn=function(){function u(a,s){this._x=a,this._y=s}return Object.defineProperty(u.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),u.prototype.add=function(a){return new u(this.x+a.x,this.y+a.y)},u.prototype.sub=function(a){return new u(this.x-a.x,this.y-a.y)},u.prototype.mul=function(a){return new u(this.x*a.x,this.y*a.y)},u.prototype.div=function(a){return new u(this.x/a.x,this.y/a.y)},u.prototype.abs=function(){return new u(Math.abs(this.x),Math.abs(this.y))},u.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},u.prototype.floor=function(){return new u(Math.floor(this.x),Math.floor(this.y))},u}();function ku(u,a){return u instanceof At&&u.shape.length===a}function RF(u){return ku(u,1)}function Tw(u){return ku(u,2)}function jc(u){return ku(u,3)}function Ma(u){return ku(u,4)}function Dw(u){return u%1!==0}function pm(u){return u%2===0}function Kc(u,a){a===void 0&&(a=2);var s=Math.pow(10,a);return Math.floor(u*s)/s}function hm(u){return u&&u.width&&u.height}function Aw(u,a){var s=u.width,c=u.height,f=a/Math.max(c,s);return new hs(Math.round(s*f),Math.round(c*f))}function Zd(u){return u.reduce(function(a,s){return a.add(s)},new tn(0,0)).div(new tn(u.length,u.length))}function mm(u,a,s){return Array(u).fill(0).map(function(c,f){return a+f*s})}function yi(u){return!!u&&u!==1/0&&u!==-1/0&&!isNaN(u)||u===0}function gm(u){return yi(u)&&0<=u&&u<=1}function ms(u,a){return function(s,c,f){var m=u[s];if(!ku(m,c))throw new Error("expected weightMap["+s+"] to be a Tensor"+c+"D, instead have "+m);return a.push({originalPath:s,paramPath:f||s}),m}}function bi(u){var a=u;function s(f){var m=a.slice(0,f);return a=a.slice(f),m}function c(){return a}return{extractWeights:s,getRemainingWeights:c}}function vm(u,a){var s=a+"-weights_manifest.json";if(!u)return{modelBaseUri:"",manifestUri:s};if(u==="/")return{modelBaseUri:"/",manifestUri:"/"+s};var c=u.startsWith("http://")?"http://":u.startsWith("https://")?"https://":"";u=u.replace(c,"");var f=u.split("/").filter(function(b){return b}),m=u.endsWith(".json")?f[f.length-1]:s,v=c+(u.endsWith(".json")?f.slice(0,f.length-1):f).join("/");return v=u.startsWith("/")?"/"+v:v,{modelBaseUri:v,manifestUri:v==="/"?"/"+m:v+"/"+m}}/*! *****************************************************************************
		    Copyright (c) Microsoft Corporation. All rights reserved.
		    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
		    this file except in compliance with the License. You may obtain a copy of the
		    License at http://www.apache.org/licenses/LICENSE-2.0

		    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
		    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
		    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
		    MERCHANTABLITY OR NON-INFRINGEMENT.

		    See the Apache Version 2.0 License for specific language governing permissions
		    and limitations under the License.
		    ***************************************************************************** */var ym=function(u,a){return ym=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var f in c)c.hasOwnProperty(f)&&(s[f]=c[f])},ym(u,a)};function Ie(u,a){ym(u,a);function s(){this.constructor=u}u.prototype=a===null?Object.create(a):(s.prototype=a.prototype,new s)}var na=function(){return na=Object.assign||function(a){for(var s,c=1,f=arguments.length;c<f;c++){s=arguments[c];for(var m in s)Object.prototype.hasOwnProperty.call(s,m)&&(a[m]=s[m])}return a},na.apply(this,arguments)};function me(u,a,s,c){return new(s||(s=Promise))(function(f,m){function v(S){try{w(c.next(S))}catch(E){m(E)}}function b(S){try{w(c.throw(S))}catch(E){m(E)}}function w(S){S.done?f(S.value):new s(function(E){E(S.value)}).then(v,b)}w((c=c.apply(u,[])).next())})}function ge(u,a){var s={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},c,f,m,v;return v={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function b(S){return function(E){return w([S,E])}}function w(S){if(c)throw new TypeError("Generator is already executing.");for(;s;)try{if(c=1,f&&(m=S[0]&2?f.return:S[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,S[1])).done)return m;switch(f=0,m&&(S=[S[0]&2,m.value]),S[0]){case 0:case 1:m=S;break;case 4:return s.label++,{value:S[1],done:!1};case 5:s.label++,f=S[1],S=[0];continue;case 7:S=s.ops.pop(),s.trys.pop();continue;default:if(m=s.trys,!(m=m.length>0&&m[m.length-1])&&(S[0]===6||S[0]===2)){s=0;continue}if(S[0]===3&&(!m||S[1]>m[0]&&S[1]<m[3])){s.label=S[1];break}if(S[0]===6&&s.label<m[1]){s.label=m[1],m=S;break}if(m&&s.label<m[2]){s.label=m[2],s.ops.push(S);break}m[2]&&s.ops.pop(),s.trys.pop();continue}S=a.call(u,s)}catch(E){S=[6,E],f=0}finally{c=m=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}var Oa=function(){function u(a,s){s===void 0&&(s=!1);var c=a||{},f=[c.left,c.top,c.right,c.bottom].every(yi),m=[c.x,c.y,c.width,c.height].every(yi);if(!m&&!f)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(c));var v=m?[c.x,c.y,c.width,c.height]:[c.left,c.top,c.right-c.left,c.bottom-c.top],b=v[0],w=v[1],S=v[2],E=v[3];u.assertIsValidBox({x:b,y:w,width:S,height:E},"Box.constructor",s),this._x=b,this._y=w,this._width=S,this._height=E}return u.isRect=function(a){return!!a&&[a.x,a.y,a.width,a.height].every(yi)},u.assertIsValidBox=function(a,s,c){if(c===void 0&&(c=!1),!u.isRect(a))throw new Error(s+" - invalid box: "+JSON.stringify(a)+", expected object with properties x, y, width, height");if(!c&&(a.width<0||a.height<0))throw new Error(s+" - width ("+a.width+") and height ("+a.height+") must be positive numbers")},Object.defineProperty(u.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),u.prototype.round=function(){var a=[this.x,this.y,this.width,this.height].map(function(v){return Math.round(v)}),s=a[0],c=a[1],f=a[2],m=a[3];return new u({x:s,y:c,width:f,height:m})},u.prototype.floor=function(){var a=[this.x,this.y,this.width,this.height].map(function(v){return Math.floor(v)}),s=a[0],c=a[1],f=a[2],m=a[3];return new u({x:s,y:c,width:f,height:m})},u.prototype.toSquare=function(){var a=this,s=a.x,c=a.y,f=a.width,m=a.height,v=Math.abs(f-m);return f<m&&(s-=v/2,f+=v),m<f&&(c-=v/2,m+=v),new u({x:s,y:c,width:f,height:m})},u.prototype.rescale=function(a){var s=hm(a)?a.width:a,c=hm(a)?a.height:a;return new u({x:this.x*s,y:this.y*c,width:this.width*s,height:this.height*c})},u.prototype.pad=function(a,s){var c=[this.x-a/2,this.y-s/2,this.width+a,this.height+s],f=c[0],m=c[1],v=c[2],b=c[3];return new u({x:f,y:m,width:v,height:b})},u.prototype.clipAtImageBorders=function(a,s){var c=this,f=c.x,m=c.y,v=c.right,b=c.bottom,w=Math.max(f,0),S=Math.max(m,0),E=v-w,R=b-S,T=Math.min(E,a-w),P=Math.min(R,s-S);return new u({x:w,y:S,width:T,height:P}).floor()},u.prototype.shift=function(a,s){var c=this,f=c.width,m=c.height,v=this.x+a,b=this.y+s;return new u({x:v,y:b,width:f,height:m})},u.prototype.padAtBorders=function(a,s){var c=this.width+1,f=this.height+1,m=1,v=1,b=c,w=f,S=this.left,E=this.top,R=this.right,T=this.bottom;return R>s&&(b=-R+s+c,R=s),T>a&&(w=-T+a+f,T=a),S<1&&(w=2-S,S=1),E<1&&(w=2-E,E=1),{dy:v,edy:w,dx:m,edx:b,y:E,ey:T,x:S,ex:R,w:c,h:f}},u.prototype.calibrate=function(a){return new u({left:this.left+a.left*this.width,top:this.top+a.top*this.height,right:this.right+a.right*this.width,bottom:this.bottom+a.bottom*this.height}).toSquare().round()},u}(),tf=function(u){Ie(a,u);function a(s,c,f,m){return u.call(this,{left:s,top:c,right:f,bottom:m})||this}return a}(Oa),Xc=function(){function u(a,s,c,f,m){this._imageDims=new hs(m.width,m.height),this._score=a,this._classScore=s,this._className=c,this._box=new Oa(f).rescale(this._imageDims)}return Object.defineProperty(u.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"relativeBox",{get:function(){return new Oa(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),u.prototype.forSize=function(a,s){return new u(this.score,this.classScore,this.className,this.relativeBox,{width:a,height:s})},u}();function Iw(){var u=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},a=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:u,readFile:a}}function Nw(u){var a="";if(!u)try{u=KS}catch(c){a=c.toString()}var s=u?function(c){return new Promise(function(f,m){u.readFile(c,function(v,b){return v?m(v):f(b)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+a)};return{readFile:s}}function Pw(){var u=Ti.Canvas||Ti.HTMLCanvasElement,a=Ti.Image||Ti.HTMLImageElement,s=function(){if(u)return new u;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},c=function(){if(a)return new a;throw new Error("createImageElement - missing Image implementation for nodejs environment")},f=Ti.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},m=Nw();return na({Canvas:u||function(){function v(){}return v}(),Image:a||function(){function v(){}return v}(),ImageData:Ti.ImageData||function(){function v(){}return v}(),Video:Ti.HTMLVideoElement||function(){function v(){}return v}(),createCanvasElement:s,createImageElement:c,fetch:f},m)}function Mw(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"}function Ow(){return typeof Ti=="object"&&typeof mlt=="function"&&!0&&typeof process<"u"&&!!process.version}var Gn;function TF(){if(!Gn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Gn}function bm(u){Gn=u}function xm(){Mw()&&bm(Iw()),Ow()&&bm(Pw())}function DF(u){if(Gn||xm(),!Gn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var a=u.Canvas,s=a===void 0?Gn.Canvas:a,c=u.Image,f=c===void 0?Gn.Image:c;Gn.Canvas=s,Gn.Image=f,Gn.createCanvasElement=u.createCanvasElement||function(){return new s},Gn.createImageElement=u.createImageElement||function(){return new f},Gn.ImageData=u.ImageData||Gn.ImageData,Gn.Video=u.Video||Gn.Video,Gn.fetch=u.fetch||Gn.fetch,Gn.readFile=u.readFile||Gn.readFile}var zn={getEnv:TF,setEnv:bm,initialize:xm,createBrowserEnv:Iw,createFileSystem:Nw,createNodejsEnv:Pw,monkeyPatch:DF,isBrowser:Mw,isNodejs:Ow};xm();function wm(u){var a=zn.getEnv(),s=a.Image,c=a.Video;return u instanceof s&&u.complete||u instanceof c&&u.readyState>=3}function Fw(u){return new Promise(function(a,s){if(u instanceof zn.getEnv().Canvas||wm(u))return a();function c(m){m.currentTarget&&(m.currentTarget.removeEventListener("load",c),m.currentTarget.removeEventListener("error",f),a(m))}function f(m){m.currentTarget&&(m.currentTarget.removeEventListener("load",c),m.currentTarget.removeEventListener("error",f),s(m))}u.addEventListener("load",c),u.addEventListener("error",f)})}function $w(u){return new Promise(function(a,s){if(!(u instanceof Blob))return s("bufferToImage - expected buf to be of type: Blob");var c=new FileReader;c.onload=function(){if(typeof c.result!="string")return s("bufferToImage - expected reader.result to be a string, in onload");var f=zn.getEnv().createImageElement();f.onload=function(){return a(f)},f.onerror=s,f.src=c.result},c.onerror=s,c.readAsDataURL(u)})}function Lo(u){var a=u.getContext("2d");if(!a)throw new Error("canvas 2d context is null");return a}function Cm(u){var a=zn.getEnv(),s=a.Image,c=a.Video;return u instanceof s?new hs(u.naturalWidth,u.naturalHeight):u instanceof c?new hs(u.videoWidth,u.videoHeight):new hs(u.width,u.height)}function Yc(u){var a=u.width,s=u.height,c=zn.getEnv().createCanvasElement,f=c();return f.width=a,f.height=s,f}function ef(u,a){var s=zn.getEnv().ImageData;if(!(u instanceof s)&&!wm(u))throw new Error("createCanvasFromMedia - media has not finished loading yet");var c=a||Cm(u),f=c.width,m=c.height,v=Yc({width:f,height:m});return u instanceof s?Lo(v).putImageData(u,0,0):Lo(v).drawImage(u,0,0,f,m),v}function Ru(u){return u===void 0&&(u={}),Object.assign({},{boxColor:"blue",textColor:"red",lineWidth:2,fontSize:20,fontStyle:"Georgia",withScore:!0,withClassName:!0},u)}function Bw(u,a,s,c,f,m){var v=Object.assign(Ru(),m||{});u.strokeStyle=v.boxColor,u.lineWidth=v.lineWidth,u.strokeRect(a,s,c,f)}var Lw=function(u){Ie(a,u);function a(s,c){var f=u.call(this,s)||this;return f._text=c,f}return Object.defineProperty(a.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),a}(Oa),Sm=function(u){Ie(a,u);function a(s,c){var f=u.call(this,s)||this;return f._label=c,f}return a.assertIsValidLabeledBox=function(s,c){if(Oa.assertIsValidBox(s,c),!yi(s.label))throw new Error(c+" - expected property label ("+s.label+") to be a number")},Object.defineProperty(a.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),a}(Oa),Ww=function(u){Ie(a,u);function a(s,c,f,m){var v=u.call(this,s,c)||this;return v._score=f,v._classScore=m,v}return a.assertIsValidPredictedBox=function(s,c){if(Sm.assertIsValidLabeledBox(s,c),!gm(s.score)||!gm(s.classScore))throw new Error(c+" - expected properties score ("+s.score+") and ("+s.classScore+") to be a number between [0, 1]")},Object.defineProperty(a.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),a}(Sm);function _m(u,a,s,c,f){f===void 0&&(f={});var m=Object.assign(Ru(),f),v=2+m.lineWidth;u.fillStyle=m.textColor,u.font=m.fontSize+"px "+m.fontStyle,u.fillText(c,a+v,s+v+m.fontSize*.6)}function Qc(u){return!zn.isNodejs()&&typeof u=="string"?document.getElementById(u):u}function AF(u,a,s){var c=zn.getEnv().Canvas,f=Qc(u);if(!(f instanceof c))throw new Error("drawDetection - expected canvas to be of type: HTMLCanvasElement");var m=Array.isArray(a)?a:[a];m.forEach(function(v){var b=v instanceof Xc?v.box:v,w=b.x,S=b.y,E=b.width,R=b.height,T=Ru(s),P=Lo(f);Bw(P,w,S,E,R,T);var O=T.withScore,$=v instanceof Lw?v.text:O&&v instanceof Ww?""+Kc(v.score):v instanceof Xc?""+v.className+(O?" ("+Kc(v.score)+")":""):"";$&&_m(P,w,S+R,$,T)})}function nf(u,a){return me(this,void 0,void 0,function(){var s,c;return ge(this,function(f){switch(f.label){case 0:return s=zn.getEnv().fetch,[4,s(u,a)];case 1:if(c=f.sent(),!(c.status<400))throw new Error("failed to fetch: ("+c.status+") "+c.statusText+", from url: "+c.url);return[2,c]}})})}function IF(u){return me(this,void 0,void 0,function(){var a,s;return ge(this,function(c){switch(c.label){case 0:return[4,nf(u)];case 1:return a=c.sent(),[4,a.blob()];case 2:if(s=c.sent(),!s.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+s.type+", for url: "+a.url);return[2,$w(s)]}})})}function Uw(u){return me(this,void 0,void 0,function(){return ge(this,function(a){switch(a.label){case 0:return[4,nf(u)];case 1:return[2,a.sent().json()]}})})}function NF(u){return me(this,void 0,void 0,function(){var a;return ge(this,function(s){switch(s.label){case 0:return a=Float32Array.bind,[4,nf(u)];case 1:return[4,s.sent().arrayBuffer()];case 2:return[2,new(a.apply(Float32Array,[void 0,s.sent()]))]}})})}function zw(u,a){return me(this,void 0,void 0,function(){var s,c,f,m,v,b;return ge(this,function(w){switch(w.label){case 0:return s=a||zn.getEnv().createCanvasElement(),c=u.shape.slice(Ma(u)?1:0),f=c[0],m=c[1],v=c[2],b=te(function(){return u.as3D(f,m,v).toInt()}),[4,Dh(b,s)];case 1:return w.sent(),b.dispose(),[2,s]}})})}function Vw(u,a,s){s===void 0&&(s=!1);var c=zn.getEnv(),f=c.Image,m=c.Canvas;if(!(u instanceof f||u instanceof m))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var v=Cm(u),b=a/Math.max(v.height,v.width),w=b*v.width,S=b*v.height,E=Yc({width:a,height:a}),R=u instanceof m?u:ef(u),T=Math.abs(w-S)/2,P=s&&w<S?T:0,O=s&&S<w?T:0;return Lo(E).drawImage(R,P,O,w,S),E}function Em(u){var a=zn.getEnv(),s=a.Image,c=a.Canvas,f=a.Video;return u instanceof s||u instanceof c||u instanceof f}function Hw(u,a){return me(this,void 0,void 0,function(){var s,c,f,m;return ge(this,function(v){switch(v.label){case 0:return s=vm(u,a),c=s.manifestUri,f=s.modelBaseUri,[4,Uw(c)];case 1:return m=v.sent(),[2,am.loadWeights(m,f)]}})})}function Gw(u,a){return a===void 0&&(a=!1),te(function(){var s=u.shape.slice(1),c=s[0],f=s[1];if(c===f)return u;var m=Math.abs(c-f),v=Math.round(m*(a?.5:1)),b=c>f?2:1,w=function(P){var O=u.shape.slice();return O[b]=P,Zo(O,0)},S=w(v),E=m-S.shape[b],R=a&&E?w(E):null,T=[R,u,S].filter(function(P){return!!P}).map(function(P){return P.toFloat()});return or(T,b)})}var rf=function(){function u(a,s){s===void 0&&(s=!1);var c=this;if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(a))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+a);this._treatAsBatchInput=s,this._batchSize=a.length,a.forEach(function(f,m){if(jc(f)){c._imageTensors[m]=f,c._inputDimensions[m]=f.shape;return}if(Ma(f)){var v=f.shape[0];if(v!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+v+" passed, but not supported in input array");c._imageTensors[m]=f,c._inputDimensions[m]=f.shape.slice(1);return}var b=f instanceof zn.getEnv().Canvas?f:ef(f);c._canvases[m]=b,c._inputDimensions[m]=[b.height,b.width,3]})}return Object.defineProperty(u.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"reshapedInputDimensions",{get:function(){var a=this;return mm(this.batchSize,0,1).map(function(s,c){return a.getReshapedInputDimensions(c)})},enumerable:!0,configurable:!0}),u.prototype.getInput=function(a){return this.canvases[a]||this.imageTensors[a]},u.prototype.getInputDimensions=function(a){return this._inputDimensions[a]},u.prototype.getInputHeight=function(a){return this._inputDimensions[a][0]},u.prototype.getInputWidth=function(a){return this._inputDimensions[a][1]},u.prototype.getReshapedInputDimensions=function(a){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var s=this.getInputWidth(a),c=this.getInputHeight(a);return Aw({width:s,height:c},this.inputSize)},u.prototype.toBatchTensor=function(a,s){var c=this;return s===void 0&&(s=!0),this._inputSize=a,te(function(){var f=mm(c.batchSize,0,1).map(function(v){var b=c.getInput(v);if(b instanceof At){var w=Ma(b)?b:b.expandDims();return w=Gw(w,s),(w.shape[1]!==a||w.shape[2]!==a)&&(w=Xd.resizeBilinear(w,[a,a])),w.as3D(a,a,3)}if(b instanceof zn.getEnv().Canvas)return Od(Vw(b,a,s));throw new Error("toBatchTensor - at batchIdx "+v+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+b)}),m=bo(f.map(function(v){return v.toFloat()})).as4D(c.batchSize,a,a,3);return m})},u}();function wr(u){return me(this,void 0,void 0,function(){var a,s,c;return ge(this,function(f){switch(f.label){case 0:if(u instanceof rf)return[2,u];if(a=Array.isArray(u)?u:[u],!a.length)throw new Error("toNetInput - empty array passed as input");return s=function(m){return Array.isArray(u)?" at input index "+m+":":""},c=a.map(Qc),c.forEach(function(m,v){if(!Em(m)&&!jc(m)&&!Ma(m))throw typeof a[v]=="string"?new Error("toNetInput -"+s(v)+" string passed, but could not resolve HTMLElement for element id "+a[v]):new Error("toNetInput -"+s(v)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Ma(m)){var b=m.shape[0];if(b!==1)throw new Error("toNetInput -"+s(v)+" tf.Tensor4D with batchSize "+b+" passed, but not supported in input array")}}),[4,Promise.all(c.map(function(m){return Em(m)&&Fw(m)}))];case 1:return f.sent(),[2,new rf(c,Array.isArray(u))]}})})}var xi=function(){function u(a){this._name=a,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(u.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),u.prototype.getParamFromPath=function(a){var s=this.traversePropertyPath(a),c=s.obj,f=s.objProp;return c[f]},u.prototype.reassignParamFromPath=function(a,s){var c=this.traversePropertyPath(a),f=c.obj,m=c.objProp;f[m].dispose(),f[m]=s},u.prototype.getParamList=function(){var a=this;return this._paramMappings.map(function(s){var c=s.paramPath;return{path:c,tensor:a.getParamFromPath(c)}})},u.prototype.getTrainableParams=function(){return this.getParamList().filter(function(a){return a.tensor instanceof Pn})},u.prototype.getFrozenParams=function(){return this.getParamList().filter(function(a){return!(a.tensor instanceof Pn)})},u.prototype.variable=function(){var a=this;this.getFrozenParams().forEach(function(s){var c=s.path,f=s.tensor;a.reassignParamFromPath(c,f.variable())})},u.prototype.freeze=function(){var a=this;this.getTrainableParams().forEach(function(s){var c=s.path,f=s.tensor,m=kn(f.dataSync());f.dispose(),a.reassignParamFromPath(c,m)})},u.prototype.dispose=function(a){a===void 0&&(a=!0),this.getParamList().forEach(function(s){if(a&&s.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+s.path);s.tensor.dispose()}),this._params=void 0},u.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(a){var s=a.tensor;return Array.from(s.dataSync())}).reduce(function(a,s){return a.concat(s)}))},u.prototype.load=function(a){return me(this,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return a instanceof Float32Array?(this.extractWeights(a),[2]):[4,this.loadFromUri(a)];case 1:return s.sent(),[2]}})})},u.prototype.loadFromUri=function(a){return me(this,void 0,void 0,function(){var s;return ge(this,function(c){switch(c.label){case 0:if(a&&typeof a!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Hw(a,this.getDefaultModelName())];case 1:return s=c.sent(),this.loadFromWeightMap(s),[2]}})})},u.prototype.loadFromDisk=function(a){return me(this,void 0,void 0,function(){var s,c,f,m,v,b,w,S,E,R;return ge(this,function(T){switch(T.label){case 0:if(a&&typeof a!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return s=zn.getEnv().readFile,c=vm(a,this.getDefaultModelName()),f=c.manifestUri,m=c.modelBaseUri,v=function(P){return Promise.all(P.map(function(O){return s(O).then(function($){return $.buffer})}))},b=am.weightsLoaderFactory(v),E=(S=JSON).parse,[4,s(f)];case 1:return w=E.apply(S,[T.sent().toString()]),[4,b(w,m)];case 2:return R=T.sent(),this.loadFromWeightMap(R),[2]}})})},u.prototype.loadFromWeightMap=function(a){var s=this.extractParamsFromWeigthMap(a),c=s.paramMappings,f=s.params;this._paramMappings=c,this._params=f},u.prototype.extractWeights=function(a){var s=this.extractParams(a),c=s.paramMappings,f=s.params;this._paramMappings=c,this._params=f},u.prototype.traversePropertyPath=function(a){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var s=a.split("/").reduce(function(m,v){if(!m.nextObj.hasOwnProperty(v))throw new Error("traversePropertyPath - object does not have property "+v+", for path "+a);return{obj:m.nextObj,objProp:v,nextObj:m.nextObj[v]}},{nextObj:this.params}),c=s.obj,f=s.objProp;if(!c||!f||!(c[f]instanceof At))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+a);return{obj:c,objProp:f}},u}();function qw(u,a,s){s===void 0&&(s=!0);var c=Math.max(0,Math.min(u.right,a.right)-Math.max(u.left,a.left)),f=Math.max(0,Math.min(u.bottom,a.bottom)-Math.max(u.top,a.top)),m=c*f;return s?m/(u.area+a.area-m):m/Math.min(u.area,a.area)}function Tu(u,a,s,c){c===void 0&&(c=!0);for(var f=a.map(function(b,w){return{score:b,boxIndex:w}}).sort(function(b,w){return b.score-w.score}).map(function(b){return b.boxIndex}),m=[],v=function(){var b=f.pop();m.push(b);for(var w=f,S=[],E=0;E<w.length;E++){var R=w[E],T=u[b],P=u[R];S.push(qw(T,P,c))}f=f.filter(function(O,$){return S[$]<=s})};f.length>0;)v();return m}function Jc(u,a){return te(function(){var s=a[0],c=a[1],f=a[2],m=Zo(u.shape.slice(0,3).concat([1]),s),v=Zo(u.shape.slice(0,3).concat([1]),c),b=Zo(u.shape.slice(0,3).concat([1]),f),w=or([m,v,b],3);return jr(u,w)})}function PF(u){for(var a=u.slice(),s=a.length-1;s>0;s--){var c=Math.floor(Math.random()*(s+1)),f=a[s];a[s]=a[c],a[c]=f}return a}function of(u){return 1/(1+Math.exp(-u))}function MF(u){return Math.log(u/(1-u))}var af=function(u){return typeof u=="number"};function jw(u){if(!u)throw new Error("invalid config: "+u);if(typeof u.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+u.withSeparableConvs);if(!af(u.iouThreshold)||u.iouThreshold<0||u.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+u.iouThreshold);if(!Array.isArray(u.classes)||!u.classes.length||!u.classes.every(function(a){return typeof a=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(u.classes));if(!Array.isArray(u.anchors)||!u.anchors.length||!u.anchors.map(function(a){return a||{}}).every(function(a){return af(a.x)&&af(a.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(u.anchors));if(u.meanRgb&&(!Array.isArray(u.meanRgb)||u.meanRgb.length!==3||!u.meanRgb.every(af)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(u.meanRgb))}function km(u){return te(function(){var a=xo(u,Nt(.10000000149011612));return Ue(xr(jr(u,a)),a)})}function wi(u,a){return te(function(){var s=li(u,[[0,0],[1,1],[1,1],[0,0]]);return s=Bo(s,a.conv.filters,[1,1],"valid"),s=jr(s,a.bn.sub),s=xo(s,a.bn.truediv),s=Ue(s,a.conv.bias),km(s)})}function Ci(u,a){return te(function(){var s=li(u,[[0,0],[1,1],[1,1],[0,0]]);return s=Vd(s,a.depthwise_filter,a.pointwise_filter,[1,1],"valid"),s=Ue(s,a.bias),km(s)})}function OF(u,a){var s=Jd(u,a);function c(v,b){var w=Un(u(v)),S=Un(u(v));return a.push({paramPath:b+"/sub"},{paramPath:b+"/truediv"}),{sub:w,truediv:S}}function f(v,b,w){var S=s(v,b,3,w+"/conv"),E=c(b,w+"/bn");return{conv:S,bn:E}}var m=kw(u,a);return{extractConvParams:s,extractConvWithBatchNormParams:f,extractSeparableConvParams:m}}function FF(u,a,s,c){var f=bi(u),m=f.extractWeights,v=f.getRemainingWeights,b=[],w=OF(m,b),S=w.extractConvParams,E=w.extractConvWithBatchNormParams,R=w.extractSeparableConvParams,T;if(a.withSeparableConvs){var P=c[0],O=c[1],$=c[2],B=c[3],U=c[4],z=c[5],j=c[6],K=c[7],J=c[8],dt=a.isFirstLayerConv2d?S(P,O,3,"conv0"):R(P,O,"conv0"),vt=R(O,$,"conv1"),bt=R($,B,"conv2"),kt=R(B,U,"conv3"),_t=R(U,z,"conv4"),Mt=R(z,j,"conv5"),Vt=K?R(j,K,"conv6"):void 0,Jt=J?R(K,J,"conv7"):void 0,ee=S(J||K||j,5*s,1,"conv8");T={conv0:dt,conv1:vt,conv2:bt,conv3:kt,conv4:_t,conv5:Mt,conv6:Vt,conv7:Jt,conv8:ee}}else{var P=c[0],O=c[1],$=c[2],B=c[3],U=c[4],z=c[5],j=c[6],K=c[7],J=c[8],dt=E(P,O,"conv0"),vt=E(O,$,"conv1"),bt=E($,B,"conv2"),kt=E(B,U,"conv3"),_t=E(U,z,"conv4"),Mt=E(z,j,"conv5"),Vt=E(j,K,"conv6"),Jt=E(K,J,"conv7"),ee=S(J,5*s,1,"conv8");T={conv0:dt,conv1:vt,conv2:bt,conv3:kt,conv4:_t,conv5:Mt,conv6:Vt,conv7:Jt,conv8:ee}}if(v().length!==0)throw new Error("weights remaing after extract: "+v().length);return{params:T,paramMappings:b}}function $F(u,a){var s=ms(u,a);function c(b){var w=s(b+"/sub",1),S=s(b+"/truediv",1);return{sub:w,truediv:S}}function f(b){var w=s(b+"/filters",4),S=s(b+"/bias",1);return{filters:w,bias:S}}function m(b){var w=f(b+"/conv"),S=c(b+"/bn");return{conv:w,bn:S}}var v=Rw(s);return{extractConvParams:f,extractConvWithBatchNormParams:m,extractSeparableConvParams:v}}function BF(u,a){var s=[],c=$F(u,s),f=c.extractConvParams,m=c.extractConvWithBatchNormParams,v=c.extractSeparableConvParams,b;if(a.withSeparableConvs){var w=a.filterSizes&&a.filterSizes.length||9;b={conv0:a.isFirstLayerConv2d?f("conv0"):v("conv0"),conv1:v("conv1"),conv2:v("conv2"),conv3:v("conv3"),conv4:v("conv4"),conv5:v("conv5"),conv6:w>7?v("conv6"):void 0,conv7:w>8?v("conv7"):void 0,conv8:f("conv8")}}else b={conv0:m("conv0"),conv1:m("conv1"),conv2:m("conv2"),conv3:m("conv3"),conv4:m("conv4"),conv5:m("conv5"),conv6:m("conv6"),conv7:m("conv7"),conv8:f("conv8")};return vi(u,s),{params:b,paramMappings:s}}var Rm;(function(u){u[u.XS=224]="XS",u[u.SM=320]="SM",u[u.MD=416]="MD",u[u.LG=608]="LG"})(Rm||(Rm={}));var Zc=function(){function u(a){var s=a===void 0?{}:a,c=s.inputSize,f=s.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=c||416,this._scoreThreshold=f||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(u.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),u}(),Tm=function(u){Ie(a,u);function a(s){var c=u.call(this,"TinyYolov2")||this;return jw(s),c._config=s,c}return Object.defineProperty(a.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),a.prototype.runTinyYolov2=function(s,c){var f=wi(s,c.conv0);return f=Xn(f,[2,2],[2,2],"same"),f=wi(f,c.conv1),f=Xn(f,[2,2],[2,2],"same"),f=wi(f,c.conv2),f=Xn(f,[2,2],[2,2],"same"),f=wi(f,c.conv3),f=Xn(f,[2,2],[2,2],"same"),f=wi(f,c.conv4),f=Xn(f,[2,2],[2,2],"same"),f=wi(f,c.conv5),f=Xn(f,[2,2],[1,1],"same"),f=wi(f,c.conv6),f=wi(f,c.conv7),wo(f,c.conv8,"valid",!1)},a.prototype.runMobilenet=function(s,c){var f=this.config.isFirstLayerConv2d?km(wo(s,c.conv0,"valid",!1)):Ci(s,c.conv0);return f=Xn(f,[2,2],[2,2],"same"),f=Ci(f,c.conv1),f=Xn(f,[2,2],[2,2],"same"),f=Ci(f,c.conv2),f=Xn(f,[2,2],[2,2],"same"),f=Ci(f,c.conv3),f=Xn(f,[2,2],[2,2],"same"),f=Ci(f,c.conv4),f=Xn(f,[2,2],[2,2],"same"),f=Ci(f,c.conv5),f=Xn(f,[2,2],[1,1],"same"),f=c.conv6?Ci(f,c.conv6):f,f=c.conv7?Ci(f,c.conv7):f,wo(f,c.conv8,"valid",!1)},a.prototype.forwardInput=function(s,c){var f=this,m=this.params;if(!m)throw new Error("TinyYolov2 - load model before inference");return te(function(){var v=s.toBatchTensor(c,!1).toFloat();return v=f.config.meanRgb?Jc(v,f.config.meanRgb):v,v=v.div(Nt(256)),f.config.withSeparableConvs?f.runMobilenet(v,m):f.runTinyYolov2(v,m)})},a.prototype.forward=function(s,c){return me(this,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return f=this.forwardInput,[4,wr(s)];case 1:return[4,f.apply(this,[m.sent(),c])];case 2:return[2,m.sent()]}})})},a.prototype.detect=function(s,c){return c===void 0&&(c={}),me(this,void 0,void 0,function(){var f,m,v,b,w,S,E,R,T,P,O,$,B,U,z=this;return ge(this,function(j){switch(j.label){case 0:return f=new Zc(c),m=f.inputSize,v=f.scoreThreshold,[4,wr(s)];case 1:return b=j.sent(),[4,this.forwardInput(b,m)];case 2:return w=j.sent(),S=te(function(){return ar(w)[0].expandDims()}),E={width:b.getInputWidth(0),height:b.getInputHeight(0)},R=this.extractBoxes(S,b.getReshapedInputDimensions(0),v),w.dispose(),S.dispose(),T=R.map(function(K){return K.box}),P=R.map(function(K){return K.score}),O=R.map(function(K){return K.classScore}),$=R.map(function(K){return z.config.classes[K.label]}),B=Tu(T.map(function(K){return K.rescale(m)}),P,this.config.iouThreshold,!0),U=B.map(function(K){return new Xc(P[K],O[K],$[K],T[K],E)}),[2,U]}})})},a.prototype.getDefaultModelName=function(){return""},a.prototype.extractParamsFromWeigthMap=function(s){return BF(s,this.config)},a.prototype.extractParams=function(s){var c=this.config.filterSizes||a.DEFAULT_FILTER_SIZES,f=c?c.length:void 0;if(f!==7&&f!==8&&f!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+f+" filterSizes in config");return FF(s,this.config,this.boxEncodingSize,c)},a.prototype.extractBoxes=function(s,c,f){for(var m=this,v=c.width,b=c.height,w=Math.max(v,b),S=w/v,E=w/b,R=s.shape[1],T=this.config.anchors.length,P=te(function(){var Gt=s.reshape([R,R,T,m.boxEncodingSize]),qt=Gt.slice([0,0,0,0],[R,R,T,4]),ne=Gt.slice([0,0,0,4],[R,R,T,1]),be=m.withClassScores?Da(Gt.slice([0,0,0,5],[R,R,T,m.config.classes.length]),3):Nt(0);return[qt,ne,be]}),O=P[0],$=P[1],B=P[2],U=[],z=0;z<R;z++)for(var j=0;j<R;j++)for(var K=0;K<T;K++){var J=of($.get(z,j,K,0));if(!f||J>f){var dt=(j+of(O.get(z,j,K,0)))/R*S,vt=(z+of(O.get(z,j,K,1)))/R*E,bt=Math.exp(O.get(z,j,K,2))*this.config.anchors[K].x/R*S,kt=Math.exp(O.get(z,j,K,3))*this.config.anchors[K].y/R*E,_t=dt-bt/2,Mt=vt-kt/2,Vt={row:z,col:j,anchor:K},Jt=this.withClassScores?this.extractPredictedClass(B,Vt):{classScore:1,label:0},ee=Jt.classScore,le=Jt.label;U.push(na({box:new tf(_t,Mt,_t+bt,Mt+kt),score:J,classScore:J*ee,label:le},Vt))}}return O.dispose(),$.dispose(),B.dispose(),U},a.prototype.extractPredictedClass=function(s,c){var f=c.row,m=c.col,v=c.anchor;return Array(this.config.classes.length).fill(0).map(function(b,w){return s.get(f,m,v,w)}).map(function(b,w){return{classScore:b,label:w}}).reduce(function(b,w){return b.classScore>w.classScore?b:w})},a.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],a}(xi),LF=Object.freeze({convLayer:wo,disposeUnusedWeightTensors:vi,extractConvParamsFactory:Jd,extractFCParamsFactory:fm,extractSeparableConvParamsFactory:kw,loadSeparableConvParamsFactory:Rw,extractWeightEntryFactory:ms,extractWeightsFactory:bi,getModelUris:vm,SeparableConvParams:qc,TinyYolov2:Tm,get TinyYolov2SizeType(){return Rm},TinyYolov2Options:Zc,validateConfig:jw}),sf=function(u){Ie(a,u);function a(s,c,f,m){return u.call(this,{x:s,y:c,width:f,height:m})||this}return a}(Oa),Wo=function(u){Ie(a,u);function a(s,c,f){return u.call(this,s,s,"",c,f)||this}return a.prototype.forSize=function(s,c){return u.prototype.forSize.call(this,s,c)},a}(Xc),WF=.5,UF=.43,zF=.45,tl=function(){function u(a,s,c){c===void 0&&(c=new tn(0,0));var f=s.width,m=s.height;this._imgDims=new hs(f,m),this._shift=c,this._positions=a.map(function(v){return v.mul(new tn(f,m)).add(c)})}return Object.defineProperty(u.prototype,"shift",{get:function(){return new tn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"relativePositions",{get:function(){var a=this;return this._positions.map(function(s){return s.sub(a._shift).div(new tn(a.imageWidth,a.imageHeight))})},enumerable:!0,configurable:!0}),u.prototype.forSize=function(a,s){return new this.constructor(this.relativePositions,{width:a,height:s})},u.prototype.shiftBy=function(a,s){return new this.constructor(this.relativePositions,this._imgDims,new tn(a,s))},u.prototype.shiftByPoint=function(a){return this.shiftBy(a.x,a.y)},u.prototype.align=function(a){if(a){var s=a instanceof Wo?a.box.floor():a;return this.shiftBy(s.x,s.y).align()}var c=this.getRefPointsForAlignment(),f=c[0],m=c[1],v=c[2],b=function(P){return v.sub(P).magnitude()},w=(b(f)+b(m))/2,S=Math.floor(w/zF),E=Zd(c),R=Math.floor(Math.max(0,E.x-WF*S)),T=Math.floor(Math.max(0,E.y-UF*S));return new sf(R,T,Math.min(S,this.imageWidth+R),Math.min(S,this.imageHeight+T))},u.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},u}(),Kw=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.getRefPointsForAlignment=function(){var s=this.positions;return[s[0],s[1],Zd([s[3],s[4]])]},a}(tl),Dm=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.getJawOutline=function(){return this.positions.slice(0,17)},a.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},a.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},a.prototype.getNose=function(){return this.positions.slice(27,36)},a.prototype.getLeftEye=function(){return this.positions.slice(36,42)},a.prototype.getRightEye=function(){return this.positions.slice(42,48)},a.prototype.getMouth=function(){return this.positions.slice(48,68)},a.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Zd)},a}(tl),Am=function(){function u(a,s){this._label=a,this._distance=s}return Object.defineProperty(u.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),u.prototype.toString=function(a){return a===void 0&&(a=!0),""+this.label+(a?" ("+Kc(this.distance)+")":"")},u}(),uf=function(){function u(a,s){if(typeof a!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(s)||s.some(function(c){return!(c instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=a,this._descriptors=s}return Object.defineProperty(u.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),u}();function Si(u,a,s){if(s===void 0&&(s=!1),u.beginPath(),a.slice(1).forEach(function(m,v){var b=m.x,w=m.y,S=a[v];u.moveTo(S.x,S.y),u.lineTo(b,w)}),s){var c=a[a.length-1],f=a[0];if(!c||!f)return;u.moveTo(c.x,c.y),u.lineTo(f.x,f.y)}u.stroke()}function VF(u,a,s){var c=Qc(u);if(!(c instanceof zn.getEnv().Canvas))throw new Error("drawLandmarks - expected canvas to be of type: HTMLCanvasElement");var f=Object.assign(Ru(s),s||{}),m=Object.assign({drawLines:!1},s||{}).drawLines,v=Lo(c),b=f.lineWidth,w=f.color,S=w===void 0?"blue":w,E=Array.isArray(a)?a:[a];E.forEach(function(R){if(m&&R instanceof Dm){v.strokeStyle=S,v.lineWidth=b,Si(v,R.getJawOutline()),Si(v,R.getLeftEyeBrow()),Si(v,R.getRightEyeBrow()),Si(v,R.getNose()),Si(v,R.getLeftEye(),!0),Si(v,R.getRightEye(),!0),Si(v,R.getMouth(),!0);return}var T=b/2;v.fillStyle=S,R.positions.forEach(function(P){return v.fillRect(P.x-T,P.y-T,b,b)})})}function HF(u,a,s){var c=Qc(u);if(!(c instanceof zn.getEnv().Canvas))throw new Error("drawFaceExpressions - expected canvas to be of type: HTMLCanvasElement");var f=Object.assign(Ru(s),s||{}),m=Lo(c),v=f.primaryColor,b=v===void 0?"red":v,w=f.secondaryColor,S=w===void 0?"blue":w,E=f.primaryFontSize,R=E===void 0?22:E,T=f.secondaryFontSize,P=T===void 0?16:T,O=f.minConfidence,$=O===void 0?.2:O,B=Array.isArray(a)?a:[a];B.forEach(function(U){var z=U.position,j=U.expressions,K=z.x,J=z.y,dt=z.height||0,vt=j.sort(function(_t,Mt){return Mt.probability-_t.probability}),bt=vt.filter(function(_t){return _t.probability>$}),kt=J+dt+bt.length*R>c.height?-(bt.length*R):0;bt.forEach(function(_t,Mt){var Vt=_t.expression+" ("+Kc(_t.probability)+")";_m(m,K,J+dt+Mt*R+kt,Vt,{textColor:Mt===0?b:S,fontSize:Mt===0?R:P})})})}function gs(u,a){return me(this,void 0,void 0,function(){var s,c,f,m,v,b,w;return ge(this,function(S){switch(S.label){case 0:return s=zn.getEnv().Canvas,c=u,u instanceof s?[3,5]:[4,wr(u)];case 1:if(f=S.sent(),f.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return m=f.getInput(0),m instanceof s?(v=m,[3,4]):[3,2];case 2:return[4,zw(m)];case 3:v=S.sent(),S.label=4;case 4:c=v,S.label=5;case 5:return b=Lo(c),w=a.map(function(E){return E instanceof Wo?E.forSize(c.width,c.height).box.floor():E}).map(function(E){return E.clipAtImageBorders(c.width,c.height)}),[2,w.map(function(E){var R=E.x,T=E.y,P=E.width,O=E.height,$=Yc({width:P,height:O});return Lo($).putImageData(b.getImageData(R,T,P,O),0,0),$})]}})})}function vs(u,a){return me(this,void 0,void 0,function(){return ge(this,function(s){if(!jc(u)&&!Ma(u))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ma(u)&&u.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,te(function(){var c=u.shape.slice(Ma(u)?1:0),f=c[0],m=c[1],v=c[2],b=a.map(function(S){return S instanceof Wo?S.forSize(m,f).box:S}).map(function(S){return S.clipAtImageBorders(m,f)}),w=b.map(function(S){var E=S.x,R=S.y,T=S.width,P=S.height;return Wh(u.as3D(f,m,v),[R,E,0],[P,T,v])});return w})]})})}function ys(u,a,s){return te(function(){var c=Vd(u,a.depthwise_filter,a.pointwise_filter,s,"same");return c=Ue(c,a.bias),c})}function Im(u,a,s){return s===void 0&&(s=!1),te(function(){var c=xr(s?Ue(Bo(u,a.conv0.filters,[2,2],"same"),a.conv0.bias):ys(u,a.conv0,[2,2])),f=ys(c,a.conv1,[1,1]),m=xr(Ue(c,f)),v=ys(m,a.conv2,[1,1]);return xr(Ue(c,Ue(f,v)))})}function cf(u,a,s,c){return s===void 0&&(s=!1),c===void 0&&(c=!0),te(function(){var f=xr(s?Ue(Bo(u,a.conv0.filters,c?[2,2]:[1,1],"same"),a.conv0.bias):ys(u,a.conv0,c?[2,2]:[1,1])),m=ys(f,a.conv1,[1,1]),v=xr(Ue(f,m)),b=ys(v,a.conv2,[1,1]),w=xr(Ue(f,Ue(m,b))),S=ys(w,a.conv3,[1,1]);return xr(Ue(f,Ue(m,Ue(b,S))))})}function Xw(u,a){function s(v,b,w){var S=nr(u(9*v),[3,3,v,1]),E=nr(u(v*b),[1,1,v,b]),R=Un(u(b));return a.push({paramPath:w+"/depthwise_filter"},{paramPath:w+"/pointwise_filter"},{paramPath:w+"/bias"}),new qc(S,E,R)}var c=Jd(u,a);function f(v,b,w,S){S===void 0&&(S=!1);var E=S?c(v,b,3,w+"/conv0"):s(v,b,w+"/conv0"),R=s(b,b,w+"/conv1"),T=s(b,b,w+"/conv2");return{conv0:E,conv1:R,conv2:T}}function m(v,b,w,S){S===void 0&&(S=!1);var E=f(v,b,w,S),R=E.conv0,T=E.conv1,P=E.conv2,O=s(b,b,w+"/conv3");return{conv0:R,conv1:T,conv2:P,conv3:O}}return{extractDenseBlock3Params:f,extractDenseBlock4Params:m}}function GF(u){var a=[],s=bi(u),c=s.extractWeights,f=s.getRemainingWeights,m=Xw(c,a).extractDenseBlock4Params,v=m(3,32,"dense0",!0),b=m(32,64,"dense1"),w=m(64,128,"dense2"),S=m(128,256,"dense3");if(f().length!==0)throw new Error("weights remaing after extract: "+f().length);return{paramMappings:a,params:{dense0:v,dense1:b,dense2:w,dense3:S}}}function Yw(u,a){var s=ms(u,a);function c(b){var w=s(b+"/filters",4),S=s(b+"/bias",1);return{filters:w,bias:S}}function f(b){var w=s(b+"/depthwise_filter",4),S=s(b+"/pointwise_filter",4),E=s(b+"/bias",1);return new qc(w,S,E)}function m(b,w){w===void 0&&(w=!1);var S=w?c(b+"/conv0"):f(b+"/conv0"),E=f(b+"/conv1"),R=f(b+"/conv2");return{conv0:S,conv1:E,conv2:R}}function v(b,w){w===void 0&&(w=!1);var S=w?c(b+"/conv0"):f(b+"/conv0"),E=f(b+"/conv1"),R=f(b+"/conv2"),T=f(b+"/conv3");return{conv0:S,conv1:E,conv2:R,conv3:T}}return{extractDenseBlock3Params:m,extractDenseBlock4Params:v}}function qF(u){var a=[],s=Yw(u,a).extractDenseBlock4Params,c={dense0:s("dense0",!0),dense1:s("dense1"),dense2:s("dense2"),dense3:s("dense3")};return vi(u,a),{params:c,paramMappings:a}}var Qw=function(u){Ie(a,u);function a(){return u.call(this,"FaceFeatureExtractor")||this}return a.prototype.forwardInput=function(s){var c=this.params;if(!c)throw new Error("FaceFeatureExtractor - load model before inference");return te(function(){var f=s.toBatchTensor(112,!0),m=[122.782,117.001,104.298],v=Jc(f,m).div(Nt(255)),b=cf(v,c.dense0,!0);return b=cf(b,c.dense1),b=cf(b,c.dense2),b=cf(b,c.dense3),b=Wc(b,[7,7],[2,2],"valid"),b})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},a.prototype.extractParamsFromWeigthMap=function(s){return qF(s)},a.prototype.extractParams=function(s){return GF(s)},a}(xi);function _i(u,a){return te(function(){return Ue(Lc(u,a.weights),a.bias)})}function jF(u,a,s){var c=[],f=bi(u),m=f.extractWeights,v=f.getRemainingWeights,b=fm(m,c),w=b(a,s,"fc");if(v().length!==0)throw new Error("weights remaing after extract: "+v().length);return{paramMappings:c,params:{fc:w}}}function KF(u){var a=[],s=ms(u,a);function c(m){var v=s(m+"/weights",2),b=s(m+"/bias",1);return{weights:v,bias:b}}var f={fc:c("fc")};return vi(u,a),{params:f,paramMappings:a}}function XF(u){var a={},s={};return Object.keys(u).forEach(function(c){var f=c.startsWith("fc")?s:a;f[c]=u[c]}),{featureExtractorMap:a,classifierMap:s}}var Jw=function(u){Ie(a,u);function a(s,c){var f=u.call(this,s)||this;return f._faceFeatureExtractor=c,f}return Object.defineProperty(a.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),a.prototype.runNet=function(s){var c=this,f=this.params;if(!f)throw new Error(this._name+" - load model before inference");return te(function(){var m=s instanceof rf?c.faceFeatureExtractor.forwardInput(s):s;return _i(m.as2D(m.shape[0],-1),f.fc)})},a.prototype.dispose=function(s){s===void 0&&(s=!0),this.faceFeatureExtractor.dispose(s),u.prototype.dispose.call(this,s)},a.prototype.loadClassifierParams=function(s){var c=this.extractClassifierParams(s),f=c.params,m=c.paramMappings;this._params=f,this._paramMappings=m},a.prototype.extractClassifierParams=function(s){return jF(s,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},a.prototype.extractParamsFromWeigthMap=function(s){var c=XF(s),f=c.featureExtractorMap,m=c.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(f),KF(m)},a.prototype.extractParams=function(s){var c=this.getClassifierChannelsIn(),f=this.getClassifierChannelsOut(),m=f*c+f,v=s.slice(0,s.length-m),b=s.slice(s.length-m);return this.faceFeatureExtractor.extractWeights(v),this.extractClassifierParams(b)},a}(xi),lf={neutral:0,happy:1,sad:2,angry:3,fearful:4,disgusted:5,surprised:6},Zw=function(u){Ie(a,u);function a(s){return s===void 0&&(s=new Qw),u.call(this,"FaceExpressionNet",s)||this}return a.getFaceExpressionLabel=function(s){var c=lf[s];if(typeof c!="number")throw new Error("getFaceExpressionLabel - no label for faceExpression: "+s);return c},a.decodeProbabilites=function(s){if(s.length!==7)throw new Error("decodeProbabilites - expected probabilities.length to be 7, have: "+s.length);return Object.keys(lf).map(function(c){return{expression:c,probability:s[lf[c]]}})},a.prototype.forwardInput=function(s){var c=this;return te(function(){return Da(c.runNet(s))})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.predictExpressions=function(s){return me(this,void 0,void 0,function(){var c,f,m,v,b=this;return ge(this,function(w){switch(w.label){case 0:return[4,wr(s)];case 1:return c=w.sent(),[4,this.forwardInput(c)];case 2:return f=w.sent(),[4,Promise.all(ar(f).map(function(S){return me(b,void 0,void 0,function(){var E;return ge(this,function(R){switch(R.label){case 0:return[4,S.data()];case 1:return E=R.sent(),S.dispose(),[2,E]}})})}))];case 3:return m=w.sent(),f.dispose(),v=m.map(function(S){return a.decodeProbabilites(S)}),[2,c.isBatchInput?v:v[0]]}})})},a.prototype.getDefaultModelName=function(){return"face_expression_model"},a.prototype.getClassifierChannelsIn=function(){return 256},a.prototype.getClassifierChannelsOut=function(){return 7},a}(Jw),t2=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.postProcess=function(s,c,f){var m=f.map(function(b){var w=b.width,S=b.height,E=c/Math.max(S,w);return{width:w*E,height:S*E}}),v=m.length;return te(function(){var b=function(T,P){return bo([Zo([68],T),Zo([68],P)],1).as2D(1,136).as1D()},w=function(T,P){var O=m[T],$=O.width,B=O.height;return P($,B)?Math.abs($-B)/2:0},S=function(T){return w(T,function(P,O){return P<O})},E=function(T){return w(T,function(P,O){return O<P})},R=s.mul(Zo([v,136],c)).sub(bo(Array.from(Array(v),function(T,P){return b(S(P),E(P))}))).div(bo(Array.from(Array(v),function(T,P){return b(m[P].width,m[P].height)})));return R})},a.prototype.forwardInput=function(s){var c=this;return te(function(){var f=c.runNet(s);return c.postProcess(f,s.inputSize,s.inputDimensions.map(function(m){var v=m[0],b=m[1];return{height:v,width:b}}))})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.detectLandmarks=function(s){return me(this,void 0,void 0,function(){var c,f,m,v=this;return ge(this,function(b){switch(b.label){case 0:return[4,wr(s)];case 1:return c=b.sent(),f=te(function(){return ar(v.forwardInput(c))}),[4,Promise.all(f.map(function(w,S){return me(v,void 0,void 0,function(){var E,R,T,P,O;return ge(this,function($){switch($.label){case 0:return T=(R=Array).from,[4,w.data()];case 1:return E=T.apply(R,[$.sent()]),P=E.filter(function(B,U){return pm(U)}),O=E.filter(function(B,U){return!pm(U)}),[2,new Dm(Array(68).fill(0).map(function(B,U){return new tn(P[U],O[U])}),{height:c.getInputHeight(S),width:c.getInputWidth(S)})]}})})}))];case 2:return m=b.sent(),f.forEach(function(w){return w.dispose()}),[2,c.isBatchInput?m:m[0]]}})})},a.prototype.getClassifierChannelsOut=function(){return 136},a}(Jw),Nm=function(u){Ie(a,u);function a(s){return s===void 0&&(s=new Qw),u.call(this,"FaceLandmark68Net",s)||this}return a.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},a.prototype.getClassifierChannelsIn=function(){return 256},a}(t2);function YF(u){var a=[],s=Yw(u,a).extractDenseBlock3Params,c={dense0:s("dense0",!0),dense1:s("dense1"),dense2:s("dense2")};return vi(u,a),{params:c,paramMappings:a}}function QF(u){var a=[],s=bi(u),c=s.extractWeights,f=s.getRemainingWeights,m=Xw(c,a).extractDenseBlock3Params,v=m(3,32,"dense0",!0),b=m(32,64,"dense1"),w=m(64,128,"dense2");if(f().length!==0)throw new Error("weights remaing after extract: "+f().length);return{paramMappings:a,params:{dense0:v,dense1:b,dense2:w}}}var JF=function(u){Ie(a,u);function a(){return u.call(this,"TinyFaceFeatureExtractor")||this}return a.prototype.forwardInput=function(s){var c=this.params;if(!c)throw new Error("TinyFaceFeatureExtractor - load model before inference");return te(function(){var f=s.toBatchTensor(112,!0),m=[122.782,117.001,104.298],v=Jc(f,m).div(Nt(255)),b=Im(v,c.dense0,!0);return b=Im(b,c.dense1),b=Im(b,c.dense2),b=Wc(b,[14,14],[2,2],"valid"),b})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},a.prototype.extractParamsFromWeigthMap=function(s){return YF(s)},a.prototype.extractParams=function(s){return QF(s)},a}(xi),e2=function(u){Ie(a,u);function a(s){return s===void 0&&(s=new JF),u.call(this,"FaceLandmark68TinyNet",s)||this}return a.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},a.prototype.getClassifierChannelsIn=function(){return 128},a}(t2),ZF=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a}(Nm);function t$(u,a){return Ue(xo(u,a.weights),a.biases)}function Pm(u,a,s,c,f){f===void 0&&(f="same");var m=a.conv,v=m.filters,b=m.bias,w=Bo(u,v,s,f);return w=Ue(w,b),w=t$(w,a.scale),c?xr(w):w}function e$(u,a){return Pm(u,a,[1,1],!0)}function n2(u,a){return Pm(u,a,[1,1],!1)}function r2(u,a){return Pm(u,a,[2,2],!0,"valid")}function n$(u,a){function s(b,w,S){var E=u(b),R=E.length/(w*S*S);if(Dw(R))throw new Error("depth has to be an integer: "+R+", weights.length: "+E.length+", numFilters: "+w+", filterSize: "+S);return te(function(){return Na(nr(E,[w,R,S,S]),[2,3,1,0])})}function c(b,w,S,E){var R=s(b,w,S),T=Un(u(w));return a.push({paramPath:E+"/filters"},{paramPath:E+"/bias"}),{filters:R,bias:T}}function f(b,w){var S=Un(u(b)),E=Un(u(b));return a.push({paramPath:w+"/weights"},{paramPath:w+"/biases"}),{weights:S,biases:E}}function m(b,w,S,E){var R=c(b,w,S,E+"/conv"),T=f(w,E+"/scale");return{conv:R,scale:T}}function v(b,w,S,E,R){R===void 0&&(R=!1);var T=m((R?.5:1)*b,w,S,E+"/conv1"),P=m(b,w,S,E+"/conv2");return{conv1:T,conv2:P}}return{extractConvLayerParams:m,extractResidualLayerParams:v}}function r$(u){var a=bi(u),s=a.extractWeights,c=a.getRemainingWeights,f=[],m=n$(s,f),v=m.extractConvLayerParams,b=m.extractResidualLayerParams,w=v(4704,32,7,"conv32_down"),S=b(9216,32,3,"conv32_1"),E=b(9216,32,3,"conv32_2"),R=b(9216,32,3,"conv32_3"),T=b(36864,64,3,"conv64_down",!0),P=b(36864,64,3,"conv64_1"),O=b(36864,64,3,"conv64_2"),$=b(36864,64,3,"conv64_3"),B=b(147456,128,3,"conv128_down",!0),U=b(147456,128,3,"conv128_1"),z=b(147456,128,3,"conv128_2"),j=b(589824,256,3,"conv256_down",!0),K=b(589824,256,3,"conv256_1"),J=b(589824,256,3,"conv256_2"),dt=b(589824,256,3,"conv256_down_out"),vt=te(function(){return Na(pu(s(256*128),[128,256]),[1,0])});if(f.push({paramPath:"fc"}),c().length!==0)throw new Error("weights remaing after extract: "+c().length);var bt={conv32_down:w,conv32_1:S,conv32_2:E,conv32_3:R,conv64_down:T,conv64_1:P,conv64_2:O,conv64_3:$,conv128_down:B,conv128_1:U,conv128_2:z,conv256_down:j,conv256_1:K,conv256_2:J,conv256_down_out:dt,fc:vt};return{params:bt,paramMappings:f}}function o$(u,a){var s=ms(u,a);function c(v){var b=s(v+"/scale/weights",1),w=s(v+"/scale/biases",1);return{weights:b,biases:w}}function f(v){var b=s(v+"/conv/filters",4),w=s(v+"/conv/bias",1),S=c(v);return{conv:{filters:b,bias:w},scale:S}}function m(v){return{conv1:f(v+"/conv1"),conv2:f(v+"/conv2")}}return{extractConvLayerParams:f,extractResidualLayerParams:m}}function a$(u){var a=[],s=o$(u,a),c=s.extractConvLayerParams,f=s.extractResidualLayerParams,m=c("conv32_down"),v=f("conv32_1"),b=f("conv32_2"),w=f("conv32_3"),S=f("conv64_down"),E=f("conv64_1"),R=f("conv64_2"),T=f("conv64_3"),P=f("conv128_down"),O=f("conv128_1"),$=f("conv128_2"),B=f("conv256_down"),U=f("conv256_1"),z=f("conv256_2"),j=f("conv256_down_out"),K=u.fc;if(a.push({originalPath:"fc",paramPath:"fc"}),!Tw(K))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+K);var J={conv32_down:m,conv32_1:v,conv32_2:b,conv32_3:w,conv64_down:S,conv64_1:E,conv64_2:R,conv64_3:T,conv128_down:P,conv128_1:O,conv128_2:$,conv256_down:B,conv256_1:U,conv256_2:z,conv256_down_out:j,fc:K};return vi(u,a),{params:J,paramMappings:a}}function ra(u,a){var s=e$(u,a.conv1);return s=n2(s,a.conv2),s=Ue(s,u),s=xr(s),s}function df(u,a){var s=r2(u,a.conv1);s=n2(s,a.conv2);var c=Wc(u,2,2,"valid"),f=Rn(c.shape),m=c.shape[3]!==s.shape[3],v=c.shape[1]!==s.shape[1]||c.shape[2]!==s.shape[2];if(v){var b=s.shape.slice();b[1]=1;var w=Rn(b);s=or([s,w],1);var S=s.shape.slice();S[2]=1;var E=Rn(S);s=or([s,E],2)}return c=m?or([c,f],3):c,s=Ue(c,s),s=xr(s),s}var Mm=function(u){Ie(a,u);function a(){return u.call(this,"FaceRecognitionNet")||this}return a.prototype.forwardInput=function(s){var c=this.params;if(!c)throw new Error("FaceRecognitionNet - load model before inference");return te(function(){var f=s.toBatchTensor(150,!0).toFloat(),m=[122.782,117.001,104.298],v=Jc(f,m).div(Nt(256)),b=r2(v,c.conv32_down);b=Xn(b,3,2,"valid"),b=ra(b,c.conv32_1),b=ra(b,c.conv32_2),b=ra(b,c.conv32_3),b=df(b,c.conv64_down),b=ra(b,c.conv64_1),b=ra(b,c.conv64_2),b=ra(b,c.conv64_3),b=df(b,c.conv128_down),b=ra(b,c.conv128_1),b=ra(b,c.conv128_2),b=df(b,c.conv256_down),b=ra(b,c.conv256_1),b=ra(b,c.conv256_2),b=df(b,c.conv256_down_out);var w=b.mean([1,2]),S=Lc(w,c.fc);return S})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.computeFaceDescriptor=function(s){return me(this,void 0,void 0,function(){var c,f,m,v=this;return ge(this,function(b){switch(b.label){case 0:return[4,wr(s)];case 1:return c=b.sent(),f=te(function(){return ar(v.forwardInput(c))}),[4,Promise.all(f.map(function(w){return w.data()}))];case 2:return m=b.sent(),f.forEach(function(w){return w.dispose()}),[2,c.isBatchInput?m:m[0]]}})})},a.prototype.getDefaultModelName=function(){return"face_recognition_model"},a.prototype.extractParamsFromWeigthMap=function(s){return a$(s)},a.prototype.extractParams=function(s){return r$(s)},a}(xi);function i$(u){var a=new Mm;return a.extractWeights(u),a}function Om(u,a){var s={descriptor:a};return Object.assign({},u,s)}function Du(u,a){var s={detection:a};return Object.assign({},u,s)}function Fm(u,a){var s={expressions:a};return Object.assign({},u,s)}function el(u,a){var s=u.detection.box,c=a.shiftBy(s.x,s.y),f=c.align(),m=u.detection.imageDims,v=new Wo(u.detection.score,f.rescale(m.reverse()),m),b={landmarks:c,unshiftedLandmarks:a,alignedRect:v};return Object.assign({},u,b)}var ff=function(){function u(a){var s=a===void 0?{}:a,c=s.minFaceSize,f=s.scaleFactor,m=s.maxNumScales,v=s.scoreThresholds,b=s.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=c||20,this._scaleFactor=f||.709,this._maxNumScales=m||10,this._scoreThresholds=v||[.6,.7,.7],this._scaleSteps=b,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(w){return typeof w!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(w){return typeof w!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(u.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),u}();function s$(u,a){function s(w,S){var E=nr(u(9*w),[3,3,w,1]),R=Un(u(w)),T=Un(u(w)),P=Un(u(w)),O=Un(u(w));return a.push({paramPath:S+"/filters"},{paramPath:S+"/batch_norm_scale"},{paramPath:S+"/batch_norm_offset"},{paramPath:S+"/batch_norm_mean"},{paramPath:S+"/batch_norm_variance"}),{filters:E,batch_norm_scale:R,batch_norm_offset:T,batch_norm_mean:P,batch_norm_variance:O}}function c(w,S,E,R,T){var P=nr(u(w*S*E*E),[E,E,w,S]),O=Un(u(S));return a.push({paramPath:R+"/filters"},{paramPath:R+"/"+(T?"batch_norm_offset":"bias")}),{filters:P,bias:O}}function f(w,S,E,R){var T=c(w,S,E,R,!0),P=T.filters,O=T.bias;return{filters:P,batch_norm_offset:O}}function m(w,S,E){var R=s(w,E+"/depthwise_conv"),T=f(w,S,1,E+"/pointwise_conv");return{depthwise_conv:R,pointwise_conv:T}}function v(){var w=f(3,32,3,"mobilenetv1/conv_0"),S=m(32,64,"mobilenetv1/conv_1"),E=m(64,128,"mobilenetv1/conv_2"),R=m(128,128,"mobilenetv1/conv_3"),T=m(128,256,"mobilenetv1/conv_4"),P=m(256,256,"mobilenetv1/conv_5"),O=m(256,512,"mobilenetv1/conv_6"),$=m(512,512,"mobilenetv1/conv_7"),B=m(512,512,"mobilenetv1/conv_8"),U=m(512,512,"mobilenetv1/conv_9"),z=m(512,512,"mobilenetv1/conv_10"),j=m(512,512,"mobilenetv1/conv_11"),K=m(512,1024,"mobilenetv1/conv_12"),J=m(1024,1024,"mobilenetv1/conv_13");return{conv_0:w,conv_1:S,conv_2:E,conv_3:R,conv_4:T,conv_5:P,conv_6:O,conv_7:$,conv_8:B,conv_9:U,conv_10:z,conv_11:j,conv_12:K,conv_13:J}}function b(){var w=f(1024,256,1,"prediction_layer/conv_0"),S=f(256,512,3,"prediction_layer/conv_1"),E=f(512,128,1,"prediction_layer/conv_2"),R=f(128,256,3,"prediction_layer/conv_3"),T=f(256,128,1,"prediction_layer/conv_4"),P=f(128,256,3,"prediction_layer/conv_5"),O=f(256,64,1,"prediction_layer/conv_6"),$=f(64,128,3,"prediction_layer/conv_7"),B=c(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),U=c(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),z=c(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),j=c(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),K=c(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),J=c(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),dt=c(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),vt=c(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),bt=c(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),kt=c(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),_t=c(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),Mt=c(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),Vt={box_encoding_predictor:B,class_predictor:U},Jt={box_encoding_predictor:z,class_predictor:j},ee={box_encoding_predictor:K,class_predictor:J},le={box_encoding_predictor:dt,class_predictor:vt},Gt={box_encoding_predictor:bt,class_predictor:kt},qt={box_encoding_predictor:_t,class_predictor:Mt};return{conv_0:w,conv_1:S,conv_2:E,conv_3:R,conv_4:T,conv_5:P,conv_6:O,conv_7:$,box_predictor_0:Vt,box_predictor_1:Jt,box_predictor_2:ee,box_predictor_3:le,box_predictor_4:Gt,box_predictor_5:qt}}return{extractMobilenetV1Params:v,extractPredictionLayerParams:b}}function u$(u){var a=[],s=bi(u),c=s.extractWeights,f=s.getRemainingWeights,m=s$(c,a),v=m.extractMobilenetV1Params,b=m.extractPredictionLayerParams,w=v(),S=b(),E=Dd(c(5118*4),[1,5118,4]),R={extra_dim:E};if(a.push({paramPath:"output_layer/extra_dim"}),f().length!==0)throw new Error("weights remaing after extract: "+f().length);return{params:{mobilenetv1:w,prediction_layer:S,output_layer:R},paramMappings:a}}function c$(u,a){var s=ms(u,a);function c(S,E,R){var T=s(S+"/Conv2d_"+E+"_pointwise/weights",4,R+"/filters"),P=s(S+"/Conv2d_"+E+"_pointwise/convolution_bn_offset",1,R+"/batch_norm_offset");return{filters:T,batch_norm_offset:P}}function f(S){var E="mobilenetv1/conv_"+S,R="MobilenetV1/Conv2d_"+S+"_depthwise",T=E+"/depthwise_conv",P=E+"/pointwise_conv",O=s(R+"/depthwise_weights",4,T+"/filters"),$=s(R+"/BatchNorm/gamma",1,T+"/batch_norm_scale"),B=s(R+"/BatchNorm/beta",1,T+"/batch_norm_offset"),U=s(R+"/BatchNorm/moving_mean",1,T+"/batch_norm_mean"),z=s(R+"/BatchNorm/moving_variance",1,T+"/batch_norm_variance");return{depthwise_conv:{filters:O,batch_norm_scale:$,batch_norm_offset:B,batch_norm_mean:U,batch_norm_variance:z},pointwise_conv:c("MobilenetV1",S,P)}}function m(){return{conv_0:c("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:f(1),conv_2:f(2),conv_3:f(3),conv_4:f(4),conv_5:f(5),conv_6:f(6),conv_7:f(7),conv_8:f(8),conv_9:f(9),conv_10:f(10),conv_11:f(11),conv_12:f(12),conv_13:f(13)}}function v(S,E){var R=s(S+"/weights",4,E+"/filters"),T=s(S+"/biases",1,E+"/bias");return{filters:R,bias:T}}function b(S){var E=v("Prediction/BoxPredictor_"+S+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+S+"/box_encoding_predictor"),R=v("Prediction/BoxPredictor_"+S+"/ClassPredictor","prediction_layer/box_predictor_"+S+"/class_predictor");return{box_encoding_predictor:E,class_predictor:R}}function w(){return{conv_0:c("Prediction",0,"prediction_layer/conv_0"),conv_1:c("Prediction",1,"prediction_layer/conv_1"),conv_2:c("Prediction",2,"prediction_layer/conv_2"),conv_3:c("Prediction",3,"prediction_layer/conv_3"),conv_4:c("Prediction",4,"prediction_layer/conv_4"),conv_5:c("Prediction",5,"prediction_layer/conv_5"),conv_6:c("Prediction",6,"prediction_layer/conv_6"),conv_7:c("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:b(0),box_predictor_1:b(1),box_predictor_2:b(2),box_predictor_3:b(3),box_predictor_4:b(4),box_predictor_5:b(5)}}return{extractMobilenetV1Params:m,extractPredictionLayerParams:w}}function l$(u){var a=[],s=c$(u,a),c=s.extractMobilenetV1Params,f=s.extractPredictionLayerParams,m=u["Output/extra_dim"];if(a.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!jc(m))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+m);var v={mobilenetv1:c(),prediction_layer:f(),output_layer:{extra_dim:m}};return vi(u,a),{params:v,paramMappings:a}}function oa(u,a,s){return te(function(){var c=Bo(u,a.filters,s,"same");return c=Ue(c,a.batch_norm_offset),$d(c,0,6)})}var d$=.0010000000474974513;function f$(u,a,s){return te(function(){var c=zd(u,a.filters,s,"same");return c=xu(c,a.batch_norm_mean,a.batch_norm_variance,d$,a.batch_norm_scale,a.batch_norm_offset),$d(c,0,6)})}function p$(u){return[2,4,6,12].some(function(a){return a===u})?[2,2]:[1,1]}function h$(u,a){return te(function(){var s=null,c=oa(u,a.conv_0,[2,2]),f=[a.conv_1,a.conv_2,a.conv_3,a.conv_4,a.conv_5,a.conv_6,a.conv_7,a.conv_8,a.conv_9,a.conv_10,a.conv_11,a.conv_12,a.conv_13];if(f.forEach(function(m,v){var b=v+1,w=p$(b);c=f$(c,m.depthwise_conv,w),c=oa(c,m.pointwise_conv,[1,1]),b===11&&(s=c)}),s===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:c,conv11:s}})}function m$(u,a,s,c,f){var m=u.shape[0],v=Math.min(s,m),b=a.map(function(E,R){return{score:E,boxIndex:R}}).filter(function(E){return E.score>f}).sort(function(E,R){return R.score-E.score}),w=function(E){return E<=c?1:0},S=[];return b.forEach(function(E){if(!(S.length>=v)){for(var R=E.score,T=S.length-1;T>=0;--T){var P=g$(u,E.boxIndex,S[T]);if(P!==0&&(E.score*=w(P),E.score<=f))break}R===E.score&&S.push(E.boxIndex)}}),S}function g$(u,a,s){var c=Math.min(u.get(a,0),u.get(a,2)),f=Math.min(u.get(a,1),u.get(a,3)),m=Math.max(u.get(a,0),u.get(a,2)),v=Math.max(u.get(a,1),u.get(a,3)),b=Math.min(u.get(s,0),u.get(s,2)),w=Math.min(u.get(s,1),u.get(s,3)),S=Math.max(u.get(s,0),u.get(s,2)),E=Math.max(u.get(s,1),u.get(s,3)),R=(m-c)*(v-f),T=(S-b)*(E-w);if(R<=0||T<=0)return 0;var P=Math.max(c,b),O=Math.max(f,w),$=Math.min(m,S),B=Math.min(v,E),U=Math.max($-P,0)*Math.max(B-O,0);return U/(R+T-U)}function v$(u){var a=ar(Na(u,[1,0])),s=[jr(a[2],a[0]),jr(a[3],a[1])],c=[Ue(a[0],ea(s[0],Nt(2))),Ue(a[1],ea(s[1],Nt(2)))];return{sizes:s,centers:c}}function y$(u,a){var s=v$(u),c=s.sizes,f=s.centers,m=ar(Na(a,[1,0])),v=ea(xo(Bd(ea(m[2],Nt(5))),c[0]),Nt(2)),b=Ue(xo(ea(m[0],Nt(10)),c[0]),f[0]),w=ea(xo(Bd(ea(m[3],Nt(5))),c[1]),Nt(2)),S=Ue(xo(ea(m[1],Nt(10)),c[1]),f[1]);return Na(bo([jr(b,v),jr(S,w),Ue(b,v),Ue(S,w)]),[1,0])}function b$(u,a,s){return te(function(){var c=u.shape[0],f=y$(yo(ls(s.extra_dim,[c,1,1]),[-1,4]),yo(u,[-1,4]));f=yo(f,[c,f.shape[0]/c,4]);var m=Fh(fi(a,[0,0,1],[-1,-1,-1])),v=fi(m,[0,0,0],[-1,-1,1]);v=yo(v,[c,v.shape[1]]);var b=ar(f),w=ar(v);return{boxes:b,scores:w}})}function Au(u,a){return te(function(){var s=u.shape[0],c=yo(wo(u,a.box_encoding_predictor),[s,-1,1,4]),f=yo(wo(u,a.class_predictor),[s,-1,3]);return{boxPredictionEncoding:c,classPrediction:f}})}function x$(u,a,s){return te(function(){var c=oa(u,s.conv_0,[1,1]),f=oa(c,s.conv_1,[2,2]),m=oa(f,s.conv_2,[1,1]),v=oa(m,s.conv_3,[2,2]),b=oa(v,s.conv_4,[1,1]),w=oa(b,s.conv_5,[2,2]),S=oa(w,s.conv_6,[1,1]),E=oa(S,s.conv_7,[2,2]),R=Au(a,s.box_predictor_0),T=Au(u,s.box_predictor_1),P=Au(f,s.box_predictor_2),O=Au(v,s.box_predictor_3),$=Au(w,s.box_predictor_4),B=Au(E,s.box_predictor_5),U=or([R.boxPredictionEncoding,T.boxPredictionEncoding,P.boxPredictionEncoding,O.boxPredictionEncoding,$.boxPredictionEncoding,B.boxPredictionEncoding],1),z=or([R.classPrediction,T.classPrediction,P.classPrediction,O.classPrediction,$.classPrediction,B.classPrediction],1);return{boxPredictions:U,classPredictions:z}})}var bs=function(){function u(a){var s=a===void 0?{}:a,c=s.minConfidence,f=s.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=c||.5,this._maxResults=f||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(u.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),u}(),pf=function(u){Ie(a,u);function a(){return u.call(this,"SsdMobilenetv1")||this}return a.prototype.forwardInput=function(s){var c=this.params;if(!c)throw new Error("SsdMobilenetv1 - load model before inference");return te(function(){var f=s.toBatchTensor(512,!1).toFloat(),m=jr(xo(f,Nt(.007843137718737125)),Nt(1)),v=h$(m,c.mobilenetv1),b=x$(v.out,v.conv11,c.prediction_layer),w=b.boxPredictions,S=b.classPredictions;return b$(w,S,c.output_layer)})},a.prototype.forward=function(s){return me(this,void 0,void 0,function(){var c;return ge(this,function(f){switch(f.label){case 0:return c=this.forwardInput,[4,wr(s)];case 1:return[2,c.apply(this,[f.sent()])]}})})},a.prototype.locateFaces=function(s,c){return c===void 0&&(c={}),me(this,void 0,void 0,function(){var f,m,v,b,w,S,E,R,T,P,O,$,B,U,z,j,K,J,dt,vt;return ge(this,function(bt){switch(bt.label){case 0:return f=new bs(c),m=f.maxResults,v=f.minConfidence,[4,wr(s)];case 1:for(b=bt.sent(),w=this.forwardInput(b),S=w.boxes,E=w.scores,R=S[0],T=E[0],P=1;P<S.length;P++)S[P].dispose(),E[P].dispose();return B=($=Array).from,[4,T.data()];case 2:return O=B.apply($,[bt.sent()]),U=.5,z=m$(R,O,m,U,v),j=b.getReshapedInputDimensions(0),K=b.inputSize,J=K/j.width,dt=K/j.height,vt=z.map(function(kt){var _t=[Math.max(0,R.get(kt,0)),Math.min(1,R.get(kt,2))].map(function(Gt){return Gt*dt}),Mt=_t[0],Vt=_t[1],Jt=[Math.max(0,R.get(kt,1)),Math.min(1,R.get(kt,3))].map(function(Gt){return Gt*J}),ee=Jt[0],le=Jt[1];return new Wo(O[kt],new sf(ee,Mt,le-ee,Vt-Mt),{height:b.getInputHeight(0),width:b.getInputWidth(0)})}),R.dispose(),T.dispose(),[2,vt]}})})},a.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},a.prototype.extractParamsFromWeigthMap=function(s){return l$(s)},a.prototype.extractParams=function(s){return u$(s)},a}(xi);function o2(u){var a=new pf;return a.extractWeights(u),a}function w$(u){return o2(u)}var C$=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a}(pf),a2=function(u){Ie(a,u);function a(){var s=u!==null&&u.apply(this,arguments)||this;return s._name="TinyFaceDetectorOptions",s}return a}(Zc),nl=function(){function u(){}return u.prototype.then=function(a){return me(this,void 0,void 0,function(){var s;return ge(this,function(c){switch(c.label){case 0:return s=a,[4,this.run()];case 1:return[2,s.apply(void 0,[c.sent()])]}})})},u.prototype.run=function(){return me(this,void 0,void 0,function(){return ge(this,function(a){throw new Error("ComposableTask - run is not implemented")})})},u}();function S$(u){return te(function(){return bo(ar(u,3).reverse(),3)})}var hf=2,mf=12;function _$(u,a){var s=Jd(u,a),c=fm(u,a);function f(S,E){var R=Un(u(S));return a.push({paramPath:E}),R}function m(S,E,R){R===void 0&&(R=!1);var T=s(S[0],S[1],3,E+"/conv1"),P=f(S[1],E+"/prelu1_alpha"),O=s(S[1],S[2],3,E+"/conv2"),$=f(S[2],E+"/prelu2_alpha"),B=s(S[2],S[3],R?2:3,E+"/conv3"),U=f(S[3],E+"/prelu3_alpha");return{conv1:T,prelu1_alpha:P,conv2:O,prelu2_alpha:$,conv3:B,prelu3_alpha:U}}function v(){var S=m([3,10,16,32],"pnet"),E=s(32,2,1,"pnet/conv4_1"),R=s(32,4,1,"pnet/conv4_2");return na({},S,{conv4_1:E,conv4_2:R})}function b(){var S=m([3,28,48,64],"rnet",!0),E=c(576,128,"rnet/fc1"),R=f(128,"rnet/prelu4_alpha"),T=c(128,2,"rnet/fc2_1"),P=c(128,4,"rnet/fc2_2");return na({},S,{fc1:E,prelu4_alpha:R,fc2_1:T,fc2_2:P})}function w(){var S=m([3,32,64,64],"onet"),E=s(64,128,2,"onet/conv4"),R=f(128,"onet/prelu4_alpha"),T=c(1152,256,"onet/fc1"),P=f(256,"onet/prelu5_alpha"),O=c(256,2,"onet/fc2_1"),$=c(256,4,"onet/fc2_2"),B=c(256,10,"onet/fc2_3");return na({},S,{conv4:E,prelu4_alpha:R,fc1:T,prelu5_alpha:P,fc2_1:O,fc2_2:$,fc2_3:B})}return{extractPNetParams:v,extractRNetParams:b,extractONetParams:w}}function E$(u){var a=bi(u),s=a.extractWeights,c=a.getRemainingWeights,f=[],m=_$(s,f),v=m.extractPNetParams,b=m.extractRNetParams,w=m.extractONetParams,S=v(),E=b(),R=w();if(c().length!==0)throw new Error("weights remaing after extract: "+c().length);return{params:{pnet:S,rnet:E,onet:R},paramMappings:f}}function k$(u,a){var s=ms(u,a);function c(E){var R=s(E+"/weights",4,E+"/filters"),T=s(E+"/bias",1);return{filters:R,bias:T}}function f(E){var R=s(E+"/weights",2),T=s(E+"/bias",1);return{weights:R,bias:T}}function m(E){return s(E,1)}function v(E){var R=c(E+"/conv1"),T=m(E+"/prelu1_alpha"),P=c(E+"/conv2"),O=m(E+"/prelu2_alpha"),$=c(E+"/conv3"),B=m(E+"/prelu3_alpha");return{conv1:R,prelu1_alpha:T,conv2:P,prelu2_alpha:O,conv3:$,prelu3_alpha:B}}function b(){var E=v("pnet"),R=c("pnet/conv4_1"),T=c("pnet/conv4_2");return na({},E,{conv4_1:R,conv4_2:T})}function w(){var E=v("rnet"),R=f("rnet/fc1"),T=m("rnet/prelu4_alpha"),P=f("rnet/fc2_1"),O=f("rnet/fc2_2");return na({},E,{fc1:R,prelu4_alpha:T,fc2_1:P,fc2_2:O})}function S(){var E=v("onet"),R=c("onet/conv4"),T=m("onet/prelu4_alpha"),P=f("onet/fc1"),O=m("onet/prelu5_alpha"),$=f("onet/fc2_1"),B=f("onet/fc2_2"),U=f("onet/fc2_3");return na({},E,{conv4:R,prelu4_alpha:T,fc1:P,prelu5_alpha:O,fc2_1:$,fc2_2:B,fc2_3:U})}return{extractPNetParams:b,extractRNetParams:w,extractONetParams:S}}function R$(u){var a=[],s=k$(u,a),c=s.extractPNetParams,f=s.extractRNetParams,m=s.extractONetParams,v=c(),b=f(),w=m();return vi(u,a),{params:{pnet:v,rnet:b,onet:w},paramMappings:a}}function $m(u,a){var s=a[0],c=a[1];return{height:Math.floor(s*u),width:Math.floor(c*u)}}function T$(u,a,s){for(var c=s[0],f=s[1],m=mf/u,v=[],b=Math.min(c,f)*m,w=0;b>=12;)v.push(m*Math.pow(a,w)),b=b*a,w+=1;return v}var Bm=function(u){Ie(a,u);function a(s,c,f,m){return u.call(this,{left:s,top:c,right:f,bottom:m},!0)||this}return a}(Oa);function i2(u){return te(function(){return xo(jr(u,Nt(127.5)),Nt(.0078125))})}function Iu(u,a){return te(function(){return Ue(xr(u),xo(a,Fc(xr(Fc(u)))))})}function Lm(u,a,s){return s===void 0&&(s=!1),te(function(){var c=wo(u,a.conv1,"valid");return c=Iu(c,a.prelu1_alpha),c=Xn(c,s?[2,2]:[3,3],[2,2],"same"),c=wo(c,a.conv2,"valid"),c=Iu(c,a.prelu2_alpha),c=s?c:Xn(c,[3,3],[2,2],"valid"),c=wo(c,a.conv3,"valid"),c=Iu(c,a.prelu3_alpha),c})}function D$(u,a){return te(function(){var s=Lm(u,a,!0),c=wo(s,a.conv4_1,"valid"),f=ao(Uc(c,3),3),m=Da(jr(c,f),3),v=wo(s,a.conv4_2,"valid");return{prob:m,regions:v}})}function A$(u,a){return te(function(){var s=$m(a,u.shape.slice(1)),c=s.height,f=s.width,m=Xd.resizeBilinear(u,[c,f]),v=i2(m);return Na(v,[0,2,1,3])})}function I$(u,a,s,c){for(var f=[],m=0;m<u.shape[0];m++)for(var v=0;v<u.shape[1];v++)u.get(m,v)>=c&&f.push(new tn(v,m));var b=f.map(function(w){var S=new tf(Math.round((w.y*hf+1)/s),Math.round((w.x*hf+1)/s),Math.round((w.y*hf+mf)/s),Math.round((w.x*hf+mf)/s)),E=u.get(w.y,w.x),R=new Bm(a.get(w.y,w.x,0),a.get(w.y,w.x,1),a.get(w.y,w.x,2),a.get(w.y,w.x,3));return{cell:S,score:E,region:R}});return b}function N$(u,a,s,c,f){f.stage1=[];var m=a.map(function(T){return te(function(){var P={scale:T},O=A$(u,T),$=Date.now(),B=D$(O,c),U=B.prob,z=B.regions;P.pnet=Date.now()-$;var j=ar(ar(U,3)[1])[0],K=ar(z)[0];return{scoresTensor:j,regionsTensor:K,scale:T,statsForScale:P}})}),v=m.map(function(T){var P=T.scoresTensor,O=T.regionsTensor,$=T.scale,B=T.statsForScale,U=I$(P,O,$,s);if(P.dispose(),O.dispose(),!U.length)return f.stage1.push(B),[];var z=Date.now(),j=Tu(U.map(function(K){return K.cell}),U.map(function(K){return K.score}),.5);return B.nms=Date.now()-z,B.numBoxes=j.length,f.stage1.push(B),j.map(function(K){return U[K]})}),b=v.reduce(function(T,P){return T.concat(P)},[]),w=[],S=[];if(b.length>0){var E=Date.now(),R=Tu(b.map(function(T){return T.cell}),b.map(function(T){return T.score}),.7);f.stage1_nms=Date.now()-E,S=R.map(function(T){return b[T].score}),w=R.map(function(T){return b[T]}).map(function(T){var P=T.cell,O=T.region;return new tf(P.left+O.left*P.width,P.top+O.top*P.height,P.right+O.right*P.width,P.bottom+O.bottom*P.height).toSquare().round()})}return{boxes:w,scores:S}}function s2(u,a,s){var c=s.width,f=s.height;return me(this,void 0,void 0,function(){var m,v,b,w=this;return ge(this,function(S){switch(S.label){case 0:return m=Lo(u),[4,Promise.all(a.map(function(E){return me(w,void 0,void 0,function(){var R,T,P,O,$,B,U,z;return ge(this,function(j){return R=E.padAtBorders(u.height,u.width),T=R.y,P=R.ey,O=R.x,$=R.ex,B=O-1,U=T-1,z=m.getImageData(B,U,$-B,P-U),[2,zn.isNodejs()?ef(z):createImageBitmap(z)]})})}))];case 1:return v=S.sent(),b=[],v.forEach(function(E){var R=Yc({width:c,height:f}),T=Lo(R);T.drawImage(E,0,0,c,f);for(var P=T.getImageData(0,0,c,f).data,O=[],$=0;$<P.length;$+=4)O.push(P[$+2]),O.push(P[$+1]),O.push(P[$]);b.push(O)}),[2,b.map(function(E){var R=te(function(){var T=Na(nr(E,[1,c,f,3]),[0,2,1,3]).toFloat();return i2(T)});return R})]}})})}function P$(u,a){return te(function(){var s=Lm(u,a),c=yo(s,[s.shape[0],a.fc1.weights.shape[0]]),f=_i(c,a.fc1),m=Iu(f,a.prelu4_alpha),v=_i(m,a.fc2_1),b=ao(Uc(v,1),1),w=Da(jr(v,b),1),S=_i(m,a.fc2_2),E=ar(w,1)[1];return{scores:E,regions:S}})}function M$(u,a,s,c,f){return me(this,void 0,void 0,function(){var m,v,b,w,S,E,R,T,P,O,$,B,U,z;return ge(this,function(j){switch(j.label){case 0:return m=Date.now(),[4,s2(u,a,{width:24,height:24})];case 1:return v=j.sent(),f.stage2_extractImagePatches=Date.now()-m,m=Date.now(),b=v.map(function(K){var J=P$(K,c);return K.dispose(),J}),f.stage2_rnet=Date.now()-m,w=b.length>1?or(b.map(function(K){return K.scores})):b[0].scores,R=(E=Array).from,[4,w.data()];case 2:return S=R.apply(E,[j.sent()]),w.dispose(),T=S.map(function(K,J){return{score:K,idx:J}}).filter(function(K){return K.score>s}).map(function(K){var J=K.idx;return J}),P=T.map(function(K){return a[K]}),O=T.map(function(K){return S[K]}),$=[],B=[],P.length>0&&(m=Date.now(),U=Tu(P,O,.7),f.stage2_nms=Date.now()-m,z=U.map(function(K){return new Bm(b[T[K]].regions.get(0,0),b[T[K]].regions.get(0,1),b[T[K]].regions.get(0,2),b[T[K]].regions.get(0,3))}),B=U.map(function(K){return O[K]}),$=U.map(function(K,J){return P[K].calibrate(z[J])})),b.forEach(function(K){K.regions.dispose(),K.scores.dispose()}),[2,{boxes:$,scores:B}]}})})}function O$(u,a){return te(function(){var s=Lm(u,a);s=Xn(s,[2,2],[2,2],"same"),s=wo(s,a.conv4,"valid"),s=Iu(s,a.prelu4_alpha);var c=yo(s,[s.shape[0],a.fc1.weights.shape[0]]),f=_i(c,a.fc1),m=Iu(f,a.prelu5_alpha),v=_i(m,a.fc2_1),b=ao(Uc(v,1),1),w=Da(jr(v,b),1),S=_i(m,a.fc2_2),E=_i(m,a.fc2_3),R=ar(w,1)[1];return{scores:R,regions:S,points:E}})}function F$(u,a,s,c,f){return me(this,void 0,void 0,function(){var m,v,b,w,S,E,R,T,P,O,$,B,U,z,j;return ge(this,function(K){switch(K.label){case 0:return m=Date.now(),[4,s2(u,a,{width:48,height:48})];case 1:return v=K.sent(),f.stage3_extractImagePatches=Date.now()-m,m=Date.now(),b=v.map(function(J){var dt=O$(J,c);return J.dispose(),dt}),f.stage3_onet=Date.now()-m,w=b.length>1?or(b.map(function(J){return J.scores})):b[0].scores,R=(E=Array).from,[4,w.data()];case 2:return S=R.apply(E,[K.sent()]),w.dispose(),T=S.map(function(J,dt){return{score:J,idx:dt}}).filter(function(J){return J.score>s}).map(function(J){var dt=J.idx;return dt}),P=T.map(function(J){return new Bm(b[J].regions.get(0,0),b[J].regions.get(0,1),b[J].regions.get(0,2),b[J].regions.get(0,3))}),O=T.map(function(J,dt){return a[J].calibrate(P[dt])}),$=T.map(function(J){return S[J]}),B=[],U=[],z=[],O.length>0&&(m=Date.now(),j=Tu(O,$,.7,!1),f.stage3_nms=Date.now()-m,B=j.map(function(J){return O[J]}),U=j.map(function(J){return $[J]}),z=j.map(function(J,dt){return Array(5).fill(0).map(function(vt,bt){return new tn(b[J].points.get(0,bt)*(B[dt].width+1)+B[dt].left,b[J].points.get(0,bt+5)*(B[dt].height+1)+B[dt].top)})})),b.forEach(function(J){J.regions.dispose(),J.scores.dispose(),J.points.dispose()}),[2,{boxes:B,scores:U,points:z}]}})})}var Wm=function(u){Ie(a,u);function a(){return u.call(this,"Mtcnn")||this}return a.prototype.forwardInput=function(s,c){return c===void 0&&(c={}),me(this,void 0,void 0,function(){var f,m,v,b,w,S,E,R,T,P,O,$,B,U,z,j,K,J,dt,vt,bt;return ge(this,function(kt){switch(kt.label){case 0:if(f=this.params,!f)throw new Error("Mtcnn - load model before inference");if(m=s.canvases[0],!m)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return v={},b=Date.now(),w=te(function(){return S$(ao(Od(m)).toFloat())}),S=function(_t){return w.dispose(),v.total=Date.now()-b,_t},E=w.shape.slice(1),R=E[0],T=E[1],P=new ff(c),O=P.minFaceSize,$=P.scaleFactor,B=P.maxNumScales,U=P.scoreThresholds,z=P.scaleSteps,j=(z||T$(O,$,[R,T])).filter(function(_t){var Mt=$m(_t,[R,T]);return Math.min(Mt.width,Mt.height)>mf}).slice(0,B),v.scales=j,v.pyramid=j.map(function(_t){return $m(_t,[R,T])}),K=Date.now(),[4,N$(w,j,U[0],f.pnet,v)];case 1:return J=kt.sent(),v.total_stage1=Date.now()-K,J.boxes.length?(v.stage2_numInputBoxes=J.boxes.length,K=Date.now(),[4,M$(m,J.boxes,U[1],f.rnet,v)]):[2,S({results:[],stats:v})];case 2:return dt=kt.sent(),v.total_stage2=Date.now()-K,dt.boxes.length?(v.stage3_numInputBoxes=dt.boxes.length,K=Date.now(),[4,F$(m,dt.boxes,U[2],f.onet,v)]):[2,S({results:[],stats:v})];case 3:return vt=kt.sent(),v.total_stage3=Date.now()-K,bt=vt.boxes.map(function(_t,Mt){return el(Du({},new Wo(vt.scores[Mt],new sf(_t.left/T,_t.top/R,_t.width/T,_t.height/R),{height:R,width:T})),new Kw(vt.points[Mt].map(function(Vt){return Vt.sub(new tn(_t.left,_t.top)).div(new tn(_t.width,_t.height))}),{width:_t.width,height:_t.height}))}),[2,S({results:bt,stats:v})]}})})},a.prototype.forward=function(s,c){return c===void 0&&(c={}),me(this,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return f=this.forwardInput,[4,wr(s)];case 1:return[4,f.apply(this,[m.sent(),c])];case 2:return[2,m.sent().results]}})})},a.prototype.forwardWithStats=function(s,c){return c===void 0&&(c={}),me(this,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return f=this.forwardInput,[4,wr(s)];case 1:return[2,f.apply(this,[m.sent(),c])]}})})},a.prototype.getDefaultModelName=function(){return"mtcnn_model"},a.prototype.extractParamsFromWeigthMap=function(s){return R$(s)},a.prototype.extractParams=function(s){return E$(s)},a}(xi),$$=.4,B$=[new tn(1.603231,2.094468),new tn(6.041143,7.080126),new tn(2.882459,3.518061),new tn(4.266906,5.178857),new tn(9.041765,10.66308)],L$=[117.001,114.697,97.404],Um=function(u){Ie(a,u);function a(){var s=this,c={withSeparableConvs:!0,iouThreshold:$$,classes:["face"],anchors:B$,meanRgb:L$,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return s=u.call(this,c)||this,s}return Object.defineProperty(a.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),a.prototype.locateFaces=function(s,c){return me(this,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return[4,this.detect(s,c)];case 1:return f=m.sent(),[2,f.map(function(v){return new Wo(v.score,v.relativeBox,{width:v.imageWidth,height:v.imageHeight})})]}})})},a.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},a.prototype.extractParamsFromWeigthMap=function(s){return u.prototype.extractParamsFromWeigthMap.call(this,s)},a}(Tm),W$=.4,U$=[new tn(.738768,.874946),new tn(2.42204,2.65704),new tn(4.30971,7.04493),new tn(10.246,4.59428),new tn(12.6868,11.8741)],z$=[new tn(1.603231,2.094468),new tn(6.041143,7.080126),new tn(2.882459,3.518061),new tn(4.266906,5.178857),new tn(9.041765,10.66308)],V$=[117.001,114.697,97.404],H$="tiny_yolov2_model",G$="tiny_yolov2_separable_conv_model",zm=function(u){Ie(a,u);function a(s){s===void 0&&(s=!0);var c=this,f=Object.assign({},{withSeparableConvs:s,iouThreshold:W$,classes:["face"]},s?{anchors:z$,meanRgb:V$}:{anchors:U$,withClassScores:!0});return c=u.call(this,f)||this,c}return Object.defineProperty(a.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),a.prototype.locateFaces=function(s,c){return me(this,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return[4,this.detect(s,c)];case 1:return f=m.sent(),[2,f.map(function(v){return new Wo(v.score,v.relativeBox,{width:v.imageWidth,height:v.imageHeight})})]}})})},a.prototype.getDefaultModelName=function(){return this.withSeparableConvs?G$:H$},a.prototype.extractParamsFromWeigthMap=function(s){return u.prototype.extractParamsFromWeigthMap.call(this,s)},a}(Tm);function q$(u,a){a===void 0&&(a=!0);var s=new zm(a);return s.extractWeights(u),s}var ln={ssdMobilenetv1:new pf,tinyFaceDetector:new Um,tinyYolov2:new zm,mtcnn:new Wm,faceLandmark68Net:new Nm,faceLandmark68TinyNet:new e2,faceRecognitionNet:new Mm,faceExpressionNet:new Zw},u2=function(u,a){return ln.ssdMobilenetv1.locateFaces(u,a)},j$=function(u,a){return ln.tinyFaceDetector.locateFaces(u,a)},K$=function(u,a){return ln.tinyYolov2.locateFaces(u,a)},X$=function(u,a){return ln.mtcnn.forward(u,a)},c2=function(u){return ln.faceLandmark68Net.detectLandmarks(u)},Y$=function(u){return ln.faceLandmark68TinyNet.detectLandmarks(u)},Q$=function(u){return ln.faceRecognitionNet.computeFaceDescriptor(u)},J$=function(u){return ln.faceExpressionNet.predictExpressions(u)},l2=function(u){return ln.ssdMobilenetv1.load(u)},Z$=function(u){return ln.tinyFaceDetector.load(u)},tB=function(u){return ln.mtcnn.load(u)},eB=function(u){return ln.tinyYolov2.load(u)},nB=function(u){return ln.faceLandmark68Net.load(u)},rB=function(u){return ln.faceLandmark68TinyNet.load(u)},oB=function(u){return ln.faceRecognitionNet.load(u)},aB=function(u){return ln.faceExpressionNet.load(u)},iB=l2,sB=u2,uB=c2,Vm=function(u){Ie(a,u);function a(s,c){var f=u.call(this)||this;return f.parentTask=s,f.input=c,f}return a}(nl),d2=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v,b=this;return ge(this,function(w){switch(w.label){case 0:return[4,this.parentTask];case 1:return s=w.sent(),c=s.map(function(S){var E=S.alignedRect;return E}),this.input instanceof At?[4,vs(this.input,c)]:[3,3];case 2:return m=w.sent(),[3,5];case 3:return[4,gs(this.input,c)];case 4:m=w.sent(),w.label=5;case 5:return f=m,[4,Promise.all(s.map(function(S,E){return me(b,void 0,void 0,function(){var R;return ge(this,function(T){switch(T.label){case 0:return[4,ln.faceRecognitionNet.computeFaceDescriptor(f[E])];case 1:return R=T.sent(),[2,Om(S,R)]}})})}))];case 6:return v=w.sent(),f.forEach(function(S){return S instanceof At&&S.dispose()}),[2,v]}})})},a}(Vm),f2=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v;return ge(this,function(b){switch(b.label){case 0:return[4,this.parentTask];case 1:return s=b.sent(),s?(c=s.alignedRect,this.input instanceof At?[4,vs(this.input,[c])]:[3,3]):[2];case 2:return m=b.sent(),[3,5];case 3:return[4,gs(this.input,[c])];case 4:m=b.sent(),b.label=5;case 5:return f=m,[4,ln.faceRecognitionNet.computeFaceDescriptor(f[0])];case 6:return v=b.sent(),f.forEach(function(w){return w instanceof At&&w.dispose()}),[2,Om(s,v)]}})})},a}(Vm),Hm=function(u){Ie(a,u);function a(s,c,f){var m=u.call(this)||this;return m.parentTask=s,m.input=c,m.useTinyLandmarkNet=f,m}return Object.defineProperty(a.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ln.faceLandmark68TinyNet:ln.faceLandmark68Net},enumerable:!0,configurable:!0}),a}(nl),Gm=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v,b=this;return ge(this,function(w){switch(w.label){case 0:return[4,this.parentTask];case 1:return s=w.sent(),c=s.map(function(S){return S.detection}),this.input instanceof At?[4,vs(this.input,c)]:[3,3];case 2:return m=w.sent(),[3,5];case 3:return[4,gs(this.input,c)];case 4:m=w.sent(),w.label=5;case 5:return f=m,[4,Promise.all(f.map(function(S){return b.landmarkNet.detectLandmarks(S)}))];case 6:return v=w.sent(),f.forEach(function(S){return S instanceof At&&S.dispose()}),[2,s.map(function(S,E){return el(S,v[E])})]}})})},a.prototype.withFaceDescriptors=function(){return new d2(this,this.input)},a}(Hm),qm=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v;return ge(this,function(b){switch(b.label){case 0:return[4,this.parentTask];case 1:return s=b.sent(),s?(c=s.detection,this.input instanceof At?[4,vs(this.input,[c])]:[3,3]):[2];case 2:return m=b.sent(),[3,5];case 3:return[4,gs(this.input,[c])];case 4:m=b.sent(),b.label=5;case 5:return f=m,[4,this.landmarkNet.detectLandmarks(f[0])];case 6:return v=b.sent(),f.forEach(function(w){return w instanceof At&&w.dispose()}),[2,el(s,v)]}})})},a.prototype.withFaceDescriptor=function(){return new f2(this,this.input)},a}(Hm),p2=function(u){Ie(a,u);function a(s,c){var f=u.call(this)||this;return f.parentTask=s,f.input=c,f}return a}(nl),cB=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v;return ge(this,function(b){switch(b.label){case 0:return[4,this.parentTask];case 1:return s=b.sent(),c=s.map(function(w){return w.detection}),this.input instanceof At?[4,vs(this.input,c)]:[3,3];case 2:return m=b.sent(),[3,5];case 3:return[4,gs(this.input,c)];case 4:m=b.sent(),b.label=5;case 5:return f=m,[4,Promise.all(f.map(function(w){return ln.faceExpressionNet.predictExpressions(w)}))];case 6:return v=b.sent(),f.forEach(function(w){return w instanceof At&&w.dispose()}),[2,s.map(function(w,S){return Fm(w,v[S])})]}})})},a.prototype.withFaceLandmarks=function(){return new Gm(this,this.input,!1)},a}(p2),lB=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m,v;return ge(this,function(b){switch(b.label){case 0:return[4,this.parentTask];case 1:return s=b.sent(),s?(c=s.detection,this.input instanceof At?[4,vs(this.input,[c])]:[3,3]):[2];case 2:return m=b.sent(),[3,5];case 3:return[4,gs(this.input,[c])];case 4:m=b.sent(),b.label=5;case 5:return f=m,[4,ln.faceExpressionNet.predictExpressions(f[0])];case 6:return v=b.sent(),f.forEach(function(w){return w instanceof At&&w.dispose()}),[2,Fm(s,v)]}})})},a.prototype.withFaceLandmarks=function(){return new qm(this,this.input,!1)},a}(p2),jm=function(u){Ie(a,u);function a(s,c){c===void 0&&(c=new bs);var f=u.call(this)||this;return f.input=s,f.options=c,f}return a}(nl),Km=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c,f,m;return ge(this,function(v){switch(v.label){case 0:return s=this,c=s.input,f=s.options,f instanceof ff?[4,ln.mtcnn.forward(c,f)]:[3,2];case 1:return[2,v.sent().map(function(b){return b.detection})];case 2:if(m=f instanceof a2?function(b){return ln.tinyFaceDetector.locateFaces(b,f)}:f instanceof bs?function(b){return ln.ssdMobilenetv1.locateFaces(b,f)}:f instanceof Zc?function(b){return ln.tinyYolov2.locateFaces(b,f)}:null,!m)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,m(c)]}})})},a.prototype.runAndExtendWithFaceDetections=function(){var s=this;return new Promise(function(c){return me(s,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return[4,this.run()];case 1:return f=m.sent(),[2,c(f.map(function(v){return Du({},v)}))]}})})})},a.prototype.withFaceLandmarks=function(s){return s===void 0&&(s=!1),new Gm(this.runAndExtendWithFaceDetections(),this.input,s)},a.prototype.withFaceExpressions=function(){return new cB(this.runAndExtendWithFaceDetections(),this.input)},a}(jm),h2=function(u){Ie(a,u);function a(){return u!==null&&u.apply(this,arguments)||this}return a.prototype.run=function(){return me(this,void 0,void 0,function(){var s,c;return ge(this,function(f){switch(f.label){case 0:return[4,new Km(this.input,this.options)];case 1:return s=f.sent(),c=s[0],s.forEach(function(m){m.score>c.score&&(c=m)}),[2,c]}})})},a.prototype.runAndExtendWithFaceDetection=function(){var s=this;return new Promise(function(c){return me(s,void 0,void 0,function(){var f;return ge(this,function(m){switch(m.label){case 0:return[4,this.run()];case 1:return f=m.sent(),[2,c(f?Du({},f):void 0)]}})})})},a.prototype.withFaceLandmarks=function(s){return s===void 0&&(s=!1),new qm(this.runAndExtendWithFaceDetection(),this.input,s)},a.prototype.withFaceExpressions=function(){return new lB(this.runAndExtendWithFaceDetection(),this.input)},a}(jm);function dB(u,a){return a===void 0&&(a=new bs),new h2(u,a)}function gf(u,a){return a===void 0&&(a=new bs),new Km(u,a)}function m2(u,a){return me(this,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return[4,gf(u,new bs(a?{minConfidence:a}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,s.sent()]}})})}function fB(u,a){return a===void 0&&(a={}),me(this,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return[4,gf(u,new Zc(a)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,s.sent()]}})})}function pB(u,a){return a===void 0&&(a={}),me(this,void 0,void 0,function(){return ge(this,function(s){switch(s.label){case 0:return[4,gf(u,new ff(a)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,s.sent()]}})})}var hB=m2;function g2(u,a){if(u.length!==a.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var s=Array.from(u),c=Array.from(a);return Math.sqrt(s.map(function(f,m){return f-c[m]}).reduce(function(f,m){return f+Math.pow(m,2)},0))}var mB=function(){function u(a,s){s===void 0&&(s=.6),this._distanceThreshold=s;var c=Array.isArray(a)?a:[a];if(!c.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var f=1,m=function(){return"person "+f++};this._labeledDescriptors=c.map(function(v){if(v instanceof uf)return v;if(v instanceof Float32Array)return new uf(m(),[v]);if(v.descriptor&&v.descriptor instanceof Float32Array)return new uf(m(),[v.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(u.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),u.prototype.computeMeanDistance=function(a,s){return s.map(function(c){return g2(c,a)}).reduce(function(c,f){return c+f},0)/(s.length||1)},u.prototype.matchDescriptor=function(a){var s=this;return this.labeledDescriptors.map(function(c){var f=c.descriptors,m=c.label;return new Am(m,s.computeMeanDistance(a,f))}).reduce(function(c,f){return c.distance<f.distance?c:f})},u.prototype.findBestMatch=function(a){var s=this.matchDescriptor(a);return s.distance<this.distanceThreshold?s:new Am("unknown",s.distance)},u}();function gB(u){var a=new Wm;return a.extractWeights(u),a}function vB(u){var a=new Um;return a.extractWeights(u),a}function v2(u,a){var s=a.width,c=a.height;if(Array.isArray(u))return u.map(function(w){return v2(w,{width:s,height:c})});var f=u.unshiftedLandmarks&&u.unshiftedLandmarks instanceof tl,m=u.detection&&u.detection instanceof Wo;if(f){var v=u.detection.forSize(s,c),b=u.unshiftedLandmarks.forSize(v.box.width,v.box.height);return el(Du(u,v),b)}return m?Du(u,u.detection.forSize(s,c)):u instanceof tl||u instanceof Wo?u.forSize(s,c):u}n.tf=kF,n.TfjsImageRecognitionBase=LF,n.BoundingBox=tf,n.Box=Oa,n.BoxWithText=Lw,n.Dimensions=hs,n.LabeledBox=Sm,n.ObjectDetection=Xc,n.Point=tn,n.PredictedBox=Ww,n.Rect=sf,n.awaitMediaLoaded=Fw,n.bufferToImage=$w,n.createCanvas=Yc,n.createCanvasFromMedia=ef,n.drawBox=Bw,n.drawDetection=AF,n.drawText=_m,n.fetchImage=IF,n.fetchJson=Uw,n.fetchNetWeights=NF,n.fetchOrThrow=nf,n.getContext2dOrThrow=Lo,n.getDefaultDrawOptions=Ru,n.getMediaDimensions=Cm,n.imageTensorToCanvas=zw,n.imageToSquare=Vw,n.isMediaElement=Em,n.isMediaLoaded=wm,n.loadWeightMap=Hw,n.NetInput=rf,n.resolveInput=Qc,n.toNetInput=wr,n.env=zn,n.sigmoid=of,n.inverseSigmoid=MF,n.iou=qw,n.nonMaxSuppression=Tu,n.normalize=Jc,n.padToSquare=Gw,n.shuffleArray=PF,n.isTensor=ku,n.isTensor1D=RF,n.isTensor2D=Tw,n.isTensor3D=jc,n.isTensor4D=Ma,n.isFloat=Dw,n.isEven=pm,n.round=Kc,n.isDimensions=hm,n.computeReshapedDimensions=Aw,n.getCenterPoint=Zd,n.range=mm,n.isValidNumber=yi,n.isValidProbablitiy=gm,n.NeuralNetwork=xi,n.FaceDetection=Wo,n.FaceLandmarks=tl,n.FaceLandmarks5=Kw,n.FaceLandmarks68=Dm,n.FaceMatch=Am,n.LabeledFaceDescriptors=uf,n.drawContour=Si,n.drawLandmarks=VF,n.drawFaceExpressions=HF,n.extractFaces=gs,n.extractFaceTensors=vs,n.FaceExpressionNet=Zw,n.faceExpressionLabels=lf,n.FaceLandmarkNet=ZF,n.FaceLandmark68Net=Nm,n.FaceLandmark68TinyNet=e2,n.createFaceRecognitionNet=i$,n.FaceRecognitionNet=Mm,n.extendWithFaceDescriptor=Om,n.extendWithFaceDetection=Du,n.extendWithFaceExpressions=Fm,n.extendWithFaceLandmarks=el,n.allFacesSsdMobilenetv1=m2,n.allFacesTinyYolov2=fB,n.allFacesMtcnn=pB,n.allFaces=hB,n.ComposableTask=nl,n.ComputeFaceDescriptorsTaskBase=Vm,n.ComputeAllFaceDescriptorsTask=d2,n.ComputeSingleFaceDescriptorTask=f2,n.detectSingleFace=dB,n.detectAllFaces=gf,n.DetectFacesTaskBase=jm,n.DetectAllFacesTask=Km,n.DetectSingleFaceTask=h2,n.DetectFaceLandmarksTaskBase=Hm,n.DetectAllFaceLandmarksTask=Gm,n.DetectSingleFaceLandmarksTask=qm,n.FaceMatcher=mB,n.nets=ln,n.ssdMobilenetv1=u2,n.tinyFaceDetector=j$,n.tinyYolov2=K$,n.mtcnn=X$,n.detectFaceLandmarks=c2,n.detectFaceLandmarksTiny=Y$,n.computeFaceDescriptor=Q$,n.recognizeFaceExpressions=J$,n.loadSsdMobilenetv1Model=l2,n.loadTinyFaceDetectorModel=Z$,n.loadMtcnnModel=tB,n.loadTinyYolov2Model=eB,n.loadFaceLandmarkModel=nB,n.loadFaceLandmarkTinyModel=rB,n.loadFaceRecognitionModel=oB,n.loadFaceExpressionModel=aB,n.loadFaceDetectionModel=iB,n.locateFaces=sB,n.detectLandmarks=uB,n.createMtcnn=gB,n.Mtcnn=Wm,n.MtcnnOptions=ff,n.createSsdMobilenetv1=o2,n.createFaceDetectionNet=w$,n.FaceDetectionNet=C$,n.SsdMobilenetv1=pf,n.SsdMobilenetv1Options=bs,n.createTinyFaceDetector=vB,n.TinyFaceDetector=Um,n.TinyFaceDetectorOptions=a2,n.TinyYolov2=zm,n.createTinyYolov2=q$,n.euclideanDistance=g2,n.resizeResults=v2,Object.defineProperty(n,"__esModule",{value:!0})})}(yl,yl.exports)),yl.exports}blt();const nD=(e,t)=>{const n=e.__vccOpts||e;for(const[r,o]of t)n[r]=o;return n},xlt={components:{FileUpload:IE},data(){return{faceCount:null,loading:!1,src:null}},async mounted(){await this.loadModels()},methods:{async loadModels(){try{await Go.tinyFaceDetector.loadFromUri("/ai-image-recognition-app/models")}catch(e){console.error("❌ Error loading Face-api.js models",e)}},onFileSelect(e){const t=e.files[0],n=new FileReader;n.onload=async r=>{this.src&&URL.revokeObjectURL(this.src),this.src=r.target.result},n.readAsDataURL(t)},async detectFaces(){if(console.log("detecting..."),console.log("setting loading to true"),!!this.src){this.loading=!0,this.faceCount=null,await this.$nextTick(),await new Promise(e=>setTimeout(e,50));try{const e=this.$refs.imageRef,t=this.$refs.canvasRef;if(!e){this.loading=!1;return}if(!t){this.loading=!1;return}const n={width:e.width,height:e.height};t.width=n.width,t.height=n.height;const r=await flt(e,new GT);if(!r||r.length===0){this.faceCount=0,this.loading=!1;return}const o=eD(r,n),i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),o.forEach(l=>{const d=l.box;i.strokeStyle="red",i.lineWidth=2,i.strokeRect(d.x,d.y,d.width,d.height)}),this.faceCount=o.length}catch(e){console.error("❌ Face detection failed:",e)}this.loading=!1}},clearImage(){this.src&&URL.revokeObjectURL(this.src),this.src=null,this.faceCount=null}}},wlt={class:"app-container"},Clt={class:"face-recognition-container fade-in"},Slt={class:"button-group"},_lt={key:0,class:"image-preview-container"},Elt={class:"canvas-wrapper"},klt=["src"],Rlt={ref:"canvasRef",class:"canvas-overlay"},Tlt={class:"status-container"},Dlt={key:0,class:"loading-spinner"},Alt={class:"face-count"},Ilt={key:0,class:"text-green-500"},Nlt={key:1,class:"text-red-500"};function Plt(e,t,n,r,o,i){const l=Ao("FileUpload");return de(),He("div",wlt,[t[6]||(t[6]=Ve("div",{class:"intro-container fade-in"},[Ve("h1",{class:"intro-title"},"Welcome to My Face Detection App! 👋"),Ve("p",{class:"intro-text"}," This is an AI-powered face detection app built with Vue.js & Face-api.js. Upload an image, and the app will detect faces instantly! "),Ve("p",{class:"intro-text"}," I'm Miriam Araújo, a passionate web developer focused on JavaScript, Vue.js, and AI applications. ")],-1)),Ve("div",Clt,[t[5]||(t[5]=Ve("h2",{class:"title"},"Face Detection",-1)),Ve("div",Slt,[In(l,{mode:"basic",onSelect:i.onFileSelect,customUpload:"",auto:"",accept:"image/jpeg, image/png",class:"custom-btn upload-btn"},{default:zo(()=>t[2]||(t[2]=[Ve("i",{class:"pi pi-upload"},null,-1),Us(" Upload Image ")])),_:1},8,["onSelect"]),o.src?(de(),He("button",{key:0,class:"custom-btn clear-btn",onClick:t[0]||(t[0]=(...d)=>i.clearImage&&i.clearImage(...d))},t[3]||(t[3]=[Ve("i",{class:"pi pi-trash"},null,-1),Us(" Clear Image ")]))):Hn("",!0)]),o.src?(de(),He("div",_lt,[Ve("div",Elt,[o.src?(de(),He("img",{key:0,ref:"imageRef",src:o.src,alt:"Uploaded Image",class:"image-preview fade-in",onLoad:t[1]||(t[1]=(...d)=>i.detectFaces&&i.detectFaces(...d))},null,40,klt)):Hn("",!0),Ve("canvas",Rlt,null,512)])])):Hn("",!0),Ve("div",Tlt,[o.loading?(de(),He("div",Dlt,t[4]||(t[4]=[Ve("div",{class:"spinner"},null,-1),Ve("p",null,"Detecting Faces...",-1)]))):Hn("",!0),Ve("p",Alt,[o.faceCount!==null&&o.faceCount>0?(de(),He("span",Ilt," 🟢 Detected Faces: "+va(o.faceCount),1)):o.faceCount===0?(de(),He("span",Nlt," 🔴 No Faces Detected ")):Hn("",!0)])])]),t[7]||(t[7]=c5('<footer class="footer fade-in" data-v-b10e9f87><p data-v-b10e9f87>🔗 Connect with me:</p><div class="social-links" data-v-b10e9f87><a href="https://github.com/M-Araujo" target="_blank" data-v-b10e9f87><i class="pi pi-github" data-v-b10e9f87></i> GitHub</a><a href="https://www.linkedin.com/in/miriam-araujo-dev" target="_blank" data-v-b10e9f87><i class="pi pi-linkedin" data-v-b10e9f87></i> LinkedIn</a><a href="https://codepen.io/M-Araujo" target="_blank" data-v-b10e9f87><i class="pi pi-codepen" data-v-b10e9f87></i> CodePen</a></div></footer>',1))])}const Mlt=nD(xlt,[["render",Plt],["__scopeId","data-v-b10e9f87"]]),Olt={components:{FaceRecognition:Mlt}};function Flt(e,t,n,r,o,i){const l=Ao("FaceRecognition");return de(),He("div",null,[t[0]||(t[0]=Ve("h1",null,"AI Image Recognition App",-1)),In(l)])}const $lt=nD(Olt,[["render",Flt]]);var Sr={STARTS_WITH:"startsWith",CONTAINS:"contains",NOT_CONTAINS:"notContains",ENDS_WITH:"endsWith",EQUALS:"equals",NOT_EQUALS:"notEquals",LESS_THAN:"lt",LESS_THAN_OR_EQUAL_TO:"lte",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL_TO:"gte",DATE_IS:"dateIs",DATE_IS_NOT:"dateIsNot",DATE_BEFORE:"dateBefore",DATE_AFTER:"dateAfter"};function td(e){"@babel/helpers - typeof";return td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},td(e)}function YS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Bf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YS(Object(n),!0).forEach(function(r){Blt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YS(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Blt(e,t,n){return(t=Llt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Llt(e){var t=Wlt(e,"string");return td(t)=="symbol"?t:t+""}function Wlt(e,t){if(td(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(td(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ult={ripple:!1,inputStyle:null,inputVariant:null,locale:{startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",completed:"Completed",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",today:"Today",weekHeader:"Wk",firstDayOfWeek:0,showMonthAfterYear:!1,dateFormat:"mm/dd/yy",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyFilterMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",fileChosenMessage:"{0} files",noFileChosenMessage:"No file chosen",emptyMessage:"No available options",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"Page {page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left",listLabel:"Option List"}},filterMatchModeOptions:{text:[Sr.STARTS_WITH,Sr.CONTAINS,Sr.NOT_CONTAINS,Sr.ENDS_WITH,Sr.EQUALS,Sr.NOT_EQUALS],numeric:[Sr.EQUALS,Sr.NOT_EQUALS,Sr.LESS_THAN,Sr.LESS_THAN_OR_EQUAL_TO,Sr.GREATER_THAN,Sr.GREATER_THAN_OR_EQUAL_TO],date:[Sr.DATE_IS,Sr.DATE_IS_NOT,Sr.DATE_BEFORE,Sr.DATE_AFTER]},zIndex:{modal:1100,overlay:1e3,menu:1e3,tooltip:1100},theme:void 0,unstyled:!1,pt:void 0,ptOptions:{mergeSections:!0,mergeProps:!1},csp:{nonce:void 0}},zlt=Symbol();function Vlt(e,t){var n={config:Ap(t)};return e.config.globalProperties.$primevue=n,e.provide(zlt,n),Hlt(),Glt(e,n),n}var Hu=[];function Hlt(){cr.clear(),Hu.forEach(function(e){return e==null?void 0:e()}),Hu=[]}function Glt(e,t){var n=Lf(!1),r=function(){var h;if(((h=t.config)===null||h===void 0?void 0:h.theme)!=="none"&&!en.isStyleNameLoaded("common")){var g,y,x=((g=mn.getCommonTheme)===null||g===void 0?void 0:g.call(mn))||{},C=x.primitive,_=x.semantic,k=x.global,A=x.style,I={nonce:(y=t.config)===null||y===void 0||(y=y.csp)===null||y===void 0?void 0:y.nonce};mn.load(C==null?void 0:C.css,Bf({name:"primitive-variables"},I)),mn.load(_==null?void 0:_.css,Bf({name:"semantic-variables"},I)),mn.load(k==null?void 0:k.css,Bf({name:"global-variables"},I)),mn.loadStyle(Bf({name:"global-style"},I),A),en.setLoadedStyleName("common")}};cr.on("theme:change",function(p){n.value||(e.config.globalProperties.$primevue.config.theme=p,n.value=!0)});var o=Mi(t.config,function(p,h){Oi.emit("config:change",{newValue:p,oldValue:h})},{immediate:!0,deep:!0}),i=Mi(function(){return t.config.ripple},function(p,h){Oi.emit("config:ripple:change",{newValue:p,oldValue:h})},{immediate:!0,deep:!0}),l=Mi(function(){return t.config.theme},function(p,h){n.value||en.setTheme(p),t.config.unstyled||r(),n.value=!1,Oi.emit("config:theme:change",{newValue:p,oldValue:h})},{immediate:!0,deep:!1}),d=Mi(function(){return t.config.unstyled},function(p,h){!p&&t.config.theme&&r(),Oi.emit("config:unstyled:change",{newValue:p,oldValue:h})},{immediate:!0,deep:!0});Hu.push(o),Hu.push(i),Hu.push(l),Hu.push(d)}var qlt={install:function(t,n){var r=v6(Ult,n);Vlt(t,r)}},jlt={transitionDuration:"{transition.duration}"},Klt={borderWidth:"0 0 1px 0",borderColor:"{content.border.color}"},Xlt={color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",padding:"1.125rem",fontWeight:"600",borderRadius:"0",borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",hoverBackground:"{content.background}",activeBackground:"{content.background}",activeHoverBackground:"{content.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"},toggleIcon:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",activeHoverColor:"{text.color}"},first:{topBorderRadius:"{content.border.radius}",borderWidth:"0"},last:{bottomBorderRadius:"{content.border.radius}",activeBottomBorderRadius:"0"}},Ylt={borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",color:"{text.color}",padding:"0 1.125rem 1.125rem 1.125rem"},Qlt={root:jlt,panel:Klt,header:Xlt,content:Ylt},Jlt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},Zlt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},tdt={padding:"{list.padding}",gap:"{list.gap}"},edt={focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},ndt={background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},rdt={width:"2.5rem",sm:{width:"2rem"},lg:{width:"3rem"},borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},odt={borderRadius:"{border.radius.sm}"},adt={padding:"{list.option.padding}"},idt={light:{chip:{focusBackground:"{surface.200}",focusColor:"{surface.800}"},dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"}},dark:{chip:{focusBackground:"{surface.700}",focusColor:"{surface.0}"},dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"}}},sdt={root:Jlt,overlay:Zlt,list:tdt,option:edt,optionGroup:ndt,dropdown:rdt,chip:odt,emptyMessage:adt,colorScheme:idt},udt={width:"2rem",height:"2rem",fontSize:"1rem",background:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"},cdt={size:"1rem"},ldt={borderColor:"{content.background}",offset:"-0.75rem"},ddt={width:"3rem",height:"3rem",fontSize:"1.5rem",icon:{size:"1.5rem"},group:{offset:"-1rem"}},fdt={width:"4rem",height:"4rem",fontSize:"2rem",icon:{size:"2rem"},group:{offset:"-1.5rem"}},pdt={root:udt,icon:cdt,group:ldt,lg:ddt,xl:fdt},hdt={borderRadius:"{border.radius.md}",padding:"0 0.5rem",fontSize:"0.75rem",fontWeight:"700",minWidth:"1.5rem",height:"1.5rem"},mdt={size:"0.5rem"},gdt={fontSize:"0.625rem",minWidth:"1.25rem",height:"1.25rem"},vdt={fontSize:"0.875rem",minWidth:"1.75rem",height:"1.75rem"},ydt={fontSize:"1rem",minWidth:"2rem",height:"2rem"},bdt={light:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.500}",color:"{surface.0}"},info:{background:"{sky.500}",color:"{surface.0}"},warn:{background:"{orange.500}",color:"{surface.0}"},danger:{background:"{red.500}",color:"{surface.0}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"{green.400}",color:"{green.950}"},info:{background:"{sky.400}",color:"{sky.950}"},warn:{background:"{orange.400}",color:"{orange.950}"},danger:{background:"{red.400}",color:"{red.950}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}},xdt={root:hdt,dot:mdt,sm:gdt,lg:vdt,xl:ydt,colorScheme:bdt},wdt={borderRadius:{none:"0",xs:"2px",sm:"4px",md:"6px",lg:"8px",xl:"12px"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"}},Cdt={transitionDuration:"0.2s",focusRing:{width:"1px",style:"solid",color:"{primary.color}",offset:"2px",shadow:"none"},disabledOpacity:"0.6",iconSize:"1rem",anchorGutter:"2px",primary:{50:"{emerald.50}",100:"{emerald.100}",200:"{emerald.200}",300:"{emerald.300}",400:"{emerald.400}",500:"{emerald.500}",600:"{emerald.600}",700:"{emerald.700}",800:"{emerald.800}",900:"{emerald.900}",950:"{emerald.950}"},formField:{paddingX:"0.75rem",paddingY:"0.5rem",sm:{fontSize:"0.875rem",paddingX:"0.625rem",paddingY:"0.375rem"},lg:{fontSize:"1.125rem",paddingX:"0.875rem",paddingY:"0.625rem"},borderRadius:"{border.radius.md}",focusRing:{width:"0",style:"none",color:"transparent",offset:"0",shadow:"none"},transitionDuration:"{transition.duration}"},list:{padding:"0.25rem 0.25rem",gap:"2px",header:{padding:"0.5rem 1rem 0.25rem 1rem"},option:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}"},optionGroup:{padding:"0.5rem 0.75rem",fontWeight:"600"}},content:{borderRadius:"{border.radius.md}"},mask:{transitionDuration:"0.15s"},navigation:{list:{padding:"0.25rem 0.25rem",gap:"2px"},item:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}",gap:"0.5rem"},submenuLabel:{padding:"0.5rem 0.75rem",fontWeight:"600"},submenuIcon:{size:"0.875rem"}},overlay:{select:{borderRadius:"{border.radius.md}",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},popover:{borderRadius:"{border.radius.md}",padding:"0.75rem",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},modal:{borderRadius:"{border.radius.xl}",padding:"1.25rem",shadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"},navigation:{shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"}},colorScheme:{light:{surface:{0:"#ffffff",50:"{slate.50}",100:"{slate.100}",200:"{slate.200}",300:"{slate.300}",400:"{slate.400}",500:"{slate.500}",600:"{slate.600}",700:"{slate.700}",800:"{slate.800}",900:"{slate.900}",950:"{slate.950}"},primary:{color:"{primary.500}",contrastColor:"#ffffff",hoverColor:"{primary.600}",activeColor:"{primary.700}"},highlight:{background:"{primary.50}",focusBackground:"{primary.100}",color:"{primary.700}",focusColor:"{primary.800}"},mask:{background:"rgba(0,0,0,0.4)",color:"{surface.200}"},formField:{background:"{surface.0}",disabledBackground:"{surface.200}",filledBackground:"{surface.50}",filledHoverBackground:"{surface.50}",filledFocusBackground:"{surface.50}",borderColor:"{surface.300}",hoverBorderColor:"{surface.400}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.400}",color:"{surface.700}",disabledColor:"{surface.500}",placeholderColor:"{surface.500}",invalidPlaceholderColor:"{red.600}",floatLabelColor:"{surface.500}",floatLabelFocusColor:"{primary.600}",floatLabelActiveColor:"{surface.500}",floatLabelInvalidColor:"{form.field.invalid.placeholder.color}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.700}",hoverColor:"{surface.800}",mutedColor:"{surface.500}",hoverMutedColor:"{surface.600}"},content:{background:"{surface.0}",hoverBackground:"{surface.100}",borderColor:"{surface.200}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},popover:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},modal:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.100}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.100}",activeBackground:"{surface.100}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}}},dark:{surface:{0:"#ffffff",50:"{zinc.50}",100:"{zinc.100}",200:"{zinc.200}",300:"{zinc.300}",400:"{zinc.400}",500:"{zinc.500}",600:"{zinc.600}",700:"{zinc.700}",800:"{zinc.800}",900:"{zinc.900}",950:"{zinc.950}"},primary:{color:"{primary.400}",contrastColor:"{surface.900}",hoverColor:"{primary.300}",activeColor:"{primary.200}"},highlight:{background:"color-mix(in srgb, {primary.400}, transparent 84%)",focusBackground:"color-mix(in srgb, {primary.400}, transparent 76%)",color:"rgba(255,255,255,.87)",focusColor:"rgba(255,255,255,.87)"},mask:{background:"rgba(0,0,0,0.6)",color:"{surface.200}"},formField:{background:"{surface.950}",disabledBackground:"{surface.700}",filledBackground:"{surface.800}",filledHoverBackground:"{surface.800}",filledFocusBackground:"{surface.800}",borderColor:"{surface.600}",hoverBorderColor:"{surface.500}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.300}",color:"{surface.0}",disabledColor:"{surface.400}",placeholderColor:"{surface.400}",invalidPlaceholderColor:"{red.400}",floatLabelColor:"{surface.400}",floatLabelFocusColor:"{primary.color}",floatLabelActiveColor:"{surface.400}",floatLabelInvalidColor:"{form.field.invalid.placeholder.color}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.0}",hoverColor:"{surface.0}",mutedColor:"{surface.400}",hoverMutedColor:"{surface.300}"},content:{background:"{surface.900}",hoverBackground:"{surface.800}",borderColor:"{surface.700}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},popover:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},modal:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.800}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.800}",activeBackground:"{surface.800}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}}}}},Sdt={primitive:wdt,semantic:Cdt},_dt={borderRadius:"{content.border.radius}"},Edt={root:_dt},kdt={padding:"1rem",background:"{content.background}",gap:"0.5rem",transitionDuration:"{transition.duration}"},Rdt={color:"{text.muted.color}",hoverColor:"{text.color}",borderRadius:"{content.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",hoverColor:"{navigation.item.icon.focus.color}"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Tdt={color:"{navigation.item.icon.color}"},Ddt={root:kdt,item:Rdt,separator:Tdt},Adt={borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",gap:"0.5rem",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",iconOnlyWidth:"2.5rem",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}",iconOnlyWidth:"2rem"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}",iconOnlyWidth:"3rem"},label:{fontWeight:"500"},raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"},badgeSize:"1rem",transitionDuration:"{form.field.transition.duration}"},Idt={light:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",borderColor:"{surface.100}",hoverBorderColor:"{surface.200}",activeBorderColor:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}",focusRing:{color:"{surface.600}",shadow:"none"}},info:{background:"{sky.500}",hoverBackground:"{sky.600}",activeBackground:"{sky.700}",borderColor:"{sky.500}",hoverBorderColor:"{sky.600}",activeBorderColor:"{sky.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{sky.500}",shadow:"none"}},success:{background:"{green.500}",hoverBackground:"{green.600}",activeBackground:"{green.700}",borderColor:"{green.500}",hoverBorderColor:"{green.600}",activeBorderColor:"{green.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{green.500}",shadow:"none"}},warn:{background:"{orange.500}",hoverBackground:"{orange.600}",activeBackground:"{orange.700}",borderColor:"{orange.500}",hoverBorderColor:"{orange.600}",activeBorderColor:"{orange.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{orange.500}",shadow:"none"}},help:{background:"{purple.500}",hoverBackground:"{purple.600}",activeBackground:"{purple.700}",borderColor:"{purple.500}",hoverBorderColor:"{purple.600}",activeBorderColor:"{purple.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{purple.500}",shadow:"none"}},danger:{background:"{red.500}",hoverBackground:"{red.600}",activeBackground:"{red.700}",borderColor:"{red.500}",hoverBorderColor:"{red.600}",activeBorderColor:"{red.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{red.500}",shadow:"none"}},contrast:{background:"{surface.950}",hoverBackground:"{surface.900}",activeBackground:"{surface.800}",borderColor:"{surface.950}",hoverBorderColor:"{surface.900}",activeBorderColor:"{surface.800}",color:"{surface.0}",hoverColor:"{surface.0}",activeColor:"{surface.0}",focusRing:{color:"{surface.950}",shadow:"none"}}},outlined:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",borderColor:"{primary.200}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",borderColor:"{green.200}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",borderColor:"{sky.200}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",borderColor:"{orange.200}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",borderColor:"{purple.200}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",borderColor:"{red.200}",color:"{red.500}"},contrast:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.700}",color:"{surface.950}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.700}"}},text:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",color:"{red.500}"},contrast:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.950}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.700}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}},dark:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",borderColor:"{surface.800}",hoverBorderColor:"{surface.700}",activeBorderColor:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}",focusRing:{color:"{surface.300}",shadow:"none"}},info:{background:"{sky.400}",hoverBackground:"{sky.300}",activeBackground:"{sky.200}",borderColor:"{sky.400}",hoverBorderColor:"{sky.300}",activeBorderColor:"{sky.200}",color:"{sky.950}",hoverColor:"{sky.950}",activeColor:"{sky.950}",focusRing:{color:"{sky.400}",shadow:"none"}},success:{background:"{green.400}",hoverBackground:"{green.300}",activeBackground:"{green.200}",borderColor:"{green.400}",hoverBorderColor:"{green.300}",activeBorderColor:"{green.200}",color:"{green.950}",hoverColor:"{green.950}",activeColor:"{green.950}",focusRing:{color:"{green.400}",shadow:"none"}},warn:{background:"{orange.400}",hoverBackground:"{orange.300}",activeBackground:"{orange.200}",borderColor:"{orange.400}",hoverBorderColor:"{orange.300}",activeBorderColor:"{orange.200}",color:"{orange.950}",hoverColor:"{orange.950}",activeColor:"{orange.950}",focusRing:{color:"{orange.400}",shadow:"none"}},help:{background:"{purple.400}",hoverBackground:"{purple.300}",activeBackground:"{purple.200}",borderColor:"{purple.400}",hoverBorderColor:"{purple.300}",activeBorderColor:"{purple.200}",color:"{purple.950}",hoverColor:"{purple.950}",activeColor:"{purple.950}",focusRing:{color:"{purple.400}",shadow:"none"}},danger:{background:"{red.400}",hoverBackground:"{red.300}",activeBackground:"{red.200}",borderColor:"{red.400}",hoverBorderColor:"{red.300}",activeBorderColor:"{red.200}",color:"{red.950}",hoverColor:"{red.950}",activeColor:"{red.950}",focusRing:{color:"{red.400}",shadow:"none"}},contrast:{background:"{surface.0}",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{surface.0}",hoverBorderColor:"{surface.100}",activeBorderColor:"{surface.200}",color:"{surface.950}",hoverColor:"{surface.950}",activeColor:"{surface.950}",focusRing:{color:"{surface.0}",shadow:"none"}}},outlined:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",borderColor:"{primary.700}",color:"{primary.color}"},secondary:{hoverBackground:"rgba(255,255,255,0.04)",activeBackground:"rgba(255,255,255,0.16)",borderColor:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",borderColor:"{green.700}",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",borderColor:"{sky.700}",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",borderColor:"{orange.700}",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",borderColor:"{purple.700}",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",borderColor:"{red.700}",color:"{red.400}"},contrast:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.500}",color:"{surface.0}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.600}",color:"{surface.0}"}},text:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",color:"{primary.color}"},secondary:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",color:"{red.400}"},contrast:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.0}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.0}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}}},Ndt={root:Adt,colorScheme:Idt},Pdt={background:"{content.background}",borderRadius:"{border.radius.xl}",color:"{content.color}",shadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},Mdt={padding:"1.25rem",gap:"0.5rem"},Odt={gap:"0.5rem"},Fdt={fontSize:"1.25rem",fontWeight:"500"},$dt={color:"{text.muted.color}"},Bdt={root:Pdt,body:Mdt,caption:Odt,title:Fdt,subtitle:$dt},Ldt={transitionDuration:"{transition.duration}"},Wdt={gap:"0.25rem"},Udt={padding:"1rem",gap:"0.5rem"},zdt={width:"2rem",height:"0.5rem",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Vdt={light:{indicator:{background:"{surface.200}",hoverBackground:"{surface.300}",activeBackground:"{primary.color}"}},dark:{indicator:{background:"{surface.700}",hoverBackground:"{surface.600}",activeBackground:"{primary.color}"}}},Hdt={root:Ldt,content:Wdt,indicatorList:Udt,indicator:zdt,colorScheme:Vdt},Gdt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},qdt={width:"2.5rem",color:"{form.field.icon.color}"},jdt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},Kdt={padding:"{list.padding}",gap:"{list.gap}",mobileIndent:"1rem"},Xdt={focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",icon:{color:"{list.option.icon.color}",focusColor:"{list.option.icon.focus.color}",size:"0.875rem"}},Ydt={color:"{form.field.icon.color}"},Qdt={root:Gdt,dropdown:qdt,overlay:jdt,list:Kdt,option:Xdt,clearIcon:Ydt},Jdt={borderRadius:"{border.radius.sm}",width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{width:"1rem",height:"1rem"},lg:{width:"1.5rem",height:"1.5rem"}},Zdt={size:"0.875rem",color:"{form.field.color}",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}",sm:{size:"0.75rem"},lg:{size:"1rem"}},tft={root:Jdt,icon:Zdt},eft={borderRadius:"16px",paddingX:"0.75rem",paddingY:"0.5rem",gap:"0.5rem",transitionDuration:"{transition.duration}"},nft={width:"2rem",height:"2rem"},rft={size:"1rem"},oft={size:"1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"}},aft={light:{root:{background:"{surface.100}",color:"{surface.800}"},icon:{color:"{surface.800}"},removeIcon:{color:"{surface.800}"}},dark:{root:{background:"{surface.800}",color:"{surface.0}"},icon:{color:"{surface.0}"},removeIcon:{color:"{surface.0}"}}},ift={root:eft,image:nft,icon:rft,removeIcon:oft,colorScheme:aft},sft={transitionDuration:"{transition.duration}"},uft={width:"1.5rem",height:"1.5rem",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},cft={shadow:"{overlay.popover.shadow}",borderRadius:"{overlay.popover.borderRadius}"},lft={light:{panel:{background:"{surface.800}",borderColor:"{surface.900}"},handle:{color:"{surface.0}"}},dark:{panel:{background:"{surface.900}",borderColor:"{surface.700}"},handle:{color:"{surface.0}"}}},dft={root:sft,preview:uft,panel:cft,colorScheme:lft},fft={size:"2rem",color:"{overlay.modal.color}"},pft={gap:"1rem"},hft={icon:fft,content:pft},mft={background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},gft={padding:"{overlay.popover.padding}",gap:"1rem"},vft={size:"1.5rem",color:"{overlay.popover.color}"},yft={gap:"0.5rem",padding:"0 {overlay.popover.padding} {overlay.popover.padding} {overlay.popover.padding}"},bft={root:mft,content:gft,icon:vft,footer:yft},xft={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},wft={padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},Cft={focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},Sft={mobileIndent:"1rem"},_ft={size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},Eft={borderColor:"{content.border.color}"},kft={root:xft,list:wft,item:Cft,submenu:Sft,submenuIcon:_ft,separator:Eft},Rft={transitionDuration:"{transition.duration}"},Tft={background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem",sm:{padding:"0.375rem 0.5rem"},lg:{padding:"1rem 1.25rem"}},Dft={background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{datatable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"},sm:{padding:"0.375rem 0.5rem"},lg:{padding:"1rem 1.25rem"}},Aft={fontWeight:"600"},Ift={background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},Nft={borderColor:"{datatable.border.color}",padding:"0.75rem 1rem",sm:{padding:"0.375rem 0.5rem"},lg:{padding:"1rem 1.25rem"}},Pft={background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",padding:"0.75rem 1rem",sm:{padding:"0.375rem 0.5rem"},lg:{padding:"1rem 1.25rem"}},Mft={fontWeight:"600"},Oft={background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem",sm:{padding:"0.375rem 0.5rem"},lg:{padding:"1rem 1.25rem"}},Fft={color:"{primary.color}"},$ft={width:"0.5rem"},Bft={width:"1px",color:"{primary.color}"},Lft={color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",size:"0.875rem"},Wft={size:"2rem"},Uft={hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},zft={inlineGap:"0.5rem",overlaySelect:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},overlayPopover:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}",gap:"0.5rem"},rule:{borderColor:"{content.border.color}"},constraintList:{padding:"{list.padding}",gap:"{list.gap}"},constraint:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",separator:{borderColor:"{content.border.color}"},padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"}},Vft={borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},Hft={borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},Gft={light:{root:{borderColor:"{content.border.color}"},row:{stripedBackground:"{surface.50}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},row:{stripedBackground:"{surface.950}"},bodyCell:{selectedBorderColor:"{primary.900}"}}},qft={root:Rft,header:Tft,headerCell:Dft,columnTitle:Aft,row:Ift,bodyCell:Nft,footerCell:Pft,columnFooter:Mft,footer:Oft,dropPoint:Fft,columnResizer:$ft,resizeIndicator:Bft,sortIcon:Lft,loadingIcon:Wft,rowToggleButton:Uft,filter:zft,paginatorTop:Vft,paginatorBottom:Hft,colorScheme:Gft},jft={borderColor:"transparent",borderWidth:"0",borderRadius:"0",padding:"0"},Kft={background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem",borderRadius:"0"},Xft={background:"{content.background}",color:"{content.color}",borderColor:"transparent",borderWidth:"0",padding:"0",borderRadius:"0"},Yft={background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"1px 0 0 0",padding:"0.75rem 1rem",borderRadius:"0"},Qft={borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},Jft={borderColor:"{content.border.color}",borderWidth:"1px 0 0 0"},Zft={root:jft,header:Kft,content:Xft,footer:Yft,paginatorTop:Qft,paginatorBottom:Jft},tpt={transitionDuration:"{transition.duration}"},ept={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}"},npt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",padding:"0 0 0.5rem 0"},rpt={gap:"0.5rem",fontWeight:"500"},opt={width:"2.5rem",sm:{width:"2rem"},lg:{width:"3rem"},borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},apt={color:"{form.field.icon.color}"},ipt={hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},spt={hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},upt={borderColor:"{content.border.color}",gap:"{overlay.popover.padding}"},cpt={margin:"0.5rem 0 0 0"},lpt={padding:"0.25rem",fontWeight:"500",color:"{content.color}"},dpt={hoverBackground:"{content.hover.background}",selectedBackground:"{primary.color}",rangeSelectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{primary.contrast.color}",rangeSelectedColor:"{highlight.color}",width:"2rem",height:"2rem",borderRadius:"50%",padding:"0.25rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},fpt={margin:"0.5rem 0 0 0"},ppt={padding:"0.375rem",borderRadius:"{content.border.radius}"},hpt={margin:"0.5rem 0 0 0"},mpt={padding:"0.375rem",borderRadius:"{content.border.radius}"},gpt={padding:"0.5rem 0 0 0",borderColor:"{content.border.color}"},vpt={padding:"0.5rem 0 0 0",borderColor:"{content.border.color}",gap:"0.5rem",buttonGap:"0.25rem"},ypt={light:{dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"},today:{background:"{surface.200}",color:"{surface.900}"}},dark:{dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"},today:{background:"{surface.700}",color:"{surface.0}"}}},bpt={root:tpt,panel:ept,header:npt,title:rpt,dropdown:opt,inputIcon:apt,selectMonth:ipt,selectYear:spt,group:upt,dayView:cpt,weekDay:lpt,date:dpt,monthView:fpt,month:ppt,yearView:hpt,year:mpt,buttonbar:gpt,timePicker:vpt,colorScheme:ypt},xpt={background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",borderRadius:"{overlay.modal.border.radius}",shadow:"{overlay.modal.shadow}"},wpt={padding:"{overlay.modal.padding}",gap:"0.5rem"},Cpt={fontSize:"1.25rem",fontWeight:"600"},Spt={padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"},_pt={padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}",gap:"0.5rem"},Ept={root:xpt,header:wpt,title:Cpt,content:Spt,footer:_pt},kpt={borderColor:"{content.border.color}"},Rpt={background:"{content.background}",color:"{text.color}"},Tpt={margin:"1rem 0",padding:"0 1rem",content:{padding:"0 0.5rem"}},Dpt={margin:"0 1rem",padding:"0.5rem 0",content:{padding:"0.5rem 0"}},Apt={root:kpt,content:Rpt,horizontal:Tpt,vertical:Dpt},Ipt={background:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)",padding:"0.5rem",borderRadius:"{border.radius.xl}"},Npt={borderRadius:"{content.border.radius}",padding:"0.5rem",size:"3rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Ppt={root:Ipt,item:Npt},Mpt={background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",shadow:"{overlay.modal.shadow}"},Opt={padding:"{overlay.modal.padding}"},Fpt={fontSize:"1.5rem",fontWeight:"600"},$pt={padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"},Bpt={padding:"{overlay.modal.padding}"},Lpt={root:Mpt,header:Opt,title:Fpt,content:$pt,footer:Bpt},Wpt={background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}"},Upt={color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},zpt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}",padding:"{list.padding}"},Vpt={focusBackground:"{list.option.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},Hpt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"},Gpt={toolbar:Wpt,toolbarItem:Upt,overlay:zpt,overlayOption:Vpt,content:Hpt},qpt={background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",padding:"0 1.125rem 1.125rem 1.125rem",transitionDuration:"{transition.duration}"},jpt={background:"{content.background}",hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",borderRadius:"{content.border.radius}",borderWidth:"1px",borderColor:"transparent",padding:"0.5rem 0.75rem",gap:"0.5rem",fontWeight:"600",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Kpt={color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},Xpt={padding:"0"},Ypt={root:qpt,legend:jpt,toggleIcon:Kpt,content:Xpt},Qpt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},Jpt={background:"transparent",color:"{text.color}",padding:"1.125rem",borderColor:"unset",borderWidth:"0",borderRadius:"0",gap:"0.5rem"},Zpt={highlightBorderColor:"{primary.color}",padding:"0 1.125rem 1.125rem 1.125rem",gap:"1rem"},tht={padding:"1rem",gap:"1rem",borderColor:"{content.border.color}",info:{gap:"0.5rem"}},eht={gap:"0.5rem"},nht={height:"0.25rem"},rht={gap:"0.5rem"},oht={root:Qpt,header:Jpt,content:Zpt,file:tht,fileList:eht,progressbar:nht,basic:rht},aht={color:"{form.field.float.label.color}",focusColor:"{form.field.float.label.focus.color}",activeColor:"{form.field.float.label.active.color}",invalidColor:"{form.field.float.label.invalid.color}",transitionDuration:"0.2s",positionX:"{form.field.padding.x}",positionY:"{form.field.padding.y}",fontWeight:"500",active:{fontSize:"0.75rem",fontWeight:"400"}},iht={active:{top:"-1.25rem"}},sht={input:{paddingTop:"1.5rem",paddingBottom:"{form.field.padding.y}"},active:{top:"{form.field.padding.y}"}},uht={borderRadius:"{border.radius.xs}",active:{background:"{form.field.background}",padding:"0 0.125rem"}},cht={root:aht,over:iht,in:sht,on:uht},lht={borderWidth:"1px",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},dht={background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.100}",hoverColor:"{surface.0}",size:"3rem",gutter:"0.5rem",prev:{borderRadius:"50%"},next:{borderRadius:"50%"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},fht={size:"1.5rem"},pht={background:"{content.background}",padding:"1rem 0.25rem"},hht={size:"2rem",borderRadius:"{content.border.radius}",gutter:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},mht={size:"1rem"},ght={background:"rgba(0, 0, 0, 0.5)",color:"{surface.100}",padding:"1rem"},vht={gap:"0.5rem",padding:"1rem"},yht={width:"1rem",height:"1rem",activeBackground:"{primary.color}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},bht={background:"rgba(0, 0, 0, 0.5)"},xht={background:"rgba(255, 255, 255, 0.4)",hoverBackground:"rgba(255, 255, 255, 0.6)",activeBackground:"rgba(255, 255, 255, 0.9)"},wht={size:"3rem",gutter:"0.5rem",background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.50}",hoverColor:"{surface.0}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Cht={size:"1.5rem"},Sht={light:{thumbnailNavButton:{hoverBackground:"{surface.100}",color:"{surface.600}",hoverColor:"{surface.700}"},indicatorButton:{background:"{surface.200}",hoverBackground:"{surface.300}"}},dark:{thumbnailNavButton:{hoverBackground:"{surface.700}",color:"{surface.400}",hoverColor:"{surface.0}"},indicatorButton:{background:"{surface.700}",hoverBackground:"{surface.600}"}}},_ht={root:lht,navButton:dht,navIcon:fht,thumbnailsContent:pht,thumbnailNavButton:hht,thumbnailNavButtonIcon:mht,caption:ght,indicatorList:vht,indicatorButton:yht,insetIndicatorList:bht,insetIndicatorButton:xht,closeButton:wht,closeButtonIcon:Cht,colorScheme:Sht},Eht={color:"{form.field.icon.color}"},kht={icon:Eht},Rht={color:"{form.field.float.label.color}",focusColor:"{form.field.float.label.focus.color}",invalidColor:"{form.field.float.label.invalid.color}",transitionDuration:"0.2s",positionX:"{form.field.padding.x}",top:"{form.field.padding.y}",fontSize:"0.75rem",fontWeight:"400"},Tht={paddingTop:"1.5rem",paddingBottom:"{form.field.padding.y}"},Dht={root:Rht,input:Tht},Aht={transitionDuration:"{transition.duration}"},Iht={icon:{size:"1.5rem"},mask:{background:"{mask.background}",color:"{mask.color}"}},Nht={position:{left:"auto",right:"1rem",top:"1rem",bottom:"auto"},blur:"8px",background:"rgba(255,255,255,0.1)",borderColor:"rgba(255,255,255,0.2)",borderWidth:"1px",borderRadius:"30px",padding:".5rem",gap:"0.5rem"},Pht={hoverBackground:"rgba(255,255,255,0.1)",color:"{surface.50}",hoverColor:"{surface.0}",size:"3rem",iconSize:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Mht={root:Aht,preview:Iht,toolbar:Nht,action:Pht},Oht={size:"15px",hoverSize:"30px",background:"rgba(255,255,255,0.3)",hoverBackground:"rgba(255,255,255,0.3)",borderColor:"unset",hoverBorderColor:"unset",borderWidth:"0",borderRadius:"50%",transitionDuration:"{transition.duration}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"rgba(255,255,255,0.3)",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Fht={handle:Oht},$ht={padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",gap:"0.5rem"},Bht={fontWeight:"500"},Lht={size:"1rem"},Wht={light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}}},Uht={root:$ht,text:Bht,icon:Lht,colorScheme:Wht},zht={padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{transition.duration}"},Vht={hoverBackground:"{content.hover.background}",hoverColor:"{content.hover.color}"},Hht={root:zht,display:Vht},Ght={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},qht={borderRadius:"{border.radius.sm}"},jht={light:{chip:{focusBackground:"{surface.200}",color:"{surface.800}"}},dark:{chip:{focusBackground:"{surface.700}",color:"{surface.0}"}}},Kht={root:Ght,chip:qht,colorScheme:jht},Xht={background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.icon.color}",borderRadius:"{form.field.border.radius}",padding:"0.5rem",minWidth:"2.5rem"},Yht={addon:Xht},Qht={transitionDuration:"{transition.duration}"},Jht={width:"2.5rem",borderRadius:"{form.field.border.radius}",verticalPadding:"{form.field.padding.y}"},Zht={light:{button:{background:"transparent",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.500}",activeColor:"{surface.600}"}},dark:{button:{background:"transparent",hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.300}",activeColor:"{surface.200}"}}},tmt={root:Qht,button:Jht,colorScheme:Zht},emt={gap:"0.5rem"},nmt={width:"2.5rem",sm:{width:"2rem"},lg:{width:"3rem"}},rmt={root:emt,input:nmt},omt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},amt={root:omt},imt={transitionDuration:"{transition.duration}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},smt={background:"{primary.color}"},umt={background:"{content.border.color}"},cmt={color:"{text.muted.color}"},lmt={root:imt,value:smt,range:umt,text:cmt},dmt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",borderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",shadow:"{form.field.shadow}",borderRadius:"{form.field.border.radius}",transitionDuration:"{form.field.transition.duration}"},fmt={padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},pmt={focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},hmt={background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},mmt={color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},gmt={padding:"{list.option.padding}"},vmt={light:{option:{stripedBackground:"{surface.50}"}},dark:{option:{stripedBackground:"{surface.900}"}}},ymt={root:dmt,list:fmt,option:pmt,optionGroup:hmt,checkmark:mmt,emptyMessage:gmt,colorScheme:vmt},bmt={background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",verticalOrientation:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},horizontalOrientation:{padding:"0.5rem 0.75rem",gap:"0.5rem"},transitionDuration:"{transition.duration}"},xmt={borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},wmt={focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},Cmt={padding:"0",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",shadow:"{overlay.navigation.shadow}",gap:"0.5rem"},Smt={padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},_mt={padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background.}",color:"{navigation.submenu.label.color}"},Emt={size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},kmt={borderColor:"{content.border.color}"},Rmt={borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Tmt={root:bmt,baseItem:xmt,item:wmt,overlay:Cmt,submenu:Smt,submenuLabel:_mt,submenuIcon:Emt,separator:kmt,mobileButton:Rmt},Dmt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},Amt={padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},Imt={focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},Nmt={padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background}",color:"{navigation.submenu.label.color}"},Pmt={borderColor:"{content.border.color}"},Mmt={root:Dmt,list:Amt,item:Imt,submenuLabel:Nmt,separator:Pmt},Omt={background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.5rem 0.75rem",transitionDuration:"{transition.duration}"},Fmt={borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},$mt={focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},Bmt={padding:"{navigation.list.padding}",gap:"{navigation.list.gap}",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",mobileIndent:"1rem",icon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"}},Lmt={borderColor:"{content.border.color}"},Wmt={borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Umt={root:Omt,baseItem:Fmt,item:$mt,submenu:Bmt,separator:Lmt,mobileButton:Wmt},zmt={borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},Vmt={padding:"0.5rem 0.75rem",gap:"0.5rem",sm:{padding:"0.375rem 0.625rem"},lg:{padding:"0.625rem 0.875rem"}},Hmt={fontSize:"1rem",fontWeight:"500",sm:{fontSize:"0.875rem"},lg:{fontSize:"1.125rem"}},Gmt={size:"1.125rem",sm:{size:"1rem"},lg:{size:"1.25rem"}},qmt={width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},jmt={size:"1rem",sm:{size:"0.875rem"},lg:{size:"1.125rem"}},Kmt={root:{borderWidth:"1px"}},Xmt={content:{padding:"0"}},Ymt={light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}},outlined:{color:"{blue.600}",borderColor:"{blue.600}"},simple:{color:"{blue.600}"}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}},outlined:{color:"{green.600}",borderColor:"{green.600}"},simple:{color:"{green.600}"}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}},outlined:{color:"{yellow.600}",borderColor:"{yellow.600}"},simple:{color:"{yellow.600}"}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}},outlined:{color:"{red.600}",borderColor:"{red.600}"},simple:{color:"{red.600}"}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}},outlined:{color:"{surface.500}",borderColor:"{surface.500}"},simple:{color:"{surface.500}"}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}},outlined:{color:"{surface.950}",borderColor:"{surface.950}"},simple:{color:"{surface.950}"}}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}},outlined:{color:"{blue.500}",borderColor:"{blue.500}"},simple:{color:"{blue.500}"}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}},outlined:{color:"{green.500}",borderColor:"{green.500}"},simple:{color:"{green.500}"}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}},outlined:{color:"{yellow.500}",borderColor:"{yellow.500}"},simple:{color:"{yellow.500}"}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}},outlined:{color:"{red.500}",borderColor:"{red.500}"},simple:{color:"{red.500}"}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}},outlined:{color:"{surface.400}",borderColor:"{surface.400}"},simple:{color:"{surface.400}"}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}},outlined:{color:"{surface.0}",borderColor:"{surface.0}"},simple:{color:"{surface.0}"}}}},Qmt={root:zmt,content:Vmt,text:Hmt,icon:Gmt,closeButton:qmt,closeIcon:jmt,outlined:Kmt,simple:Xmt,colorScheme:Ymt},Jmt={borderRadius:"{content.border.radius}",gap:"1rem"},Zmt={background:"{content.border.color}",size:"0.5rem"},tgt={gap:"0.5rem"},egt={size:"0.5rem"},ngt={size:"1rem"},rgt={verticalGap:"0.5rem",horizontalGap:"1rem"},ogt={root:Jmt,meters:Zmt,label:tgt,labelMarker:egt,labelIcon:ngt,labelList:rgt},agt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},igt={width:"2.5rem",color:"{form.field.icon.color}"},sgt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},ugt={padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},cgt={focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",gap:"0.5rem"},lgt={background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},dgt={color:"{form.field.icon.color}"},fgt={borderRadius:"{border.radius.sm}"},pgt={padding:"{list.option.padding}"},hgt={root:agt,dropdown:igt,overlay:sgt,list:ugt,option:cgt,optionGroup:lgt,chip:fgt,clearIcon:dgt,emptyMessage:pgt},mgt={gap:"1.125rem"},ggt={gap:"0.5rem"},vgt={root:mgt,controls:ggt},ygt={gutter:"0.75rem",transitionDuration:"{transition.duration}"},bgt={background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{content.border.color}",color:"{content.color}",selectedColor:"{highlight.color}",hoverColor:"{content.hover.color}",padding:"0.75rem 1rem",toggleablePadding:"0.75rem 1rem 1.25rem 1rem",borderRadius:"{content.border.radius}"},xgt={background:"{content.background}",hoverBackground:"{content.hover.background}",borderColor:"{content.border.color}",color:"{text.muted.color}",hoverColor:"{text.color}",size:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},wgt={color:"{content.border.color}",borderRadius:"{content.border.radius}",height:"24px"},Cgt={root:ygt,node:bgt,nodeToggleButton:xgt,connector:wgt},Sgt={outline:{width:"2px",color:"{content.background}"}},_gt={root:Sgt},Egt={padding:"0.5rem 1rem",gap:"0.25rem",borderRadius:"{content.border.radius}",background:"{content.background}",color:"{content.color}",transitionDuration:"{transition.duration}"},kgt={background:"transparent",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}",width:"2.5rem",height:"2.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Rgt={color:"{text.muted.color}"},Tgt={maxWidth:"2.5rem"},Dgt={root:Egt,navButton:kgt,currentPageReport:Rgt,jumpToPageInput:Tgt},Agt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"},Igt={background:"transparent",color:"{text.color}",padding:"1.125rem",borderColor:"{content.border.color}",borderWidth:"0",borderRadius:"0"},Ngt={padding:"0.375rem 1.125rem"},Pgt={fontWeight:"600"},Mgt={padding:"0 1.125rem 1.125rem 1.125rem"},Ogt={padding:"0 1.125rem 1.125rem 1.125rem"},Fgt={root:Agt,header:Igt,toggleableHeader:Ngt,title:Pgt,content:Mgt,footer:Ogt},$gt={gap:"0.5rem",transitionDuration:"{transition.duration}"},Bgt={background:"{content.background}",borderColor:"{content.border.color}",borderWidth:"1px",color:"{content.color}",padding:"0.25rem 0.25rem",borderRadius:"{content.border.radius}",first:{borderWidth:"1px",topBorderRadius:"{content.border.radius}"},last:{borderWidth:"1px",bottomBorderRadius:"{content.border.radius}"}},Lgt={focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",gap:"0.5rem",padding:"{navigation.item.padding}",borderRadius:"{content.border.radius}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},Wgt={indent:"1rem"},Ugt={color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}"},zgt={root:$gt,panel:Bgt,item:Lgt,submenu:Wgt,submenuIcon:Ugt},Vgt={background:"{content.border.color}",borderRadius:"{content.border.radius}",height:".75rem"},Hgt={color:"{form.field.icon.color}"},Ggt={background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",padding:"{overlay.popover.padding}",shadow:"{overlay.popover.shadow}"},qgt={gap:"0.5rem"},jgt={light:{strength:{weakBackground:"{red.500}",mediumBackground:"{amber.500}",strongBackground:"{green.500}"}},dark:{strength:{weakBackground:"{red.400}",mediumBackground:"{amber.400}",strongBackground:"{green.400}"}}},Kgt={meter:Vgt,icon:Hgt,overlay:Ggt,content:qgt,colorScheme:jgt},Xgt={gap:"1.125rem"},Ygt={gap:"0.5rem"},Qgt={root:Xgt,controls:Ygt},Jgt={background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},Zgt={padding:"{overlay.popover.padding}"},tvt={root:Jgt,content:Zgt},evt={background:"{content.border.color}",borderRadius:"{content.border.radius}",height:"1.25rem"},nvt={background:"{primary.color}"},rvt={color:"{primary.contrast.color}",fontSize:"0.75rem",fontWeight:"600"},ovt={root:evt,value:nvt,label:rvt},avt={light:{root:{colorOne:"{red.500}",colorTwo:"{blue.500}",colorThree:"{green.500}",colorFour:"{yellow.500}"}},dark:{root:{colorOne:"{red.400}",colorTwo:"{blue.400}",colorThree:"{green.400}",colorFour:"{yellow.400}"}}},ivt={colorScheme:avt},svt={width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{width:"1rem",height:"1rem"},lg:{width:"1.5rem",height:"1.5rem"}},uvt={size:"0.75rem",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}",sm:{size:"0.5rem"},lg:{size:"1rem"}},cvt={root:svt,icon:uvt},lvt={gap:"0.25rem",transitionDuration:"{transition.duration}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},dvt={size:"1rem",color:"{text.muted.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"},fvt={root:lvt,icon:dvt},pvt={light:{root:{background:"rgba(0,0,0,0.1)"}},dark:{root:{background:"rgba(255,255,255,0.3)"}}},hvt={colorScheme:pvt},mvt={transitionDuration:"{transition.duration}"},gvt={size:"9px",borderRadius:"{border.radius.sm}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},vvt={light:{bar:{background:"{surface.100}"}},dark:{bar:{background:"{surface.800}"}}},yvt={root:mvt,bar:gvt,colorScheme:vvt},bvt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},xvt={width:"2.5rem",color:"{form.field.icon.color}"},wvt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},Cvt={padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},Svt={focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},_vt={background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},Evt={color:"{form.field.icon.color}"},kvt={color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},Rvt={padding:"{list.option.padding}"},Tvt={root:bvt,dropdown:xvt,overlay:wvt,list:Cvt,option:Svt,optionGroup:_vt,clearIcon:Evt,checkmark:kvt,emptyMessage:Rvt},Dvt={borderRadius:"{form.field.border.radius}"},Avt={light:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}},dark:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}}},Ivt={root:Dvt,colorScheme:Avt},Nvt={borderRadius:"{content.border.radius}"},Pvt={light:{root:{background:"{surface.200}",animationBackground:"rgba(255,255,255,0.4)"}},dark:{root:{background:"rgba(255, 255, 255, 0.06)",animationBackground:"rgba(255, 255, 255, 0.04)"}}},Mvt={root:Nvt,colorScheme:Pvt},Ovt={transitionDuration:"{transition.duration}"},Fvt={background:"{content.border.color}",borderRadius:"{content.border.radius}",size:"3px"},$vt={background:"{primary.color}"},Bvt={width:"20px",height:"20px",borderRadius:"50%",background:"{content.border.color}",hoverBackground:"{content.border.color}",content:{borderRadius:"50%",hoverBackground:"{content.background}",width:"16px",height:"16px",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.08), 0px 1px 1px 0px rgba(0, 0, 0, 0.14)"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Lvt={light:{handle:{content:{background:"{surface.0}"}}},dark:{handle:{content:{background:"{surface.950}"}}}},Wvt={root:Ovt,track:Fvt,range:$vt,handle:Bvt,colorScheme:Lvt},Uvt={gap:"0.5rem",transitionDuration:"{transition.duration}"},zvt={root:Uvt},Vvt={borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)"},Hvt={root:Vvt},Gvt={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",transitionDuration:"{transition.duration}"},qvt={background:"{content.border.color}"},jvt={size:"24px",background:"transparent",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Kvt={root:Gvt,gutter:qvt,handle:jvt},Xvt={transitionDuration:"{transition.duration}"},Yvt={background:"{content.border.color}",activeBackground:"{primary.color}",margin:"0 0 0 1.625rem",size:"2px"},Qvt={padding:"0.5rem",gap:"1rem"},Jvt={padding:"0",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},Zvt={color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},t0t={background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"},e0t={padding:"0.875rem 0.5rem 1.125rem 0.5rem"},n0t={background:"{content.background}",color:"{content.color}",padding:"0",indent:"1rem"},r0t={root:Xvt,separator:Yvt,step:Qvt,stepHeader:Jvt,stepTitle:Zvt,stepNumber:t0t,steppanels:e0t,steppanel:n0t},o0t={transitionDuration:"{transition.duration}"},a0t={background:"{content.border.color}"},i0t={borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},s0t={color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},u0t={background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"},c0t={root:o0t,separator:a0t,itemLink:i0t,itemLabel:s0t,itemNumber:u0t},l0t={transitionDuration:"{transition.duration}"},d0t={borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},f0t={background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},p0t={color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},h0t={height:"1px",bottom:"-1px",background:"{primary.color}"},m0t={root:l0t,tablist:d0t,item:f0t,itemIcon:p0t,activeBar:h0t},g0t={transitionDuration:"{transition.duration}"},v0t={borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},y0t={background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},b0t={background:"{content.background}",color:"{content.color}",padding:"0.875rem 1.125rem 1.125rem 1.125rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"inset {focus.ring.shadow}"}},x0t={background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",width:"2.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},w0t={height:"1px",bottom:"-1px",background:"{primary.color}"},C0t={light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}},S0t={root:g0t,tablist:v0t,tab:y0t,tabpanel:b0t,navButton:x0t,activeBar:w0t,colorScheme:C0t},_0t={transitionDuration:"{transition.duration}"},E0t={background:"{content.background}",borderColor:"{content.border.color}"},k0t={borderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},R0t={background:"{content.background}",color:"{content.color}"},T0t={background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}"},D0t={light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}},A0t={root:_0t,tabList:E0t,tab:k0t,tabPanel:R0t,navButton:T0t,colorScheme:D0t},I0t={fontSize:"0.875rem",fontWeight:"700",padding:"0.25rem 0.5rem",gap:"0.25rem",borderRadius:"{content.border.radius}",roundedBorderRadius:"{border.radius.xl}"},N0t={size:"0.75rem"},P0t={light:{primary:{background:"{primary.100}",color:"{primary.700}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.100}",color:"{green.700}"},info:{background:"{sky.100}",color:"{sky.700}"},warn:{background:"{orange.100}",color:"{orange.700}"},danger:{background:"{red.100}",color:"{red.700}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"color-mix(in srgb, {primary.500}, transparent 84%)",color:"{primary.300}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",color:"{green.300}"},info:{background:"color-mix(in srgb, {sky.500}, transparent 84%)",color:"{sky.300}"},warn:{background:"color-mix(in srgb, {orange.500}, transparent 84%)",color:"{orange.300}"},danger:{background:"color-mix(in srgb, {red.500}, transparent 84%)",color:"{red.300}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}},M0t={root:I0t,icon:N0t,colorScheme:P0t},O0t={background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.color}",height:"18rem",padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{form.field.border.radius}"},F0t={gap:"0.25rem"},$0t={margin:"2px 0"},B0t={root:O0t,prompt:F0t,commandResponse:$0t},L0t={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},W0t={root:L0t},U0t={background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},z0t={padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},V0t={focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},H0t={mobileIndent:"1rem"},G0t={size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},q0t={borderColor:"{content.border.color}"},j0t={root:U0t,list:z0t,item:V0t,submenu:H0t,submenuIcon:G0t,separator:q0t},K0t={minHeight:"5rem"},X0t={eventContent:{padding:"1rem 0"}},Y0t={eventContent:{padding:"0 1rem"}},Q0t={size:"1.125rem",borderRadius:"50%",borderWidth:"2px",background:"{content.background}",borderColor:"{content.border.color}",content:{borderRadius:"50%",size:"0.375rem",background:"{primary.color}",insetShadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"}},J0t={color:"{content.border.color}",size:"2px"},Z0t={event:K0t,horizontal:X0t,vertical:Y0t,eventMarker:Q0t,eventConnector:J0t},tyt={width:"25rem",borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},eyt={size:"1.125rem"},nyt={padding:"{overlay.popover.padding}",gap:"0.5rem"},ryt={gap:"0.5rem"},oyt={fontWeight:"500",fontSize:"1rem"},ayt={fontWeight:"500",fontSize:"0.875rem"},iyt={width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},syt={size:"1rem"},uyt={light:{blur:"1.5px",info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}}}},dark:{blur:"10px",info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",detailColor:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}}}}},cyt={root:tyt,icon:eyt,content:nyt,text:ryt,summary:oyt,detail:ayt,closeButton:iyt,closeIcon:syt,colorScheme:uyt},lyt={padding:"0.25rem",borderRadius:"{content.border.radius}",gap:"0.5rem",fontWeight:"500",disabledBackground:"{form.field.disabled.background}",disabledBorderColor:"{form.field.disabled.background}",disabledColor:"{form.field.disabled.color}",invalidBorderColor:"{form.field.invalid.border.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",padding:"0.25rem"},lg:{fontSize:"{form.field.lg.font.size}",padding:"0.25rem"}},dyt={disabledColor:"{form.field.disabled.color}"},fyt={padding:"0.25rem 0.75rem",borderRadius:"{content.border.radius}",checkedShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 1px 2px 0px rgba(0, 0, 0, 0.04)",sm:{padding:"0.25rem 0.75rem"},lg:{padding:"0.25rem 0.75rem"}},pyt={light:{root:{background:"{surface.100}",checkedBackground:"{surface.100}",hoverBackground:"{surface.100}",borderColor:"{surface.100}",color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}",checkedBorderColor:"{surface.100}"},content:{checkedBackground:"{surface.0}"},icon:{color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}"}},dark:{root:{background:"{surface.950}",checkedBackground:"{surface.950}",hoverBackground:"{surface.950}",borderColor:"{surface.950}",color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}",checkedBorderColor:"{surface.950}"},content:{checkedBackground:"{surface.800}"},icon:{color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}"}}},hyt={root:lyt,icon:dyt,content:fyt,colorScheme:pyt},myt={width:"2.5rem",height:"1.5rem",borderRadius:"30px",gap:"0.25rem",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},borderWidth:"1px",borderColor:"transparent",hoverBorderColor:"transparent",checkedBorderColor:"transparent",checkedHoverBorderColor:"transparent",invalidBorderColor:"{form.field.invalid.border.color}",transitionDuration:"{form.field.transition.duration}",slideDuration:"0.2s"},gyt={borderRadius:"50%",size:"1rem"},vyt={light:{root:{background:"{surface.300}",disabledBackground:"{form.field.disabled.background}",hoverBackground:"{surface.400}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.0}",disabledBackground:"{form.field.disabled.color}",hoverBackground:"{surface.0}",checkedBackground:"{surface.0}",checkedHoverBackground:"{surface.0}",color:"{text.muted.color}",hoverColor:"{text.color}",checkedColor:"{primary.color}",checkedHoverColor:"{primary.hover.color}"}},dark:{root:{background:"{surface.700}",disabledBackground:"{surface.600}",hoverBackground:"{surface.600}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.400}",disabledBackground:"{surface.900}",hoverBackground:"{surface.300}",checkedBackground:"{surface.900}",checkedHoverBackground:"{surface.900}",color:"{surface.900}",hoverColor:"{surface.800}",checkedColor:"{primary.color}",checkedHoverColor:"{primary.hover.color}"}}},yyt={root:myt,handle:gyt,colorScheme:vyt},byt={background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.75rem"},xyt={root:byt},wyt={maxWidth:"12.5rem",gutter:"0.25rem",shadow:"{overlay.popover.shadow}",padding:"0.5rem 0.75rem",borderRadius:"{overlay.popover.border.radius}"},Cyt={light:{root:{background:"{surface.700}",color:"{surface.0}"}},dark:{root:{background:"{surface.700}",color:"{surface.0}"}}},Syt={root:wyt,colorScheme:Cyt},_yt={background:"{content.background}",color:"{content.color}",padding:"1rem",gap:"2px",indent:"1rem",transitionDuration:"{transition.duration}"},Eyt={padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.color}",hoverColor:"{text.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"},gap:"0.25rem"},kyt={color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}"},Ryt={borderRadius:"50%",size:"1.75rem",hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedHoverColor:"{primary.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Tyt={size:"2rem"},Dyt={margin:"0 0 0.5rem 0"},Ayt={root:_yt,node:Eyt,nodeIcon:kyt,nodeToggleButton:Ryt,loadingIcon:Tyt,filter:Dyt},Iyt={background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledHoverBackground:"{form.field.filled.hover.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",invalidPlaceholderColor:"{form.field.invalid.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"{form.field.sm.font.size}",paddingX:"{form.field.sm.padding.x}",paddingY:"{form.field.sm.padding.y}"},lg:{fontSize:"{form.field.lg.font.size}",paddingX:"{form.field.lg.padding.x}",paddingY:"{form.field.lg.padding.y}"}},Nyt={width:"2.5rem",color:"{form.field.icon.color}"},Pyt={background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},Myt={padding:"{list.padding}"},Oyt={padding:"{list.option.padding}"},Fyt={borderRadius:"{border.radius.sm}"},$yt={color:"{form.field.icon.color}"},Byt={root:Iyt,dropdown:Nyt,overlay:Pyt,tree:Myt,emptyMessage:Oyt,chip:Fyt,clearIcon:$yt},Lyt={transitionDuration:"{transition.duration}"},Wyt={background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},Uyt={background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{treetable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},zyt={fontWeight:"600"},Vyt={background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},Hyt={borderColor:"{treetable.border.color}",padding:"0.75rem 1rem",gap:"0.5rem"},Gyt={background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",padding:"0.75rem 1rem"},qyt={fontWeight:"600"},jyt={background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},Kyt={width:"0.5rem"},Xyt={width:"1px",color:"{primary.color}"},Yyt={color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",size:"0.875rem"},Qyt={size:"2rem"},Jyt={hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},Zyt={borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},tbt={borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},ebt={light:{root:{borderColor:"{content.border.color}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},bodyCell:{selectedBorderColor:"{primary.900}"}}},nbt={root:Lyt,header:Wyt,headerCell:Uyt,columnTitle:zyt,row:Vyt,bodyCell:Hyt,footerCell:Gyt,columnFooter:qyt,footer:jyt,columnResizer:Kyt,resizeIndicator:Xyt,sortIcon:Yyt,loadingIcon:Qyt,nodeToggleButton:Jyt,paginatorTop:Zyt,paginatorBottom:tbt,colorScheme:ebt},rbt={mask:{background:"{content.background}",color:"{text.muted.color}"},icon:{size:"2rem"}},obt={loader:rbt},abt=Object.defineProperty,ibt=Object.defineProperties,sbt=Object.getOwnPropertyDescriptors,QS=Object.getOwnPropertySymbols,ubt=Object.prototype.hasOwnProperty,cbt=Object.prototype.propertyIsEnumerable,JS=(e,t,n)=>t in e?abt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ZS,lbt=(ZS=((e,t)=>{for(var n in t||(t={}))ubt.call(t,n)&&JS(e,n,t[n]);if(QS)for(var n of QS(t))cbt.call(t,n)&&JS(e,n,t[n]);return e})({},Sdt),ibt(ZS,sbt({components:{accordion:Qlt,autocomplete:sdt,avatar:pdt,badge:xdt,blockui:Edt,breadcrumb:Ddt,button:Ndt,card:Bdt,carousel:Hdt,cascadeselect:Qdt,checkbox:tft,chip:ift,colorpicker:dft,confirmdialog:hft,confirmpopup:bft,contextmenu:kft,datatable:qft,dataview:Zft,datepicker:bpt,dialog:Ept,divider:Apt,dock:Ppt,drawer:Lpt,editor:Gpt,fieldset:Ypt,fileupload:oht,floatlabel:cht,galleria:_ht,iconfield:kht,iftalabel:Dht,image:Mht,imagecompare:Fht,inlinemessage:Uht,inplace:Hht,inputchips:Kht,inputgroup:Yht,inputnumber:tmt,inputotp:rmt,inputtext:amt,knob:lmt,listbox:ymt,megamenu:Tmt,menu:Mmt,menubar:Umt,message:Qmt,metergroup:ogt,multiselect:hgt,orderlist:vgt,organizationchart:Cgt,overlaybadge:_gt,paginator:Dgt,panel:Fgt,panelmenu:zgt,password:Kgt,picklist:Qgt,popover:tvt,progressbar:ovt,progressspinner:ivt,radiobutton:cvt,rating:fvt,ripple:hvt,scrollpanel:yvt,select:Tvt,selectbutton:Ivt,skeleton:Mvt,slider:Wvt,speeddial:zvt,splitbutton:Hvt,splitter:Kvt,stepper:r0t,steps:c0t,tabmenu:m0t,tabs:S0t,tabview:A0t,tag:M0t,terminal:B0t,textarea:W0t,tieredmenu:j0t,timeline:Z0t,toast:cyt,togglebutton:hyt,toggleswitch:yyt,toolbar:xyt,tooltip:Syt,tree:Ayt,treeselect:Byt,treetable:nbt,virtualscroller:obt}})));const rD=Q5($lt);rD.use(qlt,{theme:{preset:lbt}});rD.mount("#app")});export default dbt();
